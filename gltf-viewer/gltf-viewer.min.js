(()=>{async function e(e,t){if("img"===t)return await function(e){return new Promise(((t,n)=>{const r=new Image;r.crossOrigin="anonymous",r.onerror=()=>n(new Error(`Failed to load: ${e}`)),r.onload=()=>t(r),r.src=e}))}(e);const n=await fetch(e),r=await n.arrayBuffer();return new Uint8Array(r)}const t=new TextDecoder("utf-8");function n(e){return t.decode(e)}function r(e){return/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)}function a(e,t){return""===e?"":/^(https?:)?\/\//i.test(e)||r(e)?e:t+e}const i=1179937895;function o(e,t){const n=e[t.buffer];return n?new Uint8Array(n.buffer,n.byteOffset+(t.byteOffset||0),t.byteLength):new Uint8Array}const l=new Array(16);function s(e,t,n=0,r=0,a=e.length-n){for(let i=0;i<a;++i)t[r+i]=e[n+i];return t}function c(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}function f(e,t,n,r){const a=t.length/e,i=n.length/e;let o=0;l.length=a*i;for(let r=0;r<i;++r)for(let i=0;i<a;++i){o=0;for(let l=0;l<e;++l)o+=t[l*a+i]*n[r*e+l];l[r*a+i]=o}return s(l,r,0,0,l.length),r}function u(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n}function d(e=0,t=0,n=0,r=0){return[e,t,n,r]}function g(e,t,n=d()){return f(4,e,t,n)}function p(e=0,t=0,n=0){return[e,t,n]}function m(e,t,n=p()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]+t[r];return n}(e,t,n)}function b(e,t,n=p()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]-t[r];return n}(e,t,n)}function h(e,t,n=p()){return c(e,t,n)}function A(e){return Math.sqrt(u(e,e))}function x(e,t=p()){return c(e,1/(A(e)||1),t)}function T(e,t,n=p()){const r=e[2]*t[0]-t[2]*e[0],a=e[0]*t[1]-t[0]*e[1];return n[0]=e[1]*t[2]-t[1]*e[2],n[1]=r,n[2]=a,n}p(),d(),d();const v=4,F=0,y=1,S=32774,O=34962,w=34963,E=35040,_=35044,M=35048,U=1028,R=1029,N=2884,I=3042,C=2960,B=2929,L=32823,P=32926,k=2305,D=5120,G=5121,z=5122,V=5123,j=5124,W=5125,q=5126,H=6402,$=6407,K=6408,X=35632,J=35633,Z=519,Q=7680,Y=9728,ee=9984,te=9985,ne=9986,re=9987,ae=10240,ie=10241,oe=10242,le=10243,se=3553,ce=34067,fe=34069,ue=33984,de=33071,ge=36160,pe=36161,me=33189,be=34041,he=36064,Ae=36096,xe=33306,Te=0,ve=3314,Fe=3315,ye=3316,Se=6144,Oe=6403,we=32856,Ee=32857,_e=32877,Me=32878,Ue=32879,Re=32882,Ne=33640,Ie=33082,Ce=33083,Be=33190,Le=34892,Pe=34893,ke=35907,De=34894,Ge=34836,ze=34842,Ve=35866,je=35898,We=35899,qe=36208,He=36214,$e=36220,Ke=36226,Xe=36232,Je=36238,Ze=36244,Qe=36249,Ye=36012,et=36013,tt=36269,nt=34042,rt=35056,at=36008,it=36009,ot=5131,lt=33319,st=33320,ct=33321,ft=33323,ut=33325,dt=33326,gt=33327,pt=33328,mt=33329,bt=33330,ht=33331,At=33332,xt=33333,Tt=33334,vt=33335,Ft=33336,yt=33337,St=33338,Ot=33339,wt=33340,Et=36756,_t=36757,Mt=36759,Ut=35345,Rt=4294967295,Nt=34046,It=34047,Ct={Index:16,Vertex:32,Uniform:64,Dynamic:4096,Stream:8192},Bt={TextureBinding:4,RenderAttachment:16},Lt={Red:1,Green:2,Blue:4,Alpha:8,All:15},Pt={R8:ct,R8SNORM:Et,R8UI:bt,R8I:mt,R16UI:At,R16I:ht,RG8:ft,RG8SNORM:_t,RG8UI:Ft,RG8I:vt,R32UI:Tt,R32I:xt,RG16UI:St,RG16I:yt,RGBA8:we,SRGBA8:ke,RGBA8SNORM:Mt,RGBA8UI:$e,RGBA8I:Je,RGB10A2:Ee,RG32UI:wt,RG32I:Ot,RGBA16UI:He,RGBA16I:Xe,RGBA32UI:qe,RGBA32I:Ke,R16F:ut,RG16F:gt,RG11B10F:je,RGBA16F:ze,R32F:dt,RG32F:pt,RGBA32F:Ge,Depth16:me,Depth24:Be,Depth24Stencil8:rt,Depth32F:Ye,Depth32FStencil8:et},kt={Nearest:Y,Linear:9729},Dt={Never:512,Less:513,Equal:514,LessEqual:515,Greater:516,NotEqual:517,GreaterEqual:518,Always:Z},Gt={Vertex:1,Fragment:2},zt={Points:0,Lines:1,LineStrip:3,Triangles:v,TriangleStrip:5},Vt={UInt16:V,UInt32:W},jt={None:Te,Front:U,Back:R},Wt={Zero:F,One:y,Src:768,OneMinusSrc:769,SrcAlpha:770,OneMinusSrcAlpha:771,Dst:774,OneMinusDst:775,DstAlpha:772,OneMinusDstAlpha:773,SrcAlphaSaturated:776,Constant:32769,OneMinusConstant:32770},qt={UI8x2:274,UI8x4:276,I8x2:4370,I8x4:4372,UNORM8x2:8466,UNORM8x4:8468,SNORM8x2:12562,SNORM8x4:12564,UI16x2:290,UI16x4:292,I16x2:4386,I16x4:4388,UNORM16x2:8482,UNORM16x4:8484,SNORM16x2:12578,SNORM16x4:12580,F16x2:546,F16x4:548,F32:577,F32x2:578,F32x3:579,F32x4:580},Ht={Buffer:0,Sampler:1,Texture:2};function $t(e){return e===Ue||e===Ve}function Kt(e){return 15&e}function Xt(e){switch(e>>4&511){case 36:return q;case 34:return ot;case 274:return z;case 273:return D;case 18:return V;case 17:return G}return Te}function Jt(e){return!!(e>>13)}function Zt(e){switch(e){case ct:case Et:case ut:case dt:return Oe;case bt:case mt:case At:case ht:case Tt:case xt:return Ze;case ft:case _t:case gt:case pt:return lt;case Ft:case vt:case St:case yt:case wt:case Ot:return st;case we:case ke:case Mt:case Ee:case ze:case Ge:return K;case $e:case Je:case He:case qe:case Xe:case Ke:return Qe;case je:return $;case me:case Be:case Ye:return H;case rt:case et:return be}return Te}function Qt(e){switch(e){case ct:case bt:case ft:case Ft:case we:case ke:case $e:return G;case Et:case mt:case _t:case vt:case Mt:case Je:return D;case At:case St:case He:return V;case ht:case yt:case Xe:return z;case Tt:case wt:case qe:return W;case xt:case Ot:case Ke:return j;case Ee:return Ne;case ut:case gt:case ze:return ot;case dt:case pt:case Ge:return q;case je:return We;case me:return V;case Be:return W;case rt:return nt;case Ye:return q;case et:return tt}return Te}function Yt(e){switch(e){case mt:case ht:case xt:case vt:case yt:case Ot:case Je:case Xe:case Ke:return j;case bt:case At:case Tt:case Ft:case St:case wt:case $e:case He:case qe:return W}return q}const en={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float",16:"OES_draw_buffers_indexed"},tn=4294967295;function nn(e={}){const t=e.primitive||{},n=e.depthStencil||{},{stencilFront:r={},stencilBack:a={}}=n,{sampleCount:i=1,alphaToCoverage:o=!1}=e.multisample||{},l=e.targets||{},s=l.targets&&l.targets.map((e=>rn(e.blendColor,e.blendAlpha,e.writeMask)))||[];return{sampleCount:i,alphaToCoverage:o,topology:t.topology||v,indexFormat:t.indexFormat||V,frontFace:t.frontFace||k,cullMode:t.cullMode||Te,depth:!!e.depthStencil,depthWrite:n.depthWrite||!1,depthFormat:n.format||me,depthCompare:n.depthCompare||Z,depthBias:n.depthBias||0,depthBiasSlopeScale:n.depthBiasSlopeScale||0,stencil:!(!n.stencilFront&&!n.stencilBack),stencilFrontCompare:r.compare||Z,stencilFrontFailOp:r.failOp||Q,stencilFrontDepthFailOp:r.depthFailOp||Q,stencilFrontPassOp:r.passOp||Q,stencilBackCompare:a.compare||Z,stencilBackFailOp:a.failOp||Q,stencilBackDepthFailOp:a.depthFailOp||Q,stencilBackPassOp:a.passOp||Q,stencilReadMask:n.stencilReadMask||tn,stencilWriteMask:n.stencilWriteMask||tn,blend:!!e.targets,drawBuffers:s,...rn(l.blendColor,l.blendAlpha,l.writeMask)}}function rn(e={},t={},n=Lt.All){return{blendWriteMask:n,blendColorOp:e.operation||S,blendColorSrcFactor:void 0!==e.srcFactor?e.srcFactor:y,blendColorDstFactor:e.dstFactor||F,blendAlphaOp:t.operation||S,blendAlphaSrcFactor:void 0!==t.srcFactor?t.srcFactor:y,blendAlphaDstFactor:t.dstFactor||F}}function an(e,t,n,r,a=0,i=!1){let o=!1,l=0,s=0,c=0,f=0;if(l=r.frontFace,(i||n.frontFace!==l)&&e.frontFace(l),l=r.cullMode,(i||n.cullMode!==l)&&((o=l!==Te)&&e.cullFace(l),fn(e,N,o)),o=r.alphaToCoverage,(i||n.alphaToCoverage!==o)&&fn(e,P,o),o=!!r.depth,(i||n.depth!==o)&&fn(e,B,o),(i||o)&&(sn(e,n.depthWrite,r.depthWrite,i),l=r.depthCompare,(i||n.depthCompare!==l)&&e.depthFunc(l)),l=r.depthBiasSlopeScale,s=r.depthBias,(i||n.depthBiasSlopeScale!==l||n.depthBias!==s)&&(fn(e,L,!(!l&&!s)),e.polygonOffset(l,s)),o=!!r.stencil,(i||n.stencil!==o)&&fn(e,C,o),(i||o)&&(l=r.stencilReadMask,o=i||n.stencilReadMask!==l,s=r.stencilFrontCompare,(o||n.stencilFrontCompare!==s)&&e.stencilFuncSeparate(U,s,a,l),s=r.stencilBackCompare,(o||n.stencilBackCompare!==s)&&e.stencilFuncSeparate(R,s,a,l),l=r.stencilFrontFailOp,s=r.stencilFrontDepthFailOp,c=r.stencilFrontPassOp,(i||n.stencilFrontFailOp!==l||n.stencilFrontDepthFailOp!==s||n.stencilFrontPassOp!==c)&&e.stencilOpSeparate(U,l,s,c),l=r.stencilBackFailOp,s=r.stencilBackDepthFailOp,c=r.stencilBackPassOp,(i||n.stencilBackFailOp!==l||n.stencilBackDepthFailOp!==s||n.stencilBackPassOp!==c)&&e.stencilOpSeparate(R,l,s,c),cn(e,n.stencilWriteMask,r.stencilWriteMask,i)),o=r.blend,(i||n.blend!==o)&&fn(e,I,o),(i||o)&&(l=r.blendColorSrcFactor,s=r.blendColorDstFactor,c=r.blendAlphaSrcFactor,f=r.blendAlphaDstFactor,(i||n.blendColorSrcFactor!==l||n.blendColorDstFactor!==s||n.blendAlphaSrcFactor!==c||n.blendAlphaDstFactor!==f)&&e.blendFuncSeparate(l,s,c,f),l=r.blendColorOp,s=r.blendAlphaOp,(i||n.blendColorOp!==l||n.blendAlphaOp!==s)&&e.blendEquationSeparate(l,s),ln(e,n.blendWriteMask,r.blendWriteMask,i),t))for(let e=0;e<r.drawBuffers.length;++e)on(t,e,r,r.drawBuffers[e])}function on(e,t,n,r,a=!1){let i=0,o=0,l=0,s=0;i=r.blendColorSrcFactor,o=r.blendColorDstFactor,l=r.blendAlphaSrcFactor,s=r.blendAlphaDstFactor,(a||n.blendColorSrcFactor!==i||n.blendColorDstFactor!==o||n.blendAlphaSrcFactor!==l||n.blendAlphaDstFactor!==s)&&e.blendFuncSeparateiOES(t,i,o,l,s),i=r.blendColorOp,o=r.blendAlphaOp,(a||n.blendColorOp!==i||n.blendAlphaOp!==o)&&e.blendEquationSeparateiOES(t,i,o),function(e,t,n,r,a=!1){(a||n!==r)&&e.colorMaskiOES(t,!!(r&Lt.Red),!!(r&Lt.Green),!!(r&Lt.Blue),!!(r&Lt.Alpha))}(e,t,n.blendWriteMask,r.blendWriteMask,a)}function ln(e,t,n,r=!1){(r||t!==n)&&e.colorMask(!!(n&Lt.Red),!!(n&Lt.Green),!!(n&Lt.Blue),!!(n&Lt.Alpha))}function sn(e,t,n,r=!1){(r||t!==n)&&e.depthMask(n)}function cn(e,t,n,r=!1){(r||t!==n)&&e.stencilMask(n)}function fn(e,t,n){n?e.enable(t):e.disable(t)}function un(e,t,{texture:n,slice:r=0,mipLevel:a=0}){if($t(n.type))e.framebufferTextureLayer(ge,t,n.glt,a,r);else{const i=n.type===ce?fe+r:n.type;e.framebufferTexture2D(ge,t,i,n.glt,a)}}function dn(e,t,n){const r=e.createFramebuffer();return e.bindFramebuffer(ge,r),un(e,t,n),r}function gn(e,t,n,r,a,i=he){e.bindFramebuffer(at,t),e.bindFramebuffer(it,n),e.readBuffer(i),e.blitFramebuffer(0,0,r.width,r.height,0,0,r.width,r.height,a,Y)}function pn(e,t,n){e.bindBuffer(O,t.glb);for(let r=0;r<t.attributes.length;++r){const{ptr:a,step:i}=t.attributes[r],o=[...a];o[5]+=n,e.vertexAttribPointer(...o),e.vertexAttribDivisor(a[0],i)}}const mn=new FinalizationRegistry((({finalizer:e,gl:t})=>e(t)));function bn(e,t){const n=t.usage&Ct.Uniform?Ut:t.usage&Ct.Index?w:O,r=t.usage&Ct.Stream?E:t.usage&Ct.Dynamic?M:_,a=e.gl.createBuffer();e.gl.bindBuffer(n,a),e.gl.bufferData(n,t.size,r);const i=e=>{e.deleteBuffer(a)},o={gl:e.gl,glb:a,type:n,size:t.size,destroy(){i(this.gl)}};return mn.register(o,{finalizer:i,gl:e.gl}),o}function hn(e,t){const n=t.sampleCount||1,r=t.dimension||se,a=t.format||we,i=!function(e){switch(e){case me:case Be:case rt:case Ye:case et:return!0}return!1}(a)||(t.usage||0)&Bt.TextureBinding,[o,l,s]=t.size||[1,1,1],c=r===ce?6:r===se?1:s;let f=null,u=null;(n>1||!i)&&(u=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(pe,u),n>1?e.gl.renderbufferStorageMultisample(pe,n,a,o,l):e.gl.renderbufferStorage(pe,a,o,l)),i&&(f=e.gl.createTexture(),e.gl.activeTexture(ue),e.gl.bindTexture(r,f),$t(r)?e.gl.texStorage3D(r,t.mipLevelCount||1,a,o,l,c):e.gl.texStorage2D(r,t.mipLevelCount||1,a,o,l));const d=e=>{e.deleteTexture(f),e.deleteRenderbuffer(u)},g={gl:e.gl,glt:f,glrb:u,type:r,format:a,width:o,height:l,depth:c,samples:n,destroy(){d(this.gl)}};return mn.register(g,{finalizer:d,gl:e.gl}),g}function An(e,t={}){const n=e.gl.createSampler();let r=t.minFilter||Y;t.mipmapFilter&&(r=t.mipmapFilter===Y?r===Y?ee:te:r===Y?ne:re),e.gl.samplerParameteri(n,ie,r),e.gl.samplerParameteri(n,ae,t.magFilter||Y),e.gl.samplerParameteri(n,oe,t.addressModeU||de),e.gl.samplerParameteri(n,le,t.addressModeV||de),e.gl.samplerParameteri(n,Re,t.addressModeW||de),e.gl.samplerParameterf(n,Ce,void 0!==t.lodMaxClamp?t.lodMaxClamp:32),e.gl.samplerParameterf(n,Ie,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(n,Le,De),e.gl.samplerParameterf(n,Pe,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(n,Nt,Math.min(t.maxAnisotropy||1,e.gl.getParameter(It)));const a=e=>{e.deleteSampler(n)},i={gls:n,gl:e.gl,destroy(){a(this.gl)}};return mn.register(i,{finalizer:a,gl:e.gl}),i}function xn(e,t){const n=t.usage===Gt.Vertex?J:X,r=e.gl.createShader(n);e.gl.shaderSource(r,t.code),e.gl.compileShader(r);const a=e=>{e.deleteShader(r)},i={gl:e.gl,gls:r,destroy(){a(this.gl)}};return mn.register(i,{finalizer:a,gl:e.gl}),i}function Tn(e,t={}){let n=null;const r=[],a=t.depthStencil?t.depthStencil.texture:null,i=a&&function(e){switch(e){case rt:case et:return!0}return!1}(a.format)||!1;if(t.colors&&t.colors.length){n=e.gl.createFramebuffer(),e.gl.bindFramebuffer(ge,n);for(let n=0;n<t.colors.length;++n)t.colors[n].view.texture.samples>1?e.gl.framebufferRenderbuffer(ge,he+n,pe,t.colors[n].view.texture.glrb):un(e.gl,he+n,t.colors[n].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>he+t))),a&&(a.glrb?e.gl.framebufferRenderbuffer(ge,i?xe:Ae,pe,a.glrb):un(e.gl,i?xe:Ae,t.depthStencil));for(let n=0;n<t.colors.length;++n)r.push(t.colors[n].view.texture.samples>1?dn(e.gl,he,t.colors[n].view):null);r.push(a&&a.samples>1&&a.glt?dn(e.gl,i?xe:Ae,t.depthStencil):null)}const o=e=>{e.deleteFramebuffer(n);for(const t of r)e.deleteFramebuffer(t)},l={gl:e.gl,glfb:n,glrfb:r,depth:a,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){o(this.gl)}};return mn.register(l,{finalizer:o,gl:e.gl}),l}function vn(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function Fn(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function yn(e,t,n,r=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,r,n)}function Sn(e,{texture:t,mipLevel:n=0,origin:[r,a,i]=[0,0,0]},o,{offset:l=0,bytesPerRow:s,rowsPerImage:c=0},[f,u,d]=[t.width-r,t.height-a,t.depth-i]){const g=Zt(t.format),p=Qt(t.format),m=t.type===ce,b=m?fe+i:t.type;e.gl.activeTexture(ue),e.gl.bindTexture(t.type,t.glt);const h=function(e){switch(e){case ct:case bt:case Et:case mt:return 1;case At:case ht:case ft:case Ft:case _t:case vt:case ut:return 2;case Tt:case xt:case dt:case St:case yt:case gt:case we:case ke:case $e:case Mt:case Je:case Ee:case je:return 4;case wt:case Ot:case pt:case He:case Xe:case ze:return 8;case qe:case Ke:case Ge:return 16;case me:return 2;case Be:case rt:case Ye:return 4;case et:return 8}return 0}(t.format),A=c||u,x=Math.floor(s/h),T=l-l%s;if(e.gl.pixelStorei(Me,A),e.gl.pixelStorei(ve,x),e.gl.pixelStorei(ye,Math.floor(l%s/h)),e.gl.pixelStorei(Fe,0),e.gl.pixelStorei(_e,0),$t(t.type))e.gl.texSubImage3D(b,n,r,a,i,f,u,d,t.format,p,o,T);else if(m)for(let t=i;t<i+d;++t)e.gl.pixelStorei(Fe,t*x*A),e.gl.texSubImage2D(b+t,n,r,a,f,u,g,p,o,T);else e.gl.texSubImage2D(b,n,r,a,f,u,g,p,o,T)}function On(e,t,n,r=0){const a=e.state.buffers[t];!a||a.glb===n.glb&&a.offset===r||(a.glb=n.glb,a.offset=r,a.instanceOffset=0,pn(e.gl,a,r))}function wn(e,t,n,r=[]){if(e.state.pipeline)for(let a=0,i=0;a<n.entries.length;++a){const o=n.entries[a],l=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][o.binding];if(l)if(o.buffer){let t=o.bufferOffset||0;l.bufferDynamicOffset&&(t+=r[i]||0,++i),e.gl.bindBufferRange(Ut,l.slot,o.buffer.glb,t,o.bufferSize||o.buffer.size-t)}else o.texture?(e.gl.activeTexture(ue+l.slot),e.gl.bindTexture(o.texture.type,o.texture.glt),e.gl.uniform1i(l.loc,l.slot)):o.sampler&&e.gl.bindSampler(l.slot,o.sampler.gls)}}const En=[1,0,0,0,1,0,0,0,1],_n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Mn(e){for(let t=0;t<16;++t)e[t]=t%5?0:1;return e}function Un(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return f(4,e,t,n)}function Rn(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[5]-e[4]*e[1],r=e[0]*e[9]-e[8]*e[1],a=e[0]*e[13]-e[12]*e[1],i=e[4]*e[9]-e[8]*e[5],o=e[4]*e[13]-e[12]*e[5],l=e[8]*e[13]-e[12]*e[9],s=e[2]*e[7]-e[6]*e[3],f=e[2]*e[11]-e[10]*e[3],u=e[2]*e[15]-e[14]*e[3],d=e[6]*e[11]-e[10]*e[7],g=e[6]*e[15]-e[14]*e[7],p=e[10]*e[15]-e[14]*e[11],m=n*p-r*g+a*d+i*u-o*f+l*s;return m?(_n[0]=+e[5]*p-e[9]*g+e[13]*d,_n[1]=-e[1]*p+e[9]*u-e[13]*f,_n[2]=+e[1]*g-e[5]*u+e[13]*s,_n[3]=-e[1]*d+e[5]*f-e[9]*s,_n[4]=-e[4]*p+e[8]*g-e[12]*d,_n[5]=+e[0]*p-e[8]*u+e[12]*f,_n[6]=-e[0]*g+e[4]*u-e[12]*s,_n[7]=+e[0]*d-e[4]*f+e[8]*s,_n[8]=+e[7]*l-e[11]*o+e[15]*i,_n[9]=-e[3]*l+e[11]*a-e[15]*r,_n[10]=+e[3]*o-e[7]*a+e[15]*n,_n[11]=-e[3]*i+e[7]*r-e[11]*n,_n[12]=-e[6]*l+e[10]*o-e[14]*i,_n[13]=+e[2]*l-e[10]*a+e[14]*r,_n[14]=-e[2]*o+e[6]*a-e[14]*n,_n[15]=+e[2]*i-e[6]*r+e[10]*n,function(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return c(e,t,n)}(_n,1/m,t)):null}const Nn="#version 300 es\nprecision highp float;\nlayout(std140)uniform Model{mat4 A,B,C;vec4 D;};layout(std140)uniform Morph{vec4 E[2];};uniform sampler2D jointTexture;layout(location=0)in vec3 F;out vec3 vPosition;out vec2 vTexCoord0,vTexCoord1;\n#ifdef USE_NORMAL\nlayout(location=1)in vec3 G;\n#ifdef USE_TANGENT\nlayout(location=2)in vec4 H;out mat3 vTBN;\n#else\nout vec3 vNormal;\n#endif\n#endif \n#ifdef USE_TEXCOORD_0\nlayout(location=3)in vec2 I;\n#endif\n#ifdef USE_TEXCOORD_1\nlayout(location=4)in vec2 J;\n#endif\n#ifdef USE_COLOR_0\nout vec4 vColor0;\n#if defined(COLOR_0_VEC3)\nlayout(location=5)in vec3 K;\n#else\nlayout(location=5)in vec4 K;\n#endif\n#endif \n#if defined(USE_WEIGHTS_0) && defined(USE_JOINTS_0)\n#define USE_SKIN \nlayout(location=6)in vec4 L;layout(location=7)in vec4 M;mat4 N(int O){return mat4(texelFetch(jointTexture,ivec2(0,O),0),texelFetch(jointTexture,ivec2(1,O),0),texelFetch(jointTexture,ivec2(2,O),0),texelFetch(jointTexture,ivec2(3,O),0));}mat4 P(){mat4 Q=M.x*N(int(L.x))+M.y*N(int(L.y))+M.z*N(int(L.z))+M.w*N(int(L.w));return Q;}\n#endif \n#if defined(USE_POSITION_0)\n#define USE_MORPH \n#ifdef USE_POSITION_0\nlayout(location=8)in vec3 R;\n#endif\n#ifdef USE_POSITION_1\nlayout(location=9)in vec3 S;\n#endif\n#if !defined(USE_TANGENT_0)\n#ifdef USE_POSITION_2\nlayout(location=10)in vec3 T;\n#endif\n#ifdef USE_POSITION_3\nlayout(location=11)in vec3 U;\n#endif\n#if !defined(USE_NORMAL_0)\n#ifdef USE_POSITION_4\nlayout(location=12)in vec3 V;\n#endif\n#ifdef USE_POSITION_5\nlayout(location=13)in vec3 W;\n#endif\n#ifdef USE_POSITION_6\nlayout(location=14)in vec3 X;\n#endif\n#ifdef USE_POSITION_7\nlayout(location=15)in vec3 Y;\n#endif\n#endif \n#endif \n#ifdef USE_NORMAL_0\nlayout(location=12)in vec3 Z;\n#endif\n#ifdef USE_NORMAL_1\nlayout(location=13)in vec3 a;\n#endif\n#if !defined(USE_TANGENT_0)\n#ifdef USE_NORMAL_2\nlayout(location=14)in vec3 b;\n#endif\n#ifdef USE_NORMAL_3\nlayout(location=15)in vec3 c;\n#endif\n#endif \n#ifdef USE_TANGENT_0\nlayout(location=14)in vec3 d;\n#endif\n#ifdef USE_TANGENT_1\nlayout(location=15)in vec3 e;\n#endif\nvec3 f(){vec3 g=vec3(0.);\n#ifdef USE_POSITION_0\ng+=E[0].x*R;\n#endif\n#ifdef USE_POSITION_1\ng+=E[0].y*S;\n#endif\n#ifdef USE_POSITION_2\ng+=E[0].z*T;\n#endif\n#ifdef USE_POSITION_3\ng+=E[0].w*U;\n#endif\n#ifdef USE_POSITION_4\ng+=E[1].x*V;\n#endif\n#ifdef USE_POSITION_5\ng+=E[1].y*W;\n#endif\n#ifdef USE_POSITION_6\ng+=E[1].z*X;\n#endif\n#ifdef USE_POSITION_7\ng+=E[1].w*Y;\n#endif\nreturn g;}vec3 h(){vec3 g=vec3(0.);\n#ifdef USE_NORMAL_0\ng+=E[0].x*Z;\n#endif\n#ifdef USE_NORMAL_1\ng+=E[0].y*a;\n#endif\n#ifdef USE_NORMAL_2\ng+=E[0].z*b;\n#endif\n#ifdef USE_NORMAL_3\ng+=E[0].w*c;\n#endif\nreturn g;}vec3 i(){vec3 g=vec3(0.);\n#ifdef USE_TANGENT_0\ng+=E[0].x*d;\n#endif\n#ifdef USE_TANGENT_1\ng+=E[0].y*e;\n#endif\nreturn g;}\n#endif \nvec4 j(){vec4 k=vec4(F,1.);\n#ifdef USE_MORPH\nk+=vec4(f(),0.);\n#endif\n#ifdef USE_SKIN\nk=P()*k;\n#endif\nreturn k;}\n#ifdef USE_NORMAL\nvec3 l(){vec3 m=G;\n#ifdef USE_MORPH\nm+=h();\n#endif\n#ifdef USE_SKIN\nm=mat3(P())*m;\n#endif\nreturn normalize(m);}\n#ifdef USE_TANGENT\nvec3 n(){vec3 tan=H.xyz;\n#ifdef USE_MORPH\ntan+=i();\n#endif\n#ifdef USE_SKIN\ntan=mat3(P())*tan;\n#endif\nreturn normalize(tan);}\n#endif \n#endif \nvoid main(){vec4 k=A*j();vPosition=k.xyz/k.w;\n#ifdef USE_NORMAL\nmat3 o=mat3(B);\n#ifdef USE_TANGENT\nvec3 tan=n();vec3 p=normalize(o*l());vec3 q=normalize(o*tan);vec3 r=cross(p,q)*H.w;vTBN=mat3(q,r,p);\n#else\nvNormal=normalize(o*G);\n#endif \n#endif \n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\nvColor0=vec4(K,1.);\n#else\nvColor0=K;\n#endif\n#endif \nvTexCoord0=vec2(0.);vTexCoord1=vec2(0.);\n#ifdef USE_TEXCOORD_0\nvTexCoord0=I;\n#endif\n#ifdef USE_TEXCOORD_1\nvTexCoord1=J;\n#endif\ngl_Position=C*k;gl_PointSize=1.;}",In="#version 300 es\nprecision highp float;\nlayout(std140)uniform Model{mat4 A,B,C;vec4 D;};layout(std140)uniform Morph{vec4 E[2];};layout(std140)uniform Material{vec4 F;float G,H;float I,J;float K,L;float M,N;vec4 O;float P;};uniform sampler2D baseColorTexture;uniform sampler2D metallicRoughnessTexture;uniform sampler2D normalTexture;uniform sampler2D occlusionTexture;uniform sampler2D emissiveTexture;in vec3 vPosition;in vec2 vTexCoord0,vTexCoord1;\n#ifdef USE_COLOR_0\nin vec4 vColor0;\n#endif\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\nin mat3 vTBN;\n#else\nin vec3 vNormal;\n#endif\n#endif\nout vec4 fragColor;const float Q=2.2;const float R=3.141592653589793;vec3 S(vec3 T){return pow(T,vec3(1./Q));}vec2 U(float V){return mix(vTexCoord0,vTexCoord1,step(1.,V));}vec4 W(sampler2D X,float V){return texture(X,U(V));}vec4 W(sampler2D X,float V,vec4 Y){return mix(Y,texture(X,U(V)),step(0.,V));}vec3 Z(vec3 a,vec3 b,float c){return a+(b-a)*pow(clamp(1.-c,0.,1.),5.);}float d(float e,float f){float g=(f*f)*(e-1.)+1.;return e/(R*g*g);}float h(float e,float i,float j){float k=1./(i+sqrt(e+(1.-e)*(i*i)));float l=1./(j+sqrt(e+(1.-e)*(j*j)));return k*l;}float m(float e,float i,float j,float f){return h(e,i,j)*d(e,f);}vec3 n(vec3 T){return T/R;}vec4 o(){vec4 T=vec4(1.);\n#ifdef USE_COLOR_0\nT=vColor0;\n#endif\nreturn T;}vec4 p(){vec4 q=vec4(1.);q*=F;q*=W(baseColorTexture,I,vec4(1.));return q*o();}vec2 r(){vec4 s=W(metallicRoughnessTexture,J,vec4(1.));return vec2(clamp(G*s.b,0.,1.),clamp(H*s.g,.04,1.));}float t(){return W(occlusionTexture,N,vec4(1.)).r;}vec3 u(){return O.xyz*W(emissiveTexture,O.w,vec4(1.)).xyz;}struct v{vec3 ng;vec3 nn;vec3 t;vec3 b;};v w(vec3 x){vec3 y,t,b,ng;\n#ifdef USE_TANGENT\nt=normalize(vTBN[0]);b=normalize(vTBN[1]);ng=normalize(vTBN[2]);\n#else\n#ifdef USE_NORMAL\nng=normalize(vNormal);\n#else\nng=normalize(cross(dFdx(x),dFdy(x)));\n#endif\nvec2 z=U(L);vec3 AA=dFdx(vec3(z,0.));vec3 AB=dFdy(vec3(z,0.));vec3 AC=(AB.t*dFdx(x)-AA.t*dFdy(x))/(AA.s*AB.t-AB.s*AA.t);t=normalize(AC-ng*dot(ng,AC));b=cross(ng,t);\n#endif\nif(gl_FrontFacing==false){t*=-1.;b*=-1.;ng*=-1.;}y=ng;if(L>=0.){y=W(normalTexture,L).rgb*2.-vec3(1.);y*=vec3(K,K,1.);y=mat3(t,b,ng)*normalize(y);}v AD;AD.ng=ng;AD.t=t;AD.b=b;AD.nn=y;return AD;}\n#define LIGHT_DIRECTIONAL  0\n#define LIGHT_POINT  1\n#define LIGHT_SPOT  2\nint AE(mat4 AF){return int(AF[0].x);}vec2 AG(mat4 AF){return AF[0].zw;}vec4 AH(mat4 AF){return AF[1];}float AI(mat4 AF){return AF[2].w;}vec3 AJ(mat4 AF){return AF[2].xyz;}vec3 AK(mat4 AF){return AF[3].xyz;}float AL(float AM,float AN){if(AM<=0.){return 1./pow(AN,2.);}return max(min(1.-pow(AN/AM,4.),1.),0.)/pow(AN,2.);}float AO(vec3 AP,vec3 AQ,vec2 AR){float AS=dot(normalize(AQ),normalize(-AP));float AT=1./max(.001,AR[0]-AR[1]);float AU=-AR[1]*AT;float AV=clamp(AS*AT+AU,0.,1.);return AV*AV;}vec3 AW(mat4 AF,vec3 AX){return AE(AF)!=LIGHT_DIRECTIONAL?AK(AF)-AX:-AJ(AF);}vec3 AY(mat4 AF,vec3 AP){vec4 T=AH(AF);vec3 AZ=T.rgb*T.a;if(AE(AF)!=LIGHT_DIRECTIONAL){AZ*=AL(AI(AF),length(AP));}if(AE(AF)==LIGHT_SPOT){AZ*=AO(AP,AJ(AF),AG(AF));}return AZ;}void main(){vec4 q=p();\n#ifdef ALPHAMODE_OPAQUE\nq.a=1.;\n#endif\n#ifdef MATERIAL_UNLIT\ngl_FragColor=(vec4(S(q.rgb),q.a));return;\n#endif\nvec3 x=normalize(D.xyz-vPosition);v Aa=w(vPosition);vec3 y=Aa.nn;vec3 Ab=-normalize(reflect(x,y));float j=clamp(abs(dot(y,x)),0.001,1.);vec2 Ac=r();float Ad=Ac[0];float Ae=Ac[1];float Af=Ae*Ae;float e=Af*Af;vec3 Ag=vec3(0.04);vec3 Ah=q.rgb*(vec3(1.)-Ag)*(1.-Ad);vec3 Ai=mix(Ag,q.rgb,Ad);float a=max(max(Ai.r,Ai.g),Ai.b);float b=clamp(a*25.,0.,1.);vec3 Aj=Ai.rgb;vec3 Ak=vec3(1.,1.,1.)*b;vec3 Al=vec3(0.);vec3 Am=vec3(0.);\n#define NUM_LIGHTS  4\nmat4 An[4];An[0]=mat4(0.,0.,0.,0.,1.,1.,1.,1.,.5,-.707,-.5,0.,0.,0.,0.,0.);An[1]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,-.5,.707,.5,0.,0.,0.,0.,0.);An[2]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,.5,.707,-.5,0.,0.,0.,0.,0.);An[3]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,-.5,-.707,.5,0.,0.,0.,0.,0.);\n#ifdef NUM_LIGHTS\nfor(int Ao=0;Ao<NUM_LIGHTS;++Ao){vec3 AP=AW(An[Ao],vPosition);vec3 AZ=AY(An[Ao],AP);vec3 Ap=normalize(AP);vec3 Aq=normalize(Ap+x);float i=clamp(dot(y,Ap),0.001,1.);float f=clamp(dot(y,Aq),0.,1.);float c=clamp(dot(x,Aq),0.,1.);vec3 Ar=Z(Aj,Ak,c);vec3 As=(1.-Ar)*n(Ah);vec3 At=max(vec3(0.),Ar*m(e,i,j,f));Al+=AZ*i*As;Am+=AZ*i*At;}\n#endif\nvec4 Au=vec4(.1);vec3 Av=Au.rgb*n(Ah);Al+=Av;vec3 Aw=Al+Am;float Ax=t();Aw=mix(Aw,Aw*Ax,M);vec3 Ay=u();Aw+=Ay;\n#ifdef ALPHAMODE_MASK\nif(q.a<P){discard;}q.a=1.;\n#endif\nfragColor=vec4(S(Aw),q.a);}",Cn=1e-6,Bn=u,Ln=p(),Pn=p(),kn=p();function Dn(e,t,n,r=1/0,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const i=1/Math.tan(t/2);if(Mn(a),a[0]=i/e,a[5]=i,a[11]=-1,a[15]=0,isFinite(r)){const e=1/(n-r);a[10]=(n+r)*e,a[14]=2*n*r*e}else a[10]=-1,a[14]=-2*n;return a}function Gn(e,t,n=p(0,1,0),r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const a=b(e,t,Ln);x(a,a);const i=T(n,a,Pn);x(i,i);const o=T(a,i,kn);return x(o,o),s(i,r,0,0,3),s(o,r,0,4,3),s(a,r,0,8,3),s(e,r,0,12,3),r[3]=r[7]=r[11]=0,r[15]=1,r}const zn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Vn(e,t,n,r){const a=x(n),[i,o]=function(e,t,n,r){for(let n=0;n<3;++n)e[n]=1/0,t[n]=-1/0;const a=p(),i=p();let o=(r.nodes||[]).slice();for(;o.length>0;){const r=n.nodes?.[o.pop()];if(!r)continue;o=o.concat(r.children||[]);const l=n.meshes?.[r.mesh];if(l)for(const o of l.primitives){const l=n.accessors?.[o.attributes.POSITION];if(l){$n(a,i,l,r.extras?.model||zn);for(let n=0;n<3;++n)e[n]=Math.min(e[n],a[n]),t[n]=Math.max(t[n],i[n])}}}return[e,t]}(p(),p(),e,e.scenes[t]),l=Math.max(o[0]-i[0],o[1]-i[1]),s=Math.PI/4,c=s*r,f=l/2/Math.tan(s/2),u=l/2/Math.tan(c/2),d=Math.max(u,f);h(a,-1.2*d,a);const g=A(b(i,o)),T=d+6*g;let v=d-6*g;v=Math.max(v,T/1e4);const F=p();return m(i,o,F),h(F,.5,F),{model:Gn(a,F),proj:Dn(r,s,v,T)}}const jn=p(),Wn=p(),qn=p(),Hn=p();function $n(e,t,n,r){const a=[...n.min,1],i=[...n.max,1];g(r,a,a),g(r,i,i),s(a,jn,0,0,3),s(i,Wn,0,0,3),m(Wn,jn,qn),h(qn,.5,qn),b(Wn,qn,Hn);const o=A(Hn);for(let n=0;n<3;++n)e[n]=qn[n]-o,t[n]=qn[n]+o}const Kn=5120,Xn=5121,Jn=5122,Zn=5123,Qn=5125,Yn=5126,er=9984,tr=9985,nr=9986,rr=9987;function ar(e){return e.extras||(e.extras={}),e.extras}function ir(e,t){let n=ar(t).input||null;if(!n){const r=e.glTF.accessors?.[t.input];if(r){const{buffer:a,byteOffset:i=0}=sr(e,r);ar(t).input=n=new Float32Array(a.buffer,i+a.byteOffset,(a.byteLength-i)/4)}}return n}function or(e,t){let n=ar(t).output||null;if(!n){const r=e.glTF.accessors?.[t.output];if(r){const{buffer:a,byteOffset:i=0}=sr(e,r);let o=Float32Array;switch(r.componentType){case Kn:o=Int8Array;break;case Xn:o=Uint8Array;break;case Jn:case Zn:o=Uint16Array}ar(t).output=n=new o(a.buffer,i+a.byteOffset,(a.byteLength-i)/o.BYTES_PER_ELEMENT)}}return n}function lr(e){switch(e.type){case"VEC2":if(e.componentType===Yn)return qt.F32x2;if(e.componentType===Zn)return e.normalized?qt.UNORM16x2:qt.UI16x2;if(e.componentType===Xn)return e.normalized?qt.UNORM8x2:qt.UI8x2;break;case"VEC3":if(e.componentType===Yn)return qt.F32x3;break;case"VEC4":if(e.componentType===Yn)return qt.F32x4;if(e.componentType===Zn)return e.normalized?qt.UNORM16x4:qt.UI16x4;if(e.componentType===Xn)return e.normalized?qt.UNORM8x4:qt.UI8x4}return null}function sr(e,t){let n=ar(t).buffer,r=ar(t).byteOffset||0;if(n)return{buffer:n,byteOffset:r};const a=function(e){let t=0;switch(e.type){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":case"MAT2":t=4;break;case"MAT3":t=9;break;case"MAT4":t=16}let n=0;switch(e.componentType){case Kn:case Xn:n=1;break;case Jn:case Zn:n=2;break;case Qn:case Yn:n=4}return t*n}(t);let i=t.count*a;const o=e.glTF.bufferViews?.[t.bufferView];if(o){const l=cr(e,o),s=o.byteStride||1;r=(t.byteOffset||0)%s,i=t.count*(o.byteStride||a);const c=(t.byteOffset||0)-r;n=new Uint8Array(l.buffer,l.byteOffset+c,i)}if(t.sparse){const{count:o,indices:{bufferView:l,byteOffset:s=0,componentType:c},values:{bufferView:f,byteOffset:u=0}}=t.sparse,d=e.glTF.bufferViews?.[l],g=e.glTF.bufferViews?.[f];if(d&&g){const t=new Uint8Array(i);n&&t.set(n,r);const l=cr(e,d),f=cr(e,g),p=new(c===Xn?Uint8Array:c===Zn?Uint16Array:Uint32Array)(l.buffer,l.byteOffset+s,o),m=new Uint8Array(f.buffer,f.byteOffset+u,o*a);for(let e=0;e<o;++e){const n=p[e]*a;for(let r=0;r<a;++r)t[n+r]=m[e*a+r]}r=0,n=t}}return n?(ar(t).buffer=n,ar(t).byteOffset=r):n=new Uint8Array,{buffer:n,byteOffset:r}}function cr(e,t){let n=ar(t).buffer;if(!n){const r=e.buffers?.[t.buffer];n=r?new Uint8Array(r.buffer,r.byteOffset+(t.byteOffset||0),t.byteLength):new Uint8Array,ar(t).buffer=n}return n}const fr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ur=[0,0,0,1],dr=p(1,1,1),gr=p();function pr(e,t,n,r=null){const a=e.nodes?.[t];if(!a)return;r?.push(t);const i=ar(a),o=i.matrix=i.matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.matrix?function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){s(e,t)}(a.matrix,o):(a.rotation||a.scale||a.translation||i.rotation||i.scale||i.translation)&&function(e,t,n,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[0],r=e[0]*e[1],a=e[0]*e[2],i=e[1]*e[1],o=e[1]*e[2],l=e[2]*e[2],s=e[3]*e[0],c=e[3]*e[1],f=e[3]*e[2];t[0]=1-2*(i+l),t[1]=2*(r+f),t[2]=2*(a-c),t[4]=2*(r-f),t[5]=1-2*(n+l),t[6]=2*(o+s),t[8]=2*(a+c),t[9]=2*(o-s),t[10]=1-2*(n+i),t[3]=t[7]=t[11]=t[12]=t[13]=t[14]=0,t[15]=1}(e,t)}(t,r);for(let e=0;e<3;++e)for(let t=0;t<3;++t)r[4*e+t]*=n[e];s(e,r,0,12,3)}(i.translation||a.translation||gr,i.rotation||a.rotation||ur,i.scale||a.scale||dr,o);const l=i.model=Un(n,o,i.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(a.children)for(const t of a.children)pr(e,t,l,r)}function mr(e,t){const n=e.cameras?.[t.camera];if(n){const e=ar(t).model=ar(t).model||fr;ar(n).view=Rn(e,ar(n).view||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ar(n).translation=[e[12],e[13],e[14]]}}function br(e,t){const n=e.glTF.skins?.[t.skin];if(n){const r=n.joints.length,a=ar(t).jointMatrix=ar(t).jointMatrix||new Float32Array(16*r),i=function(e,t){let n=ar(t).inverseBindMatrices;if(!n){const r=e.glTF.accessors?.[t.inverseBindMatrices];if(r){const{buffer:a,byteOffset:i}=sr(e,r);n=new Float32Array(a.buffer,a.byteOffset+i,16*t.joints.length)}else n=new Float32Array(16*t.joints.length);ar(t).inverseBindMatrices=n}return n}(e,n);for(let o=0;o<r;++o){const r=e.glTF.nodes[n.joints[o]],l=new Float32Array(a.buffer,a.byteOffset+64*o,16),s=new Float32Array(i.buffer,i.byteOffset+64*o,16);Rn(ar(t).model||fr,l),Un(l,r&&ar(r).model||fr,l),Un(l,s,l)}}}function hr(e,t,n,r,a=0){const i=e.length;let o,l;if(r<=t)o=l=0;else if(r>=n)o=l=i-1;else{for((a>=i||e[a]>r)&&(a=0),o=a,l=o+1;l<i&&!(e[o]<=r&&e[l]>r);++o,++l);l=Math.min(l,i-1)}return[o,l]}function Ar(e,t,n,r,a,i,o,l){const c=t[r],f=t[a],u=(i-c)/(f-c),d=e.length,g=new Array(d);switch(o=r===a?"STEP":o){case"STEP":s(n,e,r*d,0,d);break;case"CUBICSPLINE":{const t=f-c,i=u*u,o=u*i;for(let l=0;l<d;++l)e[l]=(2*o-3*i+1)*n[(3*r+1)*d+l]+(o-2*i+u)*t*n[(3*r+2)*d+l]+(-2*o+3*i)*n[(3*a+1)*d+l]+(o-i)*t*n[3*a*d+l];break}default:if(l)s(n,e,r*d,0,d),s(n,g,a*d,0,d),function(e,t,n,r=[0,0,0,1]){let a=Bn(e,t),i=1;a<0&&(a*=-1,i=-1);let o=1-n,l=n;if(1-a>Cn){const e=Math.acos(a),t=Math.sin(e);o=Math.sin((1-n)*e)/t,l=Math.sin(n*e)/t}l*=i,r[0]=e[0]*o+t[0]*l,r[1]=e[1]*o+t[1]*l,r[2]=e[2]*o+t[2]*l,r[3]=e[3]*o+t[3]*l}(e,g,u,e);else for(let t=0;t<d;++t)e[t]=(1-u)*n[r*d+t]+u*n[a*d+t]}}const xr=["POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","JOINTS_0","WEIGHTS_0"],Tr=8,vr=["POSITION","NORMAL","TANGENT"],Fr=[8,12,14],yr=/(POSITION|NORMAL|TANGENT)_(\d+)/,Sr={addressModeU:10497,addressModeV:10497,magFilter:kt.Linear,minFilter:kt.Linear},Or=52,wr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Er=p(),_r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Mr(e,t,n,r,a){let i=!1,o=0,l=t.glTF.accessors?.[a.attributes.POSITION]?.count||0;if(!l)return;const c=function(e,t,n){let r=ar(n).pipeline;if(r)return r;const a=n.mode||zt.Triangles,i=t.glTF.materials?.[n.material];let o="OPAQUE",l=!1,s=!1;i&&(l=i.doubleSided||!1,o=i.alphaMode||o,s=!!i.extensions?.KHR_materials_unlit);const c=Ur(t,n),f=t.glTF.accessors?.[n.indices]?.componentType===Vt.UInt32?Vt.UInt32:Vt.UInt16,u=JSON.stringify([c,l,o,f,a,s]),d=ar(t.glTF).pipelines=ar(t.glTF).pipelines||{};if(r=d[u],r)return r;const g=[`ALPHAMODE_${o}`];for(const e of c)for(const t of e.attributes)g.push(`USE_${t.name}`),"COLOR_0"===t.name&&t.format===qt.F32x3&&g.push("COLOR_0_VEC3");s&&g.push("MATERIAL_UNLIT");const p=g.map((e=>`#define ${e}\n`)).join(""),m="#version 300 es\n",b=m+p+Nn.replace(m,""),h=m+p+In.replace(m,""),A=xn(e,{usage:Gt.Vertex,code:b}),x=xn(e,{usage:Gt.Fragment,code:h});return r=ar(n).pipeline=d[u]=function(e,t){const n=function(e,t,n){const r=e.gl.createProgram();return e.gl.attachShader(r,t),e.gl.attachShader(r,n),e.gl.linkProgram(r),r}(e,t.vertex.gls,t.fragment.gls),r=[],a={};let i=0,o=0;if(t.bindGroups){for(let l=0;l<t.bindGroups.length;++l){const s=t.bindGroups[l].entries;r.push([]);for(let t=0;t<s.length;++t){const c=s[t];let f=null,u=Rt;c.type===Ht.Buffer?(u=e.gl.getUniformBlockIndex(n,c.label),e.gl.uniformBlockBinding(n,u,i++)):c.type===Ht.Texture&&(f=e.gl.getUniformLocation(n,c.label),a[c.label]=o++),r[l][c.binding]={...c,loc:f,index:u,slot:c.type===Ht.Buffer?i-1:c.type===Ht.Texture?o-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const n=t.bindGroups[e].entries;for(let t=0;t<n.length;++t)n[t].type===Ht.Sampler&&a[n[t].label]&&(r[e][n[t].binding].slot=a[n[t].label])}}const l=e=>{e.deleteProgram(n)},s={gl:e.gl,glp:n,buffers:t.buffers,cache:r,state:nn(t),destroy(){l(this.gl)}};return mn.register(s,{finalizer:l,gl:e.gl}),s}(e,{vertex:A,fragment:x,buffers:c,bindGroups:[Pr(0,t.glTF),Lr(0,t.glTF)],primitive:{indexFormat:f,topology:a,cullMode:l?jt.None:jt.Back},depthStencil:{depthCompare:Dt.LessEqual,depthWrite:!("BLEND"===o)},targets:"BLEND"===o?{blendColor:{srcFactor:Wt.SrcAlpha,dstFactor:Wt.OneMinusSrcAlpha},blendAlpha:{srcFactor:Wt.One,dstFactor:Wt.OneMinusSrcAlpha}}:null}),A.destroy(),x.destroy(),r}(e,t,a);!function(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),an(e.gl,e.extDrawBuffersi,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const n=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)n[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let r=0;r<t.buffers.length;++r){const{attributes:a,stride:i,stepMode:o=0}=t.buffers[r],l=[];e.state.buffers[r]={glb:null,attributes:l,stride:i,step:o,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:s}of a)n[s]=(n[s]||0)+2,l.push({buffer:r,ptr:[s,Kt(e),Xt(e),Jt(e),i,t],step:o})}for(let t=0;t<n.length;++t)2===n[t]?e.gl.enableVertexAttribArray(t):1===n[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}(e,c),wn(e,0,function(e,t,n){const r=t.glTF.materials?.[n];if(r&&ar(r).bindGroup)return ar(r).bindGroup;if(!r&&ar(t.glTF).defaultMaterialBindGroup)return ar(t.glTF).defaultMaterialBindGroup;const a=new Float32Array(20);a[0]=a[1]=a[2]=a[3]=1,a[4]=1,a[5]=1,a[6]=a[7]=a[9]=a[11]=a[15]=-1,a[8]=1,a[10]=0,a[12]=a[13]=a[14]=0,a[16]=.5;const i=bn(e,{usage:Ct.Uniform,size:a.byteLength});r&&(ar(r).gpuBuffer=i);const o=[{binding:0,buffer:i},{binding:1,texture:Dr(e,t.glTF)},{binding:2,sampler:Gr(e,t.glTF)},{binding:3,texture:Dr(e,t.glTF)},{binding:4,sampler:Gr(e,t.glTF)},{binding:5,texture:Dr(e,t.glTF)},{binding:6,sampler:Gr(e,t.glTF)},{binding:7,texture:Dr(e,t.glTF)},{binding:8,sampler:Gr(e,t.glTF)},{binding:9,texture:Dr(e,t.glTF)},{binding:10,sampler:Gr(e,t.glTF)}];if(r){if(r.pbrMetallicRoughness){const n=r.pbrMetallicRoughness;n.baseColorFactor&&s(n.baseColorFactor,a,0,0,4),(n.metallicFactor||0===n.metallicFactor)&&(a[4]=n.metallicFactor),(n.roughnessFactor||0===n.roughnessFactor)&&(a[5]=n.roughnessFactor),n.baseColorTexture&&(o[1].texture=Nr(e,t,n.baseColorTexture.index,Pt.SRGBA8),o[2].sampler=Ir(e,t.glTF,n.baseColorTexture.index),a[6]=n.baseColorTexture.texCoord||0),n.metallicRoughnessTexture&&(o[3].texture=Nr(e,t,n.metallicRoughnessTexture.index),o[4].sampler=Ir(e,t.glTF,n.metallicRoughnessTexture.index),a[7]=n.metallicRoughnessTexture.texCoord||0)}r.normalTexture&&(o[5].texture=Nr(e,t,r.normalTexture.index),o[6].sampler=Ir(e,t.glTF,r.normalTexture.index),a[8]=r.normalTexture.scale??1,a[9]=r.normalTexture.texCoord||0),r.occlusionTexture&&(o[7].texture=Nr(e,t,r.occlusionTexture.index),o[8].sampler=Ir(e,t.glTF,r.occlusionTexture.index),a[10]=r.occlusionTexture.strength||0,a[11]=r.occlusionTexture.texCoord||0),r.emissiveFactor&&s(r.emissiveFactor,a,0,12,3),r.emissiveTexture&&(o[9].texture=Nr(e,t,r.emissiveTexture.index,Pt.SRGBA8),o[10].sampler=Ir(e,t.glTF,r.emissiveTexture.index),a[15]=r.emissiveTexture.texCoord||0),(r.alphaCutoff||0===r.alphaCutoff)&&(a[16]=r.alphaCutoff)}yn(e,i,a);const l=Fn(0,{layout:Pr(0,t.glTF),entries:o});return r?ar(r).bindGroup=l:ar(t.glTF).defaultMaterialBindGroup=l,l}(e,t,a.material)),wn(e,1,function(e,t,n,r){if(ar(n).modelBindGroup)return ar(n).modelBindGroup;const a=[{binding:0,buffer:Cr(e,n)},{binding:1,buffer:Br(e,t,n,r)},{binding:2,texture:kr(e,t,n)},{binding:3,sampler:zr(e,t)}];return ar(n).modelBindGroup=Fn(0,{layout:Lr(0,t),entries:a})}(e,t.glTF,n,r));const f=Ur(t,a);for(let n=0;n<f.length;++n){const r=f[n].attributes[0].name,i=yr.exec(r),o=Rr(e,t,i?a.targets[i[2]][i[1]]:a.attributes[r],Ct.Vertex);o&&On(e,n,o)}const u=t.glTF.accessors?.[a.indices];if(u){const n=Rr(e,t,a.indices,Ct.Index);n&&(function(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(w,e.state.index=t.glb)}(e,n),l=u.count,o=ar(u).byteOffset||0,i=!0)}i?function(e,t,n=1,r=0,a=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==a&&(t.instanceOffset=a,pn(e.gl,t,a*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,r*(e.state.state.indexFormat===V?2:4),n)}(e,l,1,o):function(e,t,n=1,r=0,a=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==a&&(t.instanceOffset=a,pn(e.gl,t,a*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,r,t,n)}(e,l)}function Ur(e,t){const n={},r=[];if(ar(t).bufferLayouts)return ar(t).bufferLayouts;function a(t){if(!t.sparse){const a=sr(e,t).buffer,i=`${t.bufferView},${a.byteOffset},${a.byteLength}`;if(i in n)return r[n[i]];n[i]=r.length}const a={attributes:[],stride:e.glTF.bufferViews?.[t.bufferView]?.byteStride||0};return r.push(a),a}for(let n=0;n<xr.length;++n){const r=e.glTF.accessors?.[t.attributes[xr[n]]];if(r){const e=lr(r);if(!e)continue;a(r).attributes.push({name:xr[n],format:e,shaderLocation:n,offset:ar(r).byteOffset||0})}}if(t.targets){const n=new Array(3);let r=Tr;for(let i=0;i<Math.min(t.targets.length,r);++i){let o=0;for(let r=0;r<vr.length;++r)(n[r]=e.glTF.accessors?.[t.targets[i][vr[r]]])&&++o;r=Tr/o|0;for(let e=0;e<vr.length;++e){const t=n[e];t&&a(t).attributes.push({name:`${vr[e]}_${i}`,format:qt.F32x3,shaderLocation:Fr[e]+i,offset:ar(t).byteOffset||0})}}}return ar(t).bufferLayouts=r,r}function Rr(e,t,n,r){const a=t.glTF.accessors?.[n];if(!a)return null;const i=r&Ct.Index&&a.componentType===Xn;if(a.sparse||i){let n=ar(a).gpuBuffer;if(!n){const o=sr(t,a);let l=o.buffer;if(i){const e=new Uint16Array(l.byteLength);for(let t=0;t<l.byteLength;++t)e[t]=l[o.byteOffset+t];l=ar(a).buffer=new Uint8Array(e.buffer,0,e.byteLength),ar(a).byteOffset=0}n=ar(a).gpuBuffer=bn(e,{usage:r,size:l.byteLength}),yn(e,n,l)}return n}const o=t.glTF.bufferViews?.[a.bufferView];if(!o)return null;const l=ar(o).gpuBuffers=ar(o).gpuBuffers||{},s=sr(t,a).buffer,c=`${s.byteOffset},${s.byteLength}`;return l[c]||(l[c]=bn(e,{usage:r,size:s.byteLength}),yn(e,l[c],s)),l[c]}function Nr(e,t,n,r=Pt.RGBA8){const a=t.glTF.textures?.[n],i=t.images?.[a?.source??-1];if(!a||!i)return Dr(e,t.glTF);let o=ar(a).texture;return o||(o=ar(a).texture=hn(e,{format:r,size:[i.width||1,i.height||1,1],usage:Bt.TextureBinding}),function(e,{src:t,origin:[n,r]=[0,0]},{texture:a,mipLevel:i=0,origin:[o,l,s]=[0,0,0]},[c,f]=[t.width-n,t.height-r]){const u=Qt(a.format),d=a.type===ce?fe+s:a.type;e.gl.activeTexture(ue),e.gl.bindTexture(a.type,a.glt),e.gl.pixelStorei(ye,n),e.gl.pixelStorei(Fe,r),e.gl.pixelStorei(_e,0),e.gl.pixelStorei(Me,0),$t(a.type)?e.gl.texSubImage3D(d,i,o,l,s,c,f,1,a.format,u,t):e.gl.texSubImage2D(d,i,o,l,c,f,Zt(a.format),u,t)}(e,{src:i},{texture:o})),o}function Ir(e,t,n){const r=t.textures?.[n],a=t.samplers?.[r?.sampler??-1];if(!a)return Gr(e,t);let i=ar(a).sampler;if(!i){const t={...Sr};switch(t.addressModeU=a.wrapS||t.addressModeU,t.addressModeV=a.wrapT||t.addressModeV,t.magFilter=a.magFilter||t.magFilter,a.minFilter){case er:t.minFilter=kt.Nearest,t.mipmapFilter=kt.Nearest;break;case nr:t.minFilter=kt.Nearest,t.mipmapFilter=kt.Linear;break;case tr:t.minFilter=kt.Linear,t.mipmapFilter=kt.Nearest;break;case rr:t.minFilter=kt.Linear,t.mipmapFilter=kt.Linear;break;default:t.minFilter=a.minFilter}i=ar(a).sampler=An(e,t)}return i}function Cr(e,t,n=null){let r=ar(t).modelBuffer;if(r||(r=ar(t).modelBuffer=bn(e,{usage:Ct.Uniform|Ct.Stream,size:4*Or})),n){const a=new Float32Array(n.buffer,0,16);s(ar(t).model||wr,a,0,0,16);const i=new Float32Array(n.buffer,64,16),o=function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){const n=function(e){return e[0]*+(e[4]*e[8]-e[7]*e[5])+e[3]*-(e[1]*e[8]-e[7]*e[2])+e[6]*+(e[1]*e[5]-e[4]*e[2])}(e);return n?(En[0]=+(e[4]*e[8]-e[7]*e[5]),En[1]=-(e[1]*e[8]-e[7]*e[2]),En[2]=+(e[1]*e[5]-e[4]*e[2]),En[3]=-(e[3]*e[8]-e[6]*e[5]),En[4]=+(e[0]*e[8]-e[6]*e[2]),En[5]=-(e[0]*e[5]-e[3]*e[2]),En[6]=+(e[3]*e[7]-e[6]*e[4]),En[7]=-(e[0]*e[7]-e[6]*e[1]),En[8]=+(e[0]*e[4]-e[3]*e[1]),function(e,t,n=[1,0,0,0,1,0,0,0,1]){return c(e,t,n)}(En,1/n,t)):null}(e,t)?function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t,n){let r=0;for(let e=0;e<3;++e)for(let a=e;a<3;++a)r=t[3*a+e],n[3*a+e]=t[3*e+a],n[3*e+a]=r;return n}(0,e,t)}(t,t):null}(function(e,t=[1,0,0,0,1,0,0,0,1]){for(let n=0;n<3;++n)for(let r=0;r<3;++r)t[3*n+r]=e[4*n+r];return t}(e,t),t)}(a);o?function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){for(let n=0;n<3;++n){for(let r=0;r<3;++r)t[4*n+r]=e[3*n+r];t[4*n+3]=0}t[12]=t[13]=t[14]=0,t[15]=1}(o,i):s(a,i,0,0,16),yn(e,r,n)}return r}function Br(e,t,n,r,a=!1){const i=ar(n).weights||n.weights||r.weights;if(!i)return function(e,t){let n=ar(t).morphBuffer;return n||(n=ar(t).morphBuffer=bn(e,{usage:Ct.Uniform,size:4*Tr})),n}(e,t);let o=ar(n).morphBuffer;if(o||(o=ar(n).morphBuffer=bn(e,{usage:Ct.Uniform|Ct.Stream,size:4*Tr})),a){const t=new Float32Array(Tr);s(i,t,0,0,Tr),yn(e,o,t)}return o}function Lr(e,t){let n=ar(t).modelLayout;return n||(n=ar(t).modelLayout=vn(0,{entries:[{binding:0,label:"Model",type:Ht.Buffer},{binding:1,label:"Morph",type:Ht.Buffer},{binding:2,label:"jointTexture",type:Ht.Texture},{binding:3,label:"jointTexture",type:Ht.Sampler}]})),n}function Pr(e,t){let n=ar(t).materialLayout;return n||(n=ar(t).materialLayout=vn(0,{entries:[{binding:0,label:"Material",type:Ht.Buffer},{binding:1,label:"baseColorTexture",type:Ht.Texture},{binding:2,label:"baseColorTexture",type:Ht.Sampler},{binding:3,label:"metallicRoughnessTexture",type:Ht.Texture},{binding:4,label:"metallicRoughnessTexture",type:Ht.Sampler},{binding:5,label:"normalTexture",type:Ht.Texture},{binding:6,label:"normalTexture",type:Ht.Sampler},{binding:7,label:"occlusionTexture",type:Ht.Texture},{binding:8,label:"occlusionTexture",type:Ht.Sampler},{binding:9,label:"emissiveTexture",type:Ht.Texture},{binding:10,label:"emissiveTexture",type:Ht.Sampler}]})),n}function kr(e,t,n,r=!1){const a=t.skins?.[n.skin];if(!a)return Dr(e,t);const i=a.joints.length;let o=ar(n).jointTexture;return o||(o=ar(n).jointTexture=hn(e,{size:[4,i,1],format:Pt.RGBA32F,usage:Bt.TextureBinding})),r&&Sn(e,{texture:o},ar(n).jointMatrix=ar(n).jointMatrix||new Float32Array(16*i),{bytesPerRow:64,rowsPerImage:i},[4,i,1]),o}function Dr(e,t){let n=ar(t).blankTexture;return n||(n=ar(t).blankTexture=hn(e,{usage:Bt.TextureBinding}),Sn(e,{texture:n},new Uint8Array([255,255,255,255]),{bytesPerRow:4}),n)}function Gr(e,t){let n=ar(t).defaultSampler;return n||(n=ar(t).defaultSampler=An(e,Sr)),n}function zr(e,t){let n=ar(t).jointSampler;return n||(n=ar(t).jointSampler=An(e,{})),n}const Vr=p(-1,-2,-2),jr=new URLSearchParams(window.location.search),Wr=document.querySelector("canvas"),qr=Wr.parentElement;let Hr=null,$r=0,Kr=0;const Xr=function(e,t={},n=0){const r=e.getContext("webgl2",t);if(r){let t=0;for(const e in en)n&+e&&r.getExtension(en[+e])&&(t|=+e);const a=16&t?r.getExtension(en[16]):null,i=function(e){const t=nn();e.blendColor(1,1,1,1),an(e,null,t,t,0,!0);const n=e.getParameter(34921);for(let t=0;t<n;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}(r),o=e=>{e.deleteFramebuffer(i.copyFrameBuffer)},l={canvas:e,gl:r,features:t,extDrawBuffersi:a,pass:null,state:i,destroy(){o(this.gl)}};return mn.register(l,{finalizer:o,gl:r}),l}return null}(Wr,{powerPreference:"low-power"}),Jr="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/63f026b2aa957d3e8207f6dd798608993e33fb0d/2.0";function Zr(e=0){if(window.requestAnimationFrame(Zr),!Hr)return;$r||($r=e);const t=e-$r,n=Hr.glTF,r=jr.get("camera"),a=jr.get("scene"),i=((null!==a&&parseInt(a))??n.scene)||0;n.animations?.length&&(function(e,t,n=0,r=!1){const a=function(e,t){let n=ar(t).duration||0;for(const r of t.channels){const a=e.nodes?.[r.target.node],i=e.accessors?.[t.samplers[r.sampler]?.input];a&&i&&(n=Math.max(n,i.max?.[0]||0))}return ar(t).duration=n}(e.glTF,t),i=r?n-Math.floor(n/a)*a:Math.min(n,a);for(const n of t.channels){const r=e.glTF.nodes?.[n.target.node],a=t.samplers[n.sampler];if(!r||!a)continue;const o=ir(e,a),l=or(e,a);if(!o?.length||!l)continue;const s=o.length,c=o[0],f=o[s-1],u=ar(n).lastKeyframe||0,[d,g]=hr(o,c,f,i,u);ar(n).lastKeyframe=d;const p=n.target.path;let m=3,b=!1;switch(p){case"rotation":m=4,b=!0;break;case"weights":m=r.weights?.length||e.glTF.meshes?.[r.mesh]?.weights?.length||0}Ar(ar(r)[p]=ar(r)[p]||new Array(m),o,l,d,g,i,a.interpolation||"LINEAR",b)}return n<a}(Hr,n.animations[Kr],t/1e3)||($r=e,Kr=(Kr+1)%n.animations.length)),function(e,t,n,r={}){const a=(r.scene??n.glTF.scene)||0,i=n.glTF.nodes,o=n.glTF.scenes?.[a]?.nodes;if(!i||!o)return;const l=function(e,t={}){let n=[];const r=e.glTF.scenes?.[(t.scene??e.glTF.scene)||0]?.nodes;if(r)for(let t=0;t<r.length;++t)pr(e.glTF,r[t],fr,n);n=n.sort().filter(((e,t,n)=>!t||e!==n[t-1]));for(const t of n){const n=e.glTF.nodes[t];"camera"in n&&mr(e.glTF,n),"skin"in n&&br(e,n)}return n}(n,{scene:a});let c=wr,f=wr,u=Er;if(r.camera){const t=n.glTF.cameras?.[r.camera.index||0];t&&(c=t.extras?.view||wr,d=_r,g=t,m=e.width/e.height,g?.orthographic?function(e,t,n,r,a,i,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const l=1/(t-e),s=1/(r-n),c=1/(a-i);Mn(o),o[0]=2*l,o[5]=2*s,o[10]=2*c,o[12]=-(t+e)*l,o[13]=-(r+n)*s,o[14]=(a+i)*c}(-g.orthographic.xmag,g.orthographic.xmag,-g.orthographic.xmag/(m||1),g.orthographic.xmag/(m||1),g.orthographic.znear,g.orthographic.zfar,d):g?.perspective?Dn(m||g.perspective.aspectRatio||1,g.perspective.yfov,g.perspective.znear,g.perspective.zfar||1/0,d):Mn(d),f=d,u=t.extras?.translation||Er),r.camera.model&&(u=p(r.camera.model[12],r.camera.model[13],r.camera.model[14]),Rn(r.camera.model,c)),f=r.camera.proj||f}var d,g,m;const b=Un(f,c,_r),h=new Float32Array(Or);s(b,h,0,32,16),s(u,h,0,48,3),function(e,t=Tn(e)){let n=e.gl.drawingBufferWidth,r=e.gl.drawingBufferHeight;t.color.length&&(n=t.color[0].width,r=t.color[0].height),e.gl.bindFramebuffer(ge,t.glfb),e.gl.viewport(0,0,n,r),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,fn(e.gl,3089,!1));let a=0;if(isNaN(t.clearDepth)||(a|=256,e.gl.clearDepth(t.clearDepth),sn(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(a|=1024,e.gl.clearStencil(t.clearStencil),cn(e.gl,e.state.state.stencilWriteMask,255),e.state.state.stencilWriteMask=255),ln(e.gl,e.state.state.blendWriteMask,Lt.All),e.state.state.blendWriteMask=Lt.All,t.color.length){for(let n=0;n<t.color.length;++n)if(t.clearColors[n]){const r=Yt(t.color[n].format);r===j?e.gl.clearBufferiv(Se,n,t.clearColors[n]):r===W?e.gl.clearBufferuiv(Se,n,t.clearColors[n]):e.gl.clearBufferfv(Se,n,t.clearColors[n])}}else t.clearColor&&(a|=16384,e.gl.clearColor(...t.clearColor));a&&e.gl.clear(a),e.pass=t}(t,Tn(t,{clearDepth:1}));const A=[];for(let e=0;e<l.length;++e){const r=i[l[e]],a=n.glTF.meshes?.[r.mesh];if(a){Cr(t,r,h),Br(t,n.glTF,r,a,!0),kr(t,n.glTF,r,!0);for(let e=0;e<a.primitives.length;++e){const i=a.primitives[e];"BLEND"===n.glTF.materials?.[i.material]?.alphaMode?A.push({node:r,mesh:a,primitive:i}):Mr(t,n,r,a,i)}}}for(const e of A)Mr(t,n,e.node,e.mesh,e.primitive);!function(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&gn(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],16384,he+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&gn(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}(t)}(Wr,Xr,Hr,{scene:i,camera:n.cameras?{index:parseInt(r)||0}:Vn(n,i,Vr,Wr.width/Wr.height)})}function Qr(){const e=window.devicePixelRatio||1,t=qr.clientWidth,n=qr.clientHeight;Wr.width=t*e,Wr.height=n*e,Wr.style.width=`${t}px`,Wr.style.height=`${n}px`}window.addEventListener("resize",Qr,!1),Qr(),async function(){let t=jr.get("url");if(!t){const e=await(await fetch(`${Jr}/model-index.json`)).json(),n=jr.get("model")||"BrainStem",r=jr.get("variant")||"glTF",a=e.find((e=>e.name===n));t=`${Jr}/${n}/${r}/${a.variants[r]}`}Hr=await async function(t,l=!0,s=e){const c=function(e){if(r(e))return"";const t=e.split(/[?#]/)[0].split("/");return t.pop(),t.length?t.join("/")+"/":""}(t);let f;const u=await s(t,"bin");var d;return d=u,f=new DataView(d.buffer||d,d.byteOffset||0,4).getUint32(0,!0)===i?function(e){let t,r;const a=e.buffer||e,o=e.byteOffset||0,l=new DataView(a,o,12);if(l.getUint32(0,!0)!==i)throw new Error("Invalid GLB format");const s=l.getUint32(4,!0);if(2!==s)throw new Error(`Unsupported GLB version: ${s}`);const c=new DataView(a,o+12);let f=0;for(;f<c.byteLength;){const e=c.getUint32(f,!0),i=c.getUint32(f+4,!0);if(f+=8,1313821514===i){const r=new Uint8Array(a,o+12+f,e);t=JSON.parse(n(r))}else 5130562===i&&(r=new Uint8Array(a,o+12+f,e));f+=e}if(!t)throw new Error("Invalid GLB format: missing JSON content");if(!t.asset||"2.0"!==t.asset.minVersion&&"2.0"!==t.asset.version)throw new Error("Unsupported glTF version: 2.0 required");return{glTF:t,binaryChunk:r}}(u):{glTF:JSON.parse(n(u))},f.baseUrl=c,l&&(f=await async function(t,n=e){return t=await async function(e,t){const n=e.buffers||[];if(e.glTF.buffers)for(let r=0;r<e.glTF.buffers.length;++r){if(n[r])continue;const i=e.glTF.buffers[r];if(i.uri)n[r]=await t(a(i.uri,e.baseUrl||""),"bin");else{if(0!==r||!e.binaryChunk)throw new Error(`Invalid glTF: missing uri for buffer ${r}`);n[r]=e.binaryChunk}}return{...e,buffers:n}}(t,n),await async function(e,t){const{glTF:n,buffers:r=[],images:i=[]}=e;if(n.images)for(let l=0;l<n.images.length;++l){if(i[l])continue;const s=n.images[l];let c=!1,f=s.uri;if(s.bufferView||0===s.bufferView){const e=n.bufferViews?.[s.bufferView];if(!e)throw new Error(`Invalid glTF: invalid bufferView for image ${l}`);const t=new Blob([o(r,e)],{type:s.mimeType});f=URL.createObjectURL(t),c=!0}if(!f)throw new Error(`Invalid glTF: missing uri or bufferView for image ${l}`);try{i[l]=await t(a(f,e.baseUrl||""),"img")}finally{c&&URL.revokeObjectURL(f)}}return{...e,images:i}}(t,n)}(f,s)),f}(t,!0),Zr()}()})();