(()=>{var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{beginDefaultPass:()=>$e,beginRenderPass:()=>je,copyBuffer:()=>Ee,copyExternalImageToTexture:()=>_e,copyTexture:()=>Ne,copyTextureToBuffer:()=>He,createBindGroup:()=>Le,createBindGroupLayout:()=>Ae,createBuffer:()=>Me,createRenderPass:()=>Re,createRenderPipeline:()=>Ie,createSampler:()=>Ue,createShader:()=>Oe,createTexture:()=>Ge,draw:()=>Ze,drawIndexed:()=>et,generateMipmap:()=>qe,getDeviceFeatures:()=>Te,isDeviceLost:()=>ke,readBuffer:()=>ze,requestWebGL2Device:()=>Pe,resetDevice:()=>Fe,setBindGroup:()=>Qe,setBlendConst:()=>nt,setIndex:()=>Je,setRenderPipeline:()=>Ye,setScissorRect:()=>it,setStencilRef:()=>rt,setVertex:()=>Ke,setViewport:()=>tt,submitRenderPass:()=>Xe,writeBuffer:()=>We,writeTexture:()=>Ve});const i=16384,n=1028,r=1029,s=3089,o=5123,a=5124,l=5125,c=5126,u=7680,d=9728,f=34067,h=34069,p=33984,g=33071,v=36160,m=36161,b=33189,x=36064,y=36096,B=33306,D=3315,w=6144,S=32856,C=32857,P=33190,F=35907,k=34836,T=34842,M=35898,G=36208,U=36214,O=36220,R=36226,A=36232,L=36238,I=36012,z=36013,W=35056,E=33321,q=33323,V=33325,_=33326,N=33327,H=33328,j=33329,$=33330,X=33331,Y=33332,J=33333,K=33334,Q=33335,Z=33336,ee=33337,te=33338,ie=33339,ne=33340,re=36756,se=36757,oe=36759,ae=16,le=9729,ce=515,ue=r,de=578,fe=579,he={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float"};function pe(e){return 32879===e||35866===e}function ge(e){return(e>>4&15)*ve(e)}function ve(e){return 15&e}function me(e){switch(e>>4&511){case 36:return c;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return o;case 17:return 5121}return 0}function be(e){return!!(e>>13)}function xe(e){let t=0;const i=[];for(let n=0;n<e.length;++n){const r=[];let s=0;for(let i=0;i<e[n].attributes.length;++i){const o=e[n].attributes[i];r.push({format:o,offset:s,shaderLocation:t}),s+=ge(o),++t}i.push({attributes:r,stride:s,stepMode:e[n].instanced?1:0})}return i}function ye(e){switch(e){case E:case re:case V:case _:return 6403;case $:case j:case Y:case X:case K:case J:return 36244;case q:case se:case N:case H:return 33319;case Z:case Q:case te:case ee:case ne:case ie:return 33320;case S:case F:case oe:case C:case T:case k:return 6408;case O:case L:case U:case G:case A:case R:return 36249;case M:return 6407;case b:case P:case I:return 6402;case W:case z:return 34041}return 0}function Be(e){switch(e){case E:case $:case re:case j:return 1;case Y:case X:case q:case Z:case se:case Q:case V:return 2;case K:case J:case _:case te:case ee:case N:case S:case F:case O:case oe:case L:case C:case M:return 4;case ne:case ie:case H:case U:case A:case T:return 8;case G:case R:case k:return 16;case b:return 2;case P:case W:case I:return 4;case z:return 8}return 0}function De(e){switch(e){case E:case $:case q:case Z:case S:case F:case O:return 5121;case re:case j:case se:case Q:case oe:case L:return 5120;case Y:case te:case U:return o;case X:case ee:case A:return 5122;case K:case ne:case G:return l;case J:case ie:case R:return a;case C:return 33640;case V:case N:case T:return 5131;case _:case H:case k:return c;case M:return 35899;case b:return o;case P:return l;case W:return 34042;case I:return c;case z:return 36269}return 0}function we(e){switch(e){case j:case X:case J:case Q:case ee:case ie:case L:case A:case R:return a;case $:case Y:case K:case Z:case te:case ne:case O:case U:case G:return l}return c}const Se=255,Ce=4294967295;function Pe(e,t={},i=0){const n=e.getContext("webgl2",t);if(n){let t=0;for(const e in he)i&+e&&n.getExtension(he[+e])&&(t|=+e);return{canvas:e,gl:n,features:t,pass:null,state:st(n),destroy(){this.gl.deleteFramebuffer(this.state.copyFrameBuffer)}}}return null}function Fe(e){e.destroy(),e.state=st(e.gl)}function ke(e){return e.gl.isContextLost()}function Te(e){return e.features}function Me(e,t){const i=64&t.usage?35345:t.usage&ae?34963:34962,n=8192&t.usage?35040:4096&t.usage?35048:35044,r=e.gl.createBuffer();return e.gl.bindBuffer(i,r),e.gl.bufferData(i,t.size,n),{gl:e.gl,glb:r,type:i,size:t.size,destroy(){this.gl.deleteBuffer(this.glb)}}}function Ge(e,t){const i=t.sampleCount||1,n=t.dimension||3553,r=t.format||S,s=!function(e){switch(e){case b:case P:case W:case I:case z:return!0}return!1}(r)||4&(t.usage||0),[o,a,l]=t.size||[1,1,1],c=n===f?6:3553===n?1:l;let u=null,d=null;return(i>1||!s)&&(d=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(m,d),i>1?e.gl.renderbufferStorageMultisample(m,i,r,o,a):e.gl.renderbufferStorage(m,r,o,a)),s&&(u=e.gl.createTexture(),e.gl.activeTexture(p),e.gl.bindTexture(n,u),pe(n)?e.gl.texStorage3D(n,t.mipLevelCount||1,r,o,a,c):e.gl.texStorage2D(n,t.mipLevelCount||1,r,o,a)),{gl:e.gl,glt:u,glrb:d,type:n,format:r,width:o,height:a,depth:c,samples:i,destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb)}}}function Ue(e,t={}){const i=e.gl.createSampler();let n=t.minFilter||d;return t.mipmapFilter&&(n=t.mipmapFilter===d?n===d?9984:9985:n===d?9986:9987),e.gl.samplerParameteri(i,10241,n),e.gl.samplerParameteri(i,10240,t.magFilter||d),e.gl.samplerParameteri(i,10242,t.addressModeU||g),e.gl.samplerParameteri(i,10243,t.addressModeV||g),e.gl.samplerParameteri(i,32882,t.addressModeW||g),e.gl.samplerParameterf(i,33083,t.lodMaxClamp||32),e.gl.samplerParameterf(i,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(i,34892,34894),e.gl.samplerParameterf(i,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(i,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047))),{gls:i,gl:e.gl,destroy(){this.gl.deleteSampler(this.gls)}}}function Oe(e,t){const i=1===t.usage?35633:35632,n=e.gl.createShader(i);return e.gl.shaderSource(n,t.code),e.gl.compileShader(n),{gl:e.gl,gls:n,destroy(){this.gl.deleteShader(this.gls)}}}function Re(e,t={}){let i=null;const n=[],r=t.depthStencil?t.depthStencil.texture:null,s=r&&function(e){switch(e){case 36168:case W:case z:return!0}return!1}(r.format)||!1;if(t.colors&&t.colors.length){i=e.gl.createFramebuffer(),e.gl.bindFramebuffer(v,i);for(let i=0;i<t.colors.length;++i)t.colors[i].view.texture.samples>1?e.gl.framebufferRenderbuffer(v,x+i,m,t.colors[i].view.texture.glrb):ot(e.gl,x+i,t.colors[i].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>x+t))),r&&(r.glrb?e.gl.framebufferRenderbuffer(v,s?B:y,m,r.glrb):ot(e.gl,s?B:y,t.depthStencil));for(let i=0;i<t.colors.length;++i)n.push(t.colors[i].view.texture.samples>1?at(e.gl,x,t.colors[i].view):null);n.push(r&&r.samples>1&&r.glt?at(e.gl,s?B:y,t.depthStencil):null)}return{gl:e.gl,glfb:i,glrfb:n,depth:r,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){this.gl.deleteFramebuffer(this.glfb);for(const e of this.glrfb)this.gl.deleteFramebuffer(e)}}}function Ae(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function Le(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function Ie(e,t){const i=function(e,t,i){const n=e.gl.createProgram();return e.gl.attachShader(n,t),e.gl.attachShader(n,i),e.gl.linkProgram(n),e.gl.deleteShader(t),e.gl.deleteShader(i),n}(e,t.vertex.gls,t.fragment.gls),n=[],r={};let s=0,o=0;if(t.bindGroups){for(let a=0;a<t.bindGroups.length;++a){const l=t.bindGroups[a].entries;n.push([]);for(let t=0;t<l.length;++t){const c=l[t];let u=null,d=4294967295;0===c.type?(d=e.gl.getUniformBlockIndex(i,c.label),e.gl.uniformBlockBinding(i,d,s++)):2===c.type&&(u=e.gl.getUniformLocation(i,c.label),r[c.label]=o++),n[a][c.binding]={...c,loc:u,index:d,slot:0===c.type?s-1:2===c.type?o-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const i=t.bindGroups[e].entries;for(let t=0;t<i.length;++t)1===i[t].type&&r[i[t].label]&&(n[e][i[t].binding].slot=r[i[t].label])}}return{gl:e.gl,glp:i,buffers:t.buffers,cache:n,state:ct(t),destroy(){this.gl.deleteProgram(this.glp)}}}function ze(e,t,i,n=0){const r={done:!1};return function(e,t,i,n,r){const s=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),function(e,t,i,n){return new Promise(((i,n)=>{!function r(){const s=e.clientWaitSync(t,0,0);37149==s?n():37147==s?setTimeout(r,10):i()}()}))}(e,s).finally((()=>e.deleteSync(s))).then((()=>{const s=new Uint8Array(r);return e.bindBuffer(t,i),e.getBufferSubData(t,n,s,0,r),s}))}(e.gl,t.type,t.glb,n,i.byteLength).then((e=>i.set(e))).finally((()=>r.done=!0)),r}function We(e,t,i,n=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,n,i)}function Ee(e,t,i,n=t.size,r=0,s=0){e.gl.bindBuffer(36662,t.glb),e.gl.bindBuffer(36663,i.glb),e.gl.copyBufferSubData(36662,36663,r,s,n)}function qe(e,t,i=4352){e.gl.activeTexture(p),e.gl.bindTexture(t.type,t.glt),e.gl.hint(33170,i),e.gl.generateMipmap(t.type)}function Ve(e,{texture:t,mipLevel:i=0,origin:[n,r,s]=[0,0,0]},o,{offset:a=0,bytesPerRow:l,rowsPerImage:c=0},[u,d,g]=[t.width-n,t.height-r,t.depth-s]){const v=ye(t.format),m=De(t.format),b=t.type===f,x=b?h+s:t.type;e.gl.activeTexture(p),e.gl.bindTexture(t.type,t.glt);const y=Be(t.format),B=c||d,w=Math.floor(l/y),S=a-a%l;if(e.gl.pixelStorei(32878,B),e.gl.pixelStorei(3314,w),e.gl.pixelStorei(3316,Math.floor(a%l/y)),e.gl.pixelStorei(D,0),e.gl.pixelStorei(32877,0),pe(t.type))e.gl.texSubImage3D(x,i,n,r,s,u,d,g,t.format,m,o,S);else if(b)for(let t=s;t<s+g;++t)e.gl.pixelStorei(D,t*w*B),e.gl.texSubImage2D(x+t,i,n,r,u,d,v,m,o,S);else e.gl.texSubImage2D(x,i,n,r,u,d,v,m,o,S)}function _e(e,{src:t,origin:[i,n]=[0,0]},{texture:r,mipLevel:s=0,origin:[o,a,l]=[0,0,0]},[c,u]=[t.width-i,t.height-n]){const d=De(r.format),g=r.type===f?h+l:r.type;e.gl.activeTexture(p),e.gl.bindTexture(r.type,r.glt),e.gl.pixelStorei(3316,i),e.gl.pixelStorei(D,n),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),pe(r.type)?e.gl.texSubImage3D(g,s,o,a,l,c,u,1,r.format,d,t):e.gl.texSubImage2D(g,s,o,a,c,u,ye(r.format),d,t)}function Ne(e,{texture:t,mipLevel:i=0,origin:[n,r,s]=[0,0,0]},{texture:o,mipLevel:a=0,origin:[l,c,u]=[0,0,0]},[d,g,m]=[t.width-n,t.height-r,t.depth-s]){const b=o.type===f,y=b?h+u:o.type;if(e.gl.activeTexture(p),e.gl.bindTexture(o.type,o.glt),e.gl.readBuffer(x),e.gl.bindFramebuffer(v,e.state.copyFrameBuffer),pe(t.type)||t.type===f)for(let f=s;f<s+m;++f)ot(e.gl,x,{texture:t,mipLevel:i,slice:f}),pe(o.type)?e.gl.copyTexSubImage3D(y+(b?f:0),a,l,c,u,n,r,d,g):e.gl.copyTexSubImage2D(y+(b?f:0),a,l,c,n,r,d,g);else{const s=0;ot(e.gl,x,{texture:t,mipLevel:i,slice:s}),pe(o.type)?e.gl.copyTexSubImage3D(y+(b?s:0),a,l,c,u,n,r,d,g):e.gl.copyTexSubImage2D(y+(b?s:0),a,l,c,n,r,d,g)}e.gl.bindFramebuffer(v,e.pass?e.pass.glfb:null)}function He(e,{texture:t,mipLevel:i=0,origin:[n,r,s]=[0,0,0]},o,{offset:a=0,bytesPerRow:l,rowsPerImage:c=0},[u,d,h]=[t.width-n,t.height-r,t.depth-s]){e.gl.bindBuffer(35051,o),e.gl.readBuffer(x),e.gl.bindFramebuffer(v,e.state.copyFrameBuffer);const p=De(t.format),g=ye(t.format),m=Be(t.format),b=c||d,y=Math.floor(l/m),B=a-a%l;if(e.gl.pixelStorei(3330,y),e.gl.pixelStorei(3332,Math.floor(a%l/m)),e.gl.pixelStorei(3331,0),pe(t.type)||t.type===f)for(let o=s;o<s+h;++o)ot(e.gl,x,{texture:t,mipLevel:i,slice:o}),e.gl.readPixels(n,r,u,d,g,p,B+(o-s)*l*b);else{const s=0;ot(e.gl,x,{texture:t,mipLevel:i,slice:s}),e.gl.readPixels(n,r,u,d,g,p,B)}e.gl.bindFramebuffer(v,e.pass?e.pass.glfb:null)}function je(e,t){let n=e.gl.drawingBufferWidth,r=e.gl.drawingBufferHeight;t.color.length&&(n=t.color[0].width,r=t.color[0].height),e.gl.bindFramebuffer(v,t.glfb),e.gl.viewport(0,0,n,r),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,pt(e.gl,s,!1));let o=0;if(isNaN(t.clearDepth)||(o|=256,e.gl.clearDepth(t.clearDepth),ft(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(o|=1024,e.gl.clearStencil(t.clearStencil),ht(e.gl,e.state.state.stencilWriteMask,Se),e.state.state.stencilWriteMask=Se),dt(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15,t.color.length){for(let i=0;i<t.color.length;++i)if(t.clearColors[i]){const n=we(t.color[i].format);n===a?e.gl.clearBufferiv(w,i,t.clearColors[i]):n===l?e.gl.clearBufferuiv(w,i,t.clearColors[i]):e.gl.clearBufferfv(w,i,t.clearColors[i])}}else t.clearColor&&(o|=i,e.gl.clearColor(...t.clearColor));o&&e.gl.clear(o),e.pass=t}function $e(e,t={}){e.gl.bindFramebuffer(v,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,pt(e.gl,s,!1));let n=0;isNaN(t.clearDepth)||(n|=256,e.gl.clearDepth(t.clearDepth),ft(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(n|=1024,e.gl.clearStencil(t.clearStencil),ht(e.gl,e.state.state.stencilWriteMask,Se),e.state.state.stencilWriteMask=Se),t.clearColor&&(n|=i,e.gl.clearColor(...t.clearColor),dt(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15),n&&e.gl.clear(n),e.pass=null}function Xe(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&lt(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],i,x+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&lt(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}function Ye(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),ut(e.gl,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const i=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)i[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let n=0;n<t.buffers.length;++n){const{attributes:r,stride:s,stepMode:o=0}=t.buffers[n],a=[];e.state.buffers[n]={glb:null,attributes:a,stride:s,step:o,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:l}of r)i[l]=(i[l]||0)+2,a.push({buffer:n,ptr:[l,ve(e),me(e),be(e),s,t],step:o})}for(let t=0;t<i.length;++t)2===i[t]?e.gl.enableVertexAttribArray(t):1===i[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}function Je(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}function Ke(e,t,i,n=0){const r=e.state.buffers[t];!r||r.glb===i.glb&&r.offset===n||(r.glb=i.glb,r.offset=n,r.instanceOffset=0,gt(e.gl,r,n))}function Qe(e,t,i,n=[]){if(e.state.pipeline)for(let r=0,s=0;r<i.entries.length;++r){const o=i.entries[r],a=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][o.binding];if(a)if(o.buffer){let t=o.bufferOffset||0;a.bufferDynamicOffset&&(t+=n[s]||0,++s),e.gl.bindBufferRange(35345,a.slot,o.buffer.glb,t,o.bufferSize||o.buffer.size-t)}else o.texture?(e.gl.activeTexture(p+a.slot),e.gl.bindTexture(o.texture.type,o.texture.glt),e.gl.uniform1i(a.loc,a.slot)):o.sampler&&e.gl.bindSampler(a.slot,o.sampler.gls)}}function Ze(e,t,i=1,n=0,r=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==r&&(t.instanceOffset=r,gt(e.gl,t,r*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,n,t,i)}function et(e,t,i=1,n=0,r=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==r&&(t.instanceOffset=r,gt(e.gl,t,r*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,n*(e.state.state.indexFormat===o?2:4),i)}function tt(e,t,i,n,r,s=0,o=1){e.gl.viewport(t,i,n,r),e.gl.depthRange(s,o)}function it(e,t,i,n,r){e.state.scissor||(pt(e.gl,s,!0),e.state.scissor=!0),e.gl.scissor(t,i,n,r)}function nt(e,t){e.gl.blendColor(...t)}function rt(e,t){if(e.state.stencilRef!==t){const{stencilFrontCompare:i,stencilBackCompare:s,stencilReadMask:o}=e.state.state;e.gl.stencilFuncSeparate(n,i,t,o),e.gl.stencilFuncSeparate(r,s,t,o),e.state.stencilRef=t}}function st(e){const t=ct();e.blendColor(1,1,1,1),ut(e,t,t,0,!0);for(let t=0;t<16;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function ot(e,t,{texture:i,slice:n=0,mipLevel:r=0}){if(pe(i.type))e.framebufferTextureLayer(v,t,i.glt,r,n);else{const s=i.type===f?h+n:i.type;e.framebufferTexture2D(v,t,s,i.glt,r)}}function at(e,t,i){const n=e.createFramebuffer();return e.bindFramebuffer(v,n),ot(e,t,i),n}function lt(e,t,i,n,r,s=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,i),e.readBuffer(s),e.blitFramebuffer(0,0,n.width,n.height,0,0,n.width,n.height,r,d)}function ct(e={}){const t=e.primitive||{},i=e.depthStencil||{},{stencilFront:n={},stencilBack:r={}}=i,{sampleCount:s=1,alphaToCoverage:a=!1}=e.multisample||{},l=e.targets||{};let c=l.writeMask||15,d=l.blendColor||{},f=l.blendColor||{};return l.targets&&l.targets[0]&&(c=l.targets[0].writeMask||c,d=l.targets[0].blendColor||d,f=l.targets[0].blendAlpha||f),{sampleCount:s,alphaToCoverage:a,topology:t.topology||4,indexFormat:t.indexFormat||o,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:i.depthWrite||!1,depthFormat:i.format||b,depthCompare:i.depthCompare||519,depthBias:i.depthBias||0,depthBiasSlopeScale:i.depthBiasSlopeScale||0,stencil:!(!i.stencilFront&&!i.stencilBack),stencilFrontCompare:n.compare||519,stencilFrontFailOp:n.failOp||u,stencilFrontDepthFailOp:n.depthFailOp||u,stencilFrontPassOp:n.passOp||u,stencilBackCompare:r.compare||519,stencilBackFailOp:r.failOp||u,stencilBackDepthFailOp:r.depthFailOp||u,stencilBackPassOp:r.passOp||u,stencilReadMask:i.stencilReadMask||Ce,stencilWriteMask:i.stencilWriteMask||Ce,blend:!!e.targets,blendWriteMask:c,blendColorOp:d.operation||32774,blendColorSrcFactor:d.srcFactor||1,blendColorDstFactor:d.dstFactor||0,blendAlphaOp:f.operation||32774,blendAlphaSrcFactor:f.srcFactor||1,blendAlphaDstFactor:f.dstFactor||0}}function ut(e,t,i,s=0,o=!1){let a=!1,l=0,c=0,u=0,d=0;l=i.frontFace,(o||t.frontFace!==l)&&e.frontFace(l),l=i.cullMode,(o||t.cullMode!==l)&&((a=0!==l)&&e.cullFace(l),pt(e,2884,a)),a=i.alphaToCoverage,(o||t.alphaToCoverage!==a)&&pt(e,32926,a),a=!!i.depth,(o||t.depth!==a)&&pt(e,2929,a),(o||a)&&(ft(e,t.depthWrite,i.depthWrite,o),l=i.depthCompare,(o||t.depthCompare!==l)&&e.depthFunc(l)),l=i.depthBiasSlopeScale,c=i.depthBias,(o||t.depthBiasSlopeScale!==l||t.depthBias!==c)&&(pt(e,32823,!(!l&&!c)),e.polygonOffset(l,c)),a=!!i.stencil,(o||t.stencil!==a)&&pt(e,2960,a),(o||a)&&(l=i.stencilReadMask,a=o||t.stencilReadMask!==l,c=i.stencilFrontCompare,(a||t.stencilFrontCompare!==c)&&e.stencilFuncSeparate(n,c,s,l),c=i.stencilBackCompare,(a||t.stencilBackCompare!==c)&&e.stencilFuncSeparate(r,c,s,l),l=i.stencilFrontFailOp,c=i.stencilFrontDepthFailOp,u=i.stencilFrontPassOp,(o||t.stencilFrontFailOp!==l||t.stencilFrontDepthFailOp!==c||t.stencilFrontPassOp!==u)&&e.stencilOpSeparate(n,l,c,u),l=i.stencilBackFailOp,c=i.stencilBackDepthFailOp,u=i.stencilBackPassOp,(o||t.stencilBackFailOp!==l||t.stencilBackDepthFailOp!==c||t.stencilBackPassOp!==u)&&e.stencilOpSeparate(r,l,c,u),ht(e,t.stencilWriteMask,i.stencilWriteMask,o)),a=i.blend,(o||t.blend!==a)&&pt(e,3042,a),(o||a)&&(l=i.blendColorSrcFactor,c=i.blendColorDstFactor,u=i.blendAlphaSrcFactor,d=i.blendAlphaDstFactor,(o||t.blendColorSrcFactor!==l||t.blendColorDstFactor!==c||t.blendAlphaSrcFactor!==u||t.blendAlphaDstFactor!==d)&&e.blendFuncSeparate(l,c,u,d),l=i.blendColorOp,c=i.blendAlphaOp,(o||t.blendColorOp!==l||t.blendAlphaOp!==c)&&e.blendEquationSeparate(l,c),dt(e,t.blendWriteMask,i.blendWriteMask,o))}function dt(e,t,i,n=!1){(n||t!==i)&&e.colorMask(!!(1&i),!!(2&i),!!(4&i),!!(8&i))}function ft(e,t,i,n=!1){(n||t!==i)&&e.depthMask(i)}function ht(e,t,i,n=!1){(n||t!==i)&&e.stencilMask(i)}function pt(e,t,i){i?e.enable(t):e.disable(t)}function gt(e,t,i){e.bindBuffer(34962,t.glb);for(let n=0;n<t.attributes.length;++n){const{ptr:r,step:s}=t.attributes[n],o=[...r];o[5]+=i,e.vertexAttribPointer(...o),e.vertexAttribDivisor(r[0],s)}}class vt{init(){}render(e){return!1}resize(e,t){}destroy(){}}class mt extends vt{resources=[];width=1;height=1;resize(e,t){this.width=e,this.height=t}destroy(){for(let e=0;e<this.resources.length;++e)this.resources[e].destroy();this.resources.length=0}register(e){for(let t=0;t<e.length;++t)this.resources.push(e[t])}}function bt(e){const t=e.positions,i=e.uvs,n=e.normals,r=e.colors;let s=0,o=0;t&&(o=t.length,s+=3),i&&(s+=2),n&&(s+=3),r&&(s+=4);const a=new Float32Array(s*o);for(let e=0;e<o;++e){let o=0;t&&(a[e*s+o++]=t[e][0],a[e*s+o++]=t[e][1],a[e*s+o++]=t[e][2]),i&&(a[e*s+o++]=i[e][0],a[e*s+o++]=i[e][1]),n&&(a[e*s+o++]=n[e][0],a[e*s+o++]=n[e][1],a[e*s+o++]=n[e][2]),r&&(a[e*s+o++]=r[e][0],a[e*s+o++]=r[e][1],a[e*s+o++]=r[e][2],a[e*s+o++]=r[e][3])}return a}function xt(e){const t=e.indices;if(!t)return new Uint16Array(0);const i=new Uint16Array(3*t.length);for(let e=0;e<t.length;++e)i[3*e]=t[e][0],i[3*e+1]=t[e][1],i[3*e+2]=t[e][2];return i}const yt={positions:[[-1,-1,1],[1,-1,1],[1,1,1],[-1,-1,1],[1,1,1],[-1,1,1]],uvs:[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]]},Bt={indices:[[2,1,0],[2,0,3],[6,5,4],[6,4,7],[10,9,8],[10,8,11],[14,13,12],[14,12,15],[18,17,16],[18,16,19],[20,21,22],[23,20,22]],positions:[[-1,1,1],[1,1,1],[1,-1,1],[-1,-1,1],[1,1,-1],[-1,1,-1],[-1,-1,-1],[1,-1,-1],[1,1,1],[1,1,-1],[1,-1,-1],[1,-1,1],[-1,1,-1],[-1,1,1],[-1,-1,1],[-1,-1,-1],[-1,1,-1],[1,1,-1],[1,1,1],[-1,1,1],[-1,-1,-1],[1,-1,-1],[1,-1,1],[-1,-1,1]],uvs:[[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1]],normals:[[0,0,1],[0,0,1],[0,0,1],[0,0,1],[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0]],colors:[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,1,0,1],[1,1,0,1],[1,1,0,1],[1,1,0,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1]]};function Dt(e){return document.getElementById(e)}function wt(e,t,i=32){const n=Me(e,{usage:i,size:t.byteLength});return We(e,n,t),n}function St(e){const t=new Float32Array(e.length);for(let i=0;i<e.length;++i)t[i]=e[i];return t}const Ct=bt({positions:[[0,.5,0],[.5,-.5,0],[-.5,-.5,0]],colors:[[1,0,0,1],[0,1,0,1],[0,0,1,1]]});class Pt extends mt{buffer=null;pipeline=null;constructor(e){super(),this.device=e}init(){const e=Oe(this.device,{code:"#version 300 es\nlayout (location=0) in vec3 position;\nlayout (location=1) in vec4 color;\nout vec4 vColor;\nvoid main () {\n  gl_Position = vec4(position, 1);\n  vColor = color;\n}\n",usage:1}),t=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nin vec4 vColor;\nout vec4 outColor;\nvoid main () {\n  outColor = vColor;\n}\n",usage:2});this.buffer=wt(this.device,Ct),this.pipeline=Ie(this.device,{vertex:e,fragment:t,buffers:xe([{attributes:[fe,580]}])}),this.register([this.buffer,this.pipeline,e,t])}render(e){return $e(this.device,{clearColor:[.1,.2,.3,1]}),Ye(this.device,this.pipeline),Ke(this.device,0,this.buffer),Ze(this.device,3),Xe(this.device),!1}}const Ft=function(e){const t=new Uint16Array(e.length);for(let i=0;i<e.length;++i)t[i]=e[i];return t}([0,1,2]),kt=St([0,-.05,-.05,0,.05,.05]),Tt=new Float32Array(500),Mt=new Float32Array(100);for(let e=0;e<100;e++){Mt[e]=Math.random()*(2*Math.PI),Tt[5*e]=2*Math.floor(e/10)/10-1+.1,Tt[5*e+1]=e%10*2/10-1+.1;const t=Math.floor(e/10)/10,i=e%10/10,n=t*i+.2;Tt[5*e+2]=t,Tt[5*e+3]=i,Tt[5*e+4]=n}class Gt extends mt{pipeline=null;indexBuffer=null;position=null;offsetColor=null;angle=null;bindGroup=null;ambient=null;ambientData=new Float32Array(4);t=0;constructor(e){super(),this.device=e}init(){const e=Oe(this.device,{code:"#version 300 es\nlayout (location=0) in vec2 position;\nlayout (location=1) in vec2 offset;\nlayout (location=2) in vec3 color;\nlayout (location=3) in float angle;\nout vec3 vColor;\nvoid main() {\n  gl_Position = vec4(\n    cos(angle) * position.x + sin(angle) * position.y + offset.x,\n    -sin(angle) * position.x + cos(angle) * position.y + offset.y,\n    0, 1);\n  vColor = color;\n}\n",usage:1}),t=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nlayout(std140) uniform Data {\n  vec3 ambient;\n};\nin vec3 vColor;\nout vec4 outColor;\nvoid main () {\n  outColor = vec4(ambient + vColor, 1.0);\n}\n",usage:2});this.indexBuffer=wt(this.device,Ft,ae),this.position=wt(this.device,kt),this.offsetColor=wt(this.device,Tt),this.angle=wt(this.device,Mt,8224),this.ambient=wt(this.device,this.ambientData,8256);const i=Ae(this.device,{entries:[{label:"Data",type:0}]});this.bindGroup=Le(this.device,{layout:i,entries:[{buffer:this.ambient}]}),this.pipeline=Ie(this.device,{vertex:e,fragment:t,buffers:xe([{attributes:[de]},{attributes:[de,fe],instanced:!0},{attributes:[577],instanced:!0}]),bindGroups:[i]}),this.register([this.bindGroup,this.indexBuffer,this.position,this.offsetColor,this.angle,this.pipeline,e,t,i])}render(e){for(let t=0;t<100;t++)Mt[t]+=this.t-e-2*Math.PI*Math.floor(Mt[t]/Math.PI/2);this.t=e,We(this.device,this.angle,Mt);const t=Math.sin(e)/2;return this.ambientData[0]=this.ambientData[1]=this.ambientData[2]=t,We(this.device,this.ambient,this.ambientData),$e(this.device,{clearColor:[0,0,0,1]}),Ye(this.device,this.pipeline),Je(this.device,this.indexBuffer),Ke(this.device,0,this.position),Ke(this.device,1,this.offsetColor),Ke(this.device,2,this.angle),Qe(this.device,0,this.bindGroup),et(this.device,3,100),Xe(this.device),!0}}function Ut(e,t,i=0,n=0,r=e.length-i){for(let s=0;s<r;++s)t[n+s]=e[i+s];return t}function Ot(e,t,i,n,r){for(let s=0;s<r;++s)t[n+s]=e[i+s];return t}function Rt(e=0,t=0,i=0,n=0){return[e,t,i,n]}function At(e=0,t=0,i=0){return[e,t,i]}function Lt(e,t){return function(e,t){let i=0;for(let n=0;n<e.length;++n)i+=e[n]*t[n];return i}(e,t)}function It(e,t=At()){return function(e,t,i){for(let n=0;n<e.length;++n)i[n]=e[n]*t;return i}(e,1/(function(e){return Math.sqrt(Lt(e,e))}(e)||1),t)}function zt(e,t,i=At()){const n=e[2]*t[0]-t[2]*e[0],r=e[0]*t[1]-t[0]*e[1];return i[0]=e[1]*t[2]-t[1]*e[2],i[1]=n,i[2]=r,i}Rt(),At(),Rt(),Rt();const Wt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Et(e){for(let t=0;t<16;++t)e[t]=t%5?0:1;return e}function qt(e,t,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return Ut(function(e,t,i,n){const r=t.length/4,s=i.length/4;let o=0;for(let e=0;e<s;++e)for(let s=0;s<r;++s){o=0;for(let n=0;n<4;++n)o+=t[n*r+s]*i[4*e+n];n[e*r+s]=o}return n}(0,e,t,Wt),i)}const Vt=At(),_t=At(),Nt=At();function Ht(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return Et(t),t[0]=e[0],t[5]=e[1],t[10]=e[2],t}function jt(e,t,i,n=1/0,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const s=1/Math.tan(t/2);if(Et(r),r[0]=s/e,r[5]=s,r[11]=-1,r[15]=0,isFinite(n)){const e=1/(i-n);r[10]=(i+n)*e,r[14]=2*i*n*e}else r[10]=-1,r[14]=-2*i;return r}function $t(e,t=At(),i=At(0,1,0),n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const r=function(e,t,i=At()){return function(e,t,i){for(let n=0;n<e.length;++n)i[n]=e[n]-t[n];return i}(e,t,i)}(t,e,Vt);It(r,r);const s=zt(r,i,_t);It(s,s);const o=zt(s,r,Nt);return It(o,o),n[0]=s[0],n[1]=o[0],n[2]=-r[0],n[4]=s[1],n[5]=o[1],n[6]=-r[1],n[8]=s[2],n[9]=o[2],n[10]=-r[2],n[12]=-Lt(s,e),n[13]=-Lt(o,e),n[14]=Lt(r,e),n[3]=n[7]=n[11]=0,n[15]=1,n}const Xt=512,Yt=bt({positions:Bt.positions,uvs:Bt.uvs}),Jt=xt(Bt),Kt=bt(yt);class Qt extends mt{offscreenPass=null;vertBuffer=null;indexBuffer=null;quadVertBuffer=null;cubeDataBuffer=null;cubePipeline=null;quadPipeline=null;colorTex=null;uvTex=null;positionTex=null;depthTex=null;offscreenTexSampler=null;offscreenTexBindGroup=null;cubeBindGroup=null;cubeData=new Float32Array(40);constructor(e){super(),this.device=e}init(){const e=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nlayout(std140) uniform Data {\n  mat4 model, vp;\n  vec3 color;\n};\nlayout(location = 0) in vec3 position;\nlayout(location = 1) in vec2 uv;\nout vec3 vPosition;\nout vec2 vUv;\nvoid main(void) {\n  vec4 worldPos = model * vec4(position, 1.0);\n  vPosition = worldPos.xyz;\n  vUv = uv;\n  gl_Position = vp * worldPos;\n}",usage:1}),t=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nlayout(std140) uniform Data {\n  mat4 model;\n  mat4 vp;\n  vec3 color;\n};\nin vec3 vPosition;\nin vec2 vUv;\nlayout(location = 0) out vec4 out0;\nlayout(location = 1) out vec4 out1;\nlayout(location = 2) out vec4 out2;\nvoid main(void) {\n  out0 = vec4(color, 1.0);\n  out1 = vec4(vUv, 0.0, 0.0);\n  out2 = vec4(vPosition, 0.0);\n}",usage:2}),i=Oe(this.device,{code:"#version 300 es\nlayout (location=0) in vec3 position;\nlayout (location=1) in vec2 uv;\nout vec2 vUv;\nvoid main(void) {\n  gl_Position = vec4(position, 1.0);\n  vUv = uv;\n}\n",usage:1}),n=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nuniform sampler2D tex0, tex1, tex2;\nin vec2 vUv;\nout vec4 outColor;\nvoid main(void) {\n  vec4 colorSum =\n    texture(tex0, vUv * 2.0 - vec2(0.0, 1.0)) * step(0.5, 1.0 - vUv.x) * step(0.5, vUv.y) +\n    texture(tex1, vUv * 2.0 - vec2(0.0, 0.0)) * step(0.5, 1.0 - vUv.x) * step(0.5, 1.0 - vUv.y) +\n    texture(tex2, vUv * 2.0 - vec2(1.0, 1.0)) * step(0.5, vUv.x) * step(0.5, vUv.y);\n    outColor = vec4(colorSum.rgb, 1.0);\n}\n",usage:2}),r=Ae(this.device,{entries:[{label:"Data",type:0}]});this.vertBuffer=wt(this.device,Yt),this.indexBuffer=wt(this.device,Jt,ae),this.cubeDataBuffer=wt(this.device,this.cubeData,8256),this.cubeBindGroup=Le(this.device,{layout:r,entries:[{buffer:this.cubeDataBuffer}]}),this.cubePipeline=Ie(this.device,{vertex:e,fragment:t,buffers:xe([{attributes:[fe,de]}]),bindGroups:[r],depthStencil:{depthCompare:ce,depthWrite:!0},primitive:{cullMode:ue}});const s=Ae(this.device,{entries:[{binding:0,label:"tex0",type:2},{binding:1,label:"tex0",type:1},{binding:2,label:"tex1",type:2},{binding:3,label:"tex1",type:1},{binding:4,label:"tex2",type:2},{binding:5,label:"tex2",type:1}]});this.quadVertBuffer=wt(this.device,Kt),this.colorTex=Ge(this.device,{size:[Xt,Xt,1],sampleCount:4}),this.uvTex=Ge(this.device,{size:[Xt,Xt,1],sampleCount:4}),this.positionTex=Ge(this.device,{size:[Xt,Xt,1],sampleCount:4}),this.offscreenTexSampler=Ue(this.device,{magFilter:le,minFilter:le}),this.offscreenTexBindGroup=Le(this.device,{layout:s,entries:[{binding:0,texture:this.colorTex},{binding:1,sampler:this.offscreenTexSampler},{binding:2,texture:this.uvTex},{binding:3,sampler:this.offscreenTexSampler},{binding:4,texture:this.positionTex},{binding:5,sampler:this.offscreenTexSampler}]}),this.quadPipeline=Ie(this.device,{vertex:i,fragment:n,bindGroups:[s],buffers:xe([{attributes:[fe,de]}])}),this.depthTex=Ge(this.device,{format:33189,size:[Xt,Xt,1],usage:16,sampleCount:4}),this.offscreenPass=Re(this.device,{colors:[{view:{texture:this.colorTex},clear:[.1,.2,.3,1]},{view:{texture:this.uvTex},clear:[.3,.1,.2,1]},{view:{texture:this.positionTex},clear:[.1,.3,.2,1]}],depthStencil:{texture:this.depthTex},clearDepth:1}),this.register([this.offscreenPass,this.cubePipeline,this.vertBuffer,this.indexBuffer,this.cubeDataBuffer,this.cubeBindGroup,this.quadPipeline,this.quadVertBuffer,this.offscreenTexBindGroup,this.colorTex,this.uvTex,this.positionTex,this.depthTex,this.offscreenTexSampler,t,e,n,i,r,s])}render(e){{const t=At(.5,.5,.5),i=qt(jt(this.width/this.height,Math.PI/4,.01,100),$t(function(e,t,i=At()){return function(e,t,i){for(let n=0;n<e.length;++n)i[n]=e[n]+t[n];return i}(e,t,i)}([5*Math.cos(e),2.5*Math.sin(e),5*Math.sin(e)],t),t));let n=function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return Et(t),Ut(e,t,0,12,3),t}(t);n=qt(n,Ht([.5,.5,.5]),n),Ot(n,this.cubeData,0,0,16),Ot(i,this.cubeData,0,16,16),Ot([1,1,1],this.cubeData,0,32,3),We(this.device,this.cubeDataBuffer,this.cubeData)}return je(this.device,this.offscreenPass),Ye(this.device,this.cubePipeline),Je(this.device,this.indexBuffer),Ke(this.device,0,this.vertBuffer),Qe(this.device,0,this.cubeBindGroup),et(this.device,Jt.length),Xe(this.device),$e(this.device,{clearColor:[0,0,0,1],clearDepth:1}),Ye(this.device,this.quadPipeline),Ke(this.device,0,this.quadVertBuffer),Qe(this.device,0,this.offscreenTexBindGroup),Ze(this.device,6),Xe(this.device),!0}}const Zt=512,ei=bt({positions:Bt.positions,normals:Bt.normals,uvs:Bt.uvs}),ti=xt(Bt);class ii extends mt{vertBuffer=null;indexBuffer=null;matBuffer=null;envBuffer=null;cubeDataBuffer=null;skyDataBuffer=null;cubePipeline=null;cubeTex=null;skyPipeline=null;skyTex=null;sampler=null;envBindGroup=null;cubeTexBindGroup=null;cubeDataBindGroup=null;skyTexBindGroup=null;skyDataBindGroup=null;cubeData=new Float32Array(36);skyData=new Float32Array(36);constructor(e){super(),this.device=e}init(){const e=Dt("airplane"),t=Dt("sky0"),i=Dt("sky1"),n=Dt("sky2"),r=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nlayout(std140) uniform Data {\n  mat4 model, viewProj;\n  vec4 camPos;\n};\nlayout (location=0) in vec3 position;\nlayout (location=1) in vec2 uv;\nlayout (location=2) in vec3 normal;\nout vec3 vPosition;\nout vec2 vUv;\nout vec3 vNormal;\n\nvoid main(void) {\n  vec4 worldPos = model * vec4(position, 1.0);\n  vPosition = worldPos.xyz / worldPos.w;\n  vNormal = mat3(model) * normalize(normal);\n  vUv = uv;\n  gl_Position = viewProj * worldPos;\n}\n",usage:1}),s=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nuniform sampler2D tex;\nlayout(std140) uniform Data {\n  mat4 model, viewProj;\n  vec4 camPos;\n};\nlayout(std140) uniform Material {\n  vec4 albedo;\n  vec2 metallicRoughness;\n};\nlayout(std140) uniform Env {\n  vec4 ambient;\n  vec4 lightDir;\n  vec4 lightColor;\n};\n\nin vec3 vPosition;\nin vec2 vUv;\nin vec3 vNormal;\nout vec4 color;\n\nconst float PI = 3.14159265359;\n\nvec3 toSrgb(vec3 color) {\n  return pow(color, vec3(1.0/2.2));\n}\n\nvec4 toLinear(vec4 srgbIn) {\n  return vec4(pow(srgbIn.rgb, vec3(2.2)), srgbIn.a);\n}\n\nvec3 diffuse(vec3 color) {\n  return color / PI;\n}\n\nfloat specularD(float aSqr, float nDotH) {\n  float f = (nDotH * nDotH) * (aSqr - 1.0) + 1.0;\n  return aSqr / (PI * f * f);\n}\n\nvec3 specularF(vec3 r0, vec3 r90, float vDotH) {\n  return r0 + (r90 - r0) * pow(clamp(1.0 - vDotH, 0.0, 1.0), 5.0);\n}\n\nfloat specularG(float aSqr, float nDotL, float nDotV) {\n  float gl = 2.0 * nDotL / (nDotL + sqrt(aSqr + (1.0 - aSqr) * (nDotL * nDotL)));\n  float gv = 2.0 * nDotV / (nDotV + sqrt(aSqr + (1.0 - aSqr) * (nDotV * nDotV)));\n  return gl * gv;\n}\n\nvoid main () {\n  vec3 n = normalize(vNormal);\n  vec3 v = normalize(camPos.xyz - vPosition);\n  vec3 l = normalize(-lightDir.xyz);\n  vec3 h = normalize(l + v);\n\n  float nDotL = clamp(dot(n, l), 0.001, 1.0);\n  float nDotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n  float nDotH = clamp(dot(n, h), 0.0, 1.0);\n  float vDotH = clamp(dot(v, h), 0.0, 1.0);\n\n  vec4 baseColor = toLinear(texture(tex, vUv)) * albedo;\n\n  vec3 f0 = vec3(0.04);\n  vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallicRoughness.x);\n  vec3 specularColor = mix(f0, baseColor.rgb, metallicRoughness.x);\n\n  float r0 = max(max(specularColor.r, specularColor.g), specularColor.b);\n  float r90 = clamp(r0 * 25.0, 0.0, 1.0);\n  vec3 specularEnvR0 = specularColor.rgb;\n  vec3 specularEnvR90 = vec3(1.0, 1.0, 1.0) * r90;\n\n  float a = clamp(metallicRoughness.y, 0.04, 1.0);\n  a *= a;\n  float aSqr = a * a;\n\n  vec3 color0 = vec3(0.0);\n\n  vec3 F = specularF(specularEnvR0, specularEnvR90, vDotH);\n  float D = specularD(aSqr, nDotH);\n  float G = specularG(aSqr, nDotL, nDotV);\n\n  vec3 diffuse = (1.0 - F) * diffuse(diffuseColor);\n  vec3 specular = F * G * D / (4.0 * nDotL * nDotV);\n\n  color0 += nDotL * lightColor.rgb * lightColor.a * (diffuse + specular);\n  color0 += ambient.rgb * diffuseColor;\n\n  color = vec4(toSrgb(color0), baseColor.a);\n}",usage:2}),o=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nuniform samplerCube tex;\nin vec3 vPosition;\nout vec4 color;\nvoid main () {\n  color = texture(tex, normalize(vPosition));\n}",usage:2});this.matBuffer=wt(this.device,St([1,1,1,1,.5,.5,0,0]),64),this.envBuffer=wt(this.device,St([223/255*.75,246/255*.75,245/255*.75,1,1,-2,1,0,252/255,203/255,203/255,5]),64),this.vertBuffer=wt(this.device,ei),this.indexBuffer=wt(this.device,ti,ae),this.cubeDataBuffer=wt(this.device,this.cubeData,8256),this.skyDataBuffer=wt(this.device,this.skyData,8256);const a=Ae(this.device,{entries:[{binding:0,label:"tex",type:2},{binding:1,label:"tex",type:1}]}),l=Ae(this.device,{entries:[{binding:0,label:"Material",type:0},{binding:1,label:"Env",type:0}]}),c=Ae(this.device,{entries:[{label:"Data",type:0}]});this.cubeTex=Ge(this.device,{size:[Zt,Zt,1]}),e&&(_e(this.device,{src:e},{texture:this.cubeTex}),qe(this.device,this.cubeTex)),this.sampler=Ue(this.device,{magFilter:le,minFilter:le,mipmapFilter:le,maxAnisotropy:16}),this.cubeTexBindGroup=Le(this.device,{layout:a,entries:[{binding:0,texture:this.cubeTex},{binding:1,sampler:this.sampler}]}),this.envBindGroup=Le(this.device,{layout:l,entries:[{binding:0,buffer:this.matBuffer},{binding:1,buffer:this.envBuffer}]}),this.cubeDataBindGroup=Le(this.device,{layout:c,entries:[{buffer:this.cubeDataBuffer}]});const u={vertex:r,fragment:s,buffers:xe([{attributes:[fe,de,fe]}]),bindGroups:[a,l,c],depthStencil:{depthWrite:!0,depthCompare:ce},primitive:{cullMode:ue}};if(this.cubePipeline=Ie(this.device,u),this.skyTex=Ge(this.device,{dimension:34067,size:[Zt,Zt,1]}),t&&i&&n){const e=[t,t,i,n,t,t];for(let t=0;t<6;++t)_e(this.device,{src:e[t]},{texture:this.skyTex,origin:[0,0,t]});qe(this.device,this.skyTex)}this.skyTexBindGroup=Le(this.device,{layout:a,entries:[{binding:0,texture:this.skyTex},{binding:1,sampler:this.sampler}]}),this.skyDataBindGroup=Le(this.device,{layout:c,entries:[{buffer:this.skyDataBuffer}]}),this.skyPipeline=Ie(this.device,{vertex:r,fragment:o,buffers:u.buffers,bindGroups:[a,c],depthStencil:u.depthStencil,primitive:{cullMode:1028}}),this.register([this.vertBuffer,this.indexBuffer,this.matBuffer,this.envBuffer,this.cubeDataBuffer,this.skyDataBuffer,this.cubePipeline,this.cubeTex,this.skyPipeline,this.skyTex,this.sampler,this.envBindGroup,this.cubeDataBindGroup,this.cubeTexBindGroup,this.skyDataBindGroup,this.skyTexBindGroup,r,s,o,a,l,c])}render(e){{const t=At(10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)),i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n=qt(jt(this.width/this.height,Math.PI/4,.01,100),$t(t,[0,0,0]));Ot(i,this.cubeData,0,0,16),Ot(n,this.cubeData,0,16,16),Ot(t,this.cubeData,0,32,3),We(this.device,this.cubeDataBuffer,this.cubeData),Ot(Ht([10,10,10]),this.skyData,0,0,16),Ot(n,this.skyData,0,16,16),Ot(t,this.skyData,0,32,3),We(this.device,this.skyDataBuffer,this.skyData)}return $e(this.device,{clearColor:[0,0,0,1],clearDepth:1}),Ye(this.device,this.cubePipeline),Je(this.device,this.indexBuffer),Ke(this.device,0,this.vertBuffer),Qe(this.device,0,this.cubeTexBindGroup),Qe(this.device,1,this.envBindGroup),Qe(this.device,2,this.cubeDataBindGroup),et(this.device,ti.length),Ye(this.device,this.skyPipeline),Je(this.device,this.indexBuffer),Ke(this.device,0,this.vertBuffer),Qe(this.device,0,this.skyTexBindGroup),Qe(this.device,1,this.skyDataBindGroup),et(this.device,ti.length),Xe(this.device),!0}}const ni=512,ri=[[-1,-1,-1,0,-1,8,-1,0,-1,-1,-1,0,0,0,0,0],[-2,-1,0,0,-1,1,1,0,0,1,2,0,0,0,0,0],[0,-1,0,0,-1,4,-1,0,0,-1,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0]],si=bt({positions:Bt.positions,colors:Bt.colors}),oi=xt(Bt),ai=bt(yt);class li extends mt{offscreenPass=null;vertBuffer=null;indexBuffer=null;quadVertBuffer=null;cubeDataBuffer=null;kernelDataBuffer=null;cubePipeline=null;quadPipeline=null;offscreenTex=null;offscreenTexSampler=null;depthTex=null;offscreenTexBindGroup=null;cubeBindGroup=null;kernelBindGroup=null;cubeData=new Float32Array(16);kernelData=new Float32Array(20);constructor(e){super(),this.device=e}init(){const e=Oe(this.device,{code:"#version 300 es\nlayout(std140) uniform Data {\n  mat4 mvp;\n};\nlayout (location=0) in vec4 position;\nlayout (location=1) in vec4 color;\nout vec4 vColor;\nvoid main(void) {\n  gl_Position = mvp * position;\n  vColor = color;\n}",usage:1}),t=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nin vec4 vColor;\nout vec4 outColor;\nvoid main(void) {\n  outColor = vColor;\n}",usage:2}),i=Oe(this.device,{code:"#version 300 es\nlayout (location=0) in vec4 position;\nlayout (location=1) in vec2 uv;\nout vec2 vUv;\nvoid main(void) {\n  gl_Position = position;\n  vUv = uv;\n}",usage:1}),n=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nuniform sampler2D tex;\nlayout(std140) uniform Data {\n  mat4 kernel;\n  vec2 texSize;\n  float kernelWeight;\n};\nin vec2 vUv;\nout vec4 outColor;\nvoid main(void) {\n  vec2 onePixel = vec2(1.0, 1.0) / texSize;\n  vec4 colorSum =\n    texture(tex, vUv + onePixel * vec2(-1, -1)) * kernel[0][0] +\n    texture(tex, vUv + onePixel * vec2( 0, -1)) * kernel[0][1] +\n    texture(tex, vUv + onePixel * vec2( 1, -1)) * kernel[0][2] +\n    texture(tex, vUv + onePixel * vec2(-1,  0)) * kernel[1][0] +\n    texture(tex, vUv + onePixel * vec2( 0,  0)) * kernel[1][1] +\n    texture(tex, vUv + onePixel * vec2( 1,  0)) * kernel[1][2] +\n    texture(tex, vUv + onePixel * vec2(-1,  1)) * kernel[2][0] +\n    texture(tex, vUv + onePixel * vec2( 0,  1)) * kernel[2][1] +\n    texture(tex, vUv + onePixel * vec2( 1,  1)) * kernel[2][2] ;\n    outColor = vec4((colorSum / kernelWeight).rgb, 1);\n}",usage:2}),r=Ae(this.device,{entries:[{label:"Data",type:0}]});this.vertBuffer=wt(this.device,si),this.indexBuffer=wt(this.device,oi,ae),this.cubeDataBuffer=wt(this.device,this.cubeData,8256),this.cubeBindGroup=Le(this.device,{layout:r,entries:[{buffer:this.cubeDataBuffer}]}),this.cubePipeline=Ie(this.device,{vertex:e,fragment:t,buffers:xe([{attributes:[fe,580]}]),bindGroups:[r],depthStencil:{depthCompare:ce,depthWrite:!0},primitive:{cullMode:ue}});const s=Ae(this.device,{entries:[{binding:0,label:"tex",type:2},{binding:1,label:"tex",type:1}]});this.quadVertBuffer=wt(this.device,ai),this.kernelDataBuffer=wt(this.device,this.kernelData,8256),this.offscreenTex=Ge(this.device,{size:[ni,ni,1],sampleCount:1}),this.offscreenTexSampler=Ue(this.device,{magFilter:le,minFilter:le}),this.offscreenTexBindGroup=Le(this.device,{layout:s,entries:[{binding:0,texture:this.offscreenTex},{binding:1,sampler:this.offscreenTexSampler}]}),this.kernelBindGroup=Le(this.device,{layout:r,entries:[{buffer:this.kernelDataBuffer}]}),this.quadPipeline=Ie(this.device,{vertex:i,fragment:n,bindGroups:[s,r],buffers:xe([{attributes:[fe,de]}])}),this.depthTex=Ge(this.device,{format:33189,size:[ni,ni,1],usage:16,sampleCount:1}),this.offscreenPass=Re(this.device,{colors:[{view:{texture:this.offscreenTex},clear:[.25,.25,.25,1]}],depthStencil:{texture:this.depthTex},clearDepth:1}),this.register([this.cubePipeline,this.vertBuffer,this.indexBuffer,this.cubeDataBuffer,this.kernelDataBuffer,this.quadPipeline,this.quadVertBuffer,this.offscreenTex,this.offscreenTexSampler,this.depthTex,this.offscreenPass,this.cubeBindGroup,this.offscreenTexBindGroup,this.kernelBindGroup,t,e,n,i,s,r])}render(e){Ot(qt(jt(this.width/this.height,Math.PI/4,.01,100),$t([10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0])),this.cubeData,0,0,16),We(this.device,this.cubeDataBuffer,this.cubeData);{const t=ri[Math.floor(e/2)%ri.length];let i=0;for(let e=0;e<t.length;++e)i+=t[e];i=i<=0?1:i,Ot(t,this.kernelData,0,0,16),this.kernelData[16]=ni,this.kernelData[17]=ni,this.kernelData[18]=i,We(this.device,this.kernelDataBuffer,this.kernelData)}return je(this.device,this.offscreenPass),Ye(this.device,this.cubePipeline),Je(this.device,this.indexBuffer),Ke(this.device,0,this.vertBuffer),Qe(this.device,0,this.cubeBindGroup),et(this.device,oi.length),Xe(this.device),$e(this.device,{clearColor:[0,0,0,1],clearDepth:1}),Ye(this.device,this.quadPipeline),Ke(this.device,0,this.quadVertBuffer),Qe(this.device,0,this.offscreenTexBindGroup),Qe(this.device,1,this.kernelBindGroup),Ze(this.device,6),Xe(this.device),!0}}const ci=bt({positions:Bt.positions,uvs:Bt.uvs}),ui=xt(Bt),di=ui.length,fi=new Uint16Array(2*di);for(let e=0;e<di;++e)fi[e]=ui[e];for(let e=0;e<di;e+=3)fi[di+e]=ui[e+2],fi[di+e+1]=ui[e+1],fi[di+e+2]=ui[e];class hi extends mt{vertBuffer=null;indexBuffer=null;data=new Float32Array(192);dataBuffer=null;texture=null;sampler=null;cubePipeline=null;cubeOutlinePipeline=null;textureBindGroup=null;dataBindGroup=null;constructor(e){super(),this.device=e}init(){const e=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nlayout(std140) uniform Data {\n  mat4 mvp;\n  vec4 outline;\n};\nlayout (location=0) in vec3 position;\nlayout (location=1) in vec2 uv;\nout vec2 vUv;\nvoid main(void) {\n  vUv = uv;\n  gl_Position = mvp * vec4(position, 1.0);\n}\n",usage:1}),t=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nin vec2 vUv;\nout vec4 outColor;\nuniform sampler2D tex;\nvoid main () {\n  outColor = texture(tex, vUv);\n}\n",usage:2}),i=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nlayout(std140) uniform Data {\n  mat4 mvp;\n  vec4 outline;\n};\nout vec4 outColor;\nvoid main () {\n  outColor = outline;\n}\n",usage:2});this.vertBuffer=wt(this.device,ci),this.indexBuffer=wt(this.device,fi,ae),this.dataBuffer=wt(this.device,this.data,8256),this.texture=Ge(this.device,{size:[512,512,1]});const n=Dt("airplane");n&&_e(this.device,{src:n},{texture:this.texture}),this.sampler=Ue(this.device,{});const r=Ae(this.device,{entries:[{binding:0,label:"tex",type:2},{binding:1,label:"tex",type:1}]}),s=Ae(this.device,{entries:[{label:"Data",type:0,bufferDynamicOffset:!0}]});this.textureBindGroup=Le(this.device,{layout:r,entries:[{binding:0,texture:this.texture},{binding:1,sampler:this.sampler}]}),this.dataBindGroup=Le(this.device,{layout:s,entries:[{buffer:this.dataBuffer,bufferSize:256}]});const o={vertex:e,fragment:t,buffers:xe([{attributes:[fe,de]}]),bindGroups:[r,s],depthStencil:{depthWrite:!0,depthCompare:ce,stencilBack:{compare:519,passOp:7681},stencilFront:{compare:519,passOp:7681}},primitive:{cullMode:ue}};this.cubePipeline=Ie(this.device,o),this.cubeOutlinePipeline=Ie(this.device,{vertex:e,fragment:i,buffers:o.buffers,bindGroups:[s],depthStencil:{depthWrite:!0,stencilBack:{compare:517},stencilFront:{compare:517},stencilWriteMask:0},primitive:o.primitive}),this.register([this.vertBuffer,this.indexBuffer,this.dataBuffer,this.texture,this.sampler,this.textureBindGroup,this.dataBindGroup,this.cubePipeline,this.cubeOutlinePipeline,e,t,i,r,s])}render(e){{const t=qt(jt(this.width/this.height,Math.PI/4,.01,100),$t([10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0]));let i=t;Ot(i,this.data,0,0,16),i=qt(t,Ht([1.1,1.1,1.1])),Ot(i,this.data,0,64,16),Ot([.1,.3,.2,1],this.data,0,80,4),i=qt(t,Ht([10,10,10])),Ot(i,this.data,0,128,16)}return We(this.device,this.dataBuffer,this.data),$e(this.device,{clearDepth:1,clearStencil:0}),Ye(this.device,this.cubePipeline),Je(this.device,this.indexBuffer),Ke(this.device,0,this.vertBuffer),Qe(this.device,0,this.textureBindGroup),Qe(this.device,1,this.dataBindGroup,[0]),rt(this.device,1),et(this.device,di),Qe(this.device,1,this.dataBindGroup,[512]),rt(this.device,0),et(this.device,di,1,di),Ye(this.device,this.cubeOutlinePipeline),Je(this.device,this.indexBuffer),Ke(this.device,0,this.vertBuffer),Qe(this.device,0,this.dataBindGroup,[256]),rt(this.device,1),et(this.device,di),Xe(this.device),!0}}const pi=[];for(let e=0;e<Bt.uvs.length;++e){const t=Bt.uvs[e];pi.push([2*t[0],2*t[1]])}const gi=bt({positions:Bt.positions,uvs:pi}),vi=xt(Bt);class mi{cameraData=new Float32Array(16);constructor(e,t,i,n,r,s){this.device=e,this.vertexBuffer=n,this.indexBuffer=r,this.indexCount=s;const o=Ae(0,{entries:[{label:"tex",type:2,binding:0},{label:"tex",type:1,binding:1}]}),a=Ae(0,{entries:[{label:"Camera",type:0}]});t.bindGroups=[o,a],this.pipeline=Ie(e,t),this.texture=Ge(e,{dimension:i,size:[512,512,1]}),this.sampler=Ue(e,{magFilter:le,minFilter:le,mipmapFilter:le,addressModeU:10497,addressModeV:10497,maxAnisotropy:16}),this.cameraBuffer=wt(e,this.cameraData,8256),this.textureBindGroup=Le(0,{layout:o,entries:[{binding:0,texture:this.texture},{binding:1,sampler:this.sampler}]}),this.cameraBindGroup=Le(0,{layout:a,entries:[{buffer:this.cameraBuffer}]}),o.destroy(),a.destroy()}updateCamera(e){Ot(e,this.cameraData,0,0,16),We(this.device,this.cameraBuffer,this.cameraData)}render(e){Ye(e,this.pipeline),Je(e,this.indexBuffer),Ke(e,0,this.vertexBuffer),Qe(e,0,this.textureBindGroup),Qe(e,1,this.cameraBindGroup),et(e,this.indexCount)}destroy(){this.pipeline.destroy(),this.textureBindGroup.destroy(),this.cameraBindGroup.destroy(),this.texture.destroy(),this.sampler.destroy(),this.cameraBuffer.destroy()}}class bi extends mt{vertBuffer=null;indexBuffer=null;cube=null;skybox=null;constructor(e){super(),this.device=e}init(){const e=Dt("airplane"),t=Dt("sky0"),i=Dt("sky1"),n=Dt("sky2"),r=Oe(this.device,{code:"#version 300 es\nlayout(std140) uniform Camera {\n  mat4 mvp;\n};\nlayout (location=0) in vec3 position;\nlayout (location=1) in vec2 uv;\nout vec2 vUv;\nout vec3 vNormal;\nvoid main(void) {\n  vUv = uv;\n  vNormal = normalize(position);\n  gl_Position = mvp * vec4(position, 1.0);\n}\n",usage:1}),s=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nuniform sampler2D tex;\nin vec2 vUv;\nout vec4 outColor;\nvoid main () {\n  outColor = texture(tex, vUv);\n}\n",usage:2}),o=Oe(this.device,{code:"#version 300 es\nprecision mediump float;\nuniform samplerCube tex;\nin vec3 vNormal;\nout vec4 outColor;\nvoid main () {\n  outColor = texture(tex, normalize(vNormal));\n}\n",usage:2});this.vertBuffer=wt(this.device,gi),this.indexBuffer=wt(this.device,vi,ae);const a={vertex:r,fragment:s,buffers:xe([{attributes:[fe,de]}]),depthStencil:{depthWrite:!0,depthCompare:ce},primitive:{cullMode:ue}};this.cube=new mi(this.device,a,3553,this.vertBuffer,this.indexBuffer,vi.length),e&&(_e(this.device,{src:e},{texture:this.cube.texture}),qe(this.device,this.cube.texture));const l={vertex:r,fragment:o,buffers:a.buffers,depthStencil:a.depthStencil,primitive:{cullMode:1028}};if(this.skybox=new mi(this.device,l,34067,this.vertBuffer,this.indexBuffer,vi.length),t&&i&&n){const e=[t,t,i,n,t,t];for(let t=0;t<6;++t)_e(this.device,{src:e[t]},{texture:this.skybox.texture,origin:[0,0,t]});qe(this.device,this.skybox.texture)}this.register([this.vertBuffer,this.indexBuffer,r,s,o])}render(e){const t=qt(jt(this.width/this.height,Math.PI/4,.01,100),$t([10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0]));let i=t;return this.cube.updateCamera(i),i=qt(t,Ht([10,10,10]),t),this.skybox.updateCamera(i),$e(this.device,{clearColor:[.1,.2,.3,1],clearDepth:1}),this.cube.render(this.device),this.skybox.render(this.device),Xe(this.device),!0}destroy(){super.destroy(),this.cube.destroy(),this.skybox.destroy()}}class xi{constructor(e,t,i){this.id=e,this.title=t,this.factory=i}}const yi=[new xi("basic","Hello World",(e=>new Pt(e))),new xi("instancing","Buffers & Instancing",(e=>new Gt(e))),new xi("texture","Texture & Sampler",(e=>new bi(e))),new xi("stencil","Depth Stencil",(e=>new hi(e))),new xi("postprocess","Post-processing",(e=>new li(e))),new xi("mrt","Multi Render Targets",(e=>new Qt(e))),new xi("pbr","Physically Based Rendering",(e=>new ii(e)))];let Bi,Di;const wi=2097151,Si=2**32;function Ci(e,t){return(t&wi)*Si+(e>>>0)}function Pi(e){return e>>>0}Bi=Symbol.iterator;class Fi{constructor(){this.generations=[],this.freeList=[]}[Bi](){return this.values()}get size(){return this.generations.length-this.freeList.length}clear(){this.generations.length=0,this.freeList.length=0}create(){let e,t;return this.freeList.length>0?(e=this.freeList.pop(),t=Math.abs(this.generations[e]),this.generations[e]=t):(e=this.generations.length,t=e?0:1,this.generations.push(t)),Ci(e,t)}delete(e){if(!this.has(e))return!1;const t=Pi(e);let i=-(this.generations[t]+1&wi);return t||i||++i,this.generations[t]=i,this.freeList.push(t),!0}forEach(e,t){let i=0;for(const n of this.values())e.call(t,n,i,this),i+=1}has(e){return Pi(e)<this.generations.length&&function(e){return e/Si&wi}(e)===this.generations[Pi(e)]}*values(){for(let e=0;e<this.generations.length;++e){const t=this.generations[e];this.generations[e]>=0&&(yield Ci(e,t))}}}Di=Symbol.iterator;class ki{constructor(){this.allocator=new Fi,this.data=[]}[Di](){return this.entries()}add(e){const t=this.allocator.create();return this.data[Pi(t)]=e,t}clear(){this.allocator.clear(),this.data.length=0}delete(e){return!!this.allocator.delete(e)&&(delete this.data[Pi(e)],!0)}*entries(){for(const e of this.allocator.values())yield[e,this.data[Pi(e)]]}forEach(e,t){this.allocator.forEach((i=>{e.call(t,this.data[Pi(i)],i,this)}),t)}get(e){return this.has(e)?this.data[Pi(e)]:void 0}has(e){return this.allocator.has(e)}keys(){return this.allocator.values()}*values(){for(const e of this.allocator.values())yield this.data[Pi(e)]}}const Ti=new TextDecoder("utf-8");let Mi=new DataView(new ArrayBuffer(0));function Gi(e){return Mi.buffer!==e.buffer&&(Mi=new DataView(e.buffer)),Mi}function Ui(e,t,i){return Ti.decode(new Uint8Array(e.buffer,t,i))}const Oi=t;function Ri(){const e=new ki,t=new ki,i={},n=new ki,r={},s=new ki;function o(e){const t=s.get(e);t&&(t.destroy(),s.delete(e))}const a={memory:null,"is-future-done"(t){const i=e.get(t);if(i){if(!i.done)return!1;e.delete(t)}return!0},"create-image"(e,i){const n=new Image;return n.crossOrigin="anonymous",n.src=Ui(a.memory,e,i),t.add(n)},"get-image-by-id"(e,n){const r=Ui(a.memory,e,n);if(i[r])return i[r];const s=document.getElementById(r);return s?i[r]=t.add(s):0},"delete-image"(e){t.delete(e)},"get-image-width"(e){var i;return(null===(i=t.get(e))||void 0===i?void 0:i.width)||0},"get-image-height"(e){var i;return(null===(i=t.get(e))||void 0===i?void 0:i.height)||0},"get-canvas-by-id"(e,t){const i=Ui(a.memory,e,t);if(r[i])return r[i];const s=document.getElementById(i);return s?r[i]=n.add(s):0},"get-canvas-width"(e){var t;return(null===(t=n.get(e))||void 0===t?void 0:t.width)||0},"get-canvas-height"(e){var t;return(null===(t=n.get(e))||void 0===t?void 0:t.height)||0},"webgl-request-device"(e,t,i){const r=n.get(e);if(r){const e=Pe(r,{alpha:!!(1&(o=t)),antialias:!!(2&o),depth:!!(4&o),desynchronized:!!(8&o),failIfMajorPerformanceCaveat:!!(16&o),powerPreference:32&o?"high-performance":"low-power",premultipliedAlpha:!!(64&o),preserveDrawingBuffer:!!(128&o),stencil:!!(256&o)},i);if(e)return s.add(e)}var o;return 0},"webgl-generate-mipmap"(e,t,i){qe(s.get(e),s.get(t),i)},"reset-device"(e){Oi.resetDevice(s.get(e))},"delete-device":o,"is-device-lost":e=>Oi.isDeviceLost(s.get(e)),"get-device-features":e=>Oi.getDeviceFeatures(s.get(e)),"create-buffer"(e,t,i){const n=Oi.createBuffer(s.get(e),{size:t>>>0,usage:i>>>0});return s.add(n)},"delete-buffer":o,"create-texture"(e,t,i,n,r,o,a,l,c){const u=Oi.createTexture(s.get(e),{size:[t>>>0,i>>>0,n>>>0],mipLevelCount:r>>>0,sampleCount:o>>>0,dimension:a>>>0,format:l>>>0,usage:c>>>0});return s.add(u)},"delete-texture":o,"create-sampler"(e,t,i,n,r,o,a,l,c,u,d){const f=Oi.createSampler(s.get(e),{addressModeU:t>>>0,addressModeV:i>>>0,addressModeW:n>>>0,magFilter:r>>>0,minFilter:o>>>0,mipmapFilter:a>>>0,lodMinClamp:l,lodMaxClamp:c,compare:u>>>0,maxAnisotropy:d>>>0});return s.add(f)},"delete-sampler":o,"create-shader"(e,t,i,n){const r=Oi.createShader(s.get(e),{code:Ui(a.memory,t,i),usage:n>>>0});return s.add(r)},"delete-shader":o,"create-bind-group-layout"(e,t,i){const n=[];for(let e=0;e<i;e++){const i=t+32*e,r=Gi(a.memory).getUint32(i+0,!0),s=Gi(a.memory).getUint32(i+4,!0),o=Gi(a.memory).getUint8(i+16);let l=!1,c=0,u=0,d=3553,f=!1;switch(o){case 0:l=!!Gi(a.memory).getUint8(i+20);break;case 1:c=Gi(a.memory).getUint32(i+20,!0)>>>0;break;case 2:u=Gi(a.memory).getUint32(i+20,!0)>>>0,d=Gi(a.memory).getUint32(i+24,!0)>>>0,f=!!Gi(a.memory).getUint8(i+28);break;default:throw new RangeError("invalid variant discriminant for BindingType")}n.push({label:Ui(a.memory,r,s),binding:Gi(a.memory).getUint32(i+8,!0)>>>0,visibility:Gi(a.memory).getUint32(i+12,!0)>>>0,type:o,bufferDynamicOffset:l,samplerType:c,textureSampleType:u,textureDimension:d,textureMultisampled:f})}const r=Oi.createBindGroupLayout(s.get(e),{entries:n});return s.add(r)},"delete-bind-group-layout":o,"create-bind-group"(e,t,i,n){const r=[];for(let e=0;e<n;e++){const t=i+24*e;let n=null,o=0,l=0,c=null,u=null;switch(Gi(a.memory).getUint8(t+4)){case 0:n=s.get(Gi(a.memory).getFloat64(t+8,!0)),o=Gi(a.memory).getUint32(t+16,!0),l=Gi(a.memory).getUint32(t+20,!0);break;case 1:c=s.get(Gi(a.memory).getFloat64(t+8,!0));break;case 2:u=s.get(Gi(a.memory).getFloat64(t+8,!0));break;default:throw new RangeError("invalid variant discriminant for BindingResource")}r.push({binding:Gi(a.memory).getUint32(t+0,!0),buffer:n,bufferOffset:o,bufferSize:l,sampler:c,texture:u})}const o=Oi.createBindGroup(s.get(e),{layout:s.get(t),entries:r});return s.add(o)},"delete-bind-group":o,"create-render-pipeline"(e,t,i,n,r,o,l,c,u,d,f,h,p,g,v,m,b,x,y,B,D,w,S,C,P,F,k,T,M,G,U,O,R,A,L,I,z,W,E,q,V){const _=[];for(let e=0;e<r;e++){const t=n+12*e;_.push({format:Gi(a.memory).getUint32(t+0,!0),offset:Gi(a.memory).getUint32(t+4,!0),shaderLocation:Gi(a.memory).getUint32(t+8,!0)})}const N=[];for(let e=0;e<l;e++){const t=o+16*e,i=Gi(a.memory).getUint32(t+0,!0),n=Gi(a.memory).getUint32(t+4,!0);N.push({attributes:_.slice(i,i+n),stride:Gi(a.memory).getUint32(t+8,!0),stepMode:Gi(a.memory).getUint32(t+12,!0)})}const H=[];for(let e=0;e<u;e++){const t=c+8*e;H.push(s.get(Gi(a.memory).getFloat64(t+0,!0)))}const j=[];for(let e=0;e<A;e++){const t=R+32*e;j.push({format:Gi(a.memory).getUint32(t+0,!0)>>>0,writeMask:Gi(a.memory).getUint32(t+4,!0)>>>0,blendColor:{operation:Gi(a.memory).getUint32(t+8,!0)>>>0,srcFactor:Gi(a.memory).getUint32(t+12,!0)>>>0,dstFactor:Gi(a.memory).getUint32(t+16,!0)>>>0},blendAlpha:{operation:Gi(a.memory).getUint32(t+20,!0)>>>0,srcFactor:Gi(a.memory).getUint32(t+24,!0)>>>0,dstFactor:Gi(a.memory).getUint32(t+28,!0)>>>0}})}const $=Oi.createRenderPipeline(s.get(e),{vertex:s.get(t),fragment:s.get(i),buffers:N,bindGroups:H,primitive:{topology:d>>>0,indexFormat:f>>>0,frontFace:h>>>0,cullMode:p>>>0},multisample:{sampleCount:g>>>0,alphaToCoverage:!!v},depthStencil:m?{format:b>>>0,depthWrite:!!x,depthCompare:y>>>0,stencilFront:{compare:B>>>0,failOp:D>>>0,depthFailOp:w>>>0,passOp:S>>>0},stencilBack:{compare:C>>>0,failOp:P>>>0,depthFailOp:F>>>0,passOp:k>>>0},stencilReadMask:T>>>0,stencilWriteMask:M>>>0,depthBias:G,depthBiasSlopeScale:U,depthBiasClamp:O}:null,targets:{writeMask:L>>>0,blendColor:{operation:I>>>0,srcFactor:z>>>0,dstFactor:W>>>0},blendAlpha:{operation:E>>>0,srcFactor:q>>>0,dstFactor:V>>>0},targets:j}});return s.add($)},"delete-render-pipeline":o,"create-render-pass"(e,t,i,n,r,o,l,c,u,d,f,h,p){let g;switch(c){case 0:g={clearDepth:t,clearStencil:i,clearColor:isNaN(n)?null:[n,r,o,l]};break;case 1:{const e=[];for(let t=0;t<p;t++){const i=h+32*t,n=[Gi(a.memory).getFloat32(i+16,!0),Gi(a.memory).getFloat32(i+20,!0),Gi(a.memory).getFloat32(i+24,!0),Gi(a.memory).getFloat32(i+28,!0)];e.push({view:{texture:s.get(Gi(a.memory).getFloat64(i+0,!0)),mipLevel:Gi(a.memory).getUint32(i+8,!0),slice:Gi(a.memory).getUint32(i+12,!0)},clear:isNaN(n[0])?null:n})}g={clearDepth:t,clearStencil:i,colors:e,depthStencil:{texture:s.get(u),mipLevel:d>>>0,slice:f>>>0}};break}default:throw new RangeError("invalid variant discriminant for RenderPassDescriptor")}const v=Oi.createRenderPass(s.get(e),g);return s.add(v)},"delete-render-pass":o,"read-buffer"(t,i,n,r,o){const l=Oi.readBuffer(s.get(t),s.get(i),new Uint8Array(a.memory.buffer.slice(r,r+1*o),n>>>0));return e.add(l)},"write-buffer"(e,t,i,n,r){Oi.writeBuffer(s.get(e),s.get(t),new Uint8Array(a.memory.buffer.slice(i,i+1*n)),r>>>0)},"copy-buffer"(e,t,i,n,r,o){Oi.copyBuffer(s.get(e),s.get(t),s.get(i),n>>>0,r>>>0,o>>>0)},"write-texture"(e,t,i,n,r,o,l,c,u,d,f,h,p,g){Oi.writeTexture(s.get(e),{texture:s.get(t),mipLevel:i>>>0,origin:[n>>>0,r>>>0,o>>>0]},new Uint8Array(a.memory.buffer.slice(l,l+1*c)),{offset:u>>>0,bytesPerRow:d>>>0,rowsPerImage:f>>>0},[h>>>0,p>>>0,g>>>0])},"copy-external-image-to-texture"(e,i,n,r,o,a,l,c,u,d,f){Oi.copyExternalImageToTexture(s.get(e),{src:t.get(i),origin:[n>>>0,r>>>0]},{texture:s.get(o),mipLevel:a>>>0,origin:[l>>>0,c>>>0,u>>>0]},[d>>>0,f>>>0])},"copy-texture"(e,t,i,n,r,o,a,l,c,u,d,f,h,p){Oi.copyTexture(s.get(e),{texture:s.get(t),mipLevel:i>>>0,origin:[n>>>0,r>>>0,o>>>0]},{texture:s.get(a),mipLevel:l>>>0,origin:[c>>>0,u>>>0,d>>>0]},[f>>>0,h>>>0,p>>>0])},"copy-texture-to-buffer"(e,t,i,n,r,o,a,l,c,u,d,f,h){Oi.copyTextureToBuffer(s.get(e),{texture:s.get(t),mipLevel:i>>>0,origin:[n>>>0,r>>>0,o>>>0]},s.get(a),{offset:l>>>0,bytesPerRow:c>>>0,rowsPerImage:u>>>0},[d>>>0,f>>>0,h>>>0])},"begin-render-pass"(e,t){Oi.beginRenderPass(s.get(e),s.get(t))},"begin-default-pass"(e,t,i,n,r,o,a){Oi.beginDefaultPass(s.get(e),{clearColor:isNaN(n)?null:[n,r,o,a],clearDepth:t,clearStencil:i})},"submit-render-pass"(e){Oi.submitRenderPass(s.get(e))},"set-render-pipeline"(e,t){Oi.setRenderPipeline(s.get(e),s.get(t))},"set-index"(e,t){Oi.setIndex(s.get(e),s.get(t))},"set-vertex"(e,t,i,n){Oi.setVertex(s.get(e),t>>>0,s.get(i),n>>>0)},"set-bind-group"(e,t,i,n,r){Oi.setBindGroup(s.get(e),t>>>0,s.get(i),new Uint32Array(a.memory.buffer.slice(n,n+4*r)))},draw(e,t,i,n,r){Oi.draw(s.get(e),t>>>0,i>>>0,n>>>0,r>>>0)},"draw-indexed"(e,t,i,n,r){Oi.drawIndexed(s.get(e),t>>>0,i>>>0,n>>>0,r>>>0)},"set-viewport"(e,t,i,n,r,o,a){Oi.setViewport(s.get(e),t>>>0,i>>>0,n>>>0,r>>>0,o>>>0,a>>>0)},"set-scissor-rect"(e,t,i,n,r){Oi.setScissorRect(s.get(e),t>>>0,i>>>0,n>>>0,r>>>0)},"set-blend-const"(e,t,i,n,r){Oi.setBlendConst(s.get(e),[t,i,n,r])},"set-stencil-ref"(e,t){Oi.setStencilRef(s.get(e),t>>>0)}};return a}function Ai(e){const t=new Image;return e.canvas.toBlob((e=>t.src=URL.createObjectURL(e))),t}class Li extends vt{constructor(e){super(),this.uri=e}render(){return window.location.replace(this.uri),!1}}class Ii extends vt{wasmModule=null;constructor(e){super(),this.id=e}init(){Wi.then((e=>{this.wasmModule=e,e.init(this.id)}))}render(e){return this.wasmModule?.render(e),!0}resize(e,t){this.wasmModule?.resize(e,t)}destroy(){this.wasmModule?.destroy()}}let zi=!1;const Wi=function(){let e=null;const t={env:{abort(){},seed:Date.now},Date,Math,mugl:Ri()};return WebAssembly.instantiateStreaming(fetch("examples.wasm"),t).then((i=>(t.mugl.memory=e=i.instance.exports.memory,i.instance.exports)))}();function Ei(e,t,i){return t=>zi?new Ii(e):i(t)}const qi={};for(let e=0;e<yi.length;++e)qi[yi[e].id]=new xi(yi[e].id,yi[e].title,Ei(e,yi[e].id,yi[e].factory));qi.gltf=new xi("gltf","glTF Model Viewer 🔗",(()=>new Li("./gltf.html"))),qi.docs=new xi("docs","API Documentation 🔗",(()=>new Li("../docs")));const Vi=document.getElementById("menu");for(const e in qi){const t=document.createElement("li"),i=document.createElement("a");i.id=qi[e].id,i.href=`#${qi[e].id}`,i.innerText=qi[e].title,t.appendChild(i),Vi.appendChild(t)}const _i=document.querySelector("canvas"),Ni=window.devicePixelRatio||1;if(Ni>1){const{width:e,height:t}=_i;_i.width=e*Ni,_i.height=t*Ni,_i.style.width=`${e}px`,_i.style.height=`${t}px`}const Hi=Pe(_i,{stencil:!0,powerPreference:"low-power"},15);let ji,$i=0;function Xi(e=0){$i=requestAnimationFrame(Xi),ji.render(e/1e3)||cancelAnimationFrame($i)}window.loadExample=function(e=location.hash){const t=qi[e.replace("#","")];t&&(document.getElementById("title").innerText=t.title,document.getElementById("code").href=`https://github.com/andykswong/mugl/tree/main/examples/src/apps/${t.id}.ts`,cancelAnimationFrame($i),ji&&(ji.destroy(),Fe(Hi)),ji=t.factory(Hi),ji.init(),ji.resize(_i.width,_i.height),Xi())};const Yi=function(e=512){const t=document.createElement("div");return t.style.display="none",document.body.appendChild(t),new Promise(((i,n)=>{let r=1;const s=()=>{--r<=0&&i()},o=function(e){const t=new Image;return t.crossOrigin="anonymous",t.src="./airplane.png",t}();o.id="airplane",o.onload=s,o.onerror=n,t.appendChild(o);const a=function(e){const t=document.createElement("canvas");t.width=t.height=e;const i=t.getContext("2d"),n="#28ccdf",r="#39314b",s=i.createLinearGradient(0,0,0,e);s.addColorStop(0,n),s.addColorStop(.4,"#8aebf1"),s.addColorStop(.99,"#dff6f5"),s.addColorStop(1,r),i.fillStyle=n,i.fillRect(0,0,e,e);const o=Ai(i);i.fillStyle=r,i.fillRect(0,0,e,e);const a=Ai(i);return i.fillStyle=s,i.fillRect(0,0,e,e),[Ai(i),o,a]}(e);r+=a.length;for(let e=0;e<a.length;++e)a[e].id=`sky${e}`,a[e].onload=s,a[e].onerror=n,t.appendChild(a[e])}))}();location.hash=location.hash||"#basic",document.getElementById("mode")?.addEventListener("click",(e=>{zi=e.target.checked,window.loadExample()})),Yi.then((()=>{window.loadExample()}))})();