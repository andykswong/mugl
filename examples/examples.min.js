(()=>{const e=16384,t=1028,i=1029,n=7680,r=34067,s=34069,o=33984,a=36160,l=36161,c=36064,h=36096,f=33306,u=34962,p=34963,v=515,d=1029,m=263169,g=35665,x=35676,b=512,y=768,w=[0,33189,34041,34041,32856,34836,34842,33326,33325,33328,33327],P=[0,6402,34041,34041,6408,6403,33319],F=[0,5121,5126,36193,5125,34042],B=[5126,5120,5121,5122,5123],D=[4,1,1,2,2],k=255;function C(e){return 32879===e||35866===e}const M=e=>e>0&&e>>16<=3,T=e=>e>>8&k,A=e=>B[e&k],S=e=>!!(e>>16),U=e=>P[e>>8&k];function O(e,t=!1){const i=F[e&k];return t&&36193===i?5131:i}const _={Aniso:"EXT_texture_filter_anisotropic",TexFP16Lin:"OES_texture_half_float_linear",TexFPLin:"OES_texture_float_linear"},I={DFfx:"OES_standard_derivatives",Instancing:"ANGLE_instanced_arrays",UintIndex:"OES_element_index_uint",BlendMinMax:"EXT_blend_minmax",DrawBuffers:"WEBGL_draw_buffers",DepthTex:"WEBGL_depth_texture",TexFP16:"OES_texture_half_float",TexFP:"OES_texture_float",..._},E={BufFP:"EXT_color_buffer_float",..._};class L{constructor(e,{size:t,type:i=34962,usage:n=35044}){const r=this.gl=e.gl;this.type=i,this.usage=n,this.size=t,r.bindBuffer(i,this.glb=r.createBuffer()),r.bufferData(i,t,n)}data(e,t=0){return this.gl.bindBuffer(this.type,this.glb),this.gl.bufferSubData(this.type,t,e),this}destroy(){this.gl.deleteBuffer(this.glb),this.glb=null}}const z={frontFace:2305,cullMode:0,depthBias:0,depthBiasSlopeScale:0,alphaToCoverage:!1},R={writeEnabled:!1,compare:519},q={frontCompare:519,frontFailOp:n,frontZFailOp:n,frontPassOp:n,backCompare:519,backFailOp:n,backZFailOp:n,backPassOp:n,readMask:k,writeMask:k},V={srcFactorRGB:1,dstFactorRGB:0,opRGB:32774,srcFactorAlpha:1,dstFactorAlpha:0,opAlpha:32774,colorMask:15};function G(e,n,r,s=0,o=!1){const{raster:a,depth:l,stencil:c,blend:h}=r;let f=!1,u=0,p=0,v=0,d=0;const m=n.raster||z,g=a||z;if(u=g.frontFace,(o||m.frontFace!==u)&&e.frontFace(u),u=g.cullMode,(o||m.cullMode!==u)&&((f=0!==u)&&e.cullFace(u),W(e,2884,f)),u=g.depthBiasSlopeScale,p=g.depthBias,(o||m.depthBiasSlopeScale!==u||m.depthBias!==p)&&(W(e,32823,!(!u&&!p)),e.polygonOffset(u,p)),f=g.alphaToCoverage,(o||m.alphaToCoverage!==f)&&W(e,32926,f),f=!!l,(o||n.depthOn!==f)&&W(e,2929,f),o||f){const t=n.depth||R,i=l||R;N(e,t.writeEnabled,i.writeEnabled,o),u=i.compare,(o||t.compare!==u)&&e.depthFunc(u)}if(f=!!c,(o||n.stencilOn!==f)&&W(e,2960,f),o||f){const r=n.stencil||q,a=c||q;u=a.readMask,f=o||r.readMask!==u,p=a.frontCompare,(f||r.frontCompare!==p)&&e.stencilFuncSeparate(t,p,s,u),p=a.backCompare,(f||r.backCompare!==p)&&e.stencilFuncSeparate(i,p,s,u),u=a.frontFailOp,p=a.frontZFailOp,v=a.frontPassOp,(o||r.frontFailOp!==u||r.frontZFailOp!==p||r.frontPassOp!==v)&&e.stencilOpSeparate(t,u,p,v),u=a.backFailOp,p=a.backZFailOp,v=a.backPassOp,(o||r.backFailOp!==u||r.backZFailOp!==p||r.backPassOp!==v)&&e.stencilOpSeparate(i,u,p,v),H(e,r.writeMask,a.writeMask,o)}if(f=!!h,(o||n.blendOn!==f)&&W(e,3042,f),o||f){const t=n.blend||V,i=h||V;u=i.srcFactorRGB,p=i.dstFactorRGB,v=i.srcFactorAlpha,d=i.dstFactorAlpha,(o||t.srcFactorRGB!==u||t.dstFactorRGB!==p||t.srcFactorAlpha!==v||t.dstFactorAlpha!==d)&&e.blendFuncSeparate(u,p,v,d),u=i.opRGB,p=i.opAlpha,(o||t.opRGB!==u||t.opAlpha!==p)&&e.blendEquationSeparate(u,p),j(e,t.colorMask,i.colorMask,o)}}function j(e,t,i,n=!1){(t!==i||n)&&e.colorMask(!!(1&i),!!(2&i),!!(4&i),!!(8&i))}function N(e,t,i,n=!1){(t!==i||n)&&e.depthMask(i)}function H(e,t,i,n=!1){(t!==i||n)&&e.stencilMask(i)}function W(e,t,i){i?e.enable(t):e.disable(t)}const Z=(e,t)=>!(!t&&!e)&&Object.assign(e||{},t);function X(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}class K{constructor(e,{vert:t,frag:i,indexFormat:n=5123,mode:r=4,buffers:s,uniforms:o,raster:a,depth:l=!1,stencil:c=!1,blend:h=!1}){const f=this.gl=e.gl;this.vert=t,this.frag=i,this.indexFormat=n,this.mode=r;const u=Array(16);let p=0;const v=this.buffers=s.map((({attrs:e,stride:t=0,instanced:i=!1})=>{const n=Array(e.length);let r=0;for(let t=0;t<e.length;++t){const{offset:i=r,shaderLoc:o=p}=e[t];for(n[t]={...e[t],offset:i,shaderLoc:o},u[p=o]=!0;u[++p];);r=i+(s=n[t].format,D[s&k]*T(s))}var s;return{attrs:n,stride:Math.max(t,r),instanced:i}})),d=this.glp=function(e,t,i,n){const r=X(e,35633,t),s=X(e,35632,i),o=e.createProgram();e.attachShader(o,r),e.attachShader(o,s);for(const{attrs:t}of n)for(const i of t)e.bindAttribLocation(o,i.shaderLoc,i.name);return e.linkProgram(o),e.deleteShader(r),e.deleteShader(s),o}(f,t,i,v);this.uniforms=o?Object.keys(o).reduce(((e,t)=>(e[t]={...o[t]},e)),{}):{};const m=this.cache={};let g=0,x=0;for(const e in o){const t=o[e];let i;4===t.type?(i=f.getUniformBlockIndex(d,e),this.gl.uniformBlockBinding(d,i,g++)):i=f.getUniformLocation(d,e),null!==i&&4294967295!==i&&(m[e]={...t,loc:i,binding:2===t.type?x++:4===t.type?g:-1})}this.raster={...z,...a},this.depth=!!l&&{...R,...l},this.stencil=!!c&&{...q,...c},this.blend=!!h&&{...V,...h}}destroy(){this.gl.deleteProgram(this.glp),this.glp=null}}const $={},J=[];class Q{constructor(e,{color:t=J,depth:i,clearColor:n=!1,clearDepth:r=!1,clearStencil:s=!1}=$){this.glrfb=[];const o=this.gl=e.gl,u=e.feature(I.DrawBuffers),p=this.color=t.map(Y),v=this.depth=i?Y(i):null,d=!!v&&5==(v.tex.format&k);this.clearColor=n,this.clearDepth=r,this.clearStencil=s,this.glfb=null;const m=this.glrfb=[];if(p.length){this.glfb=o.createFramebuffer(),o.bindFramebuffer(a,this.glfb);const t=u||e.webgl2?p.length:1;for(let i=0;i<t;++i)e.webgl2&&p[i].tex.samples>1?o.framebufferRenderbuffer(a,c+i,l,p[i].tex.glrb):ee(o,c+i,p[i]);if(t>1&&(e.webgl2?o.drawBuffers(p.map(((e,t)=>c+t))):u&&u.drawBuffersWEBGL(p.map(((e,t)=>c+t)))),v&&(v.tex.renderTarget||e.webgl2&&v.tex.samples>1?o.framebufferRenderbuffer(a,d?f:h,l,v.tex.glrb):M(v.tex.format)&&ee(o,d?f:h,v)),e.webgl2){for(let e=0;e<t;++e)m.push(p[e].tex.samples>1?te(o,c,p[e]):null);m.push(v&&v.tex.samples>1?te(o,d?f:h,v):null)}}}destroy(){this.gl.deleteFramebuffer(this.glfb),this.glfb=null;for(const e of this.glrfb)this.gl.deleteFramebuffer(e);this.glrfb=[]}resolve(){for(let t=0;t<this.glrfb.length-1;++t)this.glrfb[t]&&ie(this.gl,this.glfb,this.glrfb[t],this.color[t],e,c+t);const t=this.glrfb[this.glrfb.length-1];this.depth&&t&&ie(this.gl,this.glfb,t,this.depth,1280)}}const Y=e=>({mipLevel:0,slice:0,...e});function ee(e,t,i){const n=i.tex;if(C(n.type))e.framebufferTextureLayer(a,t,n.glt,i.mipLevel,i.slice);else{const o=n.type===r?s+i.slice:n.type;e.framebufferTexture2D(a,t,o,n.glt,i.mipLevel)}}function te(e,t,i){const n=e.createFramebuffer();return e.bindFramebuffer(a,n),ee(e,t,i),n}function ie(e,t,i,{tex:n},r,s){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,i),s&&e.readBuffer(s),e.blitFramebuffer(0,0,n.size[0],n.size[1],0,0,n.size[0],n.size[1],r,9728)}const ne={},re=[];class se{constructor(e,{size:[t,i,n=1],type:a=3553,format:c=263169,mipLevels:h=1,samples:f=1,renderTarget:u=!0},{wrapU:p=33071,wrapV:v=33071,wrapW:d=33071,magFilter:m=9729,minFilter:g=9729,maxLOD:x=Number.MAX_VALUE,minLOD:b=0,maxAniso:y=1}=ne){const P=this.gl=e.gl;this.webgl2=e.webgl2;const F=a===r;this.size=[t,i,F?6:n],this.type=a,this.format=c,this.mipLevels=h,this.samples=f,this.wrapU=p,this.wrapV=v,this.wrapW=d,this.magFilter=m,this.minFilter=g,this.maxLOD=x,this.minLOD=b,this.maxAniso=y;const B=this.renderTarget=M(c)&&u,D=function(e,t=!1){return t||M(e)?w[e>>16]:U(e)}(c,this.webgl2);let k=null,T=null;if((B||f>1)&&(T=P.createRenderbuffer(),P.bindRenderbuffer(l,T),f>1?P.renderbufferStorageMultisample(l,f,D,t,i):P.renderbufferStorage(l,D,t,i)),!B)if(k=P.createTexture(),P.activeTexture(o),P.bindTexture(a,k),P.texParameteri(a,10241,g),P.texParameteri(a,10240,m),P.texParameteri(a,10242,p),P.texParameteri(a,10243,v),e.webgl2&&(P.texParameteri(a,32882,d),P.texParameterf(a,33083,x),P.texParameterf(a,33082,b)),y>1&&P.texParameterf(a,34046,Math.min(y,P.getParameter(34047))),this.webgl2)C(a)?P.texStorage3D(a,h,D,t,i,n):P.texStorage2D(a,h,D,t,i);else{const e=U(c),n=O(c,this.webgl2),r=F?s:a,o=F?6:1;for(let s=0;s<o;++s)for(let o=0;o<h;++o)P.texImage2D(r+s,o,D,t>>o||1,i>>o||1,0,e,n,null)}this.glt=k,this.glrb=T}data(e,[t=0,i=0,n=0]=re,[a=this.size[0]-t,l=this.size[1]-i,c=this.size[2]-n]=re,h=0){const{gl:f,glt:u,type:p,format:v}=this,d=U(v),m=O(v,this.webgl2),g=p===r,x=35866===p,b=Array.isArray(e)?e:[e],y=g||x?b.length:1,w=g?s+n:p;f.activeTexture(o),f.bindTexture(p,u);for(let r=0;r<y;++r)C(p)?f.texSubImage3D(w,h,t,i,n+r*c,a,l,c,d,m,b[r]):this.webgl2||ArrayBuffer.isView(e)?f.texSubImage2D(w+r,h,t,i,a,l,d,m,b[r]):f.texSubImage2D(w+r,h,t,i,d,m,b[r]);return this}mipmap(e=4352){return this.gl.activeTexture(o),this.gl.bindTexture(this.type,this.glt),this.gl.hint(33170,e),this.gl.generateMipmap(this.type),this}destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb),this.glt=this.glrb=null}}class oe{constructor(e,t){this.gl=e,this.webgl2=t,this.canvas=e.canvas,this.maxAttr=Math.min(e.getParameter(34921),16);const i=this.exts={};for(const n of Object.values(t?E:I))i[n]=e.getExtension(n);this.state=this.reset(),this.renderCtx=new ae(e,t,this.state,this.maxAttr,this.feature(I.Instancing))}buffer(e){return new L(this,e)}texture(e,t){return new se(this,e,t)}pipeline(e){return new K(this,e)}pass(e){return new Q(this,e)}render(t){let{width:i,height:n}=this.gl.canvas;t.color.length&&([i,n]=t.color[0].tex.size),this.gl.bindFramebuffer(a,t.glfb),this.gl.viewport(0,0,i,n),this.gl.depthRange(0,1),this.state.scissor&&(this.state.scissor=!1,this.gl.disable(3089));const r=this.state.pipe.blend||V,s=this.state.pipe.depth||R,o=this.state.pipe.stencil||q;let l=0;return t.clearColor&&(l|=e,this.gl.clearColor(...t.clearColor),j(this.gl,r.colorMask,15)),!1!==t.clearDepth&&(l|=256,this.gl.clearDepth(t.clearDepth),N(this.gl,s.writeEnabled,!0)),!1!==t.clearStencil&&(l|=1024,this.gl.clearStencil(t.clearStencil),H(this.gl,o.writeMask,k)),l&&(this.gl.clear(l),l&e&&j(this.gl,15,r.colorMask),256&l&&N(this.gl,!0,s.writeEnabled),1024&l&&H(this.gl,k,o.writeMask)),this.renderCtx.pass=t,this.renderCtx}feature(e){return this.exts[e]}reset(){return Object.assign(this.state||{},function(e,t){const i={blend:!1,blendOn:!1,depth:!1,depthOn:!1,stencil:!1,stencilOn:!1,raster:{...z}},n=[1,1,1,1];e.useProgram(null),e.blendColor(...n),G(e,i,i,0,!0);for(let i=0;i<t;++i)e.disableVertexAttribArray(i);return{pipeObj:null,bufs:[],attrs:[],idx:null,idxFmt:5123,mode:4,pipe:i,blend:n,stencilRef:0,scissor:!1}}(this.gl,this.maxAttr))}}class ae{constructor(e,t,i,n,r){this.gl=e,this.webgl2=t,this.state=i,this.maxAttr=n,this.extInst=r,this.pass=null}pipeline(e){if(this.state.pipeObj===e)return this;this.state.pipeObj&&this.state.pipeObj.glp===e.glp||this.gl.useProgram(e.glp),this.state.pipeObj=e;const t=this.state.pipe;G(this.gl,t,e,this.state.stencilRef),function(e,{blend:t,depth:i,stencil:n,raster:r}){e.blend=Z(e.blend,t),e.blendOn=!!t,e.depth=Z(e.depth,i),e.depthOn=!!i,e.stencil=Z(e.stencil,n),e.stencilOn=!!n,Object.assign(e.raster,r)}(t,e);const i=this.state.bufs=Array(e.buffers.length),n=Array(this.maxAttr).fill(null),r=this.state.attrs;this.state.attrs=n;for(let t=0;t<e.buffers.length;++t){const{attrs:r,stride:s,instanced:o}=e.buffers[t],a=[];i[t]={glb:null,attrs:a};for(const{format:e,offset:i,shaderLoc:l}of r)a.push(n[l]={buf:t,ptr:[l,T(e),A(e),S(e),s,i],step:o?1:0})}for(let e=0;e<this.maxAttr;++e)n[e]&&!r[e]?this.gl.enableVertexAttribArray(e):!n[e]&&r[e]&&this.gl.disableVertexAttribArray(e);return this.state.idxFmt=e.indexFormat,this.state.mode=e.mode,this}index({glb:e}){return e!==this.state.idx&&this.gl.bindBuffer(34963,this.state.idx=e),this}vertex(e,{glb:t}){const i=this.state.bufs[e];if(i&&i.glb!==t){this.gl.bindBuffer(34962,i.glb=t);for(let e=0;e<i.attrs.length;++e){const{ptr:t,step:n}=i.attrs[e];this.gl.vertexAttribPointer(...t),this.webgl2?this.gl.vertexAttribDivisor(t[0],n):this.extInst?.vertexAttribDivisorANGLE(t[0],n)}}return this}uniforms(e){if(!this.state.pipeObj)return this;for(const t in e){const i=this.state.pipeObj.cache[t];if(!i)continue;const n=e[t];if(1===i.type)if(Array.isArray(n)||ArrayBuffer.isView(n))switch(i.format){case 35676:this.gl.uniformMatrix4fv(i.loc,!1,n);break;case 35675:this.gl.uniformMatrix3fv(i.loc,!1,n);break;case 35666:this.gl.uniform4fv(i.loc,n);break;case 35665:this.gl.uniform3fv(i.loc,n);break;case 35664:this.gl.uniform2fv(i.loc,n);break;case 5126:this.gl.uniform1fv(i.loc,n)}else"number"==typeof n&&5126===i.format&&this.gl.uniform1f(i.loc,n);else if(2===i.type)n?.glt&&(this.gl.activeTexture(o+i.binding),this.gl.bindTexture(n.type,n.glt),this.gl.uniform1i(i.loc,i.binding));else if(35345===n?.buffer?.type){const e=n.offset||0;this.gl.bindBufferRange(35345,i.loc,n.buffer.glb,e,n.size||n.buffer.size-e)}}return this}draw(e,t=1,i=0){return t>1&&(this.webgl2||this.extInst)?this.webgl2?this.gl.drawArraysInstanced(this.state.mode,i,e,t):this.extInst.drawArraysInstancedANGLE(this.state.mode,i,e,t):this.gl.drawArrays(this.state.mode,i,e),this}drawIndexed(e,t=1,i=0){const{mode:n,idxFmt:r}=this.state,s=i*((o=r)?o-5123+2:0);var o;return t>1&&(this.webgl2||this.extInst)?this.webgl2?this.gl.drawElementsInstanced(n,e,r,s,t):this.extInst.drawElementsInstancedANGLE(n,e,r,s,t):this.gl.drawElements(n,e,r,s),this}viewport(e,t,i,n,r=0,s=1){return this.gl.viewport(e,t,i,n),this.gl.depthRange(r,s),this}scissor(e,t,i,n){return this.state.scissor||(this.gl.enable(3089),this.state.scissor=!0),this.gl.scissor(e,t,i,n),this}blendColor(e){return this.gl.blendColor(...e),this}stencilRef(e){if(this.state.stencilRef!==e){const{frontCompare:n,backCompare:r,readMask:s}=this.state.pipe.stencil||q;this.gl.stencilFuncSeparate(t,n,e,s),this.gl.stencilFuncSeparate(i,r,e,s),this.state.stencilRef=e}return this}end(){this.pass?.resolve(),this.pass=null}}class le{constructor(){this.resources=[]}register(...e){this.resources.push(...e)}destroy(){for(const e of this.resources)e.destroy()}}function ce(e,t,i,n=35044){return e.buffer({type:t,usage:n,size:i.byteLength}).data(i)}function he(e,t){return e.reduce(((e,i,n)=>(e.push(...t(i,n)),e)),[])}function fe(e){return new Promise((t=>e.canvas.toBlob((e=>{const i=new Image;i.src=URL.createObjectURL(e),i.onload=()=>t(i)}))))}const ue=new Float32Array([0,.5,1,0,0,1,.5,-.5,0,1,0,1,-.5,-.5,0,0,1,1]);var pe=1e-6,ve="undefined"!=typeof Float32Array?Float32Array:Array;function de(){var e=new ve(16);return ve!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function me(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ge(e,t,i,n,r){var s,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(s=1/(n-r),e[10]=(r+n)*s,e[14]=2*r*n*s):(e[10]=-1,e[14]=-2*n),e}function xe(e,t,i,n){var r,s,o,a,l,c,h,f,u,p,v=t[0],d=t[1],m=t[2],g=n[0],x=n[1],b=n[2],y=i[0],w=i[1],P=i[2];return Math.abs(v-y)<pe&&Math.abs(d-w)<pe&&Math.abs(m-P)<pe?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(h=v-y,f=d-w,u=m-P,r=x*(u*=p=1/Math.hypot(h,f,u))-b*(f*=p),s=b*(h*=p)-g*u,o=g*f-x*h,(p=Math.hypot(r,s,o))?(r*=p=1/p,s*=p,o*=p):(r=0,s=0,o=0),a=f*o-u*s,l=u*r-h*o,c=h*s-f*r,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),e[0]=r,e[1]=a,e[2]=h,e[3]=0,e[4]=s,e[5]=l,e[6]=f,e[7]=0,e[8]=o,e[9]=c,e[10]=u,e[11]=0,e[12]=-(r*v+s*d+o*m),e[13]=-(a*v+l*d+c*m),e[14]=-(h*v+f*d+u*m),e[15]=1,e)}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var be=function(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],f=t[8],u=t[9],p=t[10],v=t[11],d=t[12],m=t[13],g=t[14],x=t[15],b=i[0],y=i[1],w=i[2],P=i[3];return e[0]=b*n+y*a+w*f+P*d,e[1]=b*r+y*l+w*u+P*m,e[2]=b*s+y*c+w*p+P*g,e[3]=b*o+y*h+w*v+P*x,b=i[4],y=i[5],w=i[6],P=i[7],e[4]=b*n+y*a+w*f+P*d,e[5]=b*r+y*l+w*u+P*m,e[6]=b*s+y*c+w*p+P*g,e[7]=b*o+y*h+w*v+P*x,b=i[8],y=i[9],w=i[10],P=i[11],e[8]=b*n+y*a+w*f+P*d,e[9]=b*r+y*l+w*u+P*m,e[10]=b*s+y*c+w*p+P*g,e[11]=b*o+y*h+w*v+P*x,b=i[12],y=i[13],w=i[14],P=i[15],e[12]=b*n+y*a+w*f+P*d,e[13]=b*r+y*l+w*u+P*m,e[14]=b*s+y*c+w*p+P*g,e[15]=b*o+y*h+w*v+P*x,e};const ye={positions:[[-1,-1,1],[1,-1,1],[1,1,1],[-1,-1,1],[1,1,1],[-1,1,1]],uvs:[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]]},we={indices:[[2,1,0],[2,0,3],[6,5,4],[6,4,7],[10,9,8],[10,8,11],[14,13,12],[14,12,15],[18,17,16],[18,16,19],[20,21,22],[23,20,22]],positions:[[-1,1,1],[1,1,1],[1,-1,1],[-1,-1,1],[1,1,-1],[-1,1,-1],[-1,-1,-1],[1,-1,-1],[1,1,1],[1,1,-1],[1,-1,-1],[1,-1,1],[-1,1,-1],[-1,1,1],[-1,-1,1],[-1,-1,-1],[-1,1,-1],[1,1,-1],[1,1,1],[-1,1,1],[-1,-1,-1],[1,-1,-1],[1,-1,1],[-1,-1,1]],uvs:[[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1]],normals:[[0,0,1],[0,0,1],[0,0,1],[0,0,1],[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0]],colors:[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,1,0,1],[1,1,0,1],[1,1,0,1],[1,1,0,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1]]};function Pe(e){const t=document.createElement("canvas");t.width=t.height=e;const i=t.getContext("2d"),n="#28ccdf",r="#39314b",s=i.createLinearGradient(0,0,0,e);s.addColorStop(0,n),s.addColorStop(.4,"#8aebf1"),s.addColorStop(.99,"#dff6f5"),s.addColorStop(1,r),i.fillStyle=n,i.fillRect(0,0,e,e);const o=fe(i);i.fillStyle=r,i.fillRect(0,0,e,e);const a=fe(i);i.fillStyle=s,i.fillRect(0,0,e,e);const l=fe(i);return Promise.all([l,o,a])}const Fe=()=>new Promise(((e,t)=>{const i=new Image;i.onload=()=>e(i),i.onerror=t,i.src="./airplane.png"})),Be=512,De=new Float32Array(he(we.positions,((e,t)=>[...e,2*we.uvs[t][0],2*we.uvs[t][1]]))),ke=new Uint16Array(he(we.indices,(e=>e))),Ce=10,Me=new Float32Array([0,-.05,-.05,0,.05,.05]),Te=new Float32Array(500),Ae=new Float32Array(100);for(let e=0;e<100;e++){Ae[e]=Math.random()*(2*Math.PI),Te[5*e]=2*Math.floor(e/Ce)/Ce-1+.1,Te[5*e+1]=e%Ce*2/Ce-1+.1;const t=Math.floor(e/Ce)/Ce,i=e%Ce/Ce,n=t*i+.2;Te[5*e+2]=t,Te[5*e+3]=i,Te[5*e+4]=n}const Se=1024,Ue=[[-1,-1,-1,-1,8,-1,-1,-1,-1],[-2,-1,0,-1,1,1,0,1,2],[0,0,0,0,1,0,0,0,0]],Oe=new Float32Array(he(we.positions,((e,t)=>[...e,...we.colors[t]]))),_e=new Uint16Array(he(we.indices,(e=>e))),Ie=new Float32Array(he(ye.positions,((e,t)=>[...e,...ye.uvs[t]])));function Ee(){var e=new ve(3);return ve!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}Ee();const Le=new Float32Array(he(we.positions,((e,t)=>[...e,...we.uvs[t]]))),ze=new Uint16Array(he(we.indices,(e=>e))),Re=new Float32Array(he(ye.positions,((e,t)=>[...e,...ye.uvs[t]]))),qe=new Float32Array(he(we.positions,((e,t)=>[...e,...we.uvs[t]]))),Ve=new Uint16Array(he(we.indices,(e=>e))),Ge=new Uint16Array(he(we.indices,(e=>[...e].reverse()))),je=512,Ne=new Float32Array(he(we.positions,((e,t)=>[...e,...we.uvs[t]]))),He=new Uint16Array(he(we.indices,(e=>e))),We={basic:{title:"Hello World",factory:class extends le{constructor(e){super(),this.device=e,this.angle=0,this.rotate=()=>{this.angle+=Math.PI/12,this.render()}}init(){this.buffer=ce(this.device,u,ue),this.pass=this.device.pass(),this.pipeline=this.device.pipeline({vert:"\nuniform float angle;\nattribute vec2 position;\nattribute vec4 color;\nvarying lowp vec4 vColor;\nvoid main () {\n  gl_Position = vec4(\n    cos(angle) * position.x - sin(angle) * position.y,\n    sin(angle) * position.x + cos(angle) * position.y,\n    0, 1\n  );\n  vColor = color;\n}\n",frag:"\nvarying lowp vec4 vColor;\nvoid main () {\n  gl_FragColor = vColor;\n}\n",buffers:[{attrs:[{name:"position",format:b},{name:"color",format:1024}]}],uniforms:{angle:{type:1,format:5126}}}),this.device.canvas.addEventListener("click",this.rotate),this.register(this.buffer,this.pipeline,this.pass)}render(){return this.device.render(this.pass).pipeline(this.pipeline).vertex(0,this.buffer).uniforms({angle:this.angle}).draw(3).end(),!1}destroy(){super.destroy(),this.device.canvas.removeEventListener("click",this.rotate)}}},instancing:{title:"Instancing",factory:class extends le{constructor(e){super(),this.device=e,this.t=0}init(){const e=this.device;this.position=ce(e,u,Me),this.offsetColor=ce(e,u,Te),this.angle=ce(e,u,Ae,35040),this.pass=e.pass({clearColor:[0,0,0,1]}),this.pipeline=e.pipeline({vert:"\nprecision mediump float;\nattribute vec2 position;\nattribute vec3 color;\nattribute vec2 offset;\nattribute float angle;\nvarying vec3 vColor;\nvoid main() {\n  gl_Position = vec4(\n    cos(angle) * position.x + sin(angle) * position.y + offset.x,\n    -sin(angle) * position.x + cos(angle) * position.y + offset.y,\n    0, 1);\n  vColor = color;\n}\n",frag:"\nprecision mediump float;\nuniform vec3 ambient;\nvarying vec3 vColor;\nvoid main () {\n  gl_FragColor = vec4(ambient + vColor, 1.0);\n}\n",buffers:[{attrs:[{name:"position",format:b}]},{attrs:[{name:"offset",format:b},{name:"color",format:y}],instanced:!0},{attrs:[{name:"angle",format:256}],instanced:!0}],uniforms:{ambient:{type:1,format:g}}}),this.register(this.position,this.offsetColor,this.angle,this.pipeline,this.pass)}render(e){for(let t=0;t<100;t++)Ae[t]+=this.t-e-2*Math.PI*(Ae[t]/Math.PI/2|0);this.t=e,this.angle.data(Ae);const t=Math.sin(e)/2;return this.device.render(this.pass).pipeline(this.pipeline).uniforms({ambient:[t,t,t]}).vertex(0,this.position).vertex(1,this.offsetColor).vertex(2,this.angle).draw(3,100).end(),!0}}},cube:{title:"Textures",factory:class extends le{constructor(e){super(),this.device=e,this.loaded=!1}init(){const e=this.device;this.vertBuffer=ce(e,u,De),this.indexBuffer=ce(e,p,ke),this.cubeTex=e.texture({type:3553,format:m,size:[Be,Be]},{minFilter:9987,wrapU:10497,wrapV:10497,maxAniso:16});const t={vert:"\nprecision mediump float;\nuniform mat4 mvp;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvoid main(void) {\n  vUv = uv;\n  vNormal = normalize(position);\n  gl_Position = mvp * vec4(position, 1.0);\n}\n",frag:"\nprecision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tex;\nvoid main () {\n  gl_FragColor = texture2D(tex, vUv);\n}\n",buffers:[{attrs:[{name:"position",format:y},{name:"uv",format:b}]}],uniforms:{mvp:{type:1,format:x},tex:{type:2,format:this.cubeTex.type}},depth:{compare:v,writeEnabled:!0},raster:{cullMode:d}};this.cubePipeline=e.pipeline(t),this.skyTex=e.texture({type:34067,format:m,size:[Be,Be]}),this.skyPipeline=e.pipeline({...t,frag:"\nprecision mediump float;\nvarying vec3 vNormal;\nuniform samplerCube tex;\nvoid main () {\n  gl_FragColor = textureCube(tex, normalize(vNormal));\n}\n",uniforms:{mvp:{type:1,format:x},tex:{type:2,format:this.skyTex.type}},raster:{cullMode:1028}}),this.pass=e.pass({clearDepth:1}),this.loaded=!1,Promise.all([Fe(),Pe(Be)]).then((([e,t])=>{this.skyTex.data([t[0],...t,t[0],t[0]]),this.cubeTex.data(e).mipmap(),this.loaded=!0})),this.register(this.pass,this.vertBuffer,this.cubePipeline,this.indexBuffer,this.cubeTex,this.skyPipeline,this.skyTex)}render(e){if(!this.loaded)return!0;const t=ge(de(),Math.PI/4,this.device.canvas.width/this.device.canvas.height,.01,100),i=xe(de(),[10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0],[0,1,0]),n=be(i,t,i),r=this.device.render(this.pass);let s=n;return r.pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms({mvp:s,tex:this.cubeTex}).drawIndexed(ke.length),s=be(n,n,me(de(),[10,10,10])),r.pipeline(this.skyPipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms({mvp:s,tex:this.skyTex}).drawIndexed(ke.length).end(),!0}}},postprocess:{title:"Post-processing",factory:class extends le{constructor(e){super(),this.device=e,this.kernel=0,this.nextKernel=()=>{this.kernel=(this.kernel+1)%Ue.length}}init(){const e=this.device;this.vertBuffer=ce(e,u,Oe),this.indexBuffer=ce(e,p,_e),this.cubePipeline=e.pipeline({vert:"\nuniform mat4 mvp;\nattribute vec4 position;\nattribute vec4 color;\nvarying vec4 vColor;\nvoid main(void) {\n  gl_Position = mvp * position;\n  vColor = color;\n}",frag:"\nprecision mediump float;\nvarying vec4 vColor;\nvoid main(void) {\n  gl_FragColor = vColor;\n}",buffers:[{attrs:[{name:"position",format:y},{name:"color",format:1024}]}],uniforms:{mvp:{type:1,format:x}},depth:{compare:v,writeEnabled:!0},raster:{cullMode:d}}),this.offscreenTex=e.texture({size:[Se,Se]}),this.quadVertBuffer=ce(e,u,Ie),this.quadPipeline=e.pipeline({vert:"\nattribute vec4 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvoid main(void) {\n  gl_Position = position;\n  vUv = uv;\n}\n",frag:"\nprecision mediump float; \nuniform sampler2D tex;\nuniform vec2 texSize;\nuniform mat3 kernel;\nuniform float kernelWeight;\nvarying vec2 vUv;\nvoid main(void) {\n  vec2 onePixel = vec2(1.0, 1.0) / texSize;\n  vec4 colorSum =\n    texture2D(tex, vUv + onePixel * vec2(-1, -1)) * kernel[0][0] +\n    texture2D(tex, vUv + onePixel * vec2( 0, -1)) * kernel[0][1] +\n    texture2D(tex, vUv + onePixel * vec2( 1, -1)) * kernel[0][2] +\n    texture2D(tex, vUv + onePixel * vec2(-1,  0)) * kernel[1][0] +\n    texture2D(tex, vUv + onePixel * vec2( 0,  0)) * kernel[1][1] +\n    texture2D(tex, vUv + onePixel * vec2( 1,  0)) * kernel[1][2] +\n    texture2D(tex, vUv + onePixel * vec2(-1,  1)) * kernel[2][0] +\n    texture2D(tex, vUv + onePixel * vec2( 0,  1)) * kernel[2][1] +\n    texture2D(tex, vUv + onePixel * vec2( 1,  1)) * kernel[2][2] ;\n  gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\n}\n",buffers:[{attrs:[{name:"position",format:y},{name:"uv",format:b}]}],uniforms:{tex:{type:2,format:this.offscreenTex.type},texSize:{type:1,format:35664},kernel:{type:1,format:35675},kernelWeight:{type:1,format:5126}}}),this.depthTex=e.texture({format:65796,size:[Se,Se]}),this.defaultPass=e.pass({clearColor:[0,0,0,1],clearDepth:1}),this.offscreenPass=e.pass({color:[{tex:this.offscreenTex}],depth:{tex:this.depthTex},clearColor:[.25,.25,.25,1],clearDepth:1}),e.canvas.addEventListener("click",this.nextKernel),this.register(this.defaultPass,this.offscreenPass,this.cubePipeline,this.vertBuffer,this.indexBuffer,this.quadPipeline,this.quadVertBuffer,this.offscreenTex,this.depthTex)}render(e){const t=ge(de(),Math.PI/4,this.device.canvas.width/this.device.canvas.height,.01,100),i=xe(de(),[10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0],[0,1,0]),n=be(i,t,i);this.device.render(this.offscreenPass).pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms({mvp:n}).drawIndexed(_e.length).end();const r=Ue[this.kernel];let s=r.reduce(((e,t)=>e+t));return s=s<=0?1:s,this.device.render(this.defaultPass).pipeline(this.quadPipeline).vertex(0,this.quadVertBuffer).uniforms({tex:this.offscreenTex,texSize:[this.offscreenTex.size[0],this.offscreenTex.size[1]],kernel:r,kernelWeight:s}).draw(6).end(),!0}destroy(){super.destroy(),this.device.canvas.removeEventListener("click",this.nextKernel)}}},mrt:{title:"Multi Render Targets",factory:class extends le{constructor(e){super(),this.device=e}init(){this.vertBuffer=ce(this.device,u,Le),this.indexBuffer=ce(this.device,p,ze),this.cubePipeline=this.device.pipeline({vert:this.device.webgl2?"#version 300 es\nprecision mediump float;\nuniform mat4 model, vp;\nin vec3 position;\nin vec2 uv;\nout vec3 vPosition;\nout vec2 vUv;\nvoid main(void) {\n  vec4 worldPos = model * vec4(position, 1.0);\n  vPosition = worldPos.xyz;\n  vUv = uv;\n  gl_Position = vp * worldPos;\n}":"\nprecision mediump float;\nuniform mat4 model, vp;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec3 vPosition;\nvarying vec2 vUv;\nvoid main(void) {\n  vec4 worldPos = model * vec4(position, 1.0);\n  vPosition = worldPos.xyz;\n  vUv = uv;\n  gl_Position = vp * worldPos;\n}",frag:this.device.webgl2?"#version 300 es\nprecision mediump float;\nuniform vec3 color;\nin vec3 vPosition;\nin vec2 vUv;\nlayout(location = 0) out vec4 out0;\nlayout(location = 1) out vec4 out1;\nlayout(location = 2) out vec4 out2;\nvoid main(void) {\n  out0 = vec4(color, 1.0);\n  out1 = vec4(vUv, 0.0, 0.0);\n  out2 = vec4(vPosition, 0.0);\n}":"\n#extension GL_EXT_draw_buffers : require\nprecision mediump float;\nvarying vec3 vPosition;\nvarying vec2 vUv;\nuniform vec3 color;\nvoid main(void) {\n  gl_FragData[0] = vec4(color, 1.0);\n  gl_FragData[1] = vec4(vUv, 0.0, 0.0);\n  gl_FragData[2] = vec4(vPosition, 0.0);\n}",buffers:[{attrs:[{name:"position",format:y},{name:"uv",format:b}]}],uniforms:{model:{type:1,format:x},vp:{type:1,format:x},color:{type:1,format:g}},depth:{compare:v,writeEnabled:!0},raster:{cullMode:d}});const e={size:[1024,1024]};this.colorTex=this.device.texture(e),this.uvTex=this.device.texture(e),this.positionTex=this.device.texture(e),this.depthTex=this.device.texture({...e,format:65796}),this.quadVertBuffer=ce(this.device,u,Re),this.quadPipeline=this.device.pipeline({vert:"\nattribute vec4 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvoid main(void) {\n  gl_Position = position;\n  vUv = uv;\n}\n",frag:"\nprecision mediump float;\nuniform sampler2D tex0;\nuniform sampler2D tex1;\nuniform sampler2D tex2;\nvarying vec2 vUv;\nvoid main(void) {\n  vec4 colorSum =\n    texture2D(tex0, vUv * 2.0 - vec2(0.0, 1.0)) * step(0.5, 1.0 - vUv.x) * step(0.5, vUv.y) +\n    texture2D(tex1, vUv * 2.0 - vec2(0.0, 0.0)) * step(0.5, 1.0 - vUv.x) * step(0.5, 1.0 - vUv.y) +\n    texture2D(tex2, vUv * 2.0 - vec2(1.0, 1.0)) * step(0.5, vUv.x) * step(0.5, vUv.y);\n  gl_FragColor = vec4(colorSum.rgb, 1.0);\n}\n",buffers:[{attrs:[{name:"position",format:y},{name:"uv",format:b}]}],uniforms:{tex0:{type:2,format:this.colorTex.type},tex1:{type:2,format:this.uvTex.type},tex2:{type:2,format:this.positionTex.type}}}),this.defaultPass=this.device.pass({clearColor:[0,0,0,1],clearDepth:1}),this.offscreenPass=this.device.pass({color:[{tex:this.colorTex},{tex:this.uvTex},{tex:this.positionTex}],depth:{tex:this.depthTex},clearColor:[0,0,0,1],clearDepth:1}),this.register(this.defaultPass,this.offscreenPass,this.cubePipeline,this.vertBuffer,this.indexBuffer,this.quadPipeline,this.quadVertBuffer,this.colorTex,this.uvTex,this.positionTex,this.depthTex)}render(e){const t=[.5,.5,.5],i=ge(de(),Math.PI/4,this.device.canvas.width/this.device.canvas.height,.01,100),n=xe(de(),(r=Ee(),s=[5*Math.cos(e),2.5*Math.sin(e),5*Math.sin(e)],o=t,r[0]=s[0]+o[0],r[1]=s[1]+o[1],r[2]=s[2]+o[2],r),t,[0,1,0]);var r,s,o;const a=be(n,i,n);let l=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}(de(),t);return l=be(l,l,me(de(),[.5,.5,.5])),this.device.render(this.offscreenPass).pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms({model:l,vp:a,color:[1,1,1]}).drawIndexed(ze.length).end(),this.device.render(this.defaultPass).pipeline(this.quadPipeline).vertex(0,this.quadVertBuffer).uniforms({tex0:this.colorTex,tex1:this.uvTex,tex2:this.positionTex}).draw(6).end(),!0}}},stencil:{title:"Stencil",factory:class extends le{constructor(e){super(),this.device=e}init(){const e=this.device;this.tex=e.texture({size:[512,512]}),Fe().then((e=>{this.tex.data(e)})),this.vertBuffer=ce(e,u,qe),this.indexBuffer=ce(e,p,Ve),this.skyIndexBuffer=ce(e,p,Ge);const t={vert:"\nprecision mediump float;\nuniform mat4 mvp;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvoid main(void) {\n  vUv = uv;\n  gl_Position = mvp * vec4(position, 1.0);\n}\n",frag:"\nprecision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tex;\nvoid main () {\n  gl_FragColor = texture2D(tex, vUv);\n}\n",buffers:[{attrs:[{name:"position",format:y},{name:"uv",format:b}],stride:20}],uniforms:{mvp:{type:1,format:x},tex:{type:2,format:this.tex.type}},depth:{compare:v,writeEnabled:!0},stencil:{backCompare:519,backPassOp:7681,frontCompare:519,frontPassOp:7681},raster:{cullMode:d}};this.cubePipeline=e.pipeline(t),this.cubeOutlinePipeline=e.pipeline({...t,frag:"\nprecision mediump float;\nuniform vec4 color;\nvoid main () {\n  gl_FragColor = color;\n}\n",uniforms:{mvp:{type:1,format:x},color:{type:1,format:35666}},depth:{writeEnabled:!0},stencil:{backCompare:517,frontCompare:517,writeMask:0}}),this.pass=e.pass({clearDepth:1,clearStencil:0}),this.register(this.pass,this.vertBuffer,this.indexBuffer,this.skyIndexBuffer,this.tex,this.cubePipeline,this.cubeOutlinePipeline)}render(e){const t=ge(de(),Math.PI/4,this.device.canvas.width/this.device.canvas.height,.01,100),i=xe(de(),[10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0],[0,1,0]),n=be(i,t,i),r=this.device.render(this.pass);let s=n;return r.pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms({mvp:s,tex:this.tex}).stencilRef(1).drawIndexed(Ve.length),s=be(de(),n,me(de(),[1.1,1.1,1.1])),r.pipeline(this.cubeOutlinePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms({mvp:s,color:[.1,.3,.25,1]}).stencilRef(1).drawIndexed(Ve.length),s=be(de(),n,me(de(),[10,10,10])),r.pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.skyIndexBuffer).uniforms({mvp:s,tex:this.tex}).drawIndexed(Ge.length).end(),!0}}},pbr:{title:"PBR Uniform Buffer",factory:class extends le{constructor(e){super(),this.device=e,this.loaded=!1}init(){const e=this.device;this.vertBuffer=ce(e,u,Ne),this.indexBuffer=ce(e,p,He),this.cubeTex=e.texture({type:3553,size:[je,je]}),this.matBuffer=ce(e,35345,new Float32Array([1,1,1,1,.2,.5,0,0])),this.envBuffer=ce(e,35345,new Float32Array([223/255*.75,246/255*.75,245/255*.75,1,1,-3,1,0,252/255,203/255,203/255,2]));const t={vert:"#version 300 es\nprecision mediump float;\nuniform mat4 model, viewProj;\nin vec3 position;\nin vec2 uv;\nout vec3 vPosition;\nout vec2 vUv;\nout vec3 vNormal;\n\nvoid main(void) {\n  vec4 worldPos = model * vec4(position, 1.0);\n  vPosition = worldPos.xyz;\n  vNormal = mat3(model) * normalize(position);\n  vUv = uv;\n  gl_Position = viewProj * worldPos;\n}\n",frag:"#version 300 es\nprecision mediump float;\nuniform sampler2D tex;\nuniform vec3 camPos;\nlayout (std140) uniform material {\n  vec4 albedo;\n  float metallic;\n  float roughness;\n};\nlayout (std140) uniform env {\n  vec4 ambient;\n  vec4 lightDir;\n  vec4 lightColor;\n};\n\nin vec3 vPosition;\nin vec2 vUv;\nin vec3 vNormal;\nout vec4 color;\n\nconst float PI = 3.14159265359;\n\nvec3 toSrgb(vec3 color) {\n  return pow(color, vec3(1.0/2.2));\n}\n\nvec4 toLinear(vec4 srgbIn) {\n  return vec4(pow(srgbIn.rgb, vec3(2.2)), srgbIn.a);\n}\n\nvec3 diffuse(vec3 color) {\n  return color / PI;\n}\n\nfloat specularD(float aSqr, float nDotH) {\n  float f = (nDotH * nDotH) * (aSqr - 1.0) + 1.0;\n  return aSqr / (PI * f * f);\n}\n\nvec3 specularF(vec3 r0, vec3 r90, float vDotH) {\n  return r0 + (r90 - r0) * pow(clamp(1.0 - vDotH, 0.0, 1.0), 5.0);\n}\n\nfloat specularG(float aSqr, float nDotL, float nDotV) {\n  float gl = 2.0 * nDotL / (nDotL + sqrt(aSqr + (1.0 - aSqr) * (nDotL * nDotL)));\n  float gv = 2.0 * nDotV / (nDotV + sqrt(aSqr + (1.0 - aSqr) * (nDotV * nDotV)));\n  return gl * gv;\n}\n\nvoid main () {\n  vec3 n = normalize(vNormal);\n  vec3 v = normalize(camPos - vPosition);\n  vec3 l = normalize(-lightDir.xyz);\n  vec3 h = normalize(l + v);\n\n  float nDotL = clamp(dot(n, l), 0.001, 1.0);\n  float nDotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n  float nDotH = clamp(dot(n, h), 0.0, 1.0);\n  float vDotH = clamp(dot(v, h), 0.0, 1.0);\n\n  vec4 baseColor = toLinear(texture(tex, vUv)) * albedo;\n\n  vec3 f0 = vec3(0.04);\n  vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);\n  vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n  float r0 = max(max(specularColor.r, specularColor.g), specularColor.b);\n  float r90 = clamp(r0 * 25.0, 0.0, 1.0);\n  vec3 specularEnvR0 = specularColor.rgb;\n  vec3 specularEnvR90 = vec3(1.0, 1.0, 1.0) * r90;\n\n  float a = clamp(roughness, 0.04, 1.0);\n  a *= a;\n  float aSqr = a * a;\n\n  vec3 color0 = vec3(0.0);\n\n  vec3 F = specularF(specularEnvR0, specularEnvR90, vDotH);\n  float D = specularD(aSqr, nDotH);\n  float G = specularG(aSqr, nDotL, nDotV);\n\n  vec3 diffuse = (1.0 - F) * diffuse(diffuseColor);\n  vec3 specular = F * G * D / (4.0 * nDotL * nDotV);\n\n  color0 += nDotL * lightColor.rgb * lightColor.a * (diffuse + specular);\n\n  color0 += ambient.rgb * diffuseColor;\n\n  color = vec4(toSrgb(color0), baseColor.a);\n}\n",buffers:[{attrs:[{name:"position",format:y},{name:"uv",format:b}]}],uniforms:{model:{type:1,format:x},viewProj:{type:1,format:x},tex:{type:2,format:this.cubeTex.type},camPos:{type:1,format:g},material:{type:4},env:{type:4}},depth:{compare:v,writeEnabled:!0},raster:{cullMode:d}};this.cubePipeline=e.pipeline(t),this.skyTex=e.texture({type:34067,size:[je,je]}),this.skyPipeline=e.pipeline({...t,frag:"#version 300 es\nprecision mediump float;\nuniform samplerCube tex;\nin vec3 vNormal;\nout vec4 color;\n\nvoid main () {\n  color = texture(tex, normalize(vNormal));\n}\n",uniforms:{model:{type:1,format:x},viewProj:{type:1,format:x},tex:{type:2,format:this.skyTex.type}},raster:{cullMode:1028}}),this.pass=e.pass({clearDepth:1}),this.loaded=!1,Promise.all([Fe(),Pe(je)]).then((([e,t])=>{this.skyTex.data([t[0],...t,t[0],t[0]]),this.cubeTex.data(e),this.loaded=!0})),this.register(this.pass,this.vertBuffer,this.cubePipeline,this.indexBuffer,this.cubeTex,this.skyPipeline,this.skyTex,this.matBuffer,this.envBuffer)}render(e){if(!this.loaded)return!0;const t=(i=10*Math.cos(e),n=5*Math.sin(e),r=10*Math.sin(e),(s=new ve(3))[0]=i,s[1]=n,s[2]=r,s);var i,n,r,s;const o=ge(de(),Math.PI/4,this.device.canvas.width/this.device.canvas.height,.01,100),a=xe(de(),t,[0,0,0],[0,1,0]),l=be(a,o,a),c=this.device.render(this.pass);return c.pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms({model:de(),viewProj:l,tex:this.cubeTex,camPos:t,material:{buffer:this.matBuffer},env:{buffer:this.envBuffer}}).drawIndexed(He.length),c.pipeline(this.skyPipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms({model:me(de(),[10,10,10]),viewProj:l,tex:this.skyTex}).drawIndexed(He.length).end(),!0}}}},Ze=document.getElementById("menu");for(const e in We){const t=document.createElement("li"),i=document.createElement("a");i.id=e,i.href=`#${e}`,i.innerText=We[e].title,t.appendChild(i),Ze.appendChild(t)}const Xe=document.querySelector("canvas"),Ke=window.devicePixelRatio||1;if(Ke>1){const{width:e,height:t}=Xe;Xe.width=e*Ke,Xe.height=t*Ke,Xe.style.width=`${e}px`,Xe.style.height=`${t}px`}const $e=((e,t)=>{let i=null,n=!1;return t?.webgl2&&(n=!!(i=e.getContext("webgl2",t))),i||(i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)),i?new oe(i,n):null})(Xe,{stencil:!0,powerPreference:"low-power",webgl2:!0});let Je,Qe=0;function Ye(e=0){Qe=requestAnimationFrame(Ye),Je.render(e/1e3)||cancelAnimationFrame(Qe)}window.loadExample=function(e=location.hash){const t=We[e.replace("#","")];t&&(cancelAnimationFrame(Qe),Je&&(Je.destroy(),$e.reset()),Je=new t.factory($e),Je.init(),Ye())},location.hash=location.hash||"#basic",window.loadExample()})();