(()=>{function e(e,t,n=0,r=0,i=e.length-n){for(let a=0;a<i;++a)t[r+a]=e[n+a];return t}function t(e,t,n,r,i){for(let a=0;a<i;++a)t[r+a]=e[n+a];return t}function n(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}function r(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n}function i(e,t,n,r){const i=t.length/e,a=n.length/e;let o=0;for(let s=0;s<a;++s)for(let a=0;a<i;++a){o=0;for(let r=0;r<e;++r)o+=t[r*i+a]*n[s*e+r];r[s*i+a]=o}return r}const a=o();function o(e=0,t=0,n=0,r=0){return[e,t,n,r]}function s(t,n,r=o()){return e(i(4,t,n,a),r)}function l(e=0,t=0,n=0){return[e,t,n]}function c(e,t,n=l()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]+t[r];return n}(e,t,n)}function f(e,t,n=l()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]-t[r];return n}(e,t,n)}function u(e,t,r=l()){return n(e,t,r)}function d(e){return Math.sqrt(r(e,e))}function p(e,t=l()){return n(e,1/(d(e)||1),t)}function g(e,t,n=l()){const r=e[2]*t[0]-t[2]*e[0],i=e[0]*t[1]-t[0]*e[1];return n[0]=e[1]*t[2]-t[1]*e[2],n[1]=r,n[2]=i,n}l(),o(),o();const m=5123,b=5126,h=7680,A=9728,v=34067,y=33984,x=33071,T=36161,O=33189,S=3315,w=32856,_=32857,E=33190,F=35907,M=34836,N=34842,C=35898,U=36208,I=36214,L=36220,P=36226,B=36232,R=36238,D=36012,k=36013,z=35056,G=33321,V=33323,j=33325,W=33326,H=33327,K=33328,X=33329,$=33330,q=33331,J=33332,Q=33333,Z=33334,Y=33335,ee=33336,te=33337,ne=33338,re=33339,ie=33340,ae=36756,oe=36757,se=36759,le=A,ce=9729,fe={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float"};function ue(e){return 32879===e||35866===e}function de(e){return 15&e}function pe(e){switch(e>>4&511){case 36:return b;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return m;case 17:return 5121}return 0}function ge(e){return!!(e>>13)}function me(e){switch(e){case G:case ae:case j:case W:return 6403;case $:case X:case J:case q:case Z:case Q:return 36244;case V:case oe:case H:case K:return 33319;case ee:case Y:case ne:case te:case ie:case re:return 33320;case w:case F:case se:case _:case N:case M:return 6408;case L:case R:case I:case U:case B:case P:return 36249;case C:return 6407;case O:case E:case D:return 6402;case z:case k:return 34041}return 0}function be(e){switch(e){case G:case $:case V:case ee:case w:case F:case L:return 5121;case ae:case X:case oe:case Y:case se:case R:return 5120;case J:case ne:case I:return m;case q:case te:case B:return 5122;case Z:case ie:case U:return 5125;case Q:case re:case P:return 5124;case _:return 33640;case j:case H:case N:return 5131;case W:case K:case M:return b;case C:return 35899;case O:return m;case E:return 5125;case z:return 34042;case D:return b;case k:return 36269}return 0}const he=4294967295;function Ae(e,t){const n=64&t.usage?35345:16&t.usage?34963:34962,r=8192&t.usage?35040:4096&t.usage?35048:35044,i=e.gl.createBuffer();return e.gl.bindBuffer(n,i),e.gl.bufferData(n,t.size,r),{gl:e.gl,glb:i,type:n,size:t.size,destroy(){this.gl.deleteBuffer(this.glb)}}}function ve(e,t){const n=t.sampleCount||1,r=t.dimension||3553,i=t.format||w,a=!function(e){switch(e){case O:case E:case z:case D:case k:return!0}return!1}(i)||4&(t.usage||0),[o,s,l]=t.size||[1,1,1],c=r===v?6:3553===r?1:l;let f=null,u=null;return(n>1||!a)&&(u=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(T,u),n>1?e.gl.renderbufferStorageMultisample(T,n,i,o,s):e.gl.renderbufferStorage(T,i,o,s)),a&&(f=e.gl.createTexture(),e.gl.activeTexture(y),e.gl.bindTexture(r,f),ue(r)?e.gl.texStorage3D(r,t.mipLevelCount||1,i,o,s,c):e.gl.texStorage2D(r,t.mipLevelCount||1,i,o,s)),{gl:e.gl,glt:f,glrb:u,type:r,format:i,width:o,height:s,depth:c,samples:n,destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb)}}}function ye(e,t={}){const n=e.gl.createSampler();let r=t.minFilter||A;return t.mipmapFilter&&(r=t.mipmapFilter===A?r===A?9984:9985:r===A?9986:9987),e.gl.samplerParameteri(n,10241,r),e.gl.samplerParameteri(n,10240,t.magFilter||A),e.gl.samplerParameteri(n,10242,t.addressModeU||x),e.gl.samplerParameteri(n,10243,t.addressModeV||x),e.gl.samplerParameteri(n,32882,t.addressModeW||x),e.gl.samplerParameterf(n,33083,t.lodMaxClamp||32),e.gl.samplerParameterf(n,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(n,34892,34894),e.gl.samplerParameterf(n,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(n,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047))),{gls:n,gl:e.gl,destroy(){this.gl.deleteSampler(this.gls)}}}function xe(e,t){const n=1===t.usage?35633:35632,r=e.gl.createShader(n);return e.gl.shaderSource(r,t.code),e.gl.compileShader(r),{gl:e.gl,gls:r,destroy(){this.gl.deleteShader(this.gls)}}}function Te(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function Oe(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function Se(e,t,n,r=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,r,n)}function we(e,{texture:t,mipLevel:n=0,origin:[r,i,a]=[0,0,0]},o,{offset:s=0,bytesPerRow:l,rowsPerImage:c=0},[f,u,d]=[t.width-r,t.height-i,t.depth-a]){const p=me(t.format),g=be(t.format),m=t.type===v,b=m?34069+a:t.type;e.gl.activeTexture(y),e.gl.bindTexture(t.type,t.glt);const h=function(e){switch(e){case G:case $:case ae:case X:return 1;case J:case q:case V:case ee:case oe:case Y:case j:return 2;case Z:case Q:case W:case ne:case te:case H:case w:case F:case L:case se:case R:case _:case C:return 4;case ie:case re:case K:case I:case B:case N:return 8;case U:case P:case M:return 16;case O:return 2;case E:case z:case D:return 4;case k:return 8}return 0}(t.format),A=c||u,x=Math.floor(l/h),T=s-s%l;if(e.gl.pixelStorei(32878,A),e.gl.pixelStorei(3314,x),e.gl.pixelStorei(3316,Math.floor(s%l/h)),e.gl.pixelStorei(S,0),e.gl.pixelStorei(32877,0),ue(t.type))e.gl.texSubImage3D(b,n,r,i,a,f,u,d,t.format,g,o,T);else if(m)for(let t=a;t<a+d;++t)e.gl.pixelStorei(S,t*x*A),e.gl.texSubImage2D(b+t,n,r,i,f,u,p,g,o,T);else e.gl.texSubImage2D(b,n,r,i,f,u,p,g,o,T)}function _e(e,t,n,r=0){const i=e.state.buffers[t];!i||i.glb===n.glb&&i.offset===r||(i.glb=n.glb,i.offset=r,i.instanceOffset=0,Be(e.gl,i,r))}function Ee(e,t,n,r=[]){if(e.state.pipeline)for(let i=0,a=0;i<n.entries.length;++i){const o=n.entries[i],s=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][o.binding];if(s)if(o.buffer){let t=o.bufferOffset||0;s.bufferDynamicOffset&&(t+=r[a]||0,++a),e.gl.bindBufferRange(35345,s.slot,o.buffer.glb,t,o.bufferSize||o.buffer.size-t)}else o.texture?(e.gl.activeTexture(y+s.slot),e.gl.bindTexture(o.texture.type,o.texture.glt),e.gl.uniform1i(s.loc,s.slot)):o.sampler&&e.gl.bindSampler(s.slot,o.sampler.gls)}}function Fe(e){const t=Ne();e.blendColor(1,1,1,1),Ce(e,t,t,0,!0);for(let t=0;t<16;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function Me(e,t,n,r,i,a=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,n),e.readBuffer(a),e.blitFramebuffer(0,0,r.width,r.height,0,0,r.width,r.height,i,A)}function Ne(e={}){const t=e.primitive||{},n=e.depthStencil||{},{stencilFront:r={},stencilBack:i={}}=n,{sampleCount:a=1,alphaToCoverage:o=!1}=e.multisample||{},s=e.targets||{};let l=s.writeMask||15,c=s.blendColor||{},f=s.blendColor||{};return s.targets&&s.targets[0]&&(l=s.targets[0].writeMask||l,c=s.targets[0].blendColor||c,f=s.targets[0].blendAlpha||f),{sampleCount:a,alphaToCoverage:o,topology:t.topology||4,indexFormat:t.indexFormat||m,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:n.depthWrite||!1,depthFormat:n.format||O,depthCompare:n.depthCompare||519,depthBias:n.depthBias||0,depthBiasSlopeScale:n.depthBiasSlopeScale||0,stencil:!(!n.stencilFront&&!n.stencilBack),stencilFrontCompare:r.compare||519,stencilFrontFailOp:r.failOp||h,stencilFrontDepthFailOp:r.depthFailOp||h,stencilFrontPassOp:r.passOp||h,stencilBackCompare:i.compare||519,stencilBackFailOp:i.failOp||h,stencilBackDepthFailOp:i.depthFailOp||h,stencilBackPassOp:i.passOp||h,stencilReadMask:n.stencilReadMask||he,stencilWriteMask:n.stencilWriteMask||he,blend:!!e.targets,blendWriteMask:l,blendColorOp:c.operation||32774,blendColorSrcFactor:c.srcFactor||1,blendColorDstFactor:c.dstFactor||0,blendAlphaOp:f.operation||32774,blendAlphaSrcFactor:f.srcFactor||1,blendAlphaDstFactor:f.dstFactor||0}}function Ce(e,t,n,r=0,i=!1){let a=!1,o=0,s=0,l=0,c=0;o=n.frontFace,(i||t.frontFace!==o)&&e.frontFace(o),o=n.cullMode,(i||t.cullMode!==o)&&((a=0!==o)&&e.cullFace(o),Pe(e,2884,a)),a=n.alphaToCoverage,(i||t.alphaToCoverage!==a)&&Pe(e,32926,a),a=!!n.depth,(i||t.depth!==a)&&Pe(e,2929,a),(i||a)&&(Ie(e,t.depthWrite,n.depthWrite,i),o=n.depthCompare,(i||t.depthCompare!==o)&&e.depthFunc(o)),o=n.depthBiasSlopeScale,s=n.depthBias,(i||t.depthBiasSlopeScale!==o||t.depthBias!==s)&&(Pe(e,32823,!(!o&&!s)),e.polygonOffset(o,s)),a=!!n.stencil,(i||t.stencil!==a)&&Pe(e,2960,a),(i||a)&&(o=n.stencilReadMask,a=i||t.stencilReadMask!==o,s=n.stencilFrontCompare,(a||t.stencilFrontCompare!==s)&&e.stencilFuncSeparate(1028,s,r,o),s=n.stencilBackCompare,(a||t.stencilBackCompare!==s)&&e.stencilFuncSeparate(1029,s,r,o),o=n.stencilFrontFailOp,s=n.stencilFrontDepthFailOp,l=n.stencilFrontPassOp,(i||t.stencilFrontFailOp!==o||t.stencilFrontDepthFailOp!==s||t.stencilFrontPassOp!==l)&&e.stencilOpSeparate(1028,o,s,l),o=n.stencilBackFailOp,s=n.stencilBackDepthFailOp,l=n.stencilBackPassOp,(i||t.stencilBackFailOp!==o||t.stencilBackDepthFailOp!==s||t.stencilBackPassOp!==l)&&e.stencilOpSeparate(1029,o,s,l),Le(e,t.stencilWriteMask,n.stencilWriteMask,i)),a=n.blend,(i||t.blend!==a)&&Pe(e,3042,a),(i||a)&&(o=n.blendColorSrcFactor,s=n.blendColorDstFactor,l=n.blendAlphaSrcFactor,c=n.blendAlphaDstFactor,(i||t.blendColorSrcFactor!==o||t.blendColorDstFactor!==s||t.blendAlphaSrcFactor!==l||t.blendAlphaDstFactor!==c)&&e.blendFuncSeparate(o,s,l,c),o=n.blendColorOp,s=n.blendAlphaOp,(i||t.blendColorOp!==o||t.blendAlphaOp!==s)&&e.blendEquationSeparate(o,s),Ue(e,t.blendWriteMask,n.blendWriteMask,i))}function Ue(e,t,n,r=!1){(r||t!==n)&&e.colorMask(!!(1&n),!!(2&n),!!(4&n),!!(8&n))}function Ie(e,t,n,r=!1){(r||t!==n)&&e.depthMask(n)}function Le(e,t,n,r=!1){(r||t!==n)&&e.stencilMask(n)}function Pe(e,t,n){n?e.enable(t):e.disable(t)}function Be(e,t,n){e.bindBuffer(34962,t.glb);for(let r=0;r<t.attributes.length;++r){const{ptr:i,step:a}=t.attributes[r],o=[...i];o[5]+=n,e.vertexAttribPointer(...o),e.vertexAttribDivisor(i[0],a)}}const Re=[1,0,0,0,1,0,0,0,1],De=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function ke(e){for(let t=0;t<16;++t)e[t]=t%5?0:1;return e}function ze(t,n,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return e(i(4,t,n,De),r)}function Ge(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const r=e[0]*e[5]-e[4]*e[1],i=e[0]*e[9]-e[8]*e[1],a=e[0]*e[13]-e[12]*e[1],o=e[4]*e[9]-e[8]*e[5],s=e[4]*e[13]-e[12]*e[5],l=e[8]*e[13]-e[12]*e[9],c=e[2]*e[7]-e[6]*e[3],f=e[2]*e[11]-e[10]*e[3],u=e[2]*e[15]-e[14]*e[3],d=e[6]*e[11]-e[10]*e[7],p=e[6]*e[15]-e[14]*e[7],g=e[10]*e[15]-e[14]*e[11],m=r*g-i*p+a*d+o*u-s*f+l*c;return m?(De[0]=+e[5]*g-e[9]*p+e[13]*d,De[1]=-e[1]*g+e[9]*u-e[13]*f,De[2]=+e[1]*p-e[5]*u+e[13]*c,De[3]=-e[1]*d+e[5]*f-e[9]*c,De[4]=-e[4]*g+e[8]*p-e[12]*d,De[5]=+e[0]*g-e[8]*u+e[12]*f,De[6]=-e[0]*p+e[4]*u-e[12]*c,De[7]=+e[0]*d-e[4]*f+e[8]*c,De[8]=+e[7]*l-e[11]*s+e[15]*o,De[9]=-e[3]*l+e[11]*a-e[15]*i,De[10]=+e[3]*s-e[7]*a+e[15]*r,De[11]=-e[3]*o+e[7]*i-e[11]*r,De[12]=-e[6]*l+e[10]*s-e[14]*o,De[13]=+e[2]*l-e[10]*a+e[14]*i,De[14]=-e[2]*s+e[6]*a-e[14]*r,De[15]=+e[2]*o-e[6]*i+e[10]*r,function(e,t,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return n(e,t,r)}(De,1/m,t)):null}const Ve=r;function je(e,t,n,r=[0,0,0,1]){let i=Ve(e,t),a=1;i<0&&(i*=-1,a=-1);let o=1-n,s=n;if(1-i>1e-6){const e=Math.acos(i),t=Math.sin(e);o=Math.sin((1-n)*e)/t,s=Math.sin(n*e)/t}return s*=a,r[0]=e[0]*o+t[0]*s,r[1]=e[1]*o+t[1]*s,r[2]=e[2]*o+t[2]*s,r[3]=e[3]*o+t[3]*s,r}const We=l(),He=l(),Ke=l();function Xe(e,t,n,r=1/0,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const a=1/Math.tan(t/2);if(ke(i),i[0]=a/e,i[5]=a,i[11]=-1,i[15]=0,isFinite(r)){const e=1/(n-r);i[10]=(n+r)*e,i[14]=2*n*r*e}else i[10]=-1,i[14]=-2*n;return i}function $e(t,n,r=l(0,1,0),i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const a=f(t,n,We);p(a,a);const o=g(r,a,He);p(o,o);const s=g(a,o,Ke);return p(s,s),e(o,i,0,0,3),e(s,i,0,4,3),e(a,i,0,8,3),e(t,i,0,12,3),i[3]=i[7]=i[11]=0,i[15]=1,i}const qe=5121,Je=5123,Qe=5126;function Ze(e){return e.extras||(e.extras={}),e.extras}function Ye(e,t){let n=Ze(t).input||null;if(!n){const r=e.accessors?.[t.input];if(r){const{buffer:i,byteOffset:a=0}=nt(e,r);Ze(t).input=n=new Float32Array(i.buffer,a+i.byteOffset,(i.byteLength-a)/4)}}return n}function et(e,t){let n=Ze(t).output||null;if(!n){const r=e.accessors?.[t.output];if(r){const{buffer:i,byteOffset:a=0}=nt(e,r);let o=Float32Array;switch(r.componentType){case 5120:o=Int8Array;break;case qe:o=Uint8Array;break;case 5122:case Je:o=Uint16Array}Ze(t).output=n=new o(i.buffer,a+i.byteOffset,(i.byteLength-a)/o.BYTES_PER_ELEMENT)}}return n}function tt(e){switch(e.type){case"VEC2":if(e.componentType===Qe)return 578;if(e.componentType===Je)return e.normalized?8482:290;if(e.componentType===qe)return e.normalized?8466:274;break;case"VEC3":if(e.componentType===Qe)return 579;break;case"VEC4":if(e.componentType===Qe)return 580;if(e.componentType===Je)return e.normalized?8484:292;if(e.componentType===qe)return e.normalized?8468:276}return null}function nt(e,t){let n=Ze(t).buffer,r=Ze(t).byteOffset||0;if(n)return{buffer:n,byteOffset:r};const i=function(e){let t=0;switch(e.type){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":case"MAT2":t=4;break;case"MAT3":t=9;break;case"MAT4":t=16}let n=0;switch(e.componentType){case 5120:case qe:n=1;break;case 5122:case Je:n=2;break;case 5125:case Qe:n=4}return t*n}(t);let a=t.count*i;const o=e.bufferViews?.[t.bufferView];if(o){const s=rt(e,o),l=o.byteStride||1;r=(t.byteOffset||0)%l,a=t.count*(o.byteStride||i);const c=(t.byteOffset||0)-r;n=new Uint8Array(s.buffer,s.byteOffset+c,a)}if(t.sparse){const{count:o,indices:{bufferView:s,byteOffset:l=0,componentType:c},values:{bufferView:f,byteOffset:u=0}}=t.sparse,d=e.bufferViews?.[s],p=e.bufferViews?.[f];if(d&&p){const t=new Uint8Array(a);n&&t.set(n,r);const s=rt(e,d),f=rt(e,p),g=new(c===qe?Uint8Array:c===Je?Uint16Array:Uint32Array)(s.buffer,s.byteOffset+l,o),m=new Uint8Array(f.buffer,f.byteOffset+u,o*i);for(let e=0;e<o;++e){const n=g[e]*i;for(let r=0;r<i;++r)t[n+r]=m[e*i+r]}r=0,n=t}}return n?(Ze(t).buffer=n,Ze(t).byteOffset=r):n=new Uint8Array,{buffer:n,byteOffset:r}}function rt(e,t){let n=Ze(t).buffer;if(!n){const r=e.buffers?.[t.buffer];if(r){const e=r.extras.buffer;n=new Uint8Array(e.buffer,e.byteOffset+(t.byteOffset||0),t.byteLength)}else n=new Uint8Array;Ze(t).buffer=n}return n}const it=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],at=[0,0,0,1],ot=l(1,1,1),st=l();function lt(t,n,r,i=null){const a=t.nodes?.[n];if(!a)return;i?.push(n);const o=Ze(a),s=o.matrix=o.matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.matrix?function(t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){e(t,n)}(a.matrix,s):(a.rotation||a.scale||a.translation||o.rotation||o.scale||o.translation)&&function(t,n,r,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[0],r=e[0]*e[1],i=e[0]*e[2],a=e[1]*e[1],o=e[1]*e[2],s=e[2]*e[2],l=e[3]*e[0],c=e[3]*e[1],f=e[3]*e[2];t[0]=1-2*(a+s),t[1]=2*(r+f),t[2]=2*(i-c),t[4]=2*(r-f),t[5]=1-2*(n+s),t[6]=2*(o+l),t[8]=2*(i+c),t[9]=2*(o-l),t[10]=1-2*(n+a),t[3]=t[7]=t[11]=t[12]=t[13]=t[14]=0,t[15]=1}(e,t)}(n,i);for(let e=0;e<3;++e)for(let t=0;t<3;++t)i[4*e+t]*=r[e];e(t,i,0,12,3)}(o.translation||a.translation||st,o.rotation||a.rotation||at,o.scale||a.scale||ot,s);const l=o.model=ze(r,s,o.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(a.children)for(const e of a.children)lt(t,e,l,i)}function ct(e,t){const n=e.cameras?.[t.camera];if(n){const e=Ze(t).model=Ze(t).model||it;Ze(n).view=Ge(e,Ze(n).view||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ze(n).translation=[e[12],e[13],e[14]]}}function ft(e,t){const n=e.skins?.[t.skin];if(n){const r=n.joints.length,i=Ze(t).jointMatrix=Ze(t).jointMatrix||new Float32Array(16*r),a=function(e,t){let n=Ze(t).inverseBindMatrices;if(!n){const r=e.accessors?.[t.inverseBindMatrices];if(r){const{buffer:i,byteOffset:a}=nt(e,r);n=new Float32Array(i.buffer,i.byteOffset+a,16*t.joints.length)}else n=new Float32Array(16*t.joints.length);Ze(t).inverseBindMatrices=n}return n}(e,n);for(let o=0;o<r;++o){const r=e.nodes[n.joints[o]],s=new Float32Array(i.buffer,i.byteOffset+64*o,16),l=new Float32Array(a.buffer,a.byteOffset+64*o,16);Ge(Ze(t).model||it,s),ze(s,r&&Ze(r).model||it,s),ze(s,l,s)}}}const ut=["POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","JOINTS_0","WEIGHTS_0"],dt=["POSITION","NORMAL","TANGENT"],pt=[8,12,14],gt=/(POSITION|NORMAL|TANGENT)_(\d+)/,mt={addressModeU:10497,addressModeV:10497,magFilter:ce,minFilter:ce},bt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ht=l(),At=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function vt(e,n,r,i,a){let o=!1,s=0,l=n.accessors?.[a.attributes.POSITION]?.count||0;if(!l)return;const c=function(e,t,n){let r=Ze(n).pipeline;if(r)return r;const i=n.mode||4,a=t.materials?.[n.material];let o="OPAQUE",s=!1,l=!1;a&&(s=a.doubleSided||!1,o=a.alphaMode||o,l=!!a.extensions?.KHR_materials_unlit);const c=yt(t,n),f=5125===t.accessors?.[n.indices]?.componentType?5125:5123,u=JSON.stringify([c,s,o,f,i,l]),d=Ze(t).pipelines=Ze(t).pipelines||{};if(r=d[u],r)return r;const p=[`ALPHAMODE_${o}`];for(const e of c)for(const t of e.attributes)p.push(`USE_${t.name}`),"COLOR_0"===t.name&&579===t.format&&p.push("COLOR_0_VEC3");l&&p.push("MATERIAL_UNLIT");const g=p.map((e=>`#define ${e}\n`)).join(""),m="#version 300 es\n",b=m+g+"#version 300 es\nprecision highp float;\nlayout(std140)uniform Model{mat4 A,B,C;vec4 D;};layout(std140)uniform Morph{vec4 E[2];};uniform sampler2D jointTexture;layout(location=0)in vec3 F;out vec3 vPosition;out vec2 vTexCoord0,vTexCoord1;\n#ifdef USE_NORMAL\nlayout(location=1)in vec3 G;\n#ifdef USE_TANGENT\nlayout(location=2)in vec4 H;out mat3 vTBN;\n#else\nout vec3 vNormal;\n#endif\n#endif \n#ifdef USE_TEXCOORD_0\nlayout(location=3)in vec2 I;\n#endif\n#ifdef USE_TEXCOORD_1\nlayout(location=4)in vec2 J;\n#endif\n#ifdef USE_COLOR_0\nout vec4 vColor0;\n#if defined(COLOR_0_VEC3)\nlayout(location=5)in vec3 K;\n#else\nlayout(location=5)in vec4 K;\n#endif\n#endif \n#if defined(USE_WEIGHTS_0) && defined(USE_JOINTS_0)\n#define USE_SKIN \nlayout(location=6)in vec4 L;layout(location=7)in vec4 M;mat4 N(int O){return mat4(texelFetch(jointTexture,ivec2(0,O),0),texelFetch(jointTexture,ivec2(1,O),0),texelFetch(jointTexture,ivec2(2,O),0),texelFetch(jointTexture,ivec2(3,O),0));}mat4 P(){mat4 Q=M.x*N(int(L.x))+M.y*N(int(L.y))+M.z*N(int(L.z))+M.w*N(int(L.w));return Q;}\n#endif \n#if defined(USE_POSITION_0)\n#define USE_MORPH \n#ifdef USE_POSITION_0\nlayout(location=8)in vec3 R;\n#endif\n#ifdef USE_POSITION_1\nlayout(location=9)in vec3 S;\n#endif\n#if !defined(USE_TANGENT_0)\n#ifdef USE_POSITION_2\nlayout(location=10)in vec3 T;\n#endif\n#ifdef USE_POSITION_3\nlayout(location=11)in vec3 U;\n#endif\n#if !defined(USE_NORMAL_0)\n#ifdef USE_POSITION_4\nlayout(location=12)in vec3 V;\n#endif\n#ifdef USE_POSITION_5\nlayout(location=13)in vec3 W;\n#endif\n#ifdef USE_POSITION_6\nlayout(location=14)in vec3 X;\n#endif\n#ifdef USE_POSITION_7\nlayout(location=15)in vec3 Y;\n#endif\n#endif \n#endif \n#ifdef USE_NORMAL_0\nlayout(location=12)in vec3 Z;\n#endif\n#ifdef USE_NORMAL_1\nlayout(location=13)in vec3 a;\n#endif\n#if !defined(USE_TANGENT_0)\n#ifdef USE_NORMAL_2\nlayout(location=14)in vec3 b;\n#endif\n#ifdef USE_NORMAL_3\nlayout(location=15)in vec3 c;\n#endif\n#endif \n#ifdef USE_TANGENT_0\nlayout(location=14)in vec3 d;\n#endif\n#ifdef USE_TANGENT_1\nlayout(location=15)in vec3 e;\n#endif\nvec3 f(){vec3 g=vec3(0.);\n#ifdef USE_POSITION_0\ng+=E[0].x*R;\n#endif\n#ifdef USE_POSITION_1\ng+=E[0].y*S;\n#endif\n#ifdef USE_POSITION_2\ng+=E[0].z*T;\n#endif\n#ifdef USE_POSITION_3\ng+=E[0].w*U;\n#endif\n#ifdef USE_POSITION_4\ng+=E[1].x*V;\n#endif\n#ifdef USE_POSITION_5\ng+=E[1].y*W;\n#endif\n#ifdef USE_POSITION_6\ng+=E[1].z*X;\n#endif\n#ifdef USE_POSITION_7\ng+=E[1].w*Y;\n#endif\nreturn g;}vec3 h(){vec3 g=vec3(0.);\n#ifdef USE_NORMAL_0\ng+=E[0].x*Z;\n#endif\n#ifdef USE_NORMAL_1\ng+=E[0].y*a;\n#endif\n#ifdef USE_NORMAL_2\ng+=E[0].z*b;\n#endif\n#ifdef USE_NORMAL_3\ng+=E[0].w*c;\n#endif\nreturn g;}vec3 i(){vec3 g=vec3(0.);\n#ifdef USE_TANGENT_0\ng+=E[0].x*d;\n#endif\n#ifdef USE_TANGENT_1\ng+=E[0].y*e;\n#endif\nreturn g;}\n#endif \nvec4 j(){vec4 k=vec4(F,1.);\n#ifdef USE_MORPH\nk+=vec4(f(),0.);\n#endif\n#ifdef USE_SKIN\nk=P()*k;\n#endif\nreturn k;}\n#ifdef USE_NORMAL\nvec3 l(){vec3 m=G;\n#ifdef USE_MORPH\nm+=h();\n#endif\n#ifdef USE_SKIN\nm=mat3(P())*m;\n#endif\nreturn normalize(m);}\n#ifdef USE_TANGENT\nvec3 n(){vec3 tan=H.xyz;\n#ifdef USE_MORPH\ntan+=i();\n#endif\n#ifdef USE_SKIN\ntan=mat3(P())*tan;\n#endif\nreturn normalize(tan);}\n#endif \n#endif \nvoid main(){vec4 k=A*j();vPosition=k.xyz/k.w;\n#ifdef USE_NORMAL\nmat3 o=mat3(B);\n#ifdef USE_TANGENT\nvec3 tan=n();vec3 p=normalize(o*l());vec3 q=normalize(o*tan);vec3 r=cross(p,q)*H.w;vTBN=mat3(q,r,p);\n#else\nvNormal=normalize(o*G);\n#endif \n#endif \n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\nvColor0=vec4(K,1.);\n#else\nvColor0=K;\n#endif\n#endif \nvTexCoord0=vec2(0.);vTexCoord1=vec2(0.);\n#ifdef USE_TEXCOORD_0\nvTexCoord0=I;\n#endif\n#ifdef USE_TEXCOORD_1\nvTexCoord1=J;\n#endif\ngl_Position=C*k;gl_PointSize=1.;}".replace(m,""),h=m+g+"#version 300 es\nprecision highp float;\nlayout(std140)uniform Model{mat4 A,B,C;vec4 D;};layout(std140)uniform Material{vec4 E;float F,G;float H,I;float J,K;float L,M;vec4 N;float O;};uniform sampler2D baseColorTexture;uniform sampler2D metallicRoughnessTexture;uniform sampler2D normalTexture;uniform sampler2D occlusionTexture;uniform sampler2D emissiveTexture;in vec3 vPosition;in vec2 vTexCoord0,vTexCoord1;\n#ifdef USE_COLOR_0\nin vec4 vColor0;\n#endif\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\nin mat3 vTBN;\n#else\nin vec3 vNormal;\n#endif\n#endif\nout vec4 fragColor;const float P=2.2;const float Q=3.141592653589793;vec3 R(vec3 S){return pow(S,vec3(1./P));}vec2 T(float U){return mix(vTexCoord0,vTexCoord1,step(1.,U));}vec4 V(sampler2D W,float U){return texture(W,T(U));}vec4 V(sampler2D W,float U,vec4 X){return mix(X,texture(W,T(U)),step(0.,U));}vec3 Y(vec3 Z,vec3 a,float b){return Z+(a-Z)*pow(clamp(1.-b,0.,1.),5.);}float c(float d,float e){float f=(e*e)*(d-1.)+1.;return d/(Q*f*f);}float g(float d,float h,float i){float j=1./(h+sqrt(d+(1.-d)*(h*h)));float k=1./(i+sqrt(d+(1.-d)*(i*i)));return j*k;}float l(float d,float h,float i,float e){return g(d,h,i)*c(d,e);}vec3 m(vec3 S){return S/Q;}vec4 n(){vec4 S=vec4(1.);\n#ifdef USE_COLOR_0\nS=vColor0;\n#endif\nreturn S;}vec4 o(){vec4 p=vec4(1.);p*=E;p*=V(baseColorTexture,H,vec4(1.));return p*n();}vec2 q(){vec4 r=V(metallicRoughnessTexture,I,vec4(1.));return vec2(clamp(F*r.b,0.,1.),clamp(G*r.g,.04,1.));}float s(){return V(occlusionTexture,M,vec4(1.)).r;}vec3 t(){return N.xyz*V(emissiveTexture,N.w,vec4(1.)).xyz;}struct u{vec3 ng;vec3 n;vec3 t;vec3 b;};u v(vec3 w){vec3 n,t,b,ng;\n#ifdef USE_TANGENT\nt=normalize(vTBN[0]);b=normalize(vTBN[1]);ng=normalize(vTBN[2]);\n#else\n#ifdef USE_NORMAL\nng=normalize(vNormal);\n#else\nng=normalize(cross(dFdx(w),dFdy(w)));\n#endif\nvec2 x=T(K);vec3 y=dFdx(vec3(x,0.));vec3 z=dFdy(vec3(x,0.));vec3 AA=(z.t*dFdx(w)-y.t*dFdy(w))/(y.s*z.t-z.s*y.t);t=normalize(AA-ng*dot(ng,AA));b=cross(ng,t);\n#endif\nif(gl_FrontFacing==false){t*=-1.;b*=-1.;ng*=-1.;}n=ng;if(K>=0.){n=V(normalTexture,K).rgb*2.-vec3(1.);n*=vec3(J,J,1.);n=mat3(t,b,ng)*normalize(n);}u AB;AB.ng=ng;AB.t=t;AB.b=b;AB.n=n;return AB;}\n#define LIGHT_DIRECTIONAL  0\n#define LIGHT_POINT  1\n#define LIGHT_SPOT  2\nint AC(mat4 AD){return int(AD[0].x);}vec2 AE(mat4 AD){return AD[0].zw;}vec4 AF(mat4 AD){return AD[1];}float AG(mat4 AD){return AD[2].w;}vec3 AH(mat4 AD){return AD[2].xyz;}vec3 AI(mat4 AD){return AD[3].xyz;}float AJ(float AK,float AL){if(AK<=0.){return 1./pow(AL,2.);}return max(min(1.-pow(AL/AK,4.),1.),0.)/pow(AL,2.);}float AM(vec3 AN,vec3 AO,vec2 AP){float AQ=dot(normalize(AO),normalize(-AN));float AR=1./max(.001,AP[0]-AP[1]);float AS=-AP[1]*AR;float AT=clamp(AQ*AR+AS,0.,1.);return AT*AT;}vec3 AU(mat4 AD,vec3 AV){return AC(AD)!=LIGHT_DIRECTIONAL?AI(AD)-AV:-AH(AD);}vec3 AW(mat4 AD,vec3 AN){vec4 S=AF(AD);vec3 AX=S.rgb*S.a;if(AC(AD)!=LIGHT_DIRECTIONAL){AX*=AJ(AG(AD),length(AN));}if(AC(AD)==LIGHT_SPOT){AX*=AM(AN,AH(AD),AE(AD));}return AX;}void main(){vec4 p=o();\n#ifdef ALPHAMODE_OPAQUE\np.a=1.;\n#endif\n#ifdef MATERIAL_UNLIT\ngl_FragColor=(vec4(R(p.rgb),p.a));return;\n#endif\nvec3 w=normalize(D.xyz-vPosition);u AY=v(vPosition);vec3 n=AY.n;vec3 AZ=-normalize(reflect(w,n));float i=clamp(abs(dot(n,w)),0.001,1.);vec2 Aa=q();float Ab=Aa[0];float Ac=Aa[1];float Ad=Ac*Ac;float d=Ad*Ad;vec3 Ae=vec3(0.04);vec3 Af=p.rgb*(vec3(1.)-Ae)*(1.-Ab);vec3 Ag=mix(Ae,p.rgb,Ab);float Z=max(max(Ag.r,Ag.g),Ag.b);float a=clamp(Z*25.,0.,1.);vec3 Ah=Ag.rgb;vec3 Ai=vec3(1.,1.,1.)*a;vec3 Aj=vec3(0.);vec3 Ak=vec3(0.);\n#define NUM_LIGHTS  4\nmat4 Al[4];Al[0]=mat4(0.,0.,0.,0.,1.,1.,1.,1.,.5,-.707,-.5,0.,0.,0.,0.,0.);Al[1]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,-.5,.707,.5,0.,0.,0.,0.,0.);Al[2]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,.5,.707,-.5,0.,0.,0.,0.,0.);Al[3]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,-.5,-.707,.5,0.,0.,0.,0.,0.);\n#ifdef NUM_LIGHTS\nfor(int Am=0;Am<NUM_LIGHTS;++Am){vec3 AN=AU(Al[Am],vPosition);vec3 AX=AW(Al[Am],AN);vec3 An=normalize(AN);vec3 Ao=normalize(An+w);float h=clamp(dot(n,An),0.001,1.);float e=clamp(dot(n,Ao),0.,1.);float b=clamp(dot(w,Ao),0.,1.);vec3 Ap=Y(Ah,Ai,b);vec3 Aq=(1.-Ap)*m(Af);vec3 Ar=max(vec3(0.),Ap*l(d,h,i,e));Aj+=AX*h*Aq;Ak+=AX*h*Ar;}\n#endif\nvec4 As=vec4(.1);vec3 At=As.rgb*m(Af);Aj+=At;vec3 Au=Aj+Ak;float Av=s();Au=mix(Au,Au*Av,L);vec3 Aw=t();Au+=Aw;\n#ifdef ALPHAMODE_MASK\nif(p.a<O){discard;}p.a=1.;\n#endif\nfragColor=vec4(R(Au),p.a);}".replace(m,""),A=xe(e,{usage:1,code:b}),v=xe(e,{usage:2,code:h});return r=Ze(n).pipeline=d[u]=function(e,t){const n=function(e,t,n){const r=e.gl.createProgram();return e.gl.attachShader(r,t),e.gl.attachShader(r,n),e.gl.linkProgram(r),e.gl.deleteShader(t),e.gl.deleteShader(n),r}(e,t.vertex.gls,t.fragment.gls),r=[],i={};let a=0,o=0;if(t.bindGroups){for(let s=0;s<t.bindGroups.length;++s){const l=t.bindGroups[s].entries;r.push([]);for(let t=0;t<l.length;++t){const c=l[t];let f=null,u=4294967295;0===c.type?(u=e.gl.getUniformBlockIndex(n,c.label),e.gl.uniformBlockBinding(n,u,a++)):2===c.type&&(f=e.gl.getUniformLocation(n,c.label),i[c.label]=o++),r[s][c.binding]={...c,loc:f,index:u,slot:0===c.type?a-1:2===c.type?o-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const n=t.bindGroups[e].entries;for(let t=0;t<n.length;++t)1===n[t].type&&i[n[t].label]&&(r[e][n[t].binding].slot=i[n[t].label])}}return{gl:e.gl,glp:n,buffers:t.buffers,cache:r,state:Ne(t),destroy(){this.gl.deleteProgram(this.glp)}}}(e,{vertex:A,fragment:v,buffers:c,bindGroups:[Et(0,t),_t(0,t)],primitive:{indexFormat:f,topology:i,cullMode:s?0:1029},depthStencil:{depthCompare:515,depthWrite:!("BLEND"===o)},targets:"BLEND"===o?{blendColor:{srcFactor:770,dstFactor:771},blendAlpha:{srcFactor:1,dstFactor:771}}:null}),A.destroy(),v.destroy(),r}(e,n,a);!function(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),Ce(e.gl,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const n=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)n[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let r=0;r<t.buffers.length;++r){const{attributes:i,stride:a,stepMode:o=0}=t.buffers[r],s=[];e.state.buffers[r]={glb:null,attributes:s,stride:a,step:o,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:l}of i)n[l]=(n[l]||0)+2,s.push({buffer:r,ptr:[l,de(e),pe(e),ge(e),a,t],step:o})}for(let t=0;t<n.length;++t)2===n[t]?e.gl.enableVertexAttribArray(t):1===n[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}(e,c),Ee(e,0,function(e,n,r){const i=n.materials?.[r];if(i&&Ze(i).bindGroup)return Ze(i).bindGroup;if(!i&&Ze(n).defaultMaterialBindGroup)return Ze(n).defaultMaterialBindGroup;const a=new Float32Array(20);a[0]=a[1]=a[2]=a[3]=1,a[4]=1,a[5]=1,a[6]=a[7]=a[9]=a[11]=a[15]=-1,a[8]=1,a[10]=0,a[12]=a[13]=a[14]=0,a[16]=.5;const o=Ae(e,{usage:64,size:a.byteLength});i&&(Ze(i).gpuBuffer=o);const s=[{binding:0,buffer:o},{binding:1,texture:St(e,n)},{binding:2,sampler:wt(e,n)},{binding:3,texture:St(e,n)},{binding:4,sampler:wt(e,n)},{binding:5,texture:St(e,n)},{binding:6,sampler:wt(e,n)},{binding:7,texture:St(e,n)},{binding:8,sampler:wt(e,n)},{binding:9,texture:St(e,n)},{binding:10,sampler:wt(e,n)}];if(i){if(i.pbrMetallicRoughness){const r=i.pbrMetallicRoughness;r.baseColorFactor&&t(r.baseColorFactor,a,0,0,4),(r.metallicFactor||0===r.metallicFactor)&&(a[4]=r.metallicFactor),(r.roughnessFactor||0===r.roughnessFactor)&&(a[5]=r.roughnessFactor),r.baseColorTexture&&(s[1].texture=Tt(e,n,r.baseColorTexture.index,35907),s[2].sampler=Ot(e,n,r.baseColorTexture.index),a[6]=r.baseColorTexture.texCoord||0),r.metallicRoughnessTexture&&(s[3].texture=Tt(e,n,r.metallicRoughnessTexture.index),s[4].sampler=Ot(e,n,r.metallicRoughnessTexture.index),a[7]=r.metallicRoughnessTexture.texCoord||0)}i.normalTexture&&(s[5].texture=Tt(e,n,i.normalTexture.index),s[6].sampler=Ot(e,n,i.normalTexture.index),a[8]=i.normalTexture.scale??1,a[9]=i.normalTexture.texCoord||0),i.occlusionTexture&&(s[7].texture=Tt(e,n,i.occlusionTexture.index),s[8].sampler=Ot(e,n,i.occlusionTexture.index),a[10]=i.occlusionTexture.strength||0,a[11]=i.occlusionTexture.texCoord||0),i.emissiveFactor&&t(i.emissiveFactor,a,0,12,3),i.emissiveTexture&&(s[9].texture=Tt(e,n,i.emissiveTexture.index,35907),s[10].sampler=Ot(e,n,i.emissiveTexture.index),a[15]=i.emissiveTexture.texCoord||0),(i.alphaCutoff||0===i.alphaCutoff)&&(a[16]=i.alphaCutoff)}Se(e,o,a);const l=Oe(0,{layout:Et(0,n),entries:s});return i?Ze(i).bindGroup=l:Ze(n).defaultMaterialBindGroup=l,l}(e,n,a.material)),Ee(e,1,function(e,t,n,r){if(Ze(n).modelBindGroup)return Ze(n).modelBindGroup;const i=[{binding:0,buffer:Ft(e,0,n)},{binding:1,buffer:Mt(e,t,n,r)},{binding:2,texture:Nt(e,t,n)},{binding:3,sampler:Ct(e,t)}];return Ze(n).modelBindGroup=Oe(0,{layout:_t(0,t),entries:i})}(e,n,r,i));const f=yt(n,a);for(let t=0;t<f.length;++t){const r=f[t].attributes[0].name,i=gt.exec(r),o=xt(e,n,i?a.targets[i[2]][i[1]]:a.attributes[r],32);o&&_e(e,t,o)}const u=n.accessors?.[a.indices];if(u){const t=xt(e,n,a.indices,16);t&&(function(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}(e,t),l=u.count,s=Ze(u).byteOffset||0,o=!0)}o?function(e,t,n=1,r=0,i=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==i&&(t.instanceOffset=i,Be(e.gl,t,i*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,r*(e.state.state.indexFormat===m?2:4),n)}(e,l,1,s):function(e,t,n=1,r=0,i=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==i&&(t.instanceOffset=i,Be(e.gl,t,i*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,r,t,n)}(e,l)}function yt(e,t){const n={},r=[];if(Ze(t).bufferLayouts)return Ze(t).bufferLayouts;function i(t){if(!t.sparse){const i=nt(e,t).buffer,a=`${t.bufferView},${i.byteOffset},${i.byteLength}`;if(a in n)return r[n[a]];n[a]=r.length}const i={attributes:[],stride:e.bufferViews?.[t.bufferView]?.byteStride||0};return r.push(i),i}for(let n=0;n<ut.length;++n){const r=e.accessors?.[t.attributes[ut[n]]];if(r){const e=tt(r);if(!e)continue;i(r).attributes.push({name:ut[n],format:e,shaderLocation:n,offset:Ze(r).byteOffset||0})}}if(t.targets){const n=new Array(3);let r=8;for(let a=0;a<Math.min(t.targets.length,r);++a){let o=0;for(let r=0;r<dt.length;++r)(n[r]=e.accessors?.[t.targets[a][dt[r]]])&&++o;r=8/o|0;for(let e=0;e<dt.length;++e){const t=n[e];t&&i(t).attributes.push({name:`${dt[e]}_${a}`,format:579,shaderLocation:pt[e]+a,offset:Ze(t).byteOffset||0})}}}return Ze(t).bufferLayouts=r,r}function xt(e,t,n,r){const i=t.accessors?.[n];if(!i)return null;const a=16&r&&i.componentType===qe;if(i.sparse||a){let n=Ze(i).gpuBuffer;if(!n){const o=nt(t,i);let s=o.buffer;if(a){const e=new Uint16Array(s.byteLength);for(let t=0;t<s.byteLength;++t)e[t]=s[o.byteOffset+t];s=Ze(i).buffer=new Uint8Array(e.buffer,0,e.byteLength),Ze(i).byteOffset=0}n=Ze(i).gpuBuffer=Ae(e,{usage:r,size:s.byteLength}),Se(e,n,s)}return n}const o=t.bufferViews?.[i.bufferView];if(!o)return null;const s=Ze(o).gpuBuffers=Ze(o).gpuBuffers||{},l=nt(t,i).buffer,c=`${l.byteOffset},${l.byteLength}`;return s[c]||(s[c]=Ae(e,{usage:r,size:l.byteLength}),Se(e,s[c],l)),s[c]}function Tt(e,t,n,r=32856){let i=null;const a=t.textures?.[n],o=t.images?.[a?.source];if(o&&(i=o.extras.image),!a||!i)return St(e,t);let s=Ze(a).texture;return s||(s=Ze(a).texture=ve(e,{format:r,size:[i.naturalWidth||1,i.naturalHeight||1,1],usage:4}),function(e,{src:t,origin:[n,r]=[0,0]},{texture:i,mipLevel:a=0,origin:[o,s,l]=[0,0,0]},[c,f]=[t.width-n,t.height-r]){const u=be(i.format),d=i.type===v?34069+l:i.type;e.gl.activeTexture(y),e.gl.bindTexture(i.type,i.glt),e.gl.pixelStorei(3316,n),e.gl.pixelStorei(S,r),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),ue(i.type)?e.gl.texSubImage3D(d,a,o,s,l,c,f,1,i.format,u,t):e.gl.texSubImage2D(d,a,o,s,c,f,me(i.format),u,t)}(e,{src:i},{texture:s})),s}function Ot(e,t,n){const r=t.textures?.[n],i=t.samplers?.[r?.sampler];if(!i)return wt(e,t);let a=Ze(i).sampler;if(!a){const t={...mt};switch(t.addressModeU=i.wrapS||t.addressModeU,t.addressModeV=i.wrapT||t.addressModeV,t.magFilter=i.magFilter||t.magFilter,i.minFilter){case 9984:t.minFilter=le,t.mipmapFilter=le;break;case 9986:t.minFilter=le,t.mipmapFilter=ce;break;case 9985:t.minFilter=ce,t.mipmapFilter=le;case 9987:t.minFilter=ce,t.mipmapFilter=ce;break;default:t.minFilter=i.minFilter}a=Ze(i).sampler=ye(e,t)}return a}function St(e,t){let n=Ze(t).blankTexture;return n||(n=Ze(t).blankTexture=ve(e,{usage:4}),we(e,{texture:n},new Uint8Array([255,255,255,255]),{bytesPerRow:4}),n)}function wt(e,t){let n=Ze(t).defaultSampler;return n||(n=Ze(t).defaultSampler=ye(e,mt)),n}function _t(e,t){let n=Ze(t).modelLayout;return n||(n=Ze(t).modelLayout=Te(0,{entries:[{binding:0,label:"Model",type:0},{binding:1,label:"Morph",type:0},{binding:2,label:"jointTexture",type:2},{binding:3,label:"jointTexture",type:1}]})),n}function Et(e,t){let n=Ze(t).materialLayout;return n||(n=Ze(t).materialLayout=Te(0,{entries:[{binding:0,label:"Material",type:0},{binding:1,label:"baseColorTexture",type:2},{binding:2,label:"baseColorTexture",type:1},{binding:3,label:"metallicRoughnessTexture",type:2},{binding:4,label:"metallicRoughnessTexture",type:1},{binding:5,label:"normalTexture",type:2},{binding:6,label:"normalTexture",type:1},{binding:7,label:"occlusionTexture",type:2},{binding:8,label:"occlusionTexture",type:1},{binding:9,label:"emissiveTexture",type:2},{binding:10,label:"emissiveTexture",type:1}]})),n}function Ft(e,r,i,a=null){let o=Ze(i).modelBuffer;if(o||(o=Ze(i).modelBuffer=Ae(e,{usage:8256,size:208})),a){const r=new Float32Array(a.buffer,0,16);t(Ze(i).model||bt,r,0,0,16);const s=new Float32Array(a.buffer,64,16),l=function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){const r=function(e){return e[0]*+(e[4]*e[8]-e[7]*e[5])+e[3]*-(e[1]*e[8]-e[7]*e[2])+e[6]*+(e[1]*e[5]-e[4]*e[2])}(e);return r?(Re[0]=+(e[4]*e[8]-e[7]*e[5]),Re[1]=-(e[1]*e[8]-e[7]*e[2]),Re[2]=+(e[1]*e[5]-e[4]*e[2]),Re[3]=-(e[3]*e[8]-e[6]*e[5]),Re[4]=+(e[0]*e[8]-e[6]*e[2]),Re[5]=-(e[0]*e[5]-e[3]*e[2]),Re[6]=+(e[3]*e[7]-e[6]*e[4]),Re[7]=-(e[0]*e[7]-e[6]*e[1]),Re[8]=+(e[0]*e[4]-e[3]*e[1]),function(e,t,r=[1,0,0,0,1,0,0,0,1]){return n(e,t,r)}(Re,1/r,t)):null}(e,t)?function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t,n){let r=0;for(let e=0;e<3;++e)for(let i=e;i<3;++i)r=t[3*i+e],n[3*i+e]=t[3*e+i],n[3*e+i]=r;return n}(0,e,t)}(t,t):null}(function(e,t=[1,0,0,0,1,0,0,0,1]){for(let n=0;n<3;++n)for(let r=0;r<3;++r)t[3*n+r]=e[4*n+r];return t}(e,t),t)}(r);l?function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){for(let n=0;n<3;++n){for(let r=0;r<3;++r)t[4*n+r]=e[3*n+r];t[4*n+3]=0}t[12]=t[13]=t[14]=0,t[15]=1}(l,s):t(r,s,0,0,16),Se(e,o,a)}return o}function Mt(e,n,r,i,a=!1){const o=Ze(r).weights||r.weights||i.weights;if(!o)return function(e,t){let n=Ze(t).morphBuffer;return n||(n=Ze(t).morphBuffer=Ae(e,{usage:64,size:32})),n}(e,n);let s=Ze(r).morphBuffer;if(s||(s=Ze(r).morphBuffer=Ae(e,{usage:8256,size:32})),a){const n=new Float32Array(8);t(o,n,0,0,8),Se(e,s,n)}return s}function Nt(e,t,n,r=!1){const i=t.skins?.[n.skin];if(!i)return St(e,t);let a=i.joints.length,o=Ze(n).jointTexture;return o||(o=Ze(n).jointTexture=ve(e,{size:[4,a,1],format:34836,usage:4})),r&&we(e,{texture:o},Ze(n).jointMatrix=Ze(n).jointMatrix||new Float32Array(16*a),{bytesPerRow:64,rowsPerImage:a},[4,a,1]),o}function Ct(e,t){let n=Ze(t).jointSampler;return n||(n=Ze(t).jointSampler=ye(e,{})),n}const Ut=new TextDecoder("utf-8");function It(e){return Ut.decode(e)}function Lt(e){return/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)}function Pt(e,t){return""===e?"":/^(https?:)?\/\//i.test(e)||Lt(e)?e:t+e}const Bt=1179937895;async function Rt(e,t=Dt){const n=e.uri?function(e){if(Lt(e))return"";const t=e.split(/[?#]/)[0].split("/");return t.pop(),t.length?t.join("/")+"/":""}(e.uri):"";let r=e.glTF,i=e.binaryChunk;if(!r&&e.uri){const n=await t(e.uri,"bin");if(a=n,new DataView(a.buffer||a,a.byteOffset||0,4).getUint32(0,!0)===Bt){const e=function(e){let t,n;const r=e.buffer||e,i=e.byteOffset||0,a=new DataView(r,i,12);if(a.getUint32(0,!0)!==Bt)throw new Error("Invalid GLB format");const o=a.getUint32(4,!0);if(2!==o)throw new Error("Unsupported GLB version: "+o);const s=new DataView(r,i+12);let l=0;for(;l<s.byteLength;){const e=s.getUint32(l,!0),a=s.getUint32(l+4,!0);if(l+=8,1313821514===a){const n=new Uint8Array(r,i+12+l,e);t=JSON.parse(It(n))}else 5130562===a&&(n=new Uint8Array(r,i+12+l,e));l+=e}if(!t)throw new Error("Invalid GLB format: missing JSON content");if(!t.asset||"2.0"!==t.asset.minVersion&&"2.0"!==t.asset.version)throw new Error("Unsupported glTF version: 2.0 required");return{glTF:t,binaryChunk:n}}(n);r=e.glTF,i=e.binaryChunk}else r=JSON.parse(It(n))}var a;if(!r)throw new Error("Failed to load glTF JSON");const o=await async function(e,t,n,r){if(e.buffers)for(let i=0;i<e.buffers.length;++i){const a=e.buffers[i];if(Ze(a).buffer)continue;let o;const s=a.uri;if(s)o=await n(Pt(s,r),"bin");else{if(0!==i||!t)throw new Error("Invalid glTF: missing uri for buffer "+i);o=t}Ze(a).buffer=o}return e}(r,i,t,n);return await async function(e,t,n){if(e.images)for(let r=0;r<e.images.length;++r){const i=e.images[r];if(Ze(i).image)continue;const a=i.bufferView;let o,s=!1,l=i.uri;if(a){const t=e.bufferViews?.[a];if(!t)throw new Error("Invalid glTF: invalid bufferView for image "+r);const n=new Blob([rt(e,t)],{type:i.mimeType});l=URL.createObjectURL(n),s=!0}if(!l)throw new Error("Invalid glTF: missing uri or bufferView for image "+r);try{o=await t(Pt(l,n),"img")}finally{s&&URL.revokeObjectURL(l)}Ze(i).image=o}return e}(o,t,n)}function Dt(e,t){return"img"===t?new Promise(((t,n)=>{const r=new Image;r.crossOrigin="anonymous",r.onerror=()=>n(new Error("Failed to load: "+e)),r.onload=()=>t(r),r.src=e})):fetch(e).then((e=>e.arrayBuffer())).then((e=>new Uint8Array(e)))}const kt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function zt(e,t,n,r){const i=p(n),[a,o]=function(e,t,n,r){for(let n=0;n<3;++n)e[n]=1/0,t[n]=-1/0;const i=l(),a=l();let o=(r.nodes||[]).slice();for(;o.length>0;){const r=n.nodes?.[o.pop()];if(!r)continue;o=o.concat(r.children||[]);const s=n.meshes?.[r.mesh];if(s)for(const o of s.primitives){const s=n.accessors?.[o.attributes.POSITION];if(s){Ht(i,a,s,r.extras?.model||kt);for(let n=0;n<3;++n)e[n]=Math.min(e[n],i[n]),t[n]=Math.max(t[n],a[n])}}}return[e,t]}(l(),l(),e,e.scenes[t]),s=Math.max(o[0]-a[0],o[1]-a[1]),g=Math.PI/4,m=g*r,b=s/2/Math.tan(g/2),h=s/2/Math.tan(m/2),A=Math.max(h,b);u(i,-1.2*A,i);const v=d(f(a,o));let y=A+6*v,x=A-6*v;x=Math.max(x,y/1e4);const T=l();return c(a,o,T),u(T,.5,T),{model:$e(i,T),proj:Xe(r,g,x,y)}}const Gt=l(),Vt=l(),jt=l(),Wt=l();function Ht(t,n,r,i){const a=[...r.min,1],o=[...r.max,1];s(i,a,a),s(i,o,o),e(a,Gt,0,0,3),e(o,Vt,0,0,3),c(Vt,Gt,jt),u(jt,.5,jt),f(Vt,jt,Wt);const l=d(Wt);for(let e=0;e<3;++e)t[e]=jt[e]-l,n[e]=jt[e]+l}const Kt=l(-1,-2,-2),Xt=new URLSearchParams(window.location.search),$t=document.querySelector("canvas"),qt=$t.parentElement;let Jt=null,Qt=0,Zt=0;const Yt=function(e,t={},n=0){const r=e.getContext("webgl2",t);if(r){let t=0;for(const e in fe)n&+e&&r.getExtension(fe[+e])&&(t|=+e);return{canvas:e,gl:r,features:t,pass:null,state:Fe(r),destroy(){this.gl.deleteFramebuffer(this.state.copyFrameBuffer)}}}return null}($t,{powerPreference:"low-power"}),en="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/63f026b2aa957d3e8207f6dd798608993e33fb0d/2.0";function tn(n=0){if(window.requestAnimationFrame(tn),!Jt)return;Qt||(Qt=n);const r=n-Qt,i=Xt.get("camera"),a=Xt.get("scene"),o=((null!==a&&parseInt(a))??Jt.scene)||0;Jt.animations?.length&&(function(t,n,r=0,i=!1){const a=function(e,t){let n=Ze(t).duration||0;for(const r of t.channels){const i=e.nodes?.[r.target.node],a=e.accessors?.[t.samplers[r.sampler]?.input];i&&a&&(n=Math.max(n,a.max?.[0]||0))}return Ze(t).duration=n}(t,n),o=i?r-Math.floor(r/a)*a:Math.min(r,a);for(const r of n.channels){const i=t.nodes?.[r.target.node],a=n.samplers[r.sampler];if(!i||!a)continue;const s=Ye(t,a),l=et(t,a);if(!s?.length||!l)continue;const c=s.length,f=s[0],u=s[c-1];let d,p;if(o<=f)d=p=0;else if(o>=u)d=p=c-1;else{let e=Ze(r).lastKeyframe||0;for(s[e]>o&&(e=0),d=e,p=d+1;p<c&&!(s[d]<=o&&s[p]>o);++d,++p);}Ze(r).lastKeyframe=d;const g=r.target.path;let m=3;switch(g){case"rotation":m=4;break;case"weights":m=i.weights?.length||t.meshes?.[i.mesh]?.weights?.length||0}if(!m)continue;let b=a.interpolation;d===p&&(b="STEP");const h=s[d],A=s[p],v=(o-h)/(A-h),y=Ze(i)[g]=Ze(i)[g]||new Array(m),x=new Array(m);switch(b){case"STEP":e(l,y,d*m,0,m);break;case"CUBICSPLINE":{const e=A-h,t=v*v,n=v*t;for(let r=0;r<m;++r)y[r]=(2*n-3*t+1)*l[(3*d+1)*m+r]+(n-2*t+v)*e*l[(3*d+2)*m+r]+(-2*n+3*t)*l[(3*p+1)*m+r]+(n-t)*e*l[3*p*m+r];break}default:if("rotation"===g)e(l,y,d*m,0,m),e(l,x,p*m,0,m),je(y,x,v,y);else for(let e=0;e<m;++e)y[e]=(1-v)*l[d*m+e]+v*l[p*m+e]}}return r<a}(Jt,Jt.animations[Zt],r/1e3)||(Qt=n,Zt=(Zt+1)%Jt.animations.length)),function(e,n,r,i={}){const a=(i.scene??r.scene)||0,o=r.nodes,s=r.scenes?.[a]?.nodes;if(!o||!s)return;const c=function(e,t={}){let n=[];const r=e.scenes?.[(t.scene??e.scene)||0]?.nodes;if(r)for(let t=0;t<r.length;++t)lt(e,r[t],it,n);n=n.sort().filter(((e,t,n)=>!t||e!==n[t-1]));for(const t of n){const n=e.nodes[t];"camera"in n&&ct(e,n),"skin"in n&&ft(e,n)}return n}(r,{scene:a});let f=bt,u=bt,d=ht;if(i.camera){const t=r.cameras?.[i.camera.index||0];t&&(f=t.extras?.view||bt,p=At,g=t,m=e.width/e.height,g?.orthographic?function(e,t,n,r,i,a,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const s=1/(t-e),l=1/(r-n),c=1/(i-a);ke(o),o[0]=2*s,o[5]=2*l,o[10]=2*c,o[12]=-(t+e)*s,o[13]=-(r+n)*l,o[14]=(i+a)*c}(-g.orthographic.xmag,g.orthographic.xmag,-g.orthographic.xmag/(m||1),g.orthographic.xmag/(m||1),g.orthographic.znear,g.orthographic.zfar,p):g?.perspective?Xe(m||g.perspective.aspectRatio||1,g.perspective.yfov,g.perspective.znear,g.perspective.zfar||1/0,p):ke(p),u=p,d=t.extras?.translation||ht),i.camera.model&&(d=l(i.camera.model[12],i.camera.model[13],i.camera.model[14]),Ge(i.camera.model,f)),u=i.camera.proj||u}var p,g,m;const b=ze(u,f,At),h=new Float32Array(52);t(b,h,0,32,16),t(d,h,0,48,3),function(e,t={}){e.gl.bindFramebuffer(36160,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Pe(e.gl,3089,!1));let n=0;isNaN(t.clearDepth)||(n|=256,e.gl.clearDepth(t.clearDepth),Ie(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(n|=1024,e.gl.clearStencil(t.clearStencil),Le(e.gl,e.state.state.stencilWriteMask,255),e.state.state.stencilWriteMask=255),t.clearColor&&(n|=16384,e.gl.clearColor(...t.clearColor),Ue(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15),n&&e.gl.clear(n),e.pass=null}(n,{clearDepth:1});const A=[];for(let e=0;e<c.length;++e){const t=o[c[e]],i=r.meshes?.[t.mesh];if(i){Ft(n,0,t,h),Mt(n,r,t,i,!0),Nt(n,r,t,!0);for(let e=0;e<i.primitives.length;++e){const a=i.primitives[e];"BLEND"===r.materials?.[a.material]?.alphaMode?A.push({node:t,mesh:i,primitive:a}):vt(n,r,t,i,a)}}}for(const e of A)vt(n,r,e.node,e.mesh,e.primitive);!function(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&Me(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],16384,36064+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&Me(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}(n)}($t,Yt,Jt,{scene:o,camera:Jt.cameras?{index:parseInt(i)||0}:zt(Jt,o,Kt,$t.width/$t.height)})}function nn(){const e=window.devicePixelRatio||1,t=qt.clientWidth,n=qt.clientHeight;$t.width=t*e,$t.height=n*e,$t.style.width=`${t}px`,$t.style.height=`${n}px`}window.addEventListener("resize",nn,!1),nn(),async function(){let e=Xt.get("url");if(!e){const t=await(await fetch(`${en}/model-index.json`)).json(),n=Xt.get("model")||"BrainStem",r=Xt.get("variant")||"glTF",i=t.find((e=>e.name===n));e=`${en}/${n}/${r}/${i.variants[r]}`}const t=await Rt({uri:e});Jt=t,tn()}()})();