(()=>{"use strict";function e(e,t,n=0,r=0,o=e.length-n){for(let i=0;i<o;++i)t[r+i]=e[n+i];return t}function t(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}const n=r();function r(e=0,t=0,n=0,r=0){return[e,t,n,r]}function o(t,o,i=r()){return e(function(e,t,n,r){const o=t.length/4,i=n.length/4;let a=0;for(let e=0;e<i;++e)for(let i=0;i<o;++i){a=0;for(let r=0;r<4;++r)a+=t[r*o+i]*n[4*e+r];r[e*o+i]=a}return r}(0,t,o,n),i)}function i(e=0,t=0,n=0){return[e,t,n]}function a(e,t,n=i()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]+t[r];return n}(e,t,n)}function s(e,t,n=i()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]-t[r];return n}(e,t,n)}function l(e,n,r=i()){return t(e,n,r)}function c(e){return Math.sqrt(function(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n}(e,e))}function f(e,n=i()){return t(e,1/(c(e)||1),n)}function u(e,t,n=i()){const r=e[2]*t[0]-t[2]*e[0],o=e[0]*t[1]-t[0]*e[1];return n[0]=e[1]*t[2]-t[1]*e[2],n[1]=r,n[2]=o,n}i(),r(),r();const d=34962,h=1028,g=1029,v=5120,m=5121,p=5122,b=5123,x=5126,T=6408,y=519,w=7680,O=9728,S=36160,C=36161,F=[x,v,m,p,b],_=[4,1,1,2,2],E=255;function L(e){return _[e&E]*N(e)}function N(e){return e>>8&E}function M(e){return F[e&E]}function I(e){return!!(e>>16)}function R(e){return e-b+2}class A{constructor(e,t){this.gl=e,this.props={type:d,usage:35044,...t},e.bindBuffer(this.props.type,this.glb=e.createBuffer()),e.bufferData(this.props.type,this.props.size,this.props.usage)}data(e,t=0){return this.gl.bindBuffer(this.props.type,this.glb),this.gl.bufferSubData(this.props.type,t,e),this}destroy(){this.gl.deleteBuffer(this.glb)}}class U{constructor(e,t,n){this.glt=null,this.glrb=null,this.gl=e;const r=this.props={type:3553,format:263169,width:1,height:1,...t},o=this.sampler={wrapU:33071,wrapV:33071,magFilter:O,minFilter:O,...n};r.format<=197381?(e.bindRenderbuffer(C,this.glrb=e.createRenderbuffer()),e.renderbufferStorage(C,34041,r.width,r.height)):(e.bindTexture(r.type,this.glt=e.createTexture()),e.texParameteri(r.type,10241,o.minFilter),e.texParameteri(r.type,10240,o.magFilter),e.texParameteri(r.type,10242,o.wrapU),e.texParameteri(r.type,10243,o.wrapV),e.texImage2D(r.type,0,T,r.width,r.height,0,T,m,null))}data(e,[t,n]=[0,0,0],[r,o]=[this.props.width-t,this.props.height-n,0]){return this.gl.bindTexture(this.props.type,this.glt),e.buffer?this.gl.texSubImage2D(this.props.type,0,t,n,r,o,T,m,e.buffer):e.image&&this.gl.texSubImage2D(this.props.type,0,t,n,T,m,e.image),this}mipmap(){return this.gl.bindTexture(this.props.type,this.glt),this.gl.generateMipmap(this.props.type),this}destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb)}}class D{constructor(e,t,n){if(this.glfb=null,this.gl=e,this.props=t,t.color&&t.color.length){e.bindFramebuffer(S,this.glfb=e.createFramebuffer());const r=n?t.color.length:1;for(let n=0;n<r;++n)e.framebufferTexture2D(S,36064+n,t.color[n].tex.props.type,t.color[n].tex.glt,0);r>1&&n.drawBuffersWEBGL(t.color.map(((e,t)=>36064+t))),t.depth&&e.framebufferRenderbuffer(S,33306,C,t.depth.tex.glrb)}}destroy(){this.gl.deleteFramebuffer(this.glfb)}resolve(){}}class P{constructor(e,t){this.gl=e;const n=this.gls=e.createShader(this.type=t.type);e.shaderSource(n,this.source=t.source),e.compileShader(n)}destroy(){this.gl.deleteShader(this.gls)}}class G{constructor(e,t){this.gl=e;let n=0;this.props={mode:4,indexFormat:b,...t,buffers:t.buffers.map((({attrs:e,stride:t,instanced:r=!1})=>{this.i=this.i||r;const o=Array(e.length);let i=0;for(let t=0;t<e.length;++t,++n){const{name:r,format:a,offset:s=i,shaderLoc:l=n}=e[t];o[t]={name:r,format:a,offset:s,shaderLoc:l},i=Math.max(i,s)+L(a)}return{attrs:o,stride:t||i,instanced:r}}))},this.glp=function(e,t,n,r){const o=e.createProgram();e.attachShader(o,t.gls),e.attachShader(o,n.gls);for(const{attrs:t}of r)for(const n of t)e.bindAttribLocation(o,n.shaderLoc,n.name);return e.linkProgram(o),o}(e,t.vert,t.frag,this.props.buffers)}destroy(){this.gl.deleteProgram(this.glp)}}function B(e,t,n){n?e.enable(t):e.disable(t)}class k{constructor(e){this.webgl2=!1,this.gl=e,this.canvas=e.canvas,this.d=this.feature("WEBGL_draw_buffers"),this.r=new V(e,this.feature("ANGLE_instanced_arrays"))}get width(){return this.gl.drawingBufferWidth}get height(){return this.gl.drawingBufferHeight}buffer(e){return new A(this.gl,e)}texture(e,t){return new U(this.gl,e,t)}shader(e){return new P(this.gl,e)}pipeline(e){return new G(this.gl,e)}pass(e={}){return new D(this.gl,e,this.d)}render(e){let t=this.width,n=this.height;e.props.color&&({width:t,height:n}=e.props.color[0].tex.props),this.gl.bindFramebuffer(S,e.glfb),this.gl.viewport(0,0,t,n);let r=0;return e.props.clearColor&&(r|=16384,this.gl.clearColor(...e.props.clearColor),this.gl.colorMask(!0,!0,!0,!0)),isNaN(e.props.clearDepth)||(r|=256,this.gl.clearDepth(e.props.clearDepth),this.gl.depthMask(!0)),isNaN(e.props.clearStencil)||(r|=1024,this.gl.clearStencil(e.props.clearStencil),this.gl.stencilMask(E)),r&&this.gl.clear(r),this.r}feature(e){return this.gl.getExtension(e)}reset(){this.r.reset()}}class V{constructor(e,t){this.gl=e,this.inst=t,this.reset()}reset(){this.s={p:null,r:0}}pipeline(e){if(this.s.p!==e){this.s.p=e,this.gl.useProgram(e.glp),function(e,t,n=0){const{blend:r,depth:o,stencil:i}=t,a=t.raster||{};if(B(e,32926,!!a.alphaToCoverage),B(e,2884,!!a.cullMode),B(e,32823,!(!a.depthBiasSlopeScale&&!a.depthBias)),e.polygonOffset(a.depthBiasSlopeScale||0,a.depthBias||0),a.cullMode&&e.cullFace(a.cullMode),e.frontFace(a.frontFace||2305),B(e,2929,!!o),o&&(e.depthMask(!!o.write),e.depthFunc(o.compare||y)),B(e,2960,!!i),i){var s,l;e.stencilMask(null!==(s=i.writeMask)&&void 0!==s?s:E);const t=null!==(l=i.readMask)&&void 0!==l?l:E;e.stencilFuncSeparate(h,i.frontCompare||y,n,t),e.stencilFuncSeparate(g,i.backCompare||y,n,t),e.stencilOpSeparate(h,i.frontFailOp||w,i.frontZFailOp||w,i.frontPassOp||w),e.stencilOpSeparate(g,i.backFailOp||w,i.backZFailOp||w,i.backPassOp||w)}if(B(e,3042,!!r),r){const t=r.colorMask||E;e.colorMask(!!(1&t),!!(2&t),!!(4&t),!!(8&t)),e.blendFuncSeparate(r.srcFactorRGB||1,r.dstFactorRGB||0,r.srcFactorAlpha||1,r.dstFactorAlpha||0),e.blendEquationSeparate(r.opRGB||32774,r.opAlpha||32774)}}(this.gl,e.props,this.s.r);for(let e=0;e<16;++e)this.gl.disableVertexAttribArray(e);for(const{attrs:t}of e.props.buffers)for(const{shaderLoc:e}of t)this.gl.enableVertexAttribArray(e)}return this}index({glb:e}){return this.gl.bindBuffer(34963,e),this}vertex(e,{glb:t}){const{attrs:n,stride:r,instanced:o}=this.s.p.props.buffers[e];this.gl.bindBuffer(d,t);for(const{format:e,offset:t,shaderLoc:i}of n)this.gl.vertexAttribPointer(i,N(e),M(e),I(e),r,t),this.inst&&this.inst.vertexAttribDivisorANGLE(i,o?1:0);return this}uniforms(e){let t=0;for(const n of e){const e=this.gl.getUniformLocation(this.s.p.glp,n.name);if(e)if(n.values){const t=this.s.p.props.uniforms.find((e=>e.name===n.name));if(t)switch(t.valueFormat){case 35676:this.gl.uniformMatrix4fv(e,!1,n.values);break;case 35675:this.gl.uniformMatrix3fv(e,!1,n.values);break;case 35666:this.gl.uniform4fv(e,n.values);break;case 35665:this.gl.uniform3fv(e,n.values);break;case 35664:this.gl.uniform2fv(e,n.values);break;default:this.gl.uniform1fv(e,n.values)}}else n.tex?(this.gl.activeTexture(33984+t),this.gl.bindTexture(n.tex.props.type,n.tex.glt),this.gl.uniform1i(e,t++)):isNaN(n.value)||this.gl.uniform1f(e,n.value)}return this}draw(e,t=1,n=0){const{props:{mode:r},i:o}=this.s.p;return o?this.inst&&this.inst.drawArraysInstancedANGLE(r,n,e,t):this.gl.drawArrays(r,n,e),this}drawIndexed(e,t=1,n=0){const{props:{indexFormat:r,mode:o},i}=this.s.p;return i?this.inst&&this.inst.drawElementsInstancedANGLE(o,e,r,n*R(r),t):this.gl.drawElements(o,e,r,n*R(r)),this}viewport(e,t,n,r){return this.gl.viewport(e,t,n,r),this}scissor(e,t,n,r){return this}blendColor(e){return this.gl.blendColor(...e),this}stencilRef(e){{const n=this.s.p&&this.s.p.props.stencil;if(n){var t;const r=null!==(t=n.readMask)&&void 0!==t?t:E;this.gl.stencilFuncSeparate(h,n.frontCompare||y,e,r),this.gl.stencilFuncSeparate(g,n.backCompare||y,e,r)}this.s.r=e}return this}end(){}}function H(e){return(new TextDecoder).decode(e)}function z(e){return/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)}function $(e,t){return""===e?"":/^(https?:)?\/\//i.test(e)||z(e)?e:t+e}const j=1179937895;function W(e,t,n=0,r=0,o=e.length-n){for(let i=0;i<o;++i)t[r+i]=e[n+i];return t}function q(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}const J=[1,0,0,0,1,0,0,0,1];const X=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function K(e){for(let t=0;t<16;++t)e[t]=t%5?0:1;return e}function Q(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return W(e,t)}function Z(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return W(function(e,t,n,r){const o=t.length/4,i=n.length/4;let a=0;for(let e=0;e<i;++e)for(let i=0;i<o;++i){a=0;for(let r=0;r<4;++r)a+=t[r*o+i]*n[4*e+r];r[e*o+i]=a}return r}(0,e,t,X),n)}function Y(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[5]-e[4]*e[1],r=e[0]*e[9]-e[8]*e[1],o=e[0]*e[13]-e[12]*e[1],i=e[4]*e[9]-e[8]*e[5],a=e[4]*e[13]-e[12]*e[5],s=e[8]*e[13]-e[12]*e[9],l=e[2]*e[7]-e[6]*e[3],c=e[2]*e[11]-e[10]*e[3],f=e[2]*e[15]-e[14]*e[3],u=e[6]*e[11]-e[10]*e[7],d=e[6]*e[15]-e[14]*e[7],h=e[10]*e[15]-e[14]*e[11],g=n*h-r*d+o*u+i*f-a*c+s*l;return g?(X[0]=+e[5]*h-e[9]*d+e[13]*u,X[1]=-e[1]*h+e[9]*f-e[13]*c,X[2]=+e[1]*d-e[5]*f+e[13]*l,X[3]=-e[1]*u+e[5]*c-e[9]*l,X[4]=-e[4]*h+e[8]*d-e[12]*u,X[5]=+e[0]*h-e[8]*f+e[12]*c,X[6]=-e[0]*d+e[4]*f-e[12]*l,X[7]=+e[0]*u-e[4]*c+e[8]*l,X[8]=+e[7]*s-e[11]*a+e[15]*i,X[9]=-e[3]*s+e[11]*o-e[15]*r,X[10]=+e[3]*a-e[7]*o+e[15]*n,X[11]=-e[3]*i+e[7]*r-e[11]*n,X[12]=-e[6]*s+e[10]*a-e[14]*i,X[13]=+e[2]*s-e[10]*o+e[14]*r,X[14]=-e[2]*a+e[6]*o-e[14]*n,X[15]=+e[2]*i-e[6]*r+e[10]*n,function(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return q(e,t,n)}(X,1/g,t)):null}function ee(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){const n=function(e){return e[0]*+(e[4]*e[8]-e[7]*e[5])+e[3]*-(e[1]*e[8]-e[7]*e[2])+e[6]*+(e[1]*e[5]-e[4]*e[2])}(e);return n?(J[0]=+(e[4]*e[8]-e[7]*e[5]),J[1]=-(e[1]*e[8]-e[7]*e[2]),J[2]=+(e[1]*e[5]-e[4]*e[2]),J[3]=-(e[3]*e[8]-e[6]*e[5]),J[4]=+(e[0]*e[8]-e[6]*e[2]),J[5]=-(e[0]*e[5]-e[3]*e[2]),J[6]=+(e[3]*e[7]-e[6]*e[4]),J[7]=-(e[0]*e[7]-e[6]*e[1]),J[8]=+(e[0]*e[4]-e[3]*e[1]),function(e,t,n=[1,0,0,0,1,0,0,0,1]){return q(e,t,n)}(J,1/n,t)):null}(e,t)?function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t,n){let r=0;for(let e=0;e<3;++e)for(let o=e;o<3;++o)r=t[3*o+e],n[3*o+e]=t[3*e+o],n[3*e+o]=r;return n}(0,e,t)}(t,t):null}(function(e,t=[1,0,0,0,1,0,0,0,1]){for(let n=0;n<3;++n)for(let r=0;r<3;++r)t[3*n+r]=e[4*n+r];return t}(e,t),t)}function te(e=0,t=0,n=0,r=0){return[e,t,n,r]}te();const ne=function(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n};function re(e,t,n,r=[0,0,0,1]){let o=ne(e,t),i=1;o<0&&(o*=-1,i=-1);let a=1-n,s=n;if(1-o>1e-6){const e=Math.acos(o),t=Math.sin(e);a=Math.sin((1-n)*e)/t,s=Math.sin(n*e)/t}return s*=i,r[0]=e[0]*a+t[0]*s,r[1]=e[1]*a+t[1]*s,r[2]=e[2]*a+t[2]*s,r[3]=e[3]*a+t[3]*s,r}function oe(e=0,t=0,n=0){return[e,t,n]}oe(),te(),te(),oe(),oe(),oe();const ie=3553,ae=x,se=35676;function le(e){return e.extras||(e.extras={}),e.extras}function ce(e,t){let n=le(t).input||null;if(!n){var r;const o=null===(r=e.accessors)||void 0===r?void 0:r[t.input];if(o){const{buffer:r,byteOffset:i=0}=de(e,o);le(t).input=n=new Float32Array(r.buffer,i+r.byteOffset,(r.byteLength-i)/4)}}return n}function fe(e,t){let n=le(t).output||null;if(!n){var r;const o=null===(r=e.accessors)||void 0===r?void 0:r[t.output];if(o){const{buffer:r,byteOffset:i=0}=de(e,o);let a=Float32Array;switch(o.componentType){case v:a=Int8Array;break;case m:a=Uint8Array;break;case p:case b:a=Uint16Array}le(t).output=n=new a(r.buffer,i+r.byteOffset,(r.byteLength-i)/a.BYTES_PER_ELEMENT)}}return n}function ue(e){switch(e.type){case"VEC2":if(e.componentType===x)return 512;if(e.componentType===b)return e.normalized?66052:516;if(e.componentType===m)return e.normalized?66050:514;break;case"VEC3":if(e.componentType===x)return 768;break;case"VEC4":if(e.componentType===x)return 1024;if(e.componentType===m)return e.normalized?66562:1026;if(e.componentType===b)return e.normalized?66564:1028}return null}function de(e,t){var n;let r=le(t).buffer,o=le(t).byteOffset||0;if(r)return{buffer:r,byteOffset:o};const i=function(e){let t=0;switch(e.type){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":case"MAT2":t=4;break;case"MAT3":t=9;break;case"MAT4":t=16}let n=0;switch(e.componentType){case v:case m:n=1;break;case p:case b:n=2;break;case 5125:case x:n=4}return t*n}(t);let a=t.count*i;const s=null===(n=e.bufferViews)||void 0===n?void 0:n[t.bufferView];if(s){const n=he(e,s),l=s.byteStride||1;o=(t.byteOffset||0)%l,a=t.count*(s.byteStride||i);const c=(t.byteOffset||0)-o;r=new Uint8Array(n.buffer,n.byteOffset+c,a)}if(t.sparse){var l,c;const{count:n,indices:{bufferView:s,byteOffset:f=0,componentType:u},values:{bufferView:d,byteOffset:h=0}}=t.sparse,g=null===(l=e.bufferViews)||void 0===l?void 0:l[s],v=null===(c=e.bufferViews)||void 0===c?void 0:c[d];if(g&&v){const t=new Uint8Array(a);r&&t.set(r,o);const s=he(e,g),l=he(e,v),c=new(u===m?Uint8Array:u===b?Uint16Array:Uint32Array)(s.buffer,s.byteOffset+f,n),d=new Uint8Array(l.buffer,l.byteOffset+h,n*i);for(let e=0;e<n;++e){const n=c[e]*i;for(let r=0;r<i;++r)t[n+r]=d[e*i+r]}o=0,r=t}}return r?(le(t).buffer=r,le(t).byteOffset=o):r=new Uint8Array,{buffer:r,byteOffset:o}}function he(e,t){let n=le(t).buffer;if(!n){var r;const o=null===(r=e.buffers)||void 0===r?void 0:r[t.buffer];if(o){const e=o.extras.buffer;n=new Uint8Array(e.buffer,e.byteOffset+(t.byteOffset||0),t.byteLength)}else n=new Uint8Array;le(t).buffer=n}return n}async function ge(e,t=ve){const n=e.uri?function(e){if(z(e))return"";const t=e.split(/[?#]/)[0].split("/");return t.pop(),t.length?t.join("/")+"/":""}(e.uri):"";let r=e.glTF,o=e.binaryChunk;if(!r&&e.uri){const n=await t(e.uri,"bin");if(i=n,new DataView(i.buffer||i,i.byteOffset||0,4).getUint32(0,!0)===j){const e=function(e){let t,n;const r=e.buffer||e,o=e.byteOffset||0,i=new DataView(r,o,12);if(i.getUint32(0,!0)!==j)throw new Error("Invalid GLB format");const a=i.getUint32(4,!0);if(2!==a)throw new Error("Unsupported GLB version: "+a);const s=new DataView(r,o+12);let l=0;for(;l<s.byteLength;){const e=s.getUint32(l,!0),i=s.getUint32(l+4,!0);if(l+=8,1313821514===i){const n=new Uint8Array(r,o+12+l,e);t=JSON.parse(H(n))}else 5130562===i&&(n=new Uint8Array(r,o+12+l,e));l+=e}if(!t)throw new Error("Invalid GLB format: missing JSON content");if(!t.asset||"2.0"!==t.asset.minVersion&&"2.0"!==t.asset.version)throw new Error("Unsupported glTF version: 2.0 required");return{glTF:t,binaryChunk:n}}(n);r=e.glTF,o=e.binaryChunk}else r=JSON.parse(H(n))}var i;if(!r)throw new Error("Failed to load glTF JSON");const a=await async function(e,t,n,r){if(e.buffers)for(let o=0;o<e.buffers.length;++o){const i=e.buffers[o];if(le(i).buffer)continue;let a;const s=i.uri;if(s)a=await n($(s,r),"bin");else{if(0!==o||!t)throw new Error("Invalid glTF: missing uri for buffer "+o);a=t}le(i).buffer=a}return e}(r,o,t,n);return await async function(e,t,n){if(e.images)for(let o=0;o<e.images.length;++o){const i=e.images[o];if(le(i).image)continue;const a=i.bufferView;let s,l=!1,c=i.uri;if(a){var r;const t=null===(r=e.bufferViews)||void 0===r?void 0:r[a];if(!t)throw new Error("Invalid glTF: invalid bufferView for image "+o);const n=new Blob([he(e,t)],{type:i.mimeType});c=URL.createObjectURL(n),l=!0}if(!c)throw new Error("Invalid glTF: missing uri or bufferView for image "+o);try{s=await t($(c,n),"img")}finally{l&&URL.revokeObjectURL(c)}le(i).image=s}return e}(a,t,n)}function ve(e,t){return"img"===t?new Promise(((t,n)=>{const r=new Image;r.crossOrigin="anonymous",r.onerror=()=>n(new Error("Failed to load: "+e)),r.onload=()=>t(r),r.src=e})):fetch(e).then((e=>e.arrayBuffer())).then((e=>new Uint8Array(e)))}const me=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],pe=[0,0,0,1],be=oe(1,1,1),xe=oe();function Te(e,t,n,r=null){var o;const i=null===(o=e.nodes)||void 0===o?void 0:o[t];if(!i)return;null==r||r.push(t);const a=le(i),s=a.matrix=a.matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];i.matrix?Q(i.matrix,s):(i.rotation||i.scale||i.translation||a.rotation||a.scale||a.translation)&&function(e,t,n,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){(function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[0],r=e[0]*e[1],o=e[0]*e[2],i=e[1]*e[1],a=e[1]*e[2],s=e[2]*e[2],l=e[3]*e[0],c=e[3]*e[1],f=e[3]*e[2];t[0]=1-2*(i+s),t[1]=2*(r+f),t[2]=2*(o-c),t[4]=2*(r-f),t[5]=1-2*(n+s),t[6]=2*(a+l),t[8]=2*(o+c),t[9]=2*(a-l),t[10]=1-2*(n+i),t[3]=t[7]=t[11]=t[12]=t[13]=t[14]=0,t[15]=1})(e,t)}(t,r);for(let e=0;e<3;++e)for(let t=0;t<3;++t)r[4*e+t]*=n[t];W(e,r,0,12,3)}(a.translation||i.translation||xe,a.rotation||i.rotation||pe,a.scale||i.scale||be,s);const l=a.model=Z(n,s,a.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(i.children)for(const t of i.children)Te(e,t,l,r)}function ye(e,t){var n;const r=null===(n=e.cameras)||void 0===n?void 0:n[t.camera];if(r){const e=le(t).model=le(t).model||me;le(r).view=Y(e,le(r).view||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),le(r).translation=[e[12],e[13],e[14]]}}function we(e,t){var n;const r=null===(n=e.skins)||void 0===n?void 0:n[t.skin];if(r){const n=r.joints.length,o=le(t).jointMatrix=le(t).jointMatrix||new Float32Array(16*n),i=function(e,t){let n=le(t).inverseBindMatrices;if(!n){var r;const o=null===(r=e.accessors)||void 0===r?void 0:r[t.inverseBindMatrices];if(o){const{buffer:r,byteOffset:i}=de(e,o);n=new Float32Array(r.buffer,r.byteOffset+i,16*t.joints.length)}else n=new Float32Array(16*t.joints.length);le(t).inverseBindMatrices=n}return n}(e,r);for(let a=0;a<n;++a){const n=e.nodes[r.joints[a]],s=new Float32Array(o.buffer,o.byteOffset+64*a,16),l=new Float32Array(i.buffer,i.byteOffset+64*a,16);Y(le(t).model||me,s),Z(s,n&&le(n).model||me,s),Z(s,l,s)}}}function Oe(e,t){let n="";for(let r=0;r<8;++r)n+=`\n#ifdef USE_${t}_${r}\n  ${e} += targetWeights[${r}] * ${t}_${r};\n#endif\n`;return n}const Se=`\nprecision highp float;\n\nuniform mat4 model;\nuniform mat4 viewProj;\nuniform mat3 normalMatrix;\n\n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\nattribute vec3 COLOR_0;\n#else\nattribute vec4 COLOR_0;\n#endif\nvarying vec4 vColor0;\n#endif\n\n#ifdef USE_TEXCOORD_0\nattribute vec2 TEXCOORD_0;\n#endif\n#ifdef USE_TEXCOORD_1\nattribute vec2 TEXCOORD_1;\n#endif\n\nvarying vec2 vTexCoord0;\nvarying vec2 vTexCoord1;\n\n\n#ifdef USE_JOINTS_0\nattribute vec4 JOINTS_0;\n#endif\n\n#ifdef USE_WEIGHTS_0\nattribute vec4 WEIGHTS_0;\n#endif\n\n#if defined(USE_WEIGHTS_0) && defined(USE_JOINTS_0)\n#define USE_SKIN\n\n#ifndef NUM_JOINTS\n#define NUM_JOINTS 24\n#endif\n\nuniform mat4 jointMatrix[NUM_JOINTS];\n\nmat4 getSkinMatrix() {\n  mat4 skin =\n    WEIGHTS_0.x * jointMatrix[int(JOINTS_0.x)] +\n    WEIGHTS_0.y * jointMatrix[int(JOINTS_0.y)] +\n    WEIGHTS_0.z * jointMatrix[int(JOINTS_0.z)] +\n    WEIGHTS_0.w * jointMatrix[int(JOINTS_0.w)];\n\n  return skin;\n}\n#endif\n\n${["POSITION","NORMAL","TANGENT"].map((e=>{let t="";for(let n=0;n<8;++n)t+=`\n#ifdef USE_${e}_${n}\n  attribute vec3 ${e}_${n};\n#endif\n`;return t})).join("\n")}\n\n#if defined(USE_POSITION_0) || defined(USE_NORMAL_0) || defined(USE_TANGENT_0)\n#define USE_MORPH\n#ifndef NUM_MORPHS\n#define NUM_MORPHS 8\n#endif\n\nuniform float targetWeights[NUM_MORPHS];\n\nvec4 getTargetPosition() {\n  vec4 pos = vec4(0);\n  ${Oe("pos.xyz","POSITION")}\n  return pos;\n}\n\nvec3 getTargetNormal() {\n  vec3 normal = vec3(0);\n  ${Oe("normal","NORMAL")}\n  return normal;\n}\n\nvec3 getTargetTangent() {\n  vec3 tangent = vec3(0);\n  ${Oe("tangent","TANGENT")}\n  return tangent;\n}\n\n#endif\n\n\n\nattribute vec3 POSITION;\nvarying vec3 vPosition;\n\nvec4 getPosition() {\n  vec4 pos = vec4(POSITION, 1.0);\n\n#ifdef USE_MORPH\n  pos += getTargetPosition();\n#endif\n#ifdef USE_SKIN\n  pos = getSkinMatrix() * pos;\n#endif\n\n  return pos;\n}\n\n#ifdef USE_NORMAL\nattribute vec3 NORMAL;\n\n#ifdef USE_TANGENT\nattribute vec4 TANGENT;\nvarying mat3 vTBN;\n\nvec3 getTangent() {\n  vec3 tan = TANGENT.xyz;\n\n#ifdef USE_MORPH\n  tan += getTargetTangent();\n#endif\n#ifdef USE_SKIN\n  tan = mat3(getSkinMatrix()) * tan;\n#endif\n\n  return normalize(tan);\n}\n#else\nvarying vec3 vNormal;\n#endif\n\nvec3 getNormal() {\n  vec3 norm = NORMAL;\n\n#ifdef USE_MORPH\n  norm += getTargetNormal();\n#endif\n#ifdef USE_SKIN\n  norm = mat3(getSkinMatrix()) * norm;\n#endif\n\n  return normalize(norm);\n}\n\n#endif\n\nvoid main(void) {\n  vec4 pos = model * getPosition();\n  vPosition = pos.xyz / pos.w;\n\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\n  vec3 tan = getTangent();\n  vec3 normW = normalize(normalMatrix * getNormal());\n  vec3 tanW = normalize(normalMatrix * tan);\n  vec3 bitanW = cross(normW, tanW) * TANGENT.w;\n  vTBN = mat3(tanW, bitanW, normW);\n#else\n  vNormal = normalize(normalMatrix * NORMAL);\n#endif\n#endif\n\n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\n  vColor0 = vec4(COLOR_0, 1.0);\n#else\n  vColor0 = COLOR_0;\n#endif\n#endif\n\n  vTexCoord0 = vec2(0.0, 0.0);\n  vTexCoord1 = vec2(0.0, 0.0);\n#ifdef USE_TEXCOORD_0\n  vTexCoord0 = TEXCOORD_0;\n#endif\n#ifdef USE_TEXCOORD_1\n  vTexCoord1 = TEXCOORD_1;\n#endif\n\n  gl_Position = viewProj * pos;\n  gl_PointSize = 1.0;\n}\n`,Ce=["POSITION","NORMAL","TANGENT"],Fe=/(POSITION|NORMAL|TANGENT)_(\d+)/,_e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ee=oe(),Le=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Ne(e,t,n={}){var r,o,i;const a=(null!==(r=n.scene)&&void 0!==r?r:t.scene)||0,s=t.nodes,l=null===(o=t.scenes)||void 0===o||null===(i=o[a])||void 0===i?void 0:i.nodes;if(!s||!l)return;const c=function(e,t={}){var n,r,o;let i=[];const a=null===(n=e.scenes)||void 0===n||null===(r=n[(null!==(o=t.scene)&&void 0!==o?o:e.scene)||0])||void 0===r?void 0:r.nodes;if(a)for(let t=0;t<a.length;++t)Te(e,a[t],me,i);i=i.sort().filter(((e,t,n)=>!t||e!==n[t-1]));for(const t of i){const n=e.nodes[t];"camera"in n&&ye(e,n),"skin"in n&&we(e,n)}return i}(t,{scene:a});let f=_e,u=_e,d=Ee;if(n.camera){var h;const r=null===(h=t.cameras)||void 0===h?void 0:h[n.camera.index||0];var g,v;r&&(f=(null===(g=r.extras)||void 0===g?void 0:g.view)||_e,m=Le,p=r,b=e.width/e.height,null!=p&&p.orthographic?function(e,t,n,r,o,i,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const s=1/(e-t),l=1/(n-r),c=1/(o-i);K(a),a[0]=-2*s,a[5]=-2*l,a[10]=2*c,a[12]=(e+t)*s,a[13]=(r+n)*l,a[14]=(o+i)*c}(-p.orthographic.xmag,p.orthographic.xmag,-p.orthographic.xmag/(b||1),p.orthographic.xmag/(b||1),p.orthographic.znear,p.orthographic.zfar,m):null!=p&&p.perspective?function(e,t,n,r=1/0,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const i=1/Math.tan(t/2);if(K(o),o[0]=i/e,o[5]=i,o[11]=-1,o[15]=0,isFinite(r)){const e=1/(n-r);o[10]=(n+r)*e,o[14]=2*n*r*e}else o[10]=-1,o[14]=-2*n}(b||p.perspective.aspectRatio||1,p.perspective.yfov,p.perspective.znear,p.perspective.zfar||1/0,m):K(m),u=m,d=(null===(v=r.extras)||void 0===v?void 0:v.translation)||Ee),n.camera.model&&(d=oe(n.camera.model[12],n.camera.model[13],n.camera.model[14]),Y(n.camera.model,f)),u=n.camera.proj||u}var m,p,b;const x={cameraPosition:d,viewProj:Z(u,f,Le)},T=e.pass(),y=e.render(T),w=[];for(let n=0;n<c.length;++n){var O;const r=s[c[n]],o=null===(O=t.meshes)||void 0===O?void 0:O[r.mesh];if(o)for(let n=0;n<o.primitives.length;++n){var S,C;const i=o.primitives[n];"BLEND"===(null===(S=t.materials)||void 0===S||null===(C=S[i.material])||void 0===C?void 0:C.alphaMode)?w.push({node:r,mesh:o,primitive:i}):Me(e,y,t,r,o,i,x)}}for(const n of w)Me(e,y,t,n.node,n.mesh,n.primitive,x);y.end(),T.destroy()}function Me(e,t,n,r,o,i,a){var s,l,c,f;a.model=Q(le(r).model||_e,a.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ee(a.model,a.normalMatrix=a.normalMatrix||[1,0,0,0,1,0,0,0,1])||function(e){for(let t=0;t<9;++t)e[t]=t%4?0:1}(a.normalMatrix);let u=!1,d=0,h=(null===(s=n.accessors)||void 0===s||null===(l=s[i.attributes.POSITION])||void 0===l?void 0:l.count)||0;if(!h)return;const g={...a,...Ie(e,n,i.material)};i.targets&&(g.targetWeights=le(r).weights||r.weights||o.weights||[0,0,0,0,0,0,0,0]);let v=0;const m=null===(c=n.skins)||void 0===c?void 0:c[r.skin];if(i.attributes.JOINTS_0&&i.attributes.WEIGHTS_0&&m){v=m.joints.length;const e=le(r).jointMatrix=le(r).jointMatrix||new Float32Array(16*v);g.jointMatrix=e}const p=[];for(const e in g)"number"==typeof g[e]?p.push({name:e,value:g[e]}):g[e].length?p.push({name:e,values:g[e]}):p.push({name:e,tex:g[e]});const b=function(e,t,n,r=0){var o,i,a;let s=le(n).pipeline;if(s)return s;const l=n.mode||4,c=null===(o=t.materials)||void 0===o?void 0:o[n.material];let f="OPAQUE",u=!1,d=!1;var h;c&&(u=c.doubleSided||!1,f=c.alphaMode||f,d=!(null===(h=c.extensions)||void 0===h||!h.KHR_materials_unlit));const g=function(e,t){const n={},r=[];let o=0;function i(t){var o,i;if(!t.sparse){const o=de(e,t).buffer,i=`${t.bufferView},${o.byteOffset},${o.byteLength}`;if(i in n)return r[n[i]];n[i]=r.length}const a={attrs:[],stride:null===(o=e.bufferViews)||void 0===o||null===(i=o[t.bufferView])||void 0===i?void 0:i.byteStride};return r.push(a),a}for(const n of["POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","JOINTS_0","WEIGHTS_0"]){var a;const r=null===(a=e.accessors)||void 0===a?void 0:a[t.attributes[n]];if(r){const e=ue(r);if(!e)continue;i(r).attrs.push({name:n,format:e,shaderLoc:o,offset:le(r).byteOffset||0}),o++}}if(t.targets){const n=new Array(3);for(let r=0;r<t.targets.length;++r){let a=0;for(let o=0;o<Ce.length;++o){var s;(n[o]=null===(s=e.accessors)||void 0===s?void 0:s[t.targets[r][Ce[o]]])&&++a}if(o+a>16)break;for(let e=0;e<Ce.length;++e){const t=n[e];t&&(i(t).attrs.push({name:`${Ce[e]}_${r}`,format:768,shaderLoc:o,offset:le(t).byteOffset||0}),o++)}}}return r}(t,n),v=5125===(null===(i=t.accessors)||void 0===i||null===(a=i[n.indices])||void 0===a?void 0:a.componentType)?5125:5123,m=n.attributes.JOINTS_0&&n.attributes.WEIGHTS_0?12*Math.ceil(r/12):0,p=JSON.stringify([g,u,f,m,v,l,d]),b=le(t).pipelines=le(t).pipelines||{};if(s=b[p],s)return s;const x=[`ALPHAMODE_${f}`];for(const e of g)for(const t of e.attrs)x.push(`USE_${t.name}`),"COLOR_0"===t.name&&3===N(t.format)&&x.push("COLOR_0_VEC3");m>0&&x.push(`NUM_JOINTS ${m}`),d&&x.push("MATERIAL_UNLIT");const T=x.map((e=>`#define ${e}`)).join("\n"),y=[];m>0&&y.push({name:"jointMatrix",type:1,valueFormat:se}),n.targets&&y.push({name:"targetWeights",type:1,valueFormat:ae});const w=e.shader({type:35633,source:T+Se}),O=e.shader({type:35632,source:T+"\n#ifdef GL_OES_standard_derivatives\n  #extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision highp float;\n\nuniform float alphaCutoff;\nuniform vec3 cameraPosition;\n\nvarying vec3 vPosition;\n\n\nconst float GAMMA = 2.2;\n\nvec3 linearTosRGB(vec3 color) {\n  return pow(color, vec3(1./GAMMA));\n}\n\nvec3 sRGBToLinear(vec3 srgbIn) {\n  return vec3(pow(srgbIn.xyz, vec3(GAMMA)));\n}\n\nvec4 sRGBToLinear(vec4 srgbIn) {\n  return vec4(sRGBToLinear(srgbIn.xyz), srgbIn.w);\n}\n\n\nconst float PI = 3.141592653589793;\n\nvec3 specularF(vec3 r0, vec3 r90, float vDotH) {\n  return r0 + (r90 - r0) * pow(clamp(1. - vDotH, 0., 1.), 5.);\n}\n\nfloat specularD(float aSqr, float nDotH) {\n  float f = (nDotH * nDotH) * (aSqr - 1.) + 1.;\n  return aSqr / (PI * f * f);\n}\n\nfloat specularV(float aSqr, float nDotL, float nDotV) {\n  float gl = 1. / (nDotL + sqrt(aSqr + (1. - aSqr) * (nDotL * nDotL)));\n  float gv = 1. / (nDotV + sqrt(aSqr + (1. - aSqr) * (nDotV * nDotV)));\n  return gl * gv;\n}\n\nfloat specularBRDF(float aSqr, float nDotL, float nDotV, float nDotH) {\n  return specularV(aSqr, nDotL, nDotV) * specularD(aSqr, nDotH);\n}\n\nvec3 diffuseBRDF(vec3 color) {\n  return color / PI;\n}\n\n\nvarying vec2 vTexCoord0;\nvarying vec2 vTexCoord1;\n\nstruct TextureInfo {\n  sampler2D tex;\n  float texCoord;\n  float scale;\n};\n\nvec2 getTexCoord(TextureInfo tex) {\n  return mix(vTexCoord0, vTexCoord1, step(1., tex.texCoord));\n}\n\nvec4 texture(TextureInfo tex) {\n  return texture2D(tex.tex, getTexCoord(tex));\n}\n\nvec4 texture(TextureInfo tex, vec4 defaultValue) {\n  return mix(defaultValue, texture2D(tex.tex, getTexCoord(tex)), step(0., tex.texCoord));\n}\n\n\nuniform TextureInfo normalTexture;\n\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\nvarying mat3 vTBN;\n#else\nvarying vec3 vNormal;\n#endif\n#endif\n\nstruct NormalInfo {\n  vec3 ng;\n  vec3 n;\n  vec3 t;\n  vec3 b;\n};\n\nNormalInfo getNormalInfo(vec3 v) {\n  vec3 n, t, b, ng;\n\n#ifdef USE_TANGENT\n  t = normalize(vTBN[0]);\n  b = normalize(vTBN[1]);\n  ng = normalize(vTBN[2]);\n#else\n#ifdef USE_NORMAL\n  ng = normalize(vNormal);\n#else\n  ng = normalize(cross(dFdx(v), dFdy(v)));\n#endif\n  vec2 UV = getTexCoord(normalTexture);\n  vec3 uvDx = dFdx(vec3(UV, 0.));\n  vec3 uvDy = dFdy(vec3(UV, 0.));\n  vec3 t_ = (uvDy.t * dFdx(v) - uvDx.t * dFdy(v)) / (uvDx.s * uvDy.t - uvDy.s * uvDx.t);\n\n  t = normalize(t_ - ng * dot(ng, t_));\n  b = cross(ng, t);\n#endif\n\n  if (gl_FrontFacing == false) {\n    t *= -1.;\n    b *= -1.;\n    ng *= -1.;\n  }\n\n  n = ng;\n  if (normalTexture.texCoord >= 0.) {\n    n = texture(normalTexture).rgb * 2. - vec3(1.);\n    n *= vec3(normalTexture.scale, normalTexture.scale, 1.);\n    n = mat3(t, b, ng) * normalize(n);\n  }\n\n  NormalInfo ni;\n  ni.ng = ng;\n  ni.t = t;\n  ni.b = b;\n  ni.n = n;\n  return ni;\n}\n\n\nconst float MIN_ROUGHNESS = .04;\n\n#ifdef USE_COLOR_0\nvarying vec4 vColor0;\n#endif\n\nuniform vec4 baseColorFactor;\nuniform TextureInfo baseColorTexture;\n\nuniform float metallicFactor;\nuniform float roughnessFactor;\nuniform TextureInfo metallicRoughnessTexture;\n\nuniform TextureInfo occlusionTexture;\n\nuniform vec3 emissiveFactor;\nuniform TextureInfo emissiveTexture;\n\nvec4 getVertexColor() {\n  vec4 color = vec4(1.);\n#ifdef USE_COLOR_0\n  color = vColor0;\n#endif\n  return color;\n}\n\nvec4 getBaseColor() {\n  vec4 baseColor = vec4(1.);\n\n  baseColor *= baseColorFactor;\n  baseColor *= sRGBToLinear(texture(baseColorTexture, vec4(1.)));\n\n  return baseColor * getVertexColor();\n}\n\nvec2 getMetallicRoughness() {\n  vec4 mrTex = texture(metallicRoughnessTexture, vec4(1.));\n  return vec2(\n    clamp(metallicFactor * mrTex.b, 0., 1.),\n    clamp(roughnessFactor * mrTex.g, MIN_ROUGHNESS, 1.)\n  );\n}\n\nfloat getOcculsion() {\n  return texture(occlusionTexture, vec4(1.)).r;\n}\n\nvec3 getEmissiveFactor() {\n  return emissiveFactor * sRGBToLinear(texture(emissiveTexture, vec4(0)).rgb);\n}\n\n\n\n#define LIGHT_DIRECTIONAL 0\n#define LIGHT_POINT 1\n#define LIGHT_SPOT 2\n\nint getLightType(mat4 light) {\n  return int(light[0].x);\n}\n\nvec2 getLightConeCos(mat4 light) {\n  return light[0].yz;\n}\n\nvec4 getLightColor(mat4 light) {\n  return light[1];\n}\n\nfloat getLightRange(mat4 light) {\n  return light[2].w;\n}\n\nvec3 getLightDirection(mat4 light) {\n  return light[2].xyz;\n}\n\nvec3 getLightPosition(mat4 light) {\n  return light[3].xyz;\n}\n\nfloat getRangeAttenuation(float range, float distance) {\n  if (range <= 0.) {\n    return 1. / pow(distance, 2.);\n  }\n  return max(min(1.0 - pow(distance / range, 4.), 1.), 0.) / pow(distance, 2.);\n}\n\nfloat getSpotAttenuation(vec3 pointToLight, vec3 direction, vec2 coneCos) {\n  float actualCos = dot(normalize(direction), normalize(-pointToLight));\n  float scale = 1. / max(.001, coneCos[0] - coneCos[1]);\n  float offset = -coneCos[1] * scale;\n  float att = clamp(actualCos * scale + offset, 0., 1.);\n  return att * att;\n}\n\nvec3 getPointToLight(mat4 light, vec3 position) {\n  return getLightType(light) != LIGHT_DIRECTIONAL ? getLightPosition(light) - position : -getLightDirection(light);\n}\n\nvec3 getLighIntensity(mat4 light, vec3 pointToLight) {\n  vec4 color = getLightColor(light);\n  vec3 intensity = color.rgb * color.a;\n\n  if (getLightType(light) != LIGHT_DIRECTIONAL) {\n    intensity *= getRangeAttenuation(getLightRange(light), length(pointToLight));\n  }\n  if (getLightType(light) == LIGHT_SPOT) {\n    intensity *= getSpotAttenuation(pointToLight, getLightDirection(light), getLightConeCos(light));\n  }\n\n  return intensity;\n}\n\n\nvoid main () {\n  vec4 baseColor = getBaseColor();\n#ifdef ALPHAMODE_OPAQUE\n  baseColor.a = 1.0;\n#endif\n\n#ifdef MATERIAL_UNLIT\n  gl_FragColor = (vec4(linearTosRGB(baseColor.rgb), baseColor.a));\n  return;\n#endif\n\n  vec3 v = normalize(cameraPosition - vPosition);\n  NormalInfo normalInfo = getNormalInfo(vPosition);\n  vec3 n = normalInfo.n;\n\n  vec3 reflection = -normalize(reflect(v, n));\n  float nDotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n\n  vec2 metallicRoughness = getMetallicRoughness();\n  float metallic = metallicRoughness[0];\n  float roughness = metallicRoughness[1];\n  float alphaRoughness = roughness * roughness;\n  float aSqr = alphaRoughness * alphaRoughness;\n\n  vec3 f0 = vec3(0.04);\n  vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);\n  vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n  float r0 = max(max(specularColor.r, specularColor.g), specularColor.b);\n  float r90 = clamp(r0 * 25.0, 0.0, 1.0);\n  vec3 specularEnvR0 = specularColor.rgb;\n  vec3 specularEnvR90 = vec3(1.0, 1.0, 1.0) * r90;\n\n  vec3 diffuseFinal = vec3(0.0);\n  vec3 specularFinal = vec3(0.0);\n\n  #define NUM_LIGHTS 4\n\n  mat4 lights[4];\n  lights[0] = mat4(\n    0., 0., 0., 0.,\n    1., 1., 1., 1.,\n    .5, -.707, -.5, 0.,\n    0., 0., 0., 0.\n  );\n  lights[1] = mat4(\n    0., 0., 0., 0.,\n    1., 1., 1., .5,\n    -.5, .707, .5, 0.,\n    0., 0., 0., 0.\n  );\n  lights[2] = mat4(\n    0., 0., 0., 0.,\n    1., 1., 1., .25,\n    .5, .707, -.5, 0.,\n    0., 0., 0., 0.\n  );\n  lights[3] = mat4(\n    0., 0., 0., 0.,\n    1., 1., 1., .25,\n    -.5, -.707, .5, 0.,\n    0., 0., 0., 0.\n  );\n\n#ifdef NUM_LIGHTS\n  for (int i = 0; i < NUM_LIGHTS; ++i) {\n    vec3 pointToLight = getPointToLight(lights[i], vPosition);\n    vec3 intensity = getLighIntensity(lights[i], pointToLight);\n    vec3 l = normalize(pointToLight);\n    vec3 h = normalize(l + v);\n    float nDotL = clamp(dot(n, l), 0.001, 1.0);\n    float nDotH = clamp(dot(n, h), 0.0, 1.0);\n    float vDotH = clamp(dot(v, h), 0.0, 1.0);\n  \n    vec3 F = specularF(specularEnvR0, specularEnvR90, vDotH);\n    vec3 diffuse = (1.0 - F) * diffuseBRDF(diffuseColor);\n    vec3 specular = max(vec3(0.0), F * specularBRDF(aSqr, nDotL, nDotV, nDotH));\n\n    diffuseFinal += intensity * nDotL * diffuse;\n    specularFinal += intensity * nDotL * specular;\n  }\n#endif\n\n  vec4 ambient = vec4(0.1);\n\n  vec3 ambientDiffuse = ambient.rgb * diffuseBRDF(diffuseColor);\n  diffuseFinal += ambientDiffuse;\n\n  vec3 colorFinal = diffuseFinal + specularFinal;\n\n  float ao = getOcculsion();\n  colorFinal = mix(colorFinal, colorFinal * ao, occlusionTexture.scale);\n\n  vec3 emissive = getEmissiveFactor();\n  colorFinal += emissive;\n\n#ifdef ALPHAMODE_MASK\n  if (baseColor.a < alphaCutoff) {\n    discard;\n  }\n  baseColor.a = 1.0;\n#else\n  alphaCutoff;\n#endif\n\n  gl_FragColor = vec4(linearTosRGB(colorFinal), baseColor.a);\n}\n"});return s=le(n).pipeline=b[p]=e.pipeline({vert:w,frag:O,buffers:g,indexFormat:v,mode:l,depth:{compare:515,write:!("BLEND"===f)},blend:"BLEND"===f?{srcFactorRGB:770,dstFactorRGB:771,srcFactorAlpha:1,dstFactorAlpha:771}:void 0,raster:{cullMode:u?0:1029},uniforms:[{name:"model",type:1,valueFormat:se},{name:"viewProj",type:1,valueFormat:se},{name:"normalMatrix",type:1,valueFormat:35675},{name:"cameraPosition",type:1,valueFormat:35665},{name:"alphaCutoff",type:1,valueFormat:ae},{name:"baseColorFactor",type:1,valueFormat:35666},{name:"baseColorTexture.tex",type:2,texType:ie},{name:"baseColorTexture.texCoord",type:1,valueFormat:ae},{name:"metallicFactor",type:1,valueFormat:ae},{name:"roughnessFactor",type:1,valueFormat:ae},{name:"metallicRoughnessTexture.tex",type:2,texType:ie},{name:"metallicRoughnessTexture.texCoord",type:1,valueFormat:ae},{name:"normalTexture.tex",type:2,texType:ie},{name:"normalTexture.texCoord",type:1,valueFormat:ae},{name:"normalTexture.scale",type:1,valueFormat:ae},{name:"emissiveFactor",type:1,valueFormat:35665},{name:"emissiveTexture.tex",type:2,texType:ie},{name:"emissiveTexture.texCoord",type:1,valueFormat:ae},{name:"occlusionTexture.tex",type:2,texType:ie},{name:"occlusionTexture.texCoord",type:1,valueFormat:ae},{name:"occlusionTexture.scale",type:1,valueFormat:ae},...y]}),w.destroy(),O.destroy(),s}(e,n,i,v);t.pipeline(b).uniforms(p);for(let r=0;r<b.props.buffers.length;++r){const o=b.props.buffers[r].attrs[0].name,a=Fe.exec(o),s=Re(e,n,a?i.targets[a[2]][a[1]]:i.attributes[o],34962);s&&t.vertex(r,s)}const x=null===(f=n.accessors)||void 0===f?void 0:f[i.indices];if(x){const r=Re(e,n,i.indices,34963);r&&(t.index(r),h=x.count,d=le(x).byteOffset||0,u=!0)}u?t.drawIndexed(h,1,d):t.draw(h)}function Ie(e,t,n){var r;const o={alphaCutoff:.5,baseColorFactor:[1,1,1,1],"baseColorTexture.tex":Ae(e,t),"baseColorTexture.texCoord":-1,metallicFactor:1,roughnessFactor:1,"metallicRoughnessTexture.tex":Ae(e,t),"metallicRoughnessTexture.texCoord":-1,"normalTexture.tex":Ae(e,t),"normalTexture.texCoord":-1,"normalTexture.scale":1,emissiveFactor:[0,0,0],"emissiveTexture.tex":Ae(e,t),"emissiveTexture.texCoord":-1,"occlusionTexture.tex":Ae(e,t),"occlusionTexture.texCoord":-1,"occlusionTexture.scale":0};function i(n,r,i=null){var a;n[r]&&(o[`${r}.tex`]=function(e,t,n){var r,o,i,a,s;const l=null===(r=t.textures)||void 0===r?void 0:r[n];if(!l)return Ae(e,t);let c=le(l).texture;if(c)return c;let f=null;const u={wrapU:10497,wrapV:10497,magFilter:9729,minFilter:9729},d=null===(o=t.images)||void 0===o?void 0:o[l.source];d&&(f=d.extras.image);const h=null===(i=t.samplers)||void 0===i?void 0:i[l.sampler];if(h)switch(u.wrapU=h.wrapS||u.wrapU,u.wrapV=h.wrapT||u.wrapV,u.magFilter=h.magFilter||u.magFilter,h.minFilter){case 9728:case 9984:case 9986:u.minFilter=9728}return c=le(l).texture=e.texture({width:(null===(a=f)||void 0===a?void 0:a.naturalWidth)||1,height:(null===(s=f)||void 0===s?void 0:s.naturalHeight)||1},u),c.data(f?{image:f}:{buffer:new Uint8Array([255,255,255,255])}),c}(e,t,n[r].index),o[`${r}.texCoord`]=n[r].texCoord||0,i&&(o[`${r}.scale`]=null!==(a=n[r][i])&&void 0!==a?a:o[`${r}.scale`]))}const a=null===(r=t.materials)||void 0===r?void 0:r[n];if(a){var s;if(a.pbrMetallicRoughness){const e=a.pbrMetallicRoughness;o.baseColorFactor=e.baseColorFactor||o.baseColorFactor,(e.metallicFactor||0===e.metallicFactor)&&(o.metallicFactor=e.metallicFactor),(e.roughnessFactor||0===e.roughnessFactor)&&(o.roughnessFactor=e.roughnessFactor),i(e,"baseColorTexture"),i(e,"metallicRoughnessTexture")}o.alphaCutoff=null!==(s=a.alphaCutoff)&&void 0!==s?s:o.alphaCutoff,o.emissiveFactor=a.emissiveFactor||o.emissiveFactor,i(a,"emissiveTexture"),i(a,"occlusionTexture","strength"),i(a,"normalTexture","scale")}return o}function Re(e,t,n,r){var o,i;const a=null===(o=t.accessors)||void 0===o?void 0:o[n];if(!a)return null;const s=34963===r&&a.componentType===m;if(a.sparse||s){let n=le(a).gpuBuffer;if(!n){const o=de(t,a);let i=o.buffer;if(s){const e=new Uint16Array(i.byteLength);for(let t=0;t<i.byteLength;++t)e[t]=i[o.byteOffset+t];i=le(a).buffer=new Uint8Array(e.buffer,0,e.byteLength),le(a).byteOffset=0}n=le(a).gpuBuffer=e.buffer({type:r,size:i.byteLength}).data(i)}return n}const l=null===(i=t.bufferViews)||void 0===i?void 0:i[a.bufferView];if(!l)return null;const c=le(l).gpuBuffers=le(l).gpuBuffers||{},f=de(t,a).buffer,u=`${f.byteOffset},${f.byteLength}`;return c[u]?c[u]:c[u]=e.buffer({type:l.target||r,size:f.byteLength}).data(f)}function Ae(e,t){let n=le(t).blankTexture;return n||(n=le(t).blankTexture=e.texture({}).data({buffer:new Uint8Array([255,255,255,255])}),n)}const Ue=i(),De=i(),Pe=i();function Ge(e,t,n,r=1/0,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const i=1/Math.tan(t/2);if(function(e){for(let t=0;t<16;++t)e[t]=t%5?0:1}(o),o[0]=i/e,o[5]=i,o[11]=-1,o[15]=0,isFinite(r)){const e=1/(n-r);o[10]=(n+r)*e,o[14]=2*n*r*e}else o[10]=-1,o[14]=-2*n;return o}function Be(t,n,r=i(0,1,0),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const a=s(t,n,Ue);f(a,a);const l=u(r,a,De);f(l,l);const c=u(a,l,Pe);return f(c,c),e(l,o,0,0,3),e(c,o,0,4,3),e(a,o,0,8,3),e(t,o,0,12,3),o[3]=o[7]=o[11]=0,o[15]=1,o}const ke=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Ve(e,t,n,r){const o=f(n),[u,d]=function(e,t,n,r){for(let n=0;n<3;++n)e[n]=1/0,t[n]=-1/0;const o=i(),a=i();let s=(r.nodes||[]).slice();for(;s.length>0;){var l,c;const r=null===(l=n.nodes)||void 0===l?void 0:l[s.pop()];if(!r)continue;s=s.concat(r.children||[]);const i=null===(c=n.meshes)||void 0===c?void 0:c[r.mesh];if(i)for(const s of i.primitives){var f;const i=null===(f=n.accessors)||void 0===f?void 0:f[s.attributes.POSITION];if(i){var u;We(o,a,i,(null===(u=r.extras)||void 0===u?void 0:u.model)||ke);for(let n=0;n<3;++n)e[n]=Math.min(e[n],o[n]),t[n]=Math.max(t[n],a[n])}}}return[e,t]}(i(),i(),e,e.scenes[t]),h=Math.max(d[0]-u[0],d[1]-u[1]),g=Math.PI/4,v=g*r,m=h/2/Math.tan(g/2),p=h/2/Math.tan(v/2),b=Math.max(p,m);l(o,-1.2*b,o);const x=c(s(u,d));let T=b+6*x,y=b-6*x;y=Math.max(y,T/1e4);const w=i();return a(u,d,w),l(w,.5,w),{model:Be(o,w),proj:Ge(r,g,y,T)}}const He=i(),ze=i(),$e=i(),je=i();function We(t,n,r,i){const f=[...r.min,1],u=[...r.max,1];o(i,f,f),o(i,u,u),e(f,He,0,0,3),e(u,ze,0,0,3),a(ze,He,$e),l($e,.5,$e),s(ze,$e,je);const d=c(je);for(let e=0;e<3;++e)t[e]=$e[e]-d,n[e]=$e[e]+d}const qe=i(-1,-2,-2),Je=new URLSearchParams(window.location.search),Xe=document.querySelector("canvas"),Ke=Xe.parentElement;let Qe=null,Ze=0,Ye=0;const et=((e,t)=>{const n=e.getContext("webgl",{powerPreference:"low-power",webgl2:!1});return n?new k(n):null})(Xe);et.feature("OES_standard_derivatives"),et.feature("OES_element_index_uint");const tt="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/63f026b2aa957d3e8207f6dd798608993e33fb0d/2.0";function nt(e=0){var t;if(window.requestAnimationFrame(nt),!Qe)return;Ze||(Ze=e);const n=e-Ze,r=Je.get("camera"),o=Je.get("scene"),i=((null!==o&&parseInt(o))??Qe.scene)||0;null!==(t=Qe.animations)&&void 0!==t&&t.length&&(function(e,t,n=0,r=!1){var o,i,a,s;const l=function(e,t){let n=le(t).duration||0;for(const s of t.channels){var r,o,i;const l=null===(r=e.nodes)||void 0===r?void 0:r[s.target.node],c=null===(o=e.accessors)||void 0===o?void 0:o[null===(i=t.samplers[s.sampler])||void 0===i?void 0:i.input];var a;l&&c&&(n=Math.max(n,(null===(a=c.max)||void 0===a?void 0:a[0])||0))}return le(t).duration=n}(e,t),c=r?n-Math.floor(n/l)*l:Math.min(n,l);for(const n of t.channels){var f;const r=null===(f=e.nodes)||void 0===f?void 0:f[n.target.node],l=t.samplers[n.sampler];if(!r||!l)continue;const u=ce(e,l),d=fe(e,l);if(null==u||!u.length||!d)continue;const h=u.length,g=u[0],v=u[h-1];let m,p;if(c<=g)m=p=0;else if(c>=v)m=p=h-1;else{let e=le(n).lastKeyframe||0;for(u[e]>c&&(e=0),m=e,p=m+1;p<h&&!(u[m]<=c&&u[p]>c);++m,++p);}le(n).lastKeyframe=m;const b=n.target.path;let x=3;switch(b){case"rotation":x=4;break;case"weights":x=(null===(o=r.weights)||void 0===o?void 0:o.length)||(null===(i=e.meshes)||void 0===i||null===(a=i[r.mesh])||void 0===a||null===(s=a.weights)||void 0===s?void 0:s.length)||0}if(!x)continue;let T=l.interpolation;m===p&&(T="STEP");const y=u[m],w=u[p],O=(c-y)/(w-y),S=le(r)[b]=le(r)[b]||new Array(x),C=new Array(x);switch(T){case"STEP":W(d,S,m*x,0,x);break;case"CUBICSPLINE":{const e=w-y,t=O*O,n=O*t;for(let r=0;r<x;++r)S[r]=(2*n-3*t+1)*d[(3*m+1)*x+r]+(n-2*t+O)*e*d[(3*m+2)*x+r]+(-2*n+3*t)*d[(3*p+1)*x+r]+(n-t)*e*d[3*p*x+r];break}default:if("rotation"===b)W(d,S,m*x,0,x),W(d,C,p*x,0,x),re(S,C,O,S);else for(let e=0;e<x;++e)S[e]=(1-O)*d[m*x+e]+O*d[p*x+e]}}return n<l}(Qe,Qe.animations[Ye],n/1e3)||(Ze=e,Ye=(Ye+1)%Qe.animations.length)),Ne(et,Qe,{scene:i,camera:Qe.cameras?{index:parseInt(r)||0}:Ve(Qe,i,qe,et.canvas.width/et.canvas.height)})}function rt(){const e=window.devicePixelRatio||1,t=Ke.clientWidth,n=Ke.clientHeight;Xe.width=t*e,Xe.height=n*e,Xe.style.width=`${t}px`,Xe.style.height=`${n}px`}window.addEventListener("resize",rt,!1),rt(),async function(){let e=Je.get("url");if(!e){const t=await(await fetch(`${tt}/model-index.json`)).json(),n=Je.get("model")||"BrainStem",r=Je.get("variant")||"glTF",o=t.find((e=>e.name===n));e=`${tt}/${n}/${r}/${o.variants[r]}`}const t=await ge({uri:e});console.log(e,t),Qe=t,nt()}()})();