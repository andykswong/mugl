(()=>{"use strict";function e(e,t,n=0,r=0,i=e.length-n){for(let o=0;o<i;++o)t[r+o]=e[n+o];return t}function t(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}const n=r();function r(e=0,t=0,n=0,r=0){return[e,t,n,r]}function i(t,i,o=r()){return e(function(e,t,n,r){const i=t.length/4,o=n.length/4;let a=0;for(let e=0;e<o;++e)for(let o=0;o<i;++o){a=0;for(let r=0;r<4;++r)a+=t[r*i+o]*n[4*e+r];r[e*i+o]=a}return r}(0,t,i,n),o)}function o(e=0,t=0,n=0){return[e,t,n]}function a(e,t,n=o()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]+t[r];return n}(e,t,n)}function s(e,t,n=o()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]-t[r];return n}(e,t,n)}function f(e,n,r=o()){return t(e,n,r)}function l(e){return Math.sqrt(function(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n}(e,e))}function c(e,n=o()){return t(e,1/(l(e)||1),n)}function u(e,t,n=o()){const r=e[2]*t[0]-t[2]*e[0],i=e[0]*t[1]-t[0]*e[1];return n[0]=e[1]*t[2]-t[1]*e[2],n[1]=r,n[2]=i,n}o(),r(),r();const d=34962,v=1028,h=1029,m=5120,b=5121,p=5122,g=5123,T=5126,_=6408,O=519,x=7680,N=9728,y=36160,S=36161,E=[T,m,b,p,g],w=[4,1,1,2,2],A=255;function I(e){return w[e&A]*M(e)}function M(e){return e>>8&A}function L(e){return E[e&A]}function R(e){return!!(e>>16)}function U(e){return e-g+2}class F{constructor(e,t){this.gl=e,this.props={type:d,usage:35044,...t},e.bindBuffer(this.props.type,this.glb=e.createBuffer()),e.bufferData(this.props.type,this.props.size,this.props.usage)}data(e,t=0){return this.gl.bindBuffer(this.props.type,this.glb),this.gl.bufferSubData(this.props.type,t,e),this}destroy(){this.gl.deleteBuffer(this.glb)}}class C{constructor(e,t,n){this.glt=null,this.glrb=null,this.gl=e;const r=this.props={type:3553,format:263169,width:1,height:1,...t},i=this.sampler={wrapU:33071,wrapV:33071,magFilter:N,minFilter:N,...n};r.format<=197381?(e.bindRenderbuffer(S,this.glrb=e.createRenderbuffer()),e.renderbufferStorage(S,34041,r.width,r.height)):(e.bindTexture(r.type,this.glt=e.createTexture()),e.texParameteri(r.type,10241,i.minFilter),e.texParameteri(r.type,10240,i.magFilter),e.texParameteri(r.type,10242,i.wrapU),e.texParameteri(r.type,10243,i.wrapV),e.texImage2D(r.type,0,_,r.width,r.height,0,_,b,null))}data(e,[t,n]=[0,0,0],[r,i]=[this.props.width-t,this.props.height-n,0]){return this.gl.bindTexture(this.props.type,this.glt),e.buffer?this.gl.texSubImage2D(this.props.type,0,t,n,r,i,_,b,e.buffer):e.image&&this.gl.texSubImage2D(this.props.type,0,t,n,_,b,e.image),this}mipmap(){return this.gl.bindTexture(this.props.type,this.glt),this.gl.generateMipmap(this.props.type),this}destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb)}}class P{constructor(e,t,n){if(this.glfb=null,this.gl=e,this.props=t,t.color&&t.color.length){e.bindFramebuffer(y,this.glfb=e.createFramebuffer());const r=n?t.color.length:1;for(let n=0;n<r;++n)e.framebufferTexture2D(y,36064+n,t.color[n].tex.props.type,t.color[n].tex.glt,0);r>1&&n.drawBuffersWEBGL(t.color.map(((e,t)=>36064+t))),t.depth&&e.framebufferRenderbuffer(y,33306,S,t.depth.tex.glrb)}}destroy(){this.gl.deleteFramebuffer(this.glfb)}resolve(){}}class G{constructor(e,t){this.gl=e;const n=this.gls=e.createShader(this.type=t.type);e.shaderSource(n,this.source=t.source),e.compileShader(n)}destroy(){this.gl.deleteShader(this.gls)}}class B{constructor(e,t){this.gl=e;let n=0;this.props={mode:4,indexFormat:g,...t,buffers:t.buffers.map((({attrs:e,stride:t,instanced:r=!1})=>{this.i=this.i||r;const i=Array(e.length);let o=0;for(let t=0;t<e.length;++t,++n){const{name:r,format:a,offset:s=o,shaderLoc:f=n}=e[t];i[t]={name:r,format:a,offset:s,shaderLoc:f},o=Math.max(o,s)+I(a)}return{attrs:i,stride:t||o,instanced:r}}))},this.glp=function(e,t,n,r){const i=e.createProgram();e.attachShader(i,t.gls),e.attachShader(i,n.gls);for(const{attrs:t}of r)for(const n of t)e.bindAttribLocation(i,n.shaderLoc,n.name);return e.linkProgram(i),i}(e,t.vert,t.frag,this.props.buffers)}destroy(){this.gl.deleteProgram(this.glp)}}function k(e,t,n){n?e.enable(t):e.disable(t)}class z{constructor(e){this.webgl2=!1,this.gl=e,this.canvas=e.canvas,this.d=this.feature("WEBGL_draw_buffers"),this.r=new D(e,this.feature("ANGLE_instanced_arrays"))}get width(){return this.gl.drawingBufferWidth}get height(){return this.gl.drawingBufferHeight}buffer(e){return new F(this.gl,e)}texture(e,t){return new C(this.gl,e,t)}shader(e){return new G(this.gl,e)}pipeline(e){return new B(this.gl,e)}pass(e={}){return new P(this.gl,e,this.d)}render(e){let t=this.width,n=this.height;e.props.color&&({width:t,height:n}=e.props.color[0].tex.props),this.gl.bindFramebuffer(y,e.glfb),this.gl.viewport(0,0,t,n);let r=0;return e.props.clearColor&&(r|=16384,this.gl.clearColor(...e.props.clearColor),this.gl.colorMask(!0,!0,!0,!0)),isNaN(e.props.clearDepth)||(r|=256,this.gl.clearDepth(e.props.clearDepth),this.gl.depthMask(!0)),isNaN(e.props.clearStencil)||(r|=1024,this.gl.clearStencil(e.props.clearStencil),this.gl.stencilMask(A)),r&&this.gl.clear(r),this.r}feature(e){return this.gl.getExtension(e)}reset(){this.r.reset()}}class D{constructor(e,t){this.gl=e,this.inst=t,this.reset()}reset(){this.s={p:null,r:0}}pipeline(e){if(this.s.p!==e){this.s.p=e,this.gl.useProgram(e.glp),function(e,t,n=0){const{blend:r,depth:i,stencil:o}=t,a=t.raster||{};if(k(e,32926,!!a.alphaToCoverage),k(e,2884,!!a.cullMode),k(e,32823,!(!a.depthBiasSlopeScale&&!a.depthBias)),e.polygonOffset(a.depthBiasSlopeScale||0,a.depthBias||0),a.cullMode&&e.cullFace(a.cullMode),e.frontFace(a.frontFace||2305),k(e,2929,!!i),i&&(e.depthMask(!!i.write),e.depthFunc(i.compare||O)),k(e,2960,!!o),o){var s,f;e.stencilMask(null!==(s=o.writeMask)&&void 0!==s?s:A);const t=null!==(f=o.readMask)&&void 0!==f?f:A;e.stencilFuncSeparate(v,o.frontCompare||O,n,t),e.stencilFuncSeparate(h,o.backCompare||O,n,t),e.stencilOpSeparate(v,o.frontFailOp||x,o.frontZFailOp||x,o.frontPassOp||x),e.stencilOpSeparate(h,o.backFailOp||x,o.backZFailOp||x,o.backPassOp||x)}if(k(e,3042,!!r),r){const t=r.colorMask||A;e.colorMask(!!(1&t),!!(2&t),!!(4&t),!!(8&t)),e.blendFuncSeparate(r.srcFactorRGB||1,r.dstFactorRGB||0,r.srcFactorAlpha||1,r.dstFactorAlpha||0),e.blendEquationSeparate(r.opRGB||32774,r.opAlpha||32774)}}(this.gl,e.props,this.s.r);for(let e=0;e<16;++e)this.gl.disableVertexAttribArray(e);for(const{attrs:t}of e.props.buffers)for(const{shaderLoc:e}of t)this.gl.enableVertexAttribArray(e)}return this}index({glb:e}){return this.gl.bindBuffer(34963,e),this}vertex(e,{glb:t}){const{attrs:n,stride:r,instanced:i}=this.s.p.props.buffers[e];this.gl.bindBuffer(d,t);for(const{format:e,offset:t,shaderLoc:o}of n)this.gl.vertexAttribPointer(o,M(e),L(e),R(e),r,t),this.inst&&this.inst.vertexAttribDivisorANGLE(o,i?1:0);return this}uniforms(e){let t=0;for(const n of e){const e=this.gl.getUniformLocation(this.s.p.glp,n.name);if(e)if(n.values||n.valueBuffer){const t=this.s.p.props.uniforms.find((e=>e.name===n.name));if(t)switch(t.valueFormat){case 35676:this.gl.uniformMatrix4fv(e,!1,n.values||n.valueBuffer);break;case 35675:this.gl.uniformMatrix3fv(e,!1,n.values||n.valueBuffer);break;case 35666:this.gl.uniform4fv(e,n.values||n.valueBuffer);break;case 35665:this.gl.uniform3fv(e,n.values||n.valueBuffer);break;case 35664:this.gl.uniform2fv(e,n.values||n.valueBuffer);break;default:this.gl.uniform1fv(e,n.values||n.valueBuffer)}}else n.tex?(this.gl.activeTexture(33984+t),this.gl.bindTexture(n.tex.props.type,n.tex.glt),this.gl.uniform1i(e,t++)):isNaN(n.value)||this.gl.uniform1f(e,n.value)}return this}draw(e,t=1,n=0){const{props:{mode:r},i}=this.s.p;return i?this.inst&&this.inst.drawArraysInstancedANGLE(r,n,e,t):this.gl.drawArrays(r,n,e),this}drawIndexed(e,t=1,n=0){const{props:{indexFormat:r,mode:i},i:o}=this.s.p;return o?this.inst&&this.inst.drawElementsInstancedANGLE(i,e,r,n*U(r),t):this.gl.drawElements(i,e,r,n*U(r)),this}viewport(e,t,n,r){return this.gl.viewport(e,t,n,r),this}scissor(e,t,n,r){return this}blendColor(e){return this.gl.blendColor(...e),this}stencilRef(e){{const n=this.s.p&&this.s.p.props.stencil;if(n){var t;const r=null!==(t=n.readMask)&&void 0!==t?t:A;this.gl.stencilFuncSeparate(v,n.frontCompare||O,e,r),this.gl.stencilFuncSeparate(h,n.backCompare||O,e,r)}this.s.r=e}return this}end(){}}function W(e){return(new TextDecoder).decode(e)}function H(e){return/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)}function V(e,t){return""===e?"":/^(https?:)?\/\//i.test(e)||H(e)?e:t+e}const j=1179937895;function $(e,t,n=0,r=0,i=e.length-n){for(let o=0;o<i;++o)t[r+o]=e[n+o];return t}function J(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}const q=[1,0,0,0,1,0,0,0,1];const X=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function K(e){for(let t=0;t<16;++t)e[t]=t%5?0:1;return e}function Q(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return $(e,t)}function Z(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return $(function(e,t,n,r){const i=t.length/4,o=n.length/4;let a=0;for(let e=0;e<o;++e)for(let o=0;o<i;++o){a=0;for(let r=0;r<4;++r)a+=t[r*i+o]*n[4*e+r];r[e*i+o]=a}return r}(0,e,t,X),n)}function Y(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[5]-e[4]*e[1],r=e[0]*e[9]-e[8]*e[1],i=e[0]*e[13]-e[12]*e[1],o=e[4]*e[9]-e[8]*e[5],a=e[4]*e[13]-e[12]*e[5],s=e[8]*e[13]-e[12]*e[9],f=e[2]*e[7]-e[6]*e[3],l=e[2]*e[11]-e[10]*e[3],c=e[2]*e[15]-e[14]*e[3],u=e[6]*e[11]-e[10]*e[7],d=e[6]*e[15]-e[14]*e[7],v=e[10]*e[15]-e[14]*e[11],h=n*v-r*d+i*u+o*c-a*l+s*f;return h?(X[0]=+e[5]*v-e[9]*d+e[13]*u,X[1]=-e[1]*v+e[9]*c-e[13]*l,X[2]=+e[1]*d-e[5]*c+e[13]*f,X[3]=-e[1]*u+e[5]*l-e[9]*f,X[4]=-e[4]*v+e[8]*d-e[12]*u,X[5]=+e[0]*v-e[8]*c+e[12]*l,X[6]=-e[0]*d+e[4]*c-e[12]*f,X[7]=+e[0]*u-e[4]*l+e[8]*f,X[8]=+e[7]*s-e[11]*a+e[15]*o,X[9]=-e[3]*s+e[11]*i-e[15]*r,X[10]=+e[3]*a-e[7]*i+e[15]*n,X[11]=-e[3]*o+e[7]*r-e[11]*n,X[12]=-e[6]*s+e[10]*a-e[14]*o,X[13]=+e[2]*s-e[10]*i+e[14]*r,X[14]=-e[2]*a+e[6]*i-e[14]*n,X[15]=+e[2]*o-e[6]*r+e[10]*n,function(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return J(e,t,n)}(X,1/h,t)):null}function ee(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){const n=function(e){return e[0]*+(e[4]*e[8]-e[7]*e[5])+e[3]*-(e[1]*e[8]-e[7]*e[2])+e[6]*+(e[1]*e[5]-e[4]*e[2])}(e);return n?(q[0]=+(e[4]*e[8]-e[7]*e[5]),q[1]=-(e[1]*e[8]-e[7]*e[2]),q[2]=+(e[1]*e[5]-e[4]*e[2]),q[3]=-(e[3]*e[8]-e[6]*e[5]),q[4]=+(e[0]*e[8]-e[6]*e[2]),q[5]=-(e[0]*e[5]-e[3]*e[2]),q[6]=+(e[3]*e[7]-e[6]*e[4]),q[7]=-(e[0]*e[7]-e[6]*e[1]),q[8]=+(e[0]*e[4]-e[3]*e[1]),function(e,t,n=[1,0,0,0,1,0,0,0,1]){return J(e,t,n)}(q,1/n,t)):null}(e,t)?function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t,n){let r=0;for(let e=0;e<3;++e)for(let i=e;i<3;++i)r=t[3*i+e],n[3*i+e]=t[3*e+i],n[3*e+i]=r;return n}(0,e,t)}(t,t):null}(function(e,t=[1,0,0,0,1,0,0,0,1]){for(let n=0;n<3;++n)for(let r=0;r<3;++r)t[3*n+r]=e[4*n+r];return t}(e,t),t)}function te(e=0,t=0,n=0,r=0){return[e,t,n,r]}te();const ne=function(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n};function re(e,t,n,r=[0,0,0,1]){let i=ne(e,t),o=1;i<0&&(i*=-1,o=-1);let a=1-n,s=n;if(1-i>1e-6){const e=Math.acos(i),t=Math.sin(e);a=Math.sin((1-n)*e)/t,s=Math.sin(n*e)/t}return s*=o,r[0]=e[0]*a+t[0]*s,r[1]=e[1]*a+t[1]*s,r[2]=e[2]*a+t[2]*s,r[3]=e[3]*a+t[3]*s,r}function ie(e=0,t=0,n=0){return[e,t,n]}ie(),te(),te(),ie(),ie(),ie();const oe=3553,ae=T,se=35676;function fe(e){return e.extras||(e.extras={}),e.extras}function le(e,t){let n=fe(t).input||null;if(!n){var r;const i=null===(r=e.accessors)||void 0===r?void 0:r[t.input];if(i){const{buffer:r,byteOffset:o=0}=de(e,i);fe(t).input=n=new Float32Array(r.buffer,o+r.byteOffset,(r.byteLength-o)/4)}}return n}function ce(e,t){let n=fe(t).output||null;if(!n){var r;const i=null===(r=e.accessors)||void 0===r?void 0:r[t.output];if(i){const{buffer:r,byteOffset:o=0}=de(e,i);let a=Float32Array;switch(i.componentType){case m:a=Int8Array;break;case b:a=Uint8Array;break;case p:case g:a=Uint16Array}fe(t).output=n=new a(r.buffer,o+r.byteOffset,(r.byteLength-o)/a.BYTES_PER_ELEMENT)}}return n}function ue(e){switch(e.type){case"VEC2":if(e.componentType===T)return 512;if(e.componentType===g)return e.normalized?66052:516;if(e.componentType===b)return e.normalized?66050:514;break;case"VEC3":if(e.componentType===T)return 768;break;case"VEC4":if(e.componentType===T)return 1024;if(e.componentType===b)return e.normalized?66562:1026;if(e.componentType===g)return e.normalized?66564:1028}return null}function de(e,t){var n;let r=fe(t).buffer,i=fe(t).byteOffset||0;if(r)return{buffer:r,byteOffset:i};const o=function(e){let t=0;switch(e.type){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":case"MAT2":t=4;break;case"MAT3":t=9;break;case"MAT4":t=16}let n=0;switch(e.componentType){case m:case b:n=1;break;case p:case g:n=2;break;case 5125:case T:n=4}return t*n}(t);let a=t.count*o;const s=null===(n=e.bufferViews)||void 0===n?void 0:n[t.bufferView];if(s){const n=ve(e,s),f=s.byteStride||1;i=(t.byteOffset||0)%f,a=t.count*(s.byteStride||o);const l=(t.byteOffset||0)-i;r=new Uint8Array(n.buffer,n.byteOffset+l,a)}if(t.sparse){var f,l;const{count:n,indices:{bufferView:s,byteOffset:c=0,componentType:u},values:{bufferView:d,byteOffset:v=0}}=t.sparse,h=null===(f=e.bufferViews)||void 0===f?void 0:f[s],m=null===(l=e.bufferViews)||void 0===l?void 0:l[d];if(h&&m){const t=new Uint8Array(a);r&&t.set(r,i);const s=ve(e,h),f=ve(e,m),l=new(u===b?Uint8Array:u===g?Uint16Array:Uint32Array)(s.buffer,s.byteOffset+c,n),d=new Uint8Array(f.buffer,f.byteOffset+v,n*o);for(let e=0;e<n;++e){const n=l[e]*o;for(let r=0;r<o;++r)t[n+r]=d[e*o+r]}i=0,r=t}}return r?(fe(t).buffer=r,fe(t).byteOffset=i):r=new Uint8Array,{buffer:r,byteOffset:i}}function ve(e,t){let n=fe(t).buffer;if(!n){var r;const i=null===(r=e.buffers)||void 0===r?void 0:r[t.buffer];if(i){const e=i.extras.buffer;n=new Uint8Array(e.buffer,e.byteOffset+(t.byteOffset||0),t.byteLength)}else n=new Uint8Array;fe(t).buffer=n}return n}async function he(e,t=me){const n=e.uri?function(e){if(H(e))return"";const t=e.split(/[?#]/)[0].split("/");return t.pop(),t.length?t.join("/")+"/":""}(e.uri):"";let r=e.glTF,i=e.binaryChunk;if(!r&&e.uri){const n=await t(e.uri,"bin");if(o=n,new DataView(o.buffer||o,o.byteOffset||0,4).getUint32(0,!0)===j){const e=function(e){let t,n;const r=e.buffer||e,i=e.byteOffset||0,o=new DataView(r,i,12);if(o.getUint32(0,!0)!==j)throw new Error("Invalid GLB format");const a=o.getUint32(4,!0);if(2!==a)throw new Error("Unsupported GLB version: "+a);const s=new DataView(r,i+12);let f=0;for(;f<s.byteLength;){const e=s.getUint32(f,!0),o=s.getUint32(f+4,!0);if(f+=8,1313821514===o){const n=new Uint8Array(r,i+12+f,e);t=JSON.parse(W(n))}else 5130562===o&&(n=new Uint8Array(r,i+12+f,e));f+=e}if(!t)throw new Error("Invalid GLB format: missing JSON content");if(!t.asset||"2.0"!==t.asset.minVersion&&"2.0"!==t.asset.version)throw new Error("Unsupported glTF version: 2.0 required");return{glTF:t,binaryChunk:n}}(n);r=e.glTF,i=e.binaryChunk}else r=JSON.parse(W(n))}var o;if(!r)throw new Error("Failed to load glTF JSON");const a=await async function(e,t,n,r){if(e.buffers)for(let i=0;i<e.buffers.length;++i){const o=e.buffers[i];if(fe(o).buffer)continue;let a;const s=o.uri;if(s)a=await n(V(s,r),"bin");else{if(0!==i||!t)throw new Error("Invalid glTF: missing uri for buffer "+i);a=t}fe(o).buffer=a}return e}(r,i,t,n);return await async function(e,t,n){if(e.images)for(let i=0;i<e.images.length;++i){const o=e.images[i];if(fe(o).image)continue;const a=o.bufferView;let s,f=!1,l=o.uri;if(a){var r;const t=null===(r=e.bufferViews)||void 0===r?void 0:r[a];if(!t)throw new Error("Invalid glTF: invalid bufferView for image "+i);const n=new Blob([ve(e,t)],{type:o.mimeType});l=URL.createObjectURL(n),f=!0}if(!l)throw new Error("Invalid glTF: missing uri or bufferView for image "+i);try{s=await t(V(l,n),"img")}finally{f&&URL.revokeObjectURL(l)}fe(o).image=s}return e}(a,t,n)}function me(e,t){return"img"===t?new Promise(((t,n)=>{const r=new Image;r.crossOrigin="anonymous",r.onerror=()=>n(new Error("Failed to load: "+e)),r.onload=()=>t(r),r.src=e})):fetch(e).then((e=>e.arrayBuffer())).then((e=>new Uint8Array(e)))}const be=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],pe=[0,0,0,1],ge=ie(1,1,1),Te=ie();function _e(e,t,n,r=null){var i;const o=null===(i=e.nodes)||void 0===i?void 0:i[t];if(!o)return;null==r||r.push(t);const a=fe(o),s=a.matrix=a.matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];o.matrix?Q(o.matrix,s):(o.rotation||o.scale||o.translation||a.rotation||a.scale||a.translation)&&function(e,t,n,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){(function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[0],r=e[0]*e[1],i=e[0]*e[2],o=e[1]*e[1],a=e[1]*e[2],s=e[2]*e[2],f=e[3]*e[0],l=e[3]*e[1],c=e[3]*e[2];t[0]=1-2*(o+s),t[1]=2*(r+c),t[2]=2*(i-l),t[4]=2*(r-c),t[5]=1-2*(n+s),t[6]=2*(a+f),t[8]=2*(i+l),t[9]=2*(a-f),t[10]=1-2*(n+o),t[3]=t[7]=t[11]=t[12]=t[13]=t[14]=0,t[15]=1})(e,t)}(t,r);for(let e=0;e<3;++e)for(let t=0;t<3;++t)r[4*e+t]*=n[e];$(e,r,0,12,3)}(a.translation||o.translation||Te,a.rotation||o.rotation||pe,a.scale||o.scale||ge,s);const f=a.model=Z(n,s,a.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(o.children)for(const t of o.children)_e(e,t,f,r)}function Oe(e,t){var n;const r=null===(n=e.cameras)||void 0===n?void 0:n[t.camera];if(r){const e=fe(t).model=fe(t).model||be;fe(r).view=Y(e,fe(r).view||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),fe(r).translation=[e[12],e[13],e[14]]}}function xe(e,t){var n;const r=null===(n=e.skins)||void 0===n?void 0:n[t.skin];if(r){const n=r.joints.length,i=fe(t).jointMatrix=fe(t).jointMatrix||new Float32Array(16*n),o=function(e,t){let n=fe(t).inverseBindMatrices;if(!n){var r;const i=null===(r=e.accessors)||void 0===r?void 0:r[t.inverseBindMatrices];if(i){const{buffer:r,byteOffset:o}=de(e,i);n=new Float32Array(r.buffer,r.byteOffset+o,16*t.joints.length)}else n=new Float32Array(16*t.joints.length);fe(t).inverseBindMatrices=n}return n}(e,r);for(let a=0;a<n;++a){const n=e.nodes[r.joints[a]],s=new Float32Array(i.buffer,i.byteOffset+64*a,16),f=new Float32Array(o.buffer,o.byteOffset+64*a,16);Y(fe(t).model||be,s),Z(s,n&&fe(n).model||be,s),Z(s,f,s)}}}const Ne=["POSITION","NORMAL","TANGENT"],ye=/(POSITION|NORMAL|TANGENT)_(\d+)/,Se=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ee=ie(),we=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Ae(e,t,n={}){var r,i,o;const a=(null!==(r=n.scene)&&void 0!==r?r:t.scene)||0,s=t.nodes,f=null===(i=t.scenes)||void 0===i||null===(o=i[a])||void 0===o?void 0:o.nodes;if(!s||!f)return;const l=function(e,t={}){var n,r,i;let o=[];const a=null===(n=e.scenes)||void 0===n||null===(r=n[(null!==(i=t.scene)&&void 0!==i?i:e.scene)||0])||void 0===r?void 0:r.nodes;if(a)for(let t=0;t<a.length;++t)_e(e,a[t],be,o);o=o.sort().filter(((e,t,n)=>!t||e!==n[t-1]));for(const t of o){const n=e.nodes[t];"camera"in n&&Oe(e,n),"skin"in n&&xe(e,n)}return o}(t,{scene:a});let c=Se,u=Se,d=Ee;if(n.camera){var v;const r=null===(v=t.cameras)||void 0===v?void 0:v[n.camera.index||0];var h,m;r&&(c=(null===(h=r.extras)||void 0===h?void 0:h.view)||Se,b=we,p=r,g=e.width/e.height,null!=p&&p.orthographic?function(e,t,n,r,i,o,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const s=1/(t-e),f=1/(r-n),l=1/(i-o);K(a),a[0]=2*s,a[5]=2*f,a[10]=2*l,a[12]=-(t+e)*s,a[13]=-(r+n)*f,a[14]=(i+o)*l}(-p.orthographic.xmag,p.orthographic.xmag,-p.orthographic.xmag/(g||1),p.orthographic.xmag/(g||1),p.orthographic.znear,p.orthographic.zfar,b):null!=p&&p.perspective?function(e,t,n,r=1/0,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const o=1/Math.tan(t/2);if(K(i),i[0]=o/e,i[5]=o,i[11]=-1,i[15]=0,isFinite(r)){const e=1/(n-r);i[10]=(n+r)*e,i[14]=2*n*r*e}else i[10]=-1,i[14]=-2*n}(g||p.perspective.aspectRatio||1,p.perspective.yfov,p.perspective.znear,p.perspective.zfar||1/0,b):K(b),u=b,d=(null===(m=r.extras)||void 0===m?void 0:m.translation)||Ee),n.camera.model&&(d=ie(n.camera.model[12],n.camera.model[13],n.camera.model[14]),Y(n.camera.model,c)),u=n.camera.proj||u}var b,p,g;const T={cameraPosition:d,viewProj:Z(u,c,we)},_=e.pass(),O=e.render(_),x=[];for(let n=0;n<l.length;++n){var N;const r=s[l[n]],i=null===(N=t.meshes)||void 0===N?void 0:N[r.mesh];if(i)for(let n=0;n<i.primitives.length;++n){var y,S;const o=i.primitives[n];"BLEND"===(null===(y=t.materials)||void 0===y||null===(S=y[o.material])||void 0===S?void 0:S.alphaMode)?x.push({node:r,mesh:i,primitive:o}):Ie(e,O,t,r,i,o,T)}}for(const n of x)Ie(e,O,t,n.node,n.mesh,n.primitive,T);O.end(),_.destroy()}function Ie(e,t,n,r,i,o,a){var s,f,l,c;a.model=Q(fe(r).model||Se,a.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ee(a.model,a.normalMatrix=a.normalMatrix||[1,0,0,0,1,0,0,0,1])||function(e){for(let t=0;t<9;++t)e[t]=t%4?0:1}(a.normalMatrix);let u=!1,d=0,v=(null===(s=n.accessors)||void 0===s||null===(f=s[o.attributes.POSITION])||void 0===f?void 0:f.count)||0;if(!v)return;const h={...a,...Me(e,n,o.material)};o.targets&&(h.targetWeights=fe(r).weights||r.weights||i.weights||[0,0,0,0,0,0,0,0]);let m=0;const b=null===(l=n.skins)||void 0===l?void 0:l[r.skin];if(o.attributes.JOINTS_0&&o.attributes.WEIGHTS_0&&b){m=b.joints.length;const e=fe(r).jointMatrix=fe(r).jointMatrix||new Float32Array(16*m);h.jointMatrix=e}const p=[];for(const e in h)"number"==typeof h[e]?p.push({name:e,value:h[e]}):h[e].length?p.push({name:e,values:h[e]}):p.push({name:e,tex:h[e]});const g=function(e,t,n,r=0){var i,o,a;let s=fe(n).pipeline;if(s)return s;const f=n.mode||4,l=null===(i=t.materials)||void 0===i?void 0:i[n.material];let c="OPAQUE",u=!1,d=!1;var v;l&&(u=l.doubleSided||!1,c=l.alphaMode||c,d=!(null===(v=l.extensions)||void 0===v||!v.KHR_materials_unlit));const h=function(e,t){const n={},r=[];let i=0;function o(t){var i,o;if(!t.sparse){const i=de(e,t).buffer,o=`${t.bufferView},${i.byteOffset},${i.byteLength}`;if(o in n)return r[n[o]];n[o]=r.length}const a={attrs:[],stride:null===(i=e.bufferViews)||void 0===i||null===(o=i[t.bufferView])||void 0===o?void 0:o.byteStride};return r.push(a),a}for(const n of["POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","JOINTS_0","WEIGHTS_0"]){var a;const r=null===(a=e.accessors)||void 0===a?void 0:a[t.attributes[n]];if(r){const e=ue(r);if(!e)continue;o(r).attrs.push({name:n,format:e,shaderLoc:i,offset:fe(r).byteOffset||0}),i++}}if(t.targets){const n=new Array(3);for(let r=0;r<t.targets.length;++r){let a=0;for(let i=0;i<Ne.length;++i){var s;(n[i]=null===(s=e.accessors)||void 0===s?void 0:s[t.targets[r][Ne[i]]])&&++a}if(i+a>16)break;for(let e=0;e<Ne.length;++e){const t=n[e];t&&(o(t).attrs.push({name:`${Ne[e]}_${r}`,format:768,shaderLoc:i,offset:fe(t).byteOffset||0}),i++)}}}return r}(t,n),m=5125===(null===(o=t.accessors)||void 0===o||null===(a=o[n.indices])||void 0===a?void 0:a.componentType)?5125:5123,b=n.attributes.JOINTS_0&&n.attributes.WEIGHTS_0?12*Math.ceil(r/12):0,p=JSON.stringify([h,u,c,b,m,f,d]),g=fe(t).pipelines=fe(t).pipelines||{};if(s=g[p],s)return s;const T=[`ALPHAMODE_${c}`];for(const e of h)for(const t of e.attrs)T.push(`USE_${t.name}`),"COLOR_0"===t.name&&3===M(t.format)&&T.push("COLOR_0_VEC3");b>0&&T.push(`NUM_JOINTS ${b}`),d&&T.push("MATERIAL_UNLIT");const _=T.map((e=>`#define ${e}\n`)).join(""),O=[];b>0&&O.push({name:"jointMatrix",type:1,valueFormat:se}),n.targets&&O.push({name:"targetWeights",type:1,valueFormat:ae});const x=e.shader({type:35633,source:_+"precision highp float;uniform mat4 model,viewProj;uniform mat3 normalMatrix;\n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\nattribute vec3 COLOR_0;\n#else\nattribute vec4 COLOR_0;\n#endif\nvarying vec4 vColor0;\n#endif\n#ifdef USE_TEXCOORD_0\nattribute vec2 TEXCOORD_0;\n#endif\n#ifdef USE_TEXCOORD_1\nattribute vec2 TEXCOORD_1;\n#endif\nvarying vec2 vTexCoord0,vTexCoord1;attribute vec3 POSITION;varying vec3 vPosition;\n#if defined(NUM_JOINTS) && defined(USE_WEIGHTS_0) && defined(USE_JOINTS_0)\n#define USE_SKIN\nattribute vec4 JOINTS_0,WEIGHTS_0;uniform mat4 jointMatrix[NUM_JOINTS];mat4 a(){mat4 b=WEIGHTS_0.x*jointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*jointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*jointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*jointMatrix[int(JOINTS_0.w)];return b;}\n#endif\n#if defined(NUM_MORPHS) && defined(USE_POSITION_0) || defined(USE_NORMAL_0) || defined(USE_TANGENT_0)\n#define USE_MORPH\nuniform float targetWeights[NUM_MORPHS];\n#ifdef USE_POSITION_0\nattribute vec3 POSITION_0;\n#endif\n#ifdef USE_POSITION_1\nattribute vec3 POSITION_1;\n#endif\n#ifdef USE_POSITION_2\nattribute vec3 POSITION_2;\n#endif\n#ifdef USE_POSITION_3\nattribute vec3 POSITION_3;\n#endif\n#ifdef USE_POSITION_4\nattribute vec3 POSITION_4;\n#endif\n#ifdef USE_POSITION_5\nattribute vec3 POSITION_5;\n#endif\n#ifdef USE_POSITION_6\nattribute vec3 POSITION_6;\n#endif\n#ifdef USE_POSITION_7\nattribute vec3 POSITION_7;\n#endif\n#ifdef USE_NORMAL_0\nattribute vec3 NORMAL_0;\n#endif\n#ifdef USE_NORMAL_1\nattribute vec3 NORMAL_1;\n#endif\n#ifdef USE_NORMAL_2\nattribute vec3 NORMAL_2;\n#endif\n#ifdef USE_NORMAL_3\nattribute vec3 NORMAL_3;\n#endif\n#ifdef USE_NORMAL_4\nattribute vec3 NORMAL_4;\n#endif\n#ifdef USE_NORMAL_5\nattribute vec3 NORMAL_5;\n#endif\n#ifdef USE_NORMAL_6\nattribute vec3 NORMAL_6;\n#endif\n#ifdef USE_NORMAL_7\nattribute vec3 NORMAL_7;\n#endif\n#ifdef USE_TANGENT_0\nattribute vec3 TANGENT_0;\n#endif\n#ifdef USE_TANGENT_1\nattribute vec3 TANGENT_1;\n#endif\n#ifdef USE_TANGENT_2\nattribute vec3 TANGENT_2;\n#endif\n#ifdef USE_TANGENT_3\nattribute vec3 TANGENT_3;\n#endif\n#ifdef USE_TANGENT_4\nattribute vec3 TANGENT_4;\n#endif\n#ifdef USE_TANGENT_5\nattribute vec3 TANGENT_5;\n#endif\n#ifdef USE_TANGENT_6\nattribute vec3 TANGENT_6;\n#endif\n#ifdef USE_TANGENT_7\nattribute vec3 TANGENT_7;\n#endif\nvec3 c(){vec3 d=vec3(0.);\n#ifdef USE_POSITION_0\nd+=targetWeights[0]*POSITION_0;\n#endif\n#ifdef USE_POSITION_1\nd+=targetWeights[1]*POSITION_1;\n#endif\n#ifdef USE_POSITION_2\nd+=targetWeights[2]*POSITION_2;\n#endif\n#ifdef USE_POSITION_3\nd+=targetWeights[3]*POSITION_3;\n#endif\n#ifdef USE_POSITION_4\nd+=targetWeights[4]*POSITION_4;\n#endif\n#ifdef USE_POSITION_5\nd+=targetWeights[5]*POSITION_5;\n#endif\n#ifdef USE_POSITION_6\nd+=targetWeights[6]*POSITION_6;\n#endif\n#ifdef USE_POSITION_7\nd+=targetWeights[7]*POSITION_7;\n#endif\nreturn d;}vec3 e(){vec3 d=vec3(0.);\n#ifdef USE_NORMAL_0\nd+=targetWeights[0]*NORMAL_0;\n#endif\n#ifdef USE_NORMAL_1\nd+=targetWeights[1]*NORMAL_1;\n#endif\n#ifdef USE_NORMAL_2\nd+=targetWeights[2]*NORMAL_2;\n#endif\n#ifdef USE_NORMAL_3\nd+=targetWeights[3]*NORMAL_3;\n#endif\n#ifdef USE_NORMAL_4\nd+=targetWeights[4]*NORMAL_4;\n#endif\n#ifdef USE_NORMAL_5\nd+=targetWeights[5]*NORMAL_5;\n#endif\n#ifdef USE_NORMAL_6\nd+=targetWeights[6]*NORMAL_6;\n#endif\n#ifdef USE_NORMAL_7\nd+=targetWeights[7]*NORMAL_7;\n#endif\nreturn d;}vec3 f(){vec3 d=vec3(0.);\n#ifdef USE_TANGENT_0\nd+=targetWeights[0]*TANGENT_0;\n#endif\n#ifdef USE_TANGENT_1\nd+=targetWeights[1]*TANGENT_1;\n#endif\n#ifdef USE_TANGENT_2\nd+=targetWeights[2]*TANGENT_2;\n#endif\n#ifdef USE_TANGENT_3\nd+=targetWeights[3]*TANGENT_3;\n#endif\n#ifdef USE_TANGENT_4\nd+=targetWeights[4]*TANGENT_4;\n#endif\n#ifdef USE_TANGENT_5\nd+=targetWeights[5]*TANGENT_5;\n#endif\n#ifdef USE_TANGENT_6\nd+=targetWeights[6]*TANGENT_6;\n#endif\n#ifdef USE_TANGENT_7\nd+=targetWeights[7]*TANGENT_7;\n#endif\nreturn d;}\n#endif\nvec4 g(){vec4 h=vec4(POSITION,1.);\n#ifdef USE_MORPH\nh+=vec4(c(),0.);\n#endif\n#ifdef USE_SKIN\nh=a()*h;\n#endif\nreturn h;}\n#ifdef USE_NORMAL\nattribute vec3 NORMAL;\n#ifdef USE_TANGENT\nattribute vec4 TANGENT;varying mat3 vTBN;vec3 i(){vec3 j=TANGENT.xyz;\n#ifdef USE_MORPH\ntan+=f();\n#endif\n#ifdef USE_SKIN\ntan=mat3(a())*tan;\n#endif\nreturn normalize(tan);}\n#else\nvarying vec3 vNormal;\n#endif\nvec3 k(){vec3 l=NORMAL;\n#ifdef USE_MORPH\nl+=e();\n#endif\n#ifdef USE_SKIN\nl=mat3(a())*l;\n#endif\nreturn normalize(l);}\n#endif\nvoid main(void){vec4 h=model*g();vPosition=h.xyz/h.w;\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\nvec3 j=i();vec3 m=normalize(normalMatrix*k());vec3 n=normalize(normalMatrix*tan);vec3 o=cross(m,n)*TANGENT.w;vTBN=mat3(n,o,m);\n#else\nvNormal=normalize(normalMatrix*NORMAL);\n#endif\n#endif\n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\nvColor0=vec4(COLOR_0,1.);\n#else\nvColor0=COLOR_0;\n#endif\n#endif\nvTexCoord0=vec2(0.);vTexCoord1=vec2(0.);\n#ifdef USE_TEXCOORD_0\nvTexCoord0=TEXCOORD_0;\n#endif\n#ifdef USE_TEXCOORD_1\nvTexCoord1=TEXCOORD_1;\n#endif\ngl_Position=viewProj*h;gl_PointSize=1.;}"}),N=e.shader({type:35632,source:_+"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;uniform float alphaCutoff;uniform vec3 cameraPosition;varying vec3 vPosition;const float a=2.2;const float b=3.141592653589793;vec3 c(vec3 d){return pow(d,vec3(1./a));}vec3 e(vec3 f){return pow(f.xyz,vec3(a));}vec4 e(vec4 f){return vec4(e(f.xyz),f.w);}vec3 g(vec3 h,vec3 i,float j){return h+(i-h)*pow(clamp(1.-j,0.,1.),5.);}float k(float l,float m){float n=(m*m)*(l-1.)+1.;return l/(b*n*n);}float o(float l,float p,float q){float r=1./(p+sqrt(l+(1.-l)*(p*p)));float s=1./(q+sqrt(l+(1.-l)*(q*q)));return r*s;}float t(float l,float p,float q,float m){return o(l,p,q)*k(l,m);}vec3 u(vec3 d){return d/b;}varying vec2 vTexCoord0,vTexCoord1;struct v{sampler2D tex;float texCoord;float scale;};vec2 w(v tex){return mix(vTexCoord0,vTexCoord1,step(1.,tex.texCoord));}vec4 x(v tex){return texture2D(tex.tex,w(tex));}vec4 x(v tex,vec4 y){return mix(y,texture2D(tex.tex,w(tex)),step(0.,tex.texCoord));}uniform v normalTexture;\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\nvarying mat3 vTBN;\n#else\nvarying vec3 vNormal;\n#endif\n#endif\nstruct z{vec3 A;vec3 B;vec3 t;vec3 b;};z C(vec3 D){vec3 B,t,b,A;\n#ifdef USE_TANGENT\nt=normalize(vTBN[0]);b=normalize(vTBN[1]);A=normalize(vTBN[2]);\n#else\n#ifdef USE_NORMAL\nA=normalize(vNormal);\n#else\nA=normalize(cross(dFdx(D),dFdy(D)));\n#endif\nvec2 E=w(normalTexture);vec3 F=dFdx(vec3(E,0.));vec3 G=dFdy(vec3(E,0.));vec3 H=(G.t*dFdx(D)-F.t*dFdy(D))/(F.s*G.t-G.s*F.t);t=normalize(H-A*dot(A,H));b=cross(A,t);\n#endif\nif(gl_FrontFacing==false){t*=-1.;b*=-1.;A*=-1.;}B=A;if(normalTexture.texCoord>=0.){B=x(normalTexture).rgb*2.-vec3(1.);B*=vec3(normalTexture.scale,normalTexture.scale,1.);B=mat3(t,b,A)*normalize(B);}z I;I.A=A;I.t=t;I.b=b;I.B=B;return I;}\n#ifdef USE_COLOR_0\nvarying vec4 vColor0;\n#endif\nuniform vec4 baseColorFactor;uniform v baseColorTexture;uniform float metallicFactor,roughnessFactor;uniform v metallicRoughnessTexture;uniform v occlusionTexture;uniform vec3 emissiveFactor;uniform v emissiveTexture;vec4 J(){vec4 d=vec4(1.);\n#ifdef USE_COLOR_0\nd=vColor0;\n#endif\nreturn d;}vec4 K(){vec4 L=vec4(1.);L*=baseColorFactor;L*=e(x(baseColorTexture,vec4(1.)));return L*J();}vec2 M(){vec4 N=x(metallicRoughnessTexture,vec4(1.));return vec2(clamp(metallicFactor*N.b,0.,1.),clamp(roughnessFactor*N.g,.04,1.));}float O(){return x(occlusionTexture,vec4(1.)).r;}vec3 P(){return emissiveFactor*e(x(emissiveTexture,vec4(0.)).rgb);}\n#define LIGHT_DIRECTIONAL 0\n#define LIGHT_POINT 1\n#define LIGHT_SPOT 2\nint Q(mat4 R){return int(R[0].x);}vec2 S(mat4 R){return R[0].yz;}vec4 T(mat4 R){return R[1];}float U(mat4 R){return R[2].w;}vec3 V(mat4 R){return R[2].xyz;}vec3 W(mat4 R){return R[3].xyz;}float X(float Y,float Z){if(Y<=0.){return 1./pow(Z,2.);}return max(min(1.0-pow(Z/Y,4.),1.),0.)/pow(Z,2.);}float ba(vec3 bb,vec3 bc,vec2 bd){float be=dot(normalize(bc),normalize(-bb));float scale=1./max(.001,bd[0]-bd[1]);float bf=-bd[1]*scale;float bg=clamp(be*scale+bf,0.,1.);return bg*bg;}vec3 bh(mat4 R,vec3 bi){return Q(R)!=LIGHT_DIRECTIONAL?W(R)-bi:-V(R);}vec3 bj(mat4 R,vec3 bb){vec4 d=T(R);vec3 bk=d.rgb*d.a;if(Q(R)!=LIGHT_DIRECTIONAL){bk*=X(U(R),length(bb));}if(Q(R)==LIGHT_SPOT){bk*=ba(bb,V(R),S(R));}return bk;}void main(){vec4 L=K();\n#ifdef ALPHAMODE_OPAQUE\nL.a=1.;\n#endif\n#ifdef MATERIAL_UNLIT\ngl_FragColor=(vec4(c(L.rgb),L.a));return;\n#endif\nvec3 D=normalize(cameraPosition-vPosition);z bl=C(vPosition);vec3 B=bl.B;vec3 bm=-normalize(reflect(D,B));float q=clamp(abs(dot(B,D)),0.001,1.);vec2 bn=M();float bo=bn[0];float bp=bn[1];float bq=bp*bp;float l=bq*bq;vec3 br=vec3(0.04);vec3 bs=L.rgb*(vec3(1.)-br)*(1.-bo);vec3 bt=mix(br,L.rgb,bo);float h=max(max(bt.r,bt.g),bt.b);float i=clamp(h*25.,0.,1.);vec3 bu=bt.rgb;vec3 bv=vec3(1.,1.,1.)*i;vec3 bw=vec3(0.);vec3 bx=vec3(0.);\n#define NUM_LIGHTS 4\nmat4 by[4];by[0]=mat4(0.,0.,0.,0.,1.,1.,1.,1.,.5,-.707,-.5,0.,0.,0.,0.,0.);by[1]=mat4(0.,0.,0.,0.,1.,1.,1.,.5,-.5,.707,.5,0.,0.,0.,0.,0.);by[2]=mat4(0.,0.,0.,0.,1.,1.,1.,.25,.5,.707,-.5,0.,0.,0.,0.,0.);by[3]=mat4(0.,0.,0.,0.,1.,1.,1.,.25,-.5,-.707,.5,0.,0.,0.,0.,0.);\n#ifdef NUM_LIGHTS\nfor(int bz=0;bz<NUM_LIGHTS;++bz){vec3 bb=bh(by[bz],vPosition);vec3 bk=bj(by[bz],bb);vec3 bA=normalize(bb);vec3 bB=normalize(bA+D);float p=clamp(dot(B,bA),0.001,1.);float m=clamp(dot(B,bB),0.,1.);float j=clamp(dot(D,bB),0.,1.);vec3 bC=g(bu,bv,j);vec3 bD=(1.-bC)*u(bs);vec3 bE=max(vec3(0.),bC*t(l,p,q,m));bw+=bk*p*bD;bx+=bk*p*bE;}\n#endif\nvec4 bF=vec4(.1);vec3 bG=bF.rgb*u(bs);bw+=bG;vec3 bH=bw+bx;float bI=O();bH=mix(bH,bH*bI,occlusionTexture.scale);vec3 bJ=P();bH+=bJ;\n#ifdef ALPHAMODE_MASK\nif(L.a<alphaCutoff){discard;}L.a=1.;\n#else\nalphaCutoff;\n#endif\ngl_FragColor=vec4(c(bH),L.a);}"});return s=fe(n).pipeline=g[p]=e.pipeline({vert:x,frag:N,buffers:h,indexFormat:m,mode:f,depth:{compare:515,write:!("BLEND"===c)},blend:"BLEND"===c?{srcFactorRGB:770,dstFactorRGB:771,srcFactorAlpha:1,dstFactorAlpha:771}:void 0,raster:{cullMode:u?0:1029},uniforms:[{name:"model",type:1,valueFormat:se},{name:"viewProj",type:1,valueFormat:se},{name:"normalMatrix",type:1,valueFormat:35675},{name:"cameraPosition",type:1,valueFormat:35665},{name:"alphaCutoff",type:1,valueFormat:ae},{name:"baseColorFactor",type:1,valueFormat:35666},{name:"baseColorTexture.tex",type:2,texType:oe},{name:"baseColorTexture.texCoord",type:1,valueFormat:ae},{name:"metallicFactor",type:1,valueFormat:ae},{name:"roughnessFactor",type:1,valueFormat:ae},{name:"metallicRoughnessTexture.tex",type:2,texType:oe},{name:"metallicRoughnessTexture.texCoord",type:1,valueFormat:ae},{name:"normalTexture.tex",type:2,texType:oe},{name:"normalTexture.texCoord",type:1,valueFormat:ae},{name:"normalTexture.scale",type:1,valueFormat:ae},{name:"emissiveFactor",type:1,valueFormat:35665},{name:"emissiveTexture.tex",type:2,texType:oe},{name:"emissiveTexture.texCoord",type:1,valueFormat:ae},{name:"occlusionTexture.tex",type:2,texType:oe},{name:"occlusionTexture.texCoord",type:1,valueFormat:ae},{name:"occlusionTexture.scale",type:1,valueFormat:ae},...O]}),x.destroy(),N.destroy(),s}(e,n,o,m);t.pipeline(g).uniforms(p);for(let r=0;r<g.props.buffers.length;++r){const i=g.props.buffers[r].attrs[0].name,a=ye.exec(i),s=Le(e,n,a?o.targets[a[2]][a[1]]:o.attributes[i],34962);s&&t.vertex(r,s)}const T=null===(c=n.accessors)||void 0===c?void 0:c[o.indices];if(T){const r=Le(e,n,o.indices,34963);r&&(t.index(r),v=T.count,d=fe(T).byteOffset||0,u=!0)}u?t.drawIndexed(v,1,d):t.draw(v)}function Me(e,t,n){var r;const i={alphaCutoff:.5,baseColorFactor:[1,1,1,1],"baseColorTexture.tex":Re(e,t),"baseColorTexture.texCoord":-1,metallicFactor:1,roughnessFactor:1,"metallicRoughnessTexture.tex":Re(e,t),"metallicRoughnessTexture.texCoord":-1,"normalTexture.tex":Re(e,t),"normalTexture.texCoord":-1,"normalTexture.scale":1,emissiveFactor:[0,0,0],"emissiveTexture.tex":Re(e,t),"emissiveTexture.texCoord":-1,"occlusionTexture.tex":Re(e,t),"occlusionTexture.texCoord":-1,"occlusionTexture.scale":0};function o(n,r,o=null){var a;n[r]&&(i[`${r}.tex`]=function(e,t,n){var r,i,o,a,s;const f=null===(r=t.textures)||void 0===r?void 0:r[n];if(!f)return Re(e,t);let l=fe(f).texture;if(l)return l;let c=null;const u={wrapU:10497,wrapV:10497,magFilter:9729,minFilter:9729},d=null===(i=t.images)||void 0===i?void 0:i[f.source];d&&(c=d.extras.image);const v=null===(o=t.samplers)||void 0===o?void 0:o[f.sampler];if(v)switch(u.wrapU=v.wrapS||u.wrapU,u.wrapV=v.wrapT||u.wrapV,u.magFilter=v.magFilter||u.magFilter,v.minFilter){case 9728:case 9984:case 9986:u.minFilter=9728}return l=fe(f).texture=e.texture({width:(null===(a=c)||void 0===a?void 0:a.naturalWidth)||1,height:(null===(s=c)||void 0===s?void 0:s.naturalHeight)||1},u),l.data(c?{image:c}:{buffer:new Uint8Array([255,255,255,255])}),l}(e,t,n[r].index),i[`${r}.texCoord`]=n[r].texCoord||0,o&&(i[`${r}.scale`]=null!==(a=n[r][o])&&void 0!==a?a:i[`${r}.scale`]))}const a=null===(r=t.materials)||void 0===r?void 0:r[n];if(a){var s;if(a.pbrMetallicRoughness){const e=a.pbrMetallicRoughness;i.baseColorFactor=e.baseColorFactor||i.baseColorFactor,(e.metallicFactor||0===e.metallicFactor)&&(i.metallicFactor=e.metallicFactor),(e.roughnessFactor||0===e.roughnessFactor)&&(i.roughnessFactor=e.roughnessFactor),o(e,"baseColorTexture"),o(e,"metallicRoughnessTexture")}i.alphaCutoff=null!==(s=a.alphaCutoff)&&void 0!==s?s:i.alphaCutoff,i.emissiveFactor=a.emissiveFactor||i.emissiveFactor,o(a,"emissiveTexture"),o(a,"occlusionTexture","strength"),o(a,"normalTexture","scale")}return i}function Le(e,t,n,r){var i,o;const a=null===(i=t.accessors)||void 0===i?void 0:i[n];if(!a)return null;const s=34963===r&&a.componentType===b;if(a.sparse||s){let n=fe(a).gpuBuffer;if(!n){const i=de(t,a);let o=i.buffer;if(s){const e=new Uint16Array(o.byteLength);for(let t=0;t<o.byteLength;++t)e[t]=o[i.byteOffset+t];o=fe(a).buffer=new Uint8Array(e.buffer,0,e.byteLength),fe(a).byteOffset=0}n=fe(a).gpuBuffer=e.buffer({type:r,size:o.byteLength}).data(o)}return n}const f=null===(o=t.bufferViews)||void 0===o?void 0:o[a.bufferView];if(!f)return null;const l=fe(f).gpuBuffers=fe(f).gpuBuffers||{},c=de(t,a).buffer,u=`${c.byteOffset},${c.byteLength}`;return l[u]?l[u]:l[u]=e.buffer({type:f.target||r,size:c.byteLength}).data(c)}function Re(e,t){let n=fe(t).blankTexture;return n||(n=fe(t).blankTexture=e.texture({}).data({buffer:new Uint8Array([255,255,255,255])}),n)}const Ue=o(),Fe=o(),Ce=o();function Pe(e,t,n,r=1/0,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const o=1/Math.tan(t/2);if(function(e){for(let t=0;t<16;++t)e[t]=t%5?0:1}(i),i[0]=o/e,i[5]=o,i[11]=-1,i[15]=0,isFinite(r)){const e=1/(n-r);i[10]=(n+r)*e,i[14]=2*n*r*e}else i[10]=-1,i[14]=-2*n;return i}function Ge(t,n,r=o(0,1,0),i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const a=s(t,n,Ue);c(a,a);const f=u(r,a,Fe);c(f,f);const l=u(a,f,Ce);return c(l,l),e(f,i,0,0,3),e(l,i,0,4,3),e(a,i,0,8,3),e(t,i,0,12,3),i[3]=i[7]=i[11]=0,i[15]=1,i}const Be=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function ke(e,t,n,r){const i=c(n),[u,d]=function(e,t,n,r){for(let n=0;n<3;++n)e[n]=1/0,t[n]=-1/0;const i=o(),a=o();let s=(r.nodes||[]).slice();for(;s.length>0;){var f,l;const r=null===(f=n.nodes)||void 0===f?void 0:f[s.pop()];if(!r)continue;s=s.concat(r.children||[]);const o=null===(l=n.meshes)||void 0===l?void 0:l[r.mesh];if(o)for(const s of o.primitives){var c;const o=null===(c=n.accessors)||void 0===c?void 0:c[s.attributes.POSITION];if(o){var u;Ve(i,a,o,(null===(u=r.extras)||void 0===u?void 0:u.model)||Be);for(let n=0;n<3;++n)e[n]=Math.min(e[n],i[n]),t[n]=Math.max(t[n],a[n])}}}return[e,t]}(o(),o(),e,e.scenes[t]),v=Math.max(d[0]-u[0],d[1]-u[1]),h=Math.PI/4,m=h*r,b=v/2/Math.tan(h/2),p=v/2/Math.tan(m/2),g=Math.max(p,b);f(i,-1.2*g,i);const T=l(s(u,d));let _=g+6*T,O=g-6*T;O=Math.max(O,_/1e4);const x=o();return a(u,d,x),f(x,.5,x),{model:Ge(i,x),proj:Pe(r,h,O,_)}}const ze=o(),De=o(),We=o(),He=o();function Ve(t,n,r,o){const c=[...r.min,1],u=[...r.max,1];i(o,c,c),i(o,u,u),e(c,ze,0,0,3),e(u,De,0,0,3),a(De,ze,We),f(We,.5,We),s(De,We,He);const d=l(He);for(let e=0;e<3;++e)t[e]=We[e]-d,n[e]=We[e]+d}const je=o(-1,-2,-2),$e=new URLSearchParams(window.location.search),Je=document.querySelector("canvas"),qe=Je.parentElement;let Xe=null,Ke=0,Qe=0;const Ze=((e,t)=>{const n=e.getContext("webgl",{powerPreference:"low-power",webgl2:!1});return n?new z(n):null})(Je);Ze.feature("OES_standard_derivatives"),Ze.feature("OES_element_index_uint");const Ye="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/63f026b2aa957d3e8207f6dd798608993e33fb0d/2.0";function et(e=0){var t;if(window.requestAnimationFrame(et),!Xe)return;Ke||(Ke=e);const n=e-Ke,r=$e.get("camera"),i=$e.get("scene"),o=((null!==i&&parseInt(i))??Xe.scene)||0;null!==(t=Xe.animations)&&void 0!==t&&t.length&&(function(e,t,n=0,r=!1){var i,o,a,s;const f=function(e,t){let n=fe(t).duration||0;for(const s of t.channels){var r,i,o;const f=null===(r=e.nodes)||void 0===r?void 0:r[s.target.node],l=null===(i=e.accessors)||void 0===i?void 0:i[null===(o=t.samplers[s.sampler])||void 0===o?void 0:o.input];var a;f&&l&&(n=Math.max(n,(null===(a=l.max)||void 0===a?void 0:a[0])||0))}return fe(t).duration=n}(e,t),l=r?n-Math.floor(n/f)*f:Math.min(n,f);for(const n of t.channels){var c;const r=null===(c=e.nodes)||void 0===c?void 0:c[n.target.node],f=t.samplers[n.sampler];if(!r||!f)continue;const u=le(e,f),d=ce(e,f);if(null==u||!u.length||!d)continue;const v=u.length,h=u[0],m=u[v-1];let b,p;if(l<=h)b=p=0;else if(l>=m)b=p=v-1;else{let e=fe(n).lastKeyframe||0;for(u[e]>l&&(e=0),b=e,p=b+1;p<v&&!(u[b]<=l&&u[p]>l);++b,++p);}fe(n).lastKeyframe=b;const g=n.target.path;let T=3;switch(g){case"rotation":T=4;break;case"weights":T=(null===(i=r.weights)||void 0===i?void 0:i.length)||(null===(o=e.meshes)||void 0===o||null===(a=o[r.mesh])||void 0===a||null===(s=a.weights)||void 0===s?void 0:s.length)||0}if(!T)continue;let _=f.interpolation;b===p&&(_="STEP");const O=u[b],x=u[p],N=(l-O)/(x-O),y=fe(r)[g]=fe(r)[g]||new Array(T),S=new Array(T);switch(_){case"STEP":$(d,y,b*T,0,T);break;case"CUBICSPLINE":{const e=x-O,t=N*N,n=N*t;for(let r=0;r<T;++r)y[r]=(2*n-3*t+1)*d[(3*b+1)*T+r]+(n-2*t+N)*e*d[(3*b+2)*T+r]+(-2*n+3*t)*d[(3*p+1)*T+r]+(n-t)*e*d[3*p*T+r];break}default:if("rotation"===g)$(d,y,b*T,0,T),$(d,S,p*T,0,T),re(y,S,N,y);else for(let e=0;e<T;++e)y[e]=(1-N)*d[b*T+e]+N*d[p*T+e]}}return n<f}(Xe,Xe.animations[Qe],n/1e3)||(Ke=e,Qe=(Qe+1)%Xe.animations.length)),Ae(Ze,Xe,{scene:o,camera:Xe.cameras?{index:parseInt(r)||0}:ke(Xe,o,je,Ze.canvas.width/Ze.canvas.height)})}function tt(){const e=window.devicePixelRatio||1,t=qe.clientWidth,n=qe.clientHeight;Je.width=t*e,Je.height=n*e,Je.style.width=`${t}px`,Je.style.height=`${n}px`}window.addEventListener("resize",tt,!1),tt(),async function(){let e=$e.get("url");if(!e){const t=await(await fetch(`${Ye}/model-index.json`)).json(),n=$e.get("model")||"BrainStem",r=$e.get("variant")||"glTF",i=t.find((e=>e.name===n));e=`${Ye}/${n}/${r}/${i.variants[r]}`}const t=await he({uri:e});console.log(e,t),Xe=t,et()}()})();