(()=>{"use strict";const e=16384,t=1028,n=1029,r=5123,i=5126,s=519,o=7680,a=9728,l=34069,c=33984,u=36160,h=36161,p=34041,f=36064,d=36096,v=33306,m=35345,g=4294967295,x=33071,b=34962,y=34963,w=515,P=n,_=263169,B=35633,F=35632,A=3553,T=34067,C={Float:i,Vec2:35664,Vec3:35665,Vec4:35666,Mat2:35675,Mat3:35675,Mat4:35676},M={Value:1,Tex:2,Buffer:4},D=512,k=768,S=[0,33189,p,p,32856,34836,34842,33326,33325,33328,33327],O=[0,6402,p,p,6408,6403,33319],U=[0,5121,i,36193,5125,34042],I=[i,5120,5121,5122,r],V=[4,1,1,2,2],L=255;function E(e){return 32879===e||35866===e}function R(e){return e>0&&e>>16<=3}function q(e){return e>>8&L}function j(e){return I[e&L]}function z(e){return!!(e>>16)}function G(e){return O[e>>8&L]}function $(e,t=!1){const n=U[e&L];return t&&36193===n?5131:n}const N={Aniso:"EXT_texture_filter_anisotropic",TexFP16Lin:"OES_texture_half_float_linear",TexFPLin:"OES_texture_float_linear"},W={DFfx:"OES_standard_derivatives",Instancing:"ANGLE_instanced_arrays",UintIndex:"OES_element_index_uint",BlendMinMax:"EXT_blend_minmax",DrawBuffers:"WEBGL_draw_buffers",DepthTex:"WEBGL_depth_texture",TexFP16:"OES_texture_half_float",TexFP:"OES_texture_float",...N},H={BufFP:"EXT_color_buffer_float",...N};class Z{constructor(e,t){const n=this.gl=e.gl;this.props={type:t.type||b,usage:t.usage||35044,size:t.size},n.bindBuffer(this.props.type,this.glb=n.createBuffer()),n.bufferData(this.props.type,this.props.size,this.props.usage)}data(e,t=0){return this.gl.bindBuffer(this.props.type,this.glb),this.gl.bufferSubData(this.props.type,t,e),this}destroy(){this.gl.deleteBuffer(this.glb),this.glb=null}}const X={frontFace:2305,cullMode:0,depthBias:0,depthBiasSlopeScale:0,alphaToCoverage:!1},J={write:!1,compare:s},Y={frontCompare:s,frontFailOp:o,frontZFailOp:o,frontPassOp:o,backCompare:s,backFailOp:o,backZFailOp:o,backPassOp:o,readMask:L,writeMask:L},K={srcFactorRGB:1,dstFactorRGB:0,opRGB:32774,srcFactorAlpha:1,dstFactorAlpha:0,opAlpha:32774,colorMask:15};function Q(e,r,i,s=0,o=!1){const{raster:a,depth:l,stencil:c,blend:u}=i;let h=!1,p=0,f=0,d=0,v=0;const m=r.raster||X,g=a||X;if(p=g.frontFace,(o||m.frontFace!==p)&&e.frontFace(p),p=g.cullMode,(o||m.cullMode!==p)&&((h=0!==p)&&e.cullFace(p),re(e,2884,h)),p=g.depthBiasSlopeScale,f=g.depthBias,(o||m.depthBiasSlopeScale!==p||m.depthBias!==f)&&(re(e,32823,!(!p&&!f)),e.polygonOffset(p,f)),h=g.alphaToCoverage,(o||m.alphaToCoverage!==h)&&re(e,32926,h),h=!!l,(o||r.depthOn!==h)&&re(e,2929,h),o||h){const t=r.depth||J,n=l||J;te(e,t.write,n.write,o),p=n.compare,(o||t.compare!==p)&&e.depthFunc(p)}if(h=!!c,(o||r.stencilOn!==h)&&re(e,2960,h),o||h){const i=r.stencil||Y,a=c||Y;p=a.readMask,h=o||i.readMask!==p,f=a.frontCompare,(h||i.frontCompare!==f)&&e.stencilFuncSeparate(t,f,s,p),f=a.backCompare,(h||i.backCompare!==f)&&e.stencilFuncSeparate(n,f,s,p),p=a.frontFailOp,f=a.frontZFailOp,d=a.frontPassOp,(o||i.frontFailOp!==p||i.frontZFailOp!==f||i.frontPassOp!==d)&&e.stencilOpSeparate(t,p,f,d),p=a.backFailOp,f=a.backZFailOp,d=a.backPassOp,(o||i.backFailOp!==p||i.backZFailOp!==f||i.backPassOp!==d)&&e.stencilOpSeparate(n,p,f,d),ne(e,i.writeMask,a.writeMask,o)}if(h=!!u,(o||r.blendOn!==h)&&re(e,3042,h),o||h){const t=r.blend||K,n=u||K;p=n.srcFactorRGB,f=n.dstFactorRGB,d=n.srcFactorAlpha,v=n.dstFactorAlpha,(o||t.srcFactorRGB!==p||t.dstFactorRGB!==f||t.srcFactorAlpha!==d||t.dstFactorAlpha!==v)&&e.blendFuncSeparate(p,f,d,v),p=n.opRGB,f=n.opAlpha,(o||t.opRGB!==p||t.opAlpha!==f)&&e.blendEquationSeparate(p,f),ee(e,t.colorMask,n.colorMask,o)}}function ee(e,t,n,r=!1){(t!==n||r)&&e.colorMask(!!(1&n),!!(2&n),!!(4&n),!!(8&n))}function te(e,t,n,r=!1){(t!==n||r)&&e.depthMask(n)}function ne(e,t,n,r=!1){(t!==n||r)&&e.stencilMask(n)}function re(e,t,n){n?e.enable(t):e.disable(t)}const ie=(e,t)=>t||e?Object.assign(e||{},t):null;class se{constructor(e,t){const n=this.gl=e.gl,r=this.gls=n.createShader(this.type=t.type);n.shaderSource(r,this.source=t.source),n.compileShader(r)}destroy(){this.gl.deleteShader(this.gls),this.gls=null}}class oe{constructor(e,t){var n;const r=this.gl=e.gl,i=Array(16);let s=0,o=!1;const a=t.buffers.map((({attrs:e,stride:t=0,instanced:n=!1})=>{o=o||n;const r=Array(e.length);let a=0,l=e.length>0?1/0:0;for(let t=0;t<e.length;++t){const{offset:n=a,shaderLoc:o=s}=e[t];for(r[t]={...e[t],offset:n,shaderLoc:o},i[s=o]=!0;i[++s];);a=Math.max(a,n+(c=r[t].format,V[c&L]*q(c))),l=Math.min(l,n)}var c;return{attrs:r,stride:t||a-l,instanced:n}})),l=(t.uniforms||[]).map((e=>({name:e.name,type:e.type||M.Value,texType:e.texType||A,valueFormat:e.valueFormat||C.Float})));this.instanced=o,this.props={vert:t.vert,frag:t.frag,indexFormat:t.indexFormat||5123,mode:null!==(n=t.mode)&&void 0!==n?n:4,buffers:a,uniforms:l,raster:{...X,...t.raster},depth:t.depth?{...J,...t.depth}:null,stencil:t.stencil?{...Y,...t.stencil}:null,blend:t.blend?{...K,...t.blend}:null};const c=this.glp=function(e,t,n,r){const i=e.createProgram();e.attachShader(i,t.gls),e.attachShader(i,n.gls);for(let t=0;t<r.length;++t){const n=r[t].attrs;for(let t=0;t<n.length;++t)e.bindAttribLocation(i,n[t].shaderLoc||0,n[t].name)}return e.linkProgram(i),i}(r,t.vert,t.frag,a),u=this.cache={};let h=0,p=0;for(let e=0;e<l.length;++e){const t=l[e];let n=null,i=g;t.type===M.Buffer?(i=r.getUniformBlockIndex(c,t.name),r.uniformBlockBinding(c,i,h++)):n=r.getUniformLocation(c,t.name),null===n&&i===g||(u[t.name]={...t,loc:n,index:i,binding:t.type===M.Tex?p++:t.type===M.Buffer?h:-1})}}destroy(){this.gl.deleteProgram(this.glp),this.glp=null}}class ae{constructor(e,t={}){var n,r,i;this.glfb=null,this.glrfb=[];const s=this.gl=e.gl,o=e.feature(W.DrawBuffers),a=(null===(n=t.color)||void 0===n?void 0:n.map(he))||[],l=he(t.depth),c=l&&5==(l.tex.props.format&L)||!1;if(this.props={color:a,depth:l,clearColor:t.clearColor||null,clearDepth:null!==(r=t.clearDepth)&&void 0!==r?r:NaN,clearStencil:null!==(i=t.clearStencil)&&void 0!==i?i:NaN},a.length){this.glfb=s.createFramebuffer(),s.bindFramebuffer(u,this.glfb);const t=o||e.webgl2?a.length:1;for(let n=0;n<t;++n)e.webgl2&&a[n].tex.props.samples>1?s.framebufferRenderbuffer(u,f+n,h,a[n].tex.glrb):le(s,f+n,a[n]);if(t>1&&(e.webgl2?s.drawBuffers(a.map(((e,t)=>f+t))):o&&o.drawBuffersWEBGL(a.map(((e,t)=>f+t)))),l&&(l.tex.props.renderTarget||e.webgl2&&l.tex.props.samples>1?s.framebufferRenderbuffer(u,c?v:d,h,l.tex.glrb):R(l.tex.props.format)&&le(s,c?v:d,l)),e.webgl2){for(let e=0;e<t;++e)this.glrfb.push(a[e].tex.props.samples>1?ce(s,f,a[e]):null);this.glrfb.push(l&&l.tex.props.samples>1?ce(s,c?v:d,l):null)}}}destroy(){this.gl.deleteFramebuffer(this.glfb),this.glfb=null;for(const e of this.glrfb)this.gl.deleteFramebuffer(e);this.glrfb=[]}resolve(){for(let t=0;t<this.glrfb.length-1;++t)this.glrfb[t]&&ue(this.gl,this.glfb,this.glrfb[t],this.props.color[t].tex,e,f+t);const t=this.glrfb[this.glrfb.length-1];this.props.depth&&t&&ue(this.gl,this.glfb,t,this.props.depth.tex,1280)}}function le(e,t,{tex:n,slice:r,mipLevel:i}){if(E(n.props.type))e.framebufferTextureLayer(u,t,n.glt,i,r);else{const s=34067===n.props.type?l+r:n.props.type;e.framebufferTexture2D(u,t,s,n.glt,i)}}function ce(e,t,n){const r=e.createFramebuffer();return e.bindFramebuffer(u,r),le(e,t,n),r}function ue(e,t,n,r,i,s=-1){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,n),s>=0&&e.readBuffer(s),e.blitFramebuffer(0,0,r.props.width,r.props.height,0,0,r.props.width,r.props.height,i,a)}function he(e){return e?{slice:0,mipLevel:0,...e}:null}class pe{constructor(e,t={},n={},r=!1){var i,s;this.glt=null,this.glrb=null,this.webgl2=r;const o=this.gl=e.gl,a=t.type||A,u=t.format||_,p=a===T,f=R(u)&&(t.renderTarget||!1),d=function(e,t=!1){return t||R(e)?S[e>>16]:G(e)}(u,r);if(this.props={type:a,format:u,width:t.width||1,height:t.height||1,depth:p?6:t.depth||1,mipLevels:t.mipLevels||1,samples:r&&t.samples||1,renderTarget:f},this.sampler={wrapU:n.wrapU||x,wrapV:n.wrapV||x,wrapW:n.wrapW||x,magFilter:n.magFilter||9728,minFilter:n.minFilter||9728,maxLOD:null!==(i=n.maxLOD)&&void 0!==i?i:1e3,minLOD:null!==(s=n.minLOD)&&void 0!==s?s:-1e3,maxAniso:n.maxAniso||1},(f||this.props.samples>1)&&(o.bindRenderbuffer(h,this.glrb=o.createRenderbuffer()),this.props.samples>1?o.renderbufferStorageMultisample(h,this.props.samples,d,this.props.width,this.props.height):o.renderbufferStorage(h,d,this.props.width,this.props.height)),!f)if(o.activeTexture(c),o.bindTexture(a,this.glt=o.createTexture()),o.texParameteri(a,10241,this.sampler.minFilter),o.texParameteri(a,10240,this.sampler.magFilter),o.texParameteri(a,10242,this.sampler.wrapU),o.texParameteri(a,10243,this.sampler.wrapV),r&&(o.texParameteri(a,32882,this.sampler.wrapW),o.texParameterf(a,33083,this.sampler.maxLOD),o.texParameterf(a,33082,this.sampler.minLOD)),this.sampler.maxAniso>1&&o.texParameterf(a,34046,Math.min(this.sampler.maxAniso,o.getParameter(34047))),r)E(a)?o.texStorage3D(a,this.props.mipLevels,d,this.props.width,this.props.height,this.props.depth):o.texStorage2D(a,this.props.mipLevels,d,this.props.width,this.props.height);else{const e=G(u),t=$(u,this.webgl2),n=p?l:a,r=p?6:1;for(let i=0;i<r;++i)for(let r=0;r<this.props.mipLevels;++r)o.texImage2D(n+i,r,d,this.props.width>>r||1,this.props.height>>r||1,0,e,t,null)}}data(e,[t,n,r=0]=[0,0],[i,s,o=this.props.depth-r]=[this.props.width-t,this.props.height-n],a=0){var u;const h=G(this.props.format),p=$(this.props.format,this.webgl2),f=this.props.type===T,d=35866===this.props.type,v=f?l+r:this.props.type;this.gl.activeTexture(c),this.gl.bindTexture(this.props.type,this.glt);const m=(f||d)&&(null===(u=e.images)||void 0===u?void 0:u.length)||1,g=e.buffer||null;let x=e.image||null;for(let l=0;l<m;++l){var b;x=(null===(b=e.images)||void 0===b?void 0:b[l])||x,E(this.props.type)?this.gl.texSubImage3D(v,a,t,n,r+l*o,i,s,o,h,p,x||g):g||this.webgl2&&x?this.gl.texSubImage2D(v+l,a,t,n,i,s,h,p,x||g):x&&this.gl.texSubImage2D(v+l,a,t,n,h,p,x)}return this}mipmap(e=4352){return this.gl.activeTexture(c),this.gl.bindTexture(this.props.type,this.glt),this.gl.hint(33170,e),this.gl.generateMipmap(this.props.type),this}destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb),this.glt=this.glrb=null}}const fe=(e,t={})=>{let n=null,r=!1;return t.webgl2&&(r=!!(n=e.getContext("webgl2",t))),n||(n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)),n?new de(n,r):null};class de{constructor(e,t){this.gl=e,this.webgl2=t,this.canvas=e.canvas,this.maxAttr=Math.min(e.getParameter(34921),16);for(const e of Object.values(t?H:W))this.feature(e);this.state=this.reset(),this.renderCtx=new ve(e,t,this.state,this.maxAttr,this.feature(W.Instancing))}get width(){return this.gl.drawingBufferWidth}get height(){return this.gl.drawingBufferHeight}buffer(e){return new Z(this,e)}texture(e,t){return new pe(this,e,t)}shader(e){return new se(this,e)}pipeline(e){return new oe(this,e)}pass(e){return new ae(this,e)}render(t){let n=this.width,r=this.height;t.props.color.length&&(n=t.props.color[0].tex.props.width,r=t.props.color[0].tex.props.height),this.gl.bindFramebuffer(u,t.glfb),this.gl.viewport(0,0,n,r),this.gl.depthRange(0,1),this.state.scissor&&(this.state.scissor=!1,this.gl.disable(3089));const i=this.state.pipe.blend||K,s=this.state.pipe.depth||J,o=this.state.pipe.stencil||Y;let a=0;return t.props.clearColor&&(a|=e,this.gl.clearColor(...t.props.clearColor),ee(this.gl,i.colorMask,15)),isNaN(t.props.clearDepth)||(a|=256,this.gl.clearDepth(t.props.clearDepth),te(this.gl,s.write,!0)),isNaN(t.props.clearStencil)||(a|=1024,this.gl.clearStencil(t.props.clearStencil),ne(this.gl,o.writeMask,L)),a&&(this.gl.clear(a),a&e&&ee(this.gl,15,i.colorMask),256&a&&te(this.gl,!0,s.write),1024&a&&ne(this.gl,L,o.writeMask)),this.renderCtx.pass=t,this.renderCtx}feature(e){return this.gl.getExtension(e)}reset(){return Object.assign(this.state||{},function(e,t){const n={blend:null,blendOn:!1,depth:null,depthOn:!1,stencil:null,stencilOn:!1,raster:{...X}},r=[1,1,1,1];e.useProgram(null),e.blendColor(...r),Q(e,n,n,0,!0);for(let n=0;n<t;++n)e.disableVertexAttribArray(n);return{pipeObj:null,bufs:[],attrs:[],idx:null,idxFmt:5123,mode:4,pipe:n,blend:r,stencilRef:0,scissor:!1}}(this.gl,this.maxAttr))}}class ve{constructor(e,t,n,r,i){this.pass=null,this.gl=e,this.webgl2=t,this.state=n,this.maxAttr=r,this.extInst=i}pipeline(e){if(this.state.pipeObj===e)return this;this.state.pipeObj&&this.state.pipeObj.glp===e.glp||this.gl.useProgram(e.glp),this.state.pipeObj=e;const t=this.state.pipe;var n,r;Q(this.gl,t,e.props,this.state.stencilRef),n=t,r=e.props,n.blend=ie(n.blend,r.blend),n.blendOn=!!r.blend,n.depth=ie(n.depth,r.depth),n.depthOn=!!r.depth,n.stencil=ie(n.stencil,r.stencil),n.stencilOn=!!r.stencil,Object.assign(n.raster,r.raster);const i=this.state.bufs=Array(e.props.buffers.length),s=Array(this.maxAttr).fill(null),o=this.state.attrs;this.state.attrs=s;for(let t=0;t<e.props.buffers.length;++t){const{attrs:n,stride:r,instanced:o}=e.props.buffers[t],a=[];i[t]={glb:null,attrs:a};for(const{format:e,offset:i,shaderLoc:l}of n)a.push(s[l]={buf:t,ptr:[l,q(e),j(e),z(e),r,i],step:o?1:0})}for(let e=0;e<this.maxAttr;++e)s[e]&&!o[e]?this.gl.enableVertexAttribArray(e):!s[e]&&o[e]&&this.gl.disableVertexAttribArray(e);return this.state.idxFmt=e.props.indexFormat,this.state.mode=e.props.mode,this}index({glb:e}){return e!==this.state.idx&&this.gl.bindBuffer(34963,this.state.idx=e),this}vertex(e,{glb:t}){const n=this.state.bufs[e];if(n&&n.glb!==t){this.gl.bindBuffer(34962,n.glb=t);for(let e=0;e<n.attrs.length;++e){const{ptr:t,step:i}=n.attrs[e];var r;this.gl.vertexAttribPointer(...t),this.webgl2?this.gl.vertexAttribDivisor(t[0],i):null===(r=this.extInst)||void 0===r||r.vertexAttribDivisorANGLE(t[0],i)}}return this}uniforms(e){if(!this.state.pipeObj)return this;for(let n=0;n<e.length;++n){const r=e[n],i=this.state.pipeObj.cache[r.name];if(i)if(i.type===M.Value)if(r.values)switch(i.valueFormat){case C.Mat4:this.gl.uniformMatrix4fv(i.loc,!1,r.values);break;case C.Mat3:this.gl.uniformMatrix3fv(i.loc,!1,r.values);break;case C.Mat2:this.gl.uniformMatrix2fv(i.loc,!1,r.values);break;case C.Vec4:this.gl.uniform4fv(i.loc,r.values);break;case C.Vec3:this.gl.uniform3fv(i.loc,r.values);break;case C.Vec2:this.gl.uniform2fv(i.loc,r.values);break;case C.Float:this.gl.uniform1fv(i.loc,r.values)}else(r.value||0===r.value)&&i.valueFormat===C.Float&&this.gl.uniform1f(i.loc,r.value);else if(i.type===M.Tex)r.tex&&(this.gl.activeTexture(c+i.binding),this.gl.bindTexture(r.tex.props.type,r.tex.glt),this.gl.uniform1i(i.loc,i.binding));else if(i.type===M.Buffer){var t;if((null===(t=r.buffer)||void 0===t?void 0:t.props.type)===m){const e=r.bufferOffset||0;this.gl.bindBufferRange(m,i.index,r.buffer.glb,e,r.bufferSize||r.buffer.props.size-e)}}}return this}draw(e,t=1,n=0){return this.state.pipeObj?(this.state.pipeObj.instanced&&(this.webgl2||this.extInst)?this.webgl2?this.gl.drawArraysInstanced(this.state.mode,n,e,t):this.extInst.drawArraysInstancedANGLE(this.state.mode,n,e,t):this.gl.drawArrays(this.state.mode,n,e),this):this}drawIndexed(e,t=1,n=0){if(!this.state.pipeObj)return this;const{mode:i,idxFmt:s}=this.state,o=n*(s-r+2);return this.state.pipeObj.instanced&&(this.webgl2||this.extInst)?this.webgl2?this.gl.drawElementsInstanced(i,e,s,o,t):this.extInst.drawElementsInstancedANGLE(i,e,s,o,t):this.gl.drawElements(i,e,s,o),this}viewport(e,t,n,r,i=0,s=1){return this.gl.viewport(e,t,n,r),this.gl.depthRange(i,s),this}scissor(e,t,n,r){return this.state.scissor||(this.gl.enable(3089),this.state.scissor=!0),this.gl.scissor(e,t,n,r),this}blendColor(e){return this.gl.blendColor(...e),this}stencilRef(e){if(this.state.stencilRef!==e){const{frontCompare:r,backCompare:i,readMask:s}=this.state.pipe.stencil||Y;this.gl.stencilFuncSeparate(t,r,e,s),this.gl.stencilFuncSeparate(n,i,e,s),this.state.stencilRef=e}return this}end(){var e;null===(e=this.pass)||void 0===e||e.resolve(),this.pass=null}}class me extends class{}{resources=[];register(e){for(let t=0;t<e.length;++t)this.resources.push(e[t])}destroy(){for(let e=0;e<this.resources.length;++e)this.resources[e].destroy();this.resources.length=0}}const ge=!1;function xe(e){const t=e.positions,n=e.uvs,r=e.normals,i=e.colors;let s=0,o=0;t&&(o=t.length,s+=3),n&&(s+=2),r&&(s+=3),i&&(s+=4);const a=new Float32Array(s*o);for(let e=0;e<o;++e){let o=0;t&&(a[e*s+o++]=t[e][0],a[e*s+o++]=t[e][1],a[e*s+o++]=t[e][2]),n&&(a[e*s+o++]=n[e][0],a[e*s+o++]=n[e][1]),r&&(a[e*s+o++]=r[e][0],a[e*s+o++]=r[e][1],a[e*s+o++]=r[e][2]),i&&(a[e*s+o++]=i[e][0],a[e*s+o++]=i[e][1],a[e*s+o++]=i[e][2],a[e*s+o++]=i[e][3])}return a}function be(e){const t=e.indices;if(!t)return new Uint16Array(0);const n=new Uint16Array(3*t.length);for(let e=0;e<t.length;++e)n[3*e]=t[e][0],n[3*e+1]=t[e][1],n[3*e+2]=t[e][2];return n}const ye={positions:[[-1,-1,1],[1,-1,1],[1,1,1],[-1,-1,1],[1,1,1],[-1,1,1]],uvs:[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]]},we={indices:[[2,1,0],[2,0,3],[6,5,4],[6,4,7],[10,9,8],[10,8,11],[14,13,12],[14,12,15],[18,17,16],[18,16,19],[20,21,22],[23,20,22]],positions:[[-1,1,1],[1,1,1],[1,-1,1],[-1,-1,1],[1,1,-1],[-1,1,-1],[-1,-1,-1],[1,-1,-1],[1,1,1],[1,1,-1],[1,-1,-1],[1,-1,1],[-1,1,-1],[-1,1,1],[-1,-1,1],[-1,-1,-1],[-1,1,-1],[1,1,-1],[1,1,1],[-1,1,1],[-1,-1,-1],[1,-1,-1],[1,-1,1],[-1,-1,1]],uvs:[[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,1]],normals:[[0,0,1],[0,0,1],[0,0,1],[0,0,1],[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0]],colors:[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[1,1,0,1],[1,1,0,1],[1,1,0,1],[1,1,0,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1]]};function Pe(e){return document.getElementById(e)}function _e(e,t,n=34962,r=35044){return e.buffer({type:n,usage:r,size:t.byteLength}).data(t)}function Be(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=e[n];return t}const Fe=xe({positions:[[0,.5,0],[.5,-.5,0],[-.5,-.5,0]],colors:[[1,0,0,1],[0,1,0,1],[0,0,1,1]]});class Ae extends me{buffer=null;pass=null;pipeline=null;angle=0;constructor(e){super(),this.device=e}init(){const e=this.device.shader({type:B,source:"\nuniform float angle;\nattribute vec2 position;\nattribute vec4 color;\nvarying lowp vec4 vColor;\nvoid main () {\n  gl_Position = vec4(\n    cos(angle) * position.x - sin(angle) * position.y,\n    sin(angle) * position.x + cos(angle) * position.y,\n    0, 1\n  );\n  vColor = color;\n}\n"}),t=this.device.shader({type:F,source:"\nvarying lowp vec4 vColor;\nvoid main () {\n  gl_FragColor = vColor;\n}\n"});this.buffer=_e(this.device,Fe),this.pass=this.device.pass(),this.pipeline=this.device.pipeline({vert:e,frag:t,buffers:[{attrs:[{name:"position",format:k},{name:"color",format:1024}]}],uniforms:[{name:"angle"}]}),this.register([this.buffer,this.pipeline,this.pass,e,t])}render(e){return this.device.render(this.pass).pipeline(this.pipeline).vertex(0,this.buffer).uniforms([{name:"angle",value:e/30*Math.PI}]).draw(3).end(),!0}}const Te=Be([0,-.05,-.05,0,.05,.05]),Ce=new Float32Array(500),Me=new Float32Array(100);for(let e=0;e<100;e++){Me[e]=Math.random()*(2*Math.PI),Ce[5*e]=2*Math.floor(e/10)/10-1+.1,Ce[5*e+1]=e%10*2/10-1+.1;const t=Math.floor(e/10)/10,n=e%10/10,r=t*n+.2;Ce[5*e+2]=t,Ce[5*e+3]=n,Ce[5*e+4]=r}class De extends me{position=null;offsetColor=null;angle=null;pass=null;pipeline=null;t=0;constructor(e){super(),this.device=e}init(){const e=this.device.shader({type:B,source:"\nprecision mediump float;\nattribute vec2 position;\nattribute vec3 color;\nattribute vec2 offset;\nattribute float angle;\nvarying vec3 vColor;\nvoid main() {\n  gl_Position = vec4(\n    cos(angle) * position.x + sin(angle) * position.y + offset.x,\n    -sin(angle) * position.x + cos(angle) * position.y + offset.y,\n    0, 1);\n  vColor = color;\n}\n"}),t=this.device.shader({type:F,source:"\nprecision mediump float;\nuniform vec3 ambient;\nvarying vec3 vColor;\nvoid main () {\n  gl_FragColor = vec4(ambient + vColor, 1.0);\n}\n"});this.position=_e(this.device,Te),this.offsetColor=_e(this.device,Ce),this.angle=_e(this.device,Me,b,35040),this.pass=this.device.pass({clearColor:[0,0,0,1]}),this.pipeline=this.device.pipeline({vert:e,frag:t,buffers:[{attrs:[{name:"position",format:D}]},{attrs:[{name:"offset",format:D},{name:"color",format:k}],instanced:!0},{attrs:[{name:"angle",format:256}],instanced:!0}],uniforms:[{name:"ambient",valueFormat:C.Vec3}]}),this.register([this.position,this.offsetColor,this.angle,this.pipeline,this.pass,e,t])}render(e){for(let t=0;t<100;t++)Me[t]+=this.t-e-2*Math.PI*Math.floor(Me[t]/Math.PI/2);this.t=e;const t=Math.sin(e)/2;return this.angle.data(Me),this.device.render(this.pass).pipeline(this.pipeline).uniforms([{name:"ambient",values:[t,t,t]}]).vertex(0,this.position).vertex(1,this.offsetColor).vertex(2,this.angle).draw(3,100).end(),!0}}function ke(e,t,n=0,r=0,i=e.length-n){for(let s=0;s<i;++s)t[r+s]=e[n+s];return t}function Se(e=0,t=0,n=0,r=0){return[e,t,n,r]}function Oe(e=0,t=0,n=0){return[e,t,n]}function Ue(e,t){return function(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n}(e,t)}function Ie(e,t=Oe()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}(e,1/(function(e){return Math.sqrt(Ue(e,e))}(e)||1),t)}function Ve(e,t,n=Oe()){const r=e[2]*t[0]-t[2]*e[0],i=e[0]*t[1]-t[0]*e[1];return n[0]=e[1]*t[2]-t[1]*e[2],n[1]=r,n[2]=i,n}Se(),Oe(),Se(),Se();const Le=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Ee(e){for(let t=0;t<16;++t)e[t]=t%5?0:1;return e}function Re(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return ke(function(e,t,n,r){const i=t.length/4,s=n.length/4;let o=0;for(let e=0;e<s;++e)for(let s=0;s<i;++s){o=0;for(let r=0;r<4;++r)o+=t[r*i+s]*n[4*e+r];r[e*i+s]=o}return r}(0,e,t,Le),n)}const qe=Oe(),je=Oe(),ze=Oe();function Ge(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return Ee(t),t[0]=e[0],t[5]=e[1],t[10]=e[2],t}function $e(e,t,n,r=1/0,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const s=1/Math.tan(t/2);if(Ee(i),i[0]=s/e,i[5]=s,i[11]=-1,i[15]=0,isFinite(r)){const e=1/(n-r);i[10]=(n+r)*e,i[14]=2*n*r*e}else i[10]=-1,i[14]=-2*n;return i}function Ne(e,t=Oe(),n=Oe(0,1,0),r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const i=function(e,t,n=Oe()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]-t[r];return n}(e,t,n)}(t,e,qe);Ie(i,i);const s=Ve(i,n,je);Ie(s,s);const o=Ve(s,i,ze);return Ie(o,o),r[0]=s[0],r[1]=o[0],r[2]=-i[0],r[4]=s[1],r[5]=o[1],r[6]=-i[1],r[8]=s[2],r[9]=o[2],r[10]=-i[2],r[12]=-Ue(s,e),r[13]=-Ue(o,e),r[14]=Ue(i,e),r[3]=r[7]=r[11]=0,r[15]=1,r}const We=1024,He=xe({positions:we.positions,uvs:we.uvs}),Ze=be(we),Xe=xe(ye);class Je extends me{offscreenPass=null;defaultPass=null;vertBuffer=null;indexBuffer=null;cubePipeline=null;quadVertBuffer=null;quadPipeline=null;colorTex=null;uvTex=null;positionTex=null;depthTex=null;constructor(e,t){super(),this.device=e,this.webgl2=t}init(){const e=this.device.shader({type:B,source:this.webgl2?"#version 300 es\nprecision mediump float;\nuniform mat4 model, vp;\nin vec3 position;\nin vec2 uv;\nout vec3 vPosition;\nout vec2 vUv;\nvoid main(void) {\n  vec4 worldPos = model * vec4(position, 1.0);\n  vPosition = worldPos.xyz;\n  vUv = uv;\n  gl_Position = vp * worldPos;\n}":"\nprecision mediump float;\nuniform mat4 model, vp;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec3 vPosition;\nvarying vec2 vUv;\nvoid main(void) {\n  vec4 worldPos = model * vec4(position, 1.0);\n  vPosition = worldPos.xyz;\n  vUv = uv;\n  gl_Position = vp * worldPos;\n}"}),t=this.device.shader({type:F,source:this.webgl2?"#version 300 es\nprecision mediump float;\nuniform vec3 color;\nin vec3 vPosition;\nin vec2 vUv;\nlayout(location = 0) out vec4 out0;\nlayout(location = 1) out vec4 out1;\nlayout(location = 2) out vec4 out2;\nvoid main(void) {\n  out0 = vec4(color, 1.0);\n  out1 = vec4(vUv, 0.0, 0.0);\n  out2 = vec4(vPosition, 0.0);\n}":"\n#extension GL_EXT_draw_buffers : require\nprecision mediump float;\nvarying vec3 vPosition;\nvarying vec2 vUv;\nuniform vec3 color;\nvoid main(void) {\n  gl_FragData[0] = vec4(color, 1.0);\n  gl_FragData[1] = vec4(vUv, 0.0, 0.0);\n  gl_FragData[2] = vec4(vPosition, 0.0);\n}"}),n=this.device.shader({type:B,source:"\nattribute vec4 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvoid main(void) {\n  gl_Position = position;\n  vUv = uv;\n}\n"}),r=this.device.shader({type:F,source:"\nprecision mediump float;\nuniform sampler2D tex0;\nuniform sampler2D tex1;\nuniform sampler2D tex2;\nvarying vec2 vUv;\nvoid main(void) {\n  vec4 colorSum =\n    texture2D(tex0, vUv * 2.0 - vec2(0.0, 1.0)) * step(0.5, 1.0 - vUv.x) * step(0.5, vUv.y) +\n    texture2D(tex1, vUv * 2.0 - vec2(0.0, 0.0)) * step(0.5, 1.0 - vUv.x) * step(0.5, 1.0 - vUv.y) +\n    texture2D(tex2, vUv * 2.0 - vec2(1.0, 1.0)) * step(0.5, vUv.x) * step(0.5, vUv.y);\n  gl_FragColor = vec4(colorSum.rgb, 1.0);\n}\n"});this.vertBuffer=_e(this.device,He),this.indexBuffer=_e(this.device,Ze,y),this.cubePipeline=this.device.pipeline({vert:e,frag:t,buffers:[{attrs:[{name:"position",format:k},{name:"uv",format:D}]}],uniforms:[{name:"model",valueFormat:C.Mat4},{name:"vp",valueFormat:C.Mat4},{name:"color",valueFormat:C.Vec3}],depth:{compare:w,write:!0},raster:{cullMode:P}});const i={width:We,height:We};this.colorTex=this.device.texture(i),this.uvTex=this.device.texture(i),this.positionTex=this.device.texture(i),this.depthTex=this.device.texture({width:We,height:We,format:65796,renderTarget:!0}),this.quadVertBuffer=_e(this.device,Xe),this.quadPipeline=this.device.pipeline({vert:n,frag:r,buffers:[{attrs:[{name:"position",format:k},{name:"uv",format:D}]}],uniforms:[{name:"tex0",type:M.Tex,texType:this.colorTex.props.type},{name:"tex1",type:M.Tex,texType:this.uvTex.props.type},{name:"tex2",type:M.Tex,texType:this.positionTex.props.type}]}),this.defaultPass=this.device.pass({clearColor:[0,0,0,1],clearDepth:1}),this.offscreenPass=this.device.pass({color:[{tex:this.colorTex},{tex:this.uvTex},{tex:this.positionTex}],depth:{tex:this.depthTex},clearColor:[0,0,0,1],clearDepth:1}),this.register([this.defaultPass,this.offscreenPass,this.cubePipeline,this.vertBuffer,this.indexBuffer,this.quadPipeline,this.quadVertBuffer,this.colorTex,this.uvTex,this.positionTex,this.depthTex,t,e,r,n])}render(e){const t=Oe(.5,.5,.5),n=Re($e(this.device.width/this.device.height,Math.PI/4,.01,100),Ne(function(e,t,n=Oe()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]+t[r];return n}(e,t,n)}([5*Math.cos(e),2.5*Math.sin(e),5*Math.sin(e)],t),t));let r=function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return Ee(t),ke(e,t,0,12,3),t}(t);return r=Re(r,Ge([.5,.5,.5]),r),this.device.render(this.offscreenPass).pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms([{name:"model",values:r},{name:"vp",values:n},{name:"color",values:[1,1,1]}]).drawIndexed(Ze.length).end(),this.device.render(this.defaultPass).pipeline(this.quadPipeline).vertex(0,this.quadVertBuffer).uniforms([{name:"tex0",tex:this.colorTex},{name:"tex1",tex:this.uvTex},{name:"tex2",tex:this.positionTex}]).draw(6).end(),!0}}const Ye=512,Ke=xe({positions:we.positions,normals:we.normals,uvs:we.uvs}),Qe=be(we);function et(e=!1){return(e?"#version 300 es\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUv;\n":"\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n")+"\n\nuniform mat4 model, viewProj;\n\nvoid main(void) {\n  vec4 worldPos = model * vec4(position, 1.0);\n  vPosition = worldPos.xyz / worldPos.w;\n  vNormal = mat3(model) * normalize(normal);\n  vUv = uv;\n  gl_Position = viewProj * worldPos;\n}\n"}function tt(e=!1){return`${e?"#version 300 es\nprecision mediump float;\nin vec3 vPosition;\nin vec2 vUv;\nin vec3 vNormal;\nout vec4 color;\nlayout (std140) uniform material {\n  vec4 albedo;\n  float metallic;\n  float roughness;\n};\nlayout (std140) uniform env {\n  vec4 ambient;\n  vec4 lightDir;\n  vec4 lightColor;\n};\n":"\nprecision mediump float;\nvarying vec3 vPosition;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nuniform vec4 albedo;\nuniform float metallic;\nuniform float roughness;\nuniform vec4 ambient;\nuniform vec4 lightDir;\nuniform vec4 lightColor;\n"}\n\nuniform sampler2D tex;\nuniform vec3 camPos;\n\nconst float PI = 3.14159265359;\n\nvec3 toSrgb(vec3 color) {\n  return pow(color, vec3(1.0/2.2));\n}\n\nvec4 toLinear(vec4 srgbIn) {\n  return vec4(pow(srgbIn.rgb, vec3(2.2)), srgbIn.a);\n}\n\nvec3 diffuse(vec3 color) {\n  return color / PI;\n}\n\nfloat specularD(float aSqr, float nDotH) {\n  float f = (nDotH * nDotH) * (aSqr - 1.0) + 1.0;\n  return aSqr / (PI * f * f);\n}\n\nvec3 specularF(vec3 r0, vec3 r90, float vDotH) {\n  return r0 + (r90 - r0) * pow(clamp(1.0 - vDotH, 0.0, 1.0), 5.0);\n}\n\nfloat specularG(float aSqr, float nDotL, float nDotV) {\n  float gl = 2.0 * nDotL / (nDotL + sqrt(aSqr + (1.0 - aSqr) * (nDotL * nDotL)));\n  float gv = 2.0 * nDotV / (nDotV + sqrt(aSqr + (1.0 - aSqr) * (nDotV * nDotV)));\n  return gl * gv;\n}\n\nvoid main () {\n  vec3 n = normalize(vNormal);\n  vec3 v = normalize(camPos - vPosition);\n  vec3 l = normalize(-lightDir.xyz);\n  vec3 h = normalize(l + v);\n\n  float nDotL = clamp(dot(n, l), 0.001, 1.0);\n  float nDotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n  float nDotH = clamp(dot(n, h), 0.0, 1.0);\n  float vDotH = clamp(dot(v, h), 0.0, 1.0);\n\n  vec4 baseColor = toLinear(${e?"texture":"texture2D"}(tex, vUv)) * albedo;\n\n  vec3 f0 = vec3(0.04);\n  vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);\n  vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n  float r0 = max(max(specularColor.r, specularColor.g), specularColor.b);\n  float r90 = clamp(r0 * 25.0, 0.0, 1.0);\n  vec3 specularEnvR0 = specularColor.rgb;\n  vec3 specularEnvR90 = vec3(1.0, 1.0, 1.0) * r90;\n\n  float a = clamp(roughness, 0.04, 1.0);\n  a *= a;\n  float aSqr = a * a;\n\n  vec3 color0 = vec3(0.0);\n\n  vec3 F = specularF(specularEnvR0, specularEnvR90, vDotH);\n  float D = specularD(aSqr, nDotH);\n  float G = specularG(aSqr, nDotL, nDotV);\n\n  vec3 diffuse = (1.0 - F) * diffuse(diffuseColor);\n  vec3 specular = F * G * D / (4.0 * nDotL * nDotV);\n\n  color0 += nDotL * lightColor.rgb * lightColor.a * (diffuse + specular);\n\n  color0 += ambient.rgb * diffuseColor;\n\n  ${e?"color":"gl_FragColor"} = vec4(toSrgb(color0), baseColor.a);\n}\n`}class nt extends me{pass=null;vertBuffer=null;indexBuffer=null;matBuffer=null;envBuffer=null;cubePipeline=null;cubeTex=null;skyPipeline=null;skyTex=null;constructor(e,t){super(),this.device=e,this.webgl2=t}init(){const e=Pe("airplane"),t=Pe("sky0"),n=Pe("sky1"),r=Pe("sky2"),i=this.device,s=this.device.shader({type:B,source:et(this.webgl2)}),o=this.device.shader({type:F,source:tt(this.webgl2)}),a=this.device.shader({type:B,source:et(!1)}),l=this.device.shader({type:F,source:"\nprecision mediump float;\nuniform samplerCube tex;\nvarying vec3 vPosition;\n\nvoid main () {\n  gl_FragColor = textureCube(tex, normalize(vPosition));\n}\n"});this.vertBuffer=_e(i,Ke),this.indexBuffer=_e(i,Qe,y),this.cubeTex=i.texture({type:A,width:Ye,height:Ye}),e&&this.cubeTex.data({image:e}).mipmap(),this.webgl2&&(this.matBuffer=_e(i,Be([1,1,1,1,.5,.5,0,0]),35345),this.envBuffer=_e(i,Be([223/255*.75,246/255*.75,245/255*.75,1,1,-2,1,0,252/255,203/255,203/255,2]),35345));const c=[{name:"model",valueFormat:C.Mat4},{name:"viewProj",valueFormat:C.Mat4},{name:"camPos",valueFormat:C.Vec3},{name:"tex",type:M.Tex,texType:this.cubeTex.props.type}].concat(this.webgl2?[{name:"material",type:M.Buffer},{name:"env",type:M.Buffer}]:[{name:"albedo",valueFormat:C.Vec4},{name:"metallic"},{name:"roughness"},{name:"ambient",valueFormat:C.Vec4},{name:"lightDir",valueFormat:C.Vec4},{name:"lightColor",valueFormat:C.Vec4}]),u={vert:s,frag:o,buffers:[{attrs:[{name:"position",format:k},{name:"uv",format:D},{name:"normal",format:k}]}],uniforms:c,depth:{compare:w,write:!0},raster:{cullMode:P}};this.cubePipeline=i.pipeline(u),this.skyTex=i.texture({type:T,width:Ye,height:Ye}),t&&n&&r&&this.skyTex.data({images:[t,t,n,r,t,t]}).mipmap(),this.skyPipeline=i.pipeline({buffers:u.buffers,vert:a,frag:l,uniforms:[{name:"model",valueFormat:C.Mat4},{name:"viewProj",valueFormat:C.Mat4},{name:"tex",type:M.Tex,texType:this.skyTex.props.type}],depth:{compare:w,write:!0},raster:{cullMode:1028}}),this.pass=i.pass({clearColor:[.3,.3,.3,1],clearDepth:1}),this.register([this.pass,this.vertBuffer,this.cubePipeline,this.indexBuffer,this.cubeTex,s,o,a,l]),this.skyPipeline&&this.register([this.skyPipeline,this.skyTex]),this.webgl2&&this.register([this.matBuffer,this.envBuffer])}render(e){const t=Oe(10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)),n=Re($e(this.device.width/this.device.height,Math.PI/4,.01,100),Ne(t,[0,0,0])),r=this.device.render(this.pass),i=[{name:"model",values:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},{name:"viewProj",values:n},{name:"tex",tex:this.cubeTex},{name:"camPos",values:t}].concat(this.webgl2?[{name:"material",buffer:this.matBuffer},{name:"env",buffer:this.envBuffer}]:[{name:"albedo",values:[1,1,1,1]},{name:"metallic",value:.2},{name:"roughness",value:.5},{name:"ambient",values:[223/255*.75,246/255*.75,245/255*.75,1]},{name:"lightDir",values:[1,-3,1,0]},{name:"lightColor",values:[252/255,203/255,203/255,2]}]);return r.pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms(i).drawIndexed(Qe.length),r.pipeline(this.skyPipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms([{name:"model",values:Ge([10,10,10])},{name:"viewProj",values:n},{name:"tex",tex:this.skyTex}]).drawIndexed(Qe.length).end(),!0}}const rt=1024,it=[[-1,-1,-1,-1,8,-1,-1,-1,-1],[-2,-1,0,-1,1,1,0,1,2],[0,0,0,0,1,0,0,0,0]],st=xe({positions:we.positions,colors:we.colors}),ot=be(we),at=xe(ye);class lt extends me{offscreenPass=null;defaultPass=null;vertBuffer=null;indexBuffer=null;cubePipeline=null;quadVertBuffer=null;quadPipeline=null;offscreenTex=null;depthTex=null;constructor(e){super(),this.device=e}init(){const e=this.device,t=this.device.shader({type:B,source:"\nuniform mat4 mvp;\nattribute vec4 position;\nattribute vec4 color;\nvarying vec4 vColor;\nvoid main(void) {\n  gl_Position = mvp * position;\n  vColor = color;\n}"}),n=this.device.shader({type:F,source:"\nprecision mediump float;\nvarying vec4 vColor;\nvoid main(void) {\n  gl_FragColor = vColor;\n}"}),r=this.device.shader({type:B,source:"\nattribute vec4 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvoid main(void) {\n  gl_Position = position;\n  vUv = uv;\n}\n"}),i=this.device.shader({type:F,source:"\nprecision mediump float; \nuniform sampler2D tex;\nuniform vec2 texSize;\nuniform mat3 kernel;\nuniform float kernelWeight;\nvarying vec2 vUv;\nvoid main(void) {\n  vec2 onePixel = vec2(1.0, 1.0) / texSize;\n  vec4 colorSum =\n    texture2D(tex, vUv + onePixel * vec2(-1, -1)) * kernel[0][0] +\n    texture2D(tex, vUv + onePixel * vec2( 0, -1)) * kernel[0][1] +\n    texture2D(tex, vUv + onePixel * vec2( 1, -1)) * kernel[0][2] +\n    texture2D(tex, vUv + onePixel * vec2(-1,  0)) * kernel[1][0] +\n    texture2D(tex, vUv + onePixel * vec2( 0,  0)) * kernel[1][1] +\n    texture2D(tex, vUv + onePixel * vec2( 1,  0)) * kernel[1][2] +\n    texture2D(tex, vUv + onePixel * vec2(-1,  1)) * kernel[2][0] +\n    texture2D(tex, vUv + onePixel * vec2( 0,  1)) * kernel[2][1] +\n    texture2D(tex, vUv + onePixel * vec2( 1,  1)) * kernel[2][2] ;\n  gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\n}\n"});this.vertBuffer=_e(e,st),this.indexBuffer=_e(e,ot,y),this.cubePipeline=e.pipeline({vert:t,frag:n,buffers:[{attrs:[{name:"position",format:k},{name:"color",format:1024}]}],uniforms:[{name:"mvp",valueFormat:C.Mat4}],depth:{compare:w,write:!0},raster:{cullMode:P}}),this.offscreenTex=e.texture({width:rt,height:rt}),this.quadVertBuffer=_e(e,at),this.quadPipeline=e.pipeline({vert:r,frag:i,buffers:[{attrs:[{name:"position",format:k},{name:"uv",format:D}]}],uniforms:[{name:"tex",type:M.Tex,texType:this.offscreenTex.props.type},{name:"texSize",valueFormat:C.Vec2},{name:"kernel",valueFormat:C.Mat3},{name:"kernelWeight"}]}),this.depthTex=e.texture({format:65796,width:rt,height:rt,renderTarget:!0}),this.defaultPass=e.pass({clearColor:[0,0,0,1],clearDepth:1}),this.offscreenPass=e.pass({color:[{tex:this.offscreenTex}],depth:{tex:this.depthTex},clearColor:[.25,.25,.25,1],clearDepth:1}),this.register([this.defaultPass,this.offscreenPass,this.cubePipeline,this.vertBuffer,this.indexBuffer,this.quadPipeline,this.quadVertBuffer,this.offscreenTex,this.depthTex,n,t,i,r])}render(e){const t=Re($e(this.device.width/this.device.height,Math.PI/4,.01,100),Ne([10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0]));this.device.render(this.offscreenPass).pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms([{name:"mvp",values:t}]).drawIndexed(ot.length).end();const n=it[Math.floor(e/2)%it.length];let r=0;for(let e=0;e<n.length;++e)r+=n[e];return r=r<=0?1:r,this.device.render(this.defaultPass).pipeline(this.quadPipeline).vertex(0,this.quadVertBuffer).uniforms([{name:"tex",tex:this.offscreenTex},{name:"texSize",values:[this.offscreenTex.props.width,this.offscreenTex.props.height]},{name:"kernel",values:n},{name:"kernelWeight",value:r}]).draw(6).end(),!0}}const ct=xe({positions:we.positions,uvs:we.uvs}),ut=be(we),ht=[];for(let e=0;e<we.indices.length;++e){const t=we.indices[e];ht.push([t[2],t[1],t[0]])}const pt=be({indices:ht});class ft extends me{pass=null;vertBuffer=null;indexBuffer=null;skyIndexBuffer=null;tex=null;cubePipeline=null;cubeOutlinePipeline=null;constructor(e){super(),this.device=e}init(){const e=this.device.shader({type:B,source:"\nprecision mediump float;\nuniform mat4 mvp;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvoid main(void) {\n  vUv = uv;\n  gl_Position = mvp * vec4(position, 1.0);\n}\n"}),t=this.device.shader({type:F,source:"\nprecision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tex;\nvoid main () {\n  gl_FragColor = texture2D(tex, vUv);\n}\n"}),n=this.device.shader({type:F,source:"\nprecision mediump float;\nuniform vec4 color;\nvoid main () {\n  gl_FragColor = color;\n}\n"});this.tex=this.device.texture({width:512,height:512});const r=Pe("airplane");r&&this.tex.data({image:r}),this.vertBuffer=_e(this.device,ct),this.indexBuffer=_e(this.device,ut,y),this.skyIndexBuffer=_e(this.device,pt,y);const i={vert:e,frag:t,buffers:[{attrs:[{name:"position",format:k},{name:"uv",format:D}],stride:20}],uniforms:[{name:"mvp",valueFormat:C.Mat4},{name:"tex",type:M.Tex,texType:this.tex.props.type}],depth:{compare:w,write:!0},stencil:{backCompare:519,backPassOp:7681,frontCompare:519,frontPassOp:7681},raster:{cullMode:P}};this.cubePipeline=this.device.pipeline(i),this.cubeOutlinePipeline=this.device.pipeline({buffers:i.buffers,raster:i.raster,vert:e,frag:n,uniforms:[{name:"mvp",valueFormat:C.Mat4},{name:"color",valueFormat:C.Vec4}],depth:{write:!0},stencil:{backCompare:517,frontCompare:517,writeMask:0}}),this.pass=this.device.pass({clearDepth:1,clearStencil:0}),this.register([this.pass,this.vertBuffer,this.indexBuffer,this.skyIndexBuffer,this.tex,this.cubePipeline,this.cubeOutlinePipeline,e,t,n])}render(e){const t=Re($e(this.device.width/this.device.height,Math.PI/4,.01,100),Ne([10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0])),n=this.device.render(this.pass);let r=t;return n.pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms([{name:"mvp",values:r},{name:"tex",tex:this.tex}]).stencilRef(1).drawIndexed(ut.length),r=Re(t,Ge([1.1,1.1,1.1])),n.pipeline(this.cubeOutlinePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms([{name:"mvp",values:r},{name:"color",values:[.1,.3,.25,1]}]).stencilRef(1).drawIndexed(ut.length),r=Re(t,Ge([10,10,10])),n.pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.skyIndexBuffer).uniforms([{name:"mvp",values:r},{name:"tex",tex:this.tex}]).drawIndexed(pt.length).end(),!0}}const dt=512,vt=[];for(let e=0;e<we.uvs.length;++e){const t=we.uvs[e];vt.push([2*t[0],2*t[1]])}const mt=xe({positions:we.positions,uvs:vt}),gt=be(we);class xt extends me{pass=null;vertBuffer=null;indexBuffer=null;cubePipeline=null;cubeTex=null;skyPipeline=null;skyTex=null;constructor(e){super(),this.device=e}init(){const e=Pe("airplane"),t=Pe("sky0"),n=Pe("sky1"),r=Pe("sky2"),i=this.device,s=this.device.shader({type:B,source:"\nprecision mediump float;\nuniform mat4 mvp;\nattribute vec3 position;\nattribute vec2 uv;\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvoid main(void) {\n  vUv = uv;\n  vNormal = normalize(position);\n  gl_Position = mvp * vec4(position, 1.0);\n}\n"}),o=this.device.shader({type:F,source:"\nprecision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tex;\nvoid main () {\n  gl_FragColor = texture2D(tex, vUv);\n}\n"}),a=this.device.shader({type:F,source:"\nprecision mediump float;\nvarying vec3 vNormal;\nuniform samplerCube tex;\nvoid main () {\n  gl_FragColor = textureCube(tex, normalize(vNormal));\n}\n"});this.vertBuffer=_e(i,mt),this.indexBuffer=_e(i,gt,y),this.cubeTex=i.texture({type:A,format:_,width:dt,height:dt},{minFilter:9987,wrapU:10497,wrapV:10497,maxAniso:16}),e&&this.cubeTex.data({image:e}).mipmap();const l={vert:s,frag:o,buffers:[{attrs:[{name:"position",format:k},{name:"uv",format:D}]}],uniforms:[{name:"mvp",valueFormat:C.Mat4},{name:"tex",type:M.Tex,texType:this.cubeTex.props.type}],depth:{compare:w,write:!0},raster:{cullMode:P}};this.cubePipeline=i.pipeline(l),this.skyTex=i.texture({type:T,format:_,width:dt,height:dt}),t&&n&&r&&this.skyTex.data({images:[t,t,n,r,t,t]}).mipmap(),this.skyPipeline=i.pipeline({buffers:l.buffers,depth:l.depth,vert:s,frag:a,uniforms:[{name:"mvp",valueFormat:C.Mat4},{name:"tex",type:M.Tex,texType:this.skyTex.props.type}],raster:{cullMode:1028}}),this.pass=i.pass({clearColor:[.3,.3,.3,1],clearDepth:1}),this.register([this.pass,this.vertBuffer,this.cubePipeline,this.indexBuffer,this.cubeTex,s,o,a]),this.skyPipeline&&this.register([this.skyPipeline,this.skyTex])}render(e){const t=Re($e(this.device.width/this.device.height,Math.PI/4,.01,100),Ne([10*Math.cos(e),5*Math.sin(e),10*Math.sin(e)],[0,0,0])),n=this.device.render(this.pass);let r=t;return n.pipeline(this.cubePipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms([{name:"mvp",values:r},{name:"tex",tex:this.cubeTex}]).drawIndexed(gt.length),this.skyPipeline&&(r=Re(t,Ge([10,10,10]),t),n.pipeline(this.skyPipeline).vertex(0,this.vertBuffer).index(this.indexBuffer).uniforms([{name:"mvp",values:r},{name:"tex",tex:this.skyTex}]).drawIndexed(gt.length).end()),!0}}class bt{constructor(e,t,n){this.id=e,this.title=t,this.factory=n}}const yt=[new bt("basic","Hello World",(e=>new Ae(e))),new bt("instancing","Instancing",(e=>new De(e))),new bt("texture","Textures",(e=>new xt(e))),new bt("stencil","Stencil",((e,t)=>new ft(e))),new bt("postprocess","Post-processing",(e=>new lt(e))),new bt("mrt","Multi Render Targets",((e,t)=>new Je(e,t))),new bt("pbr","Physically Based Rendering",((e,t)=>new nt(e,t)))],wt="undefined"!=typeof BigUint64Array,Pt=Symbol(),_t=new TextDecoder("utf-16le",{fatal:!0});function Bt(e,t){let n=new Uint32Array(e)[t+-4>>>2]>>>1;const r=new Uint16Array(e,t,n);if(n<=192)return String.fromCharCode(...r);try{return _t.decode(r)}catch{let e="",t=0;for(;n-t>1024;)e+=String.fromCharCode(...r.subarray(t,t+=1024));return e+String.fromCharCode(...r.subarray(t))}}function Ft(e){const t={};function n(e,t){return e?Bt(e.buffer,t):"<yet unknown>"}const r=e.env=e.env||{};return r.abort=r.abort||function(e,i,s,o){const a=t.memory||r.memory;throw Error(`abort: ${n(a,e)} at ${n(a,i)}:${s}:${o}`)},r.trace=r.trace||function(e,i,...s){const o=t.memory||r.memory;console.log(`trace: ${n(o,e)}${i?" ":""}${s.slice(0,i).join(", ")}`)},r.seed=r.seed||Date.now,e.Math=e.Math||Math,e.Date=e.Date||Date,t}const At=function(){throw Error("Operation requires compiling with --exportRuntime")};function Tt(e,t){const n=t.exports,r=n.memory,i=n.table,s=n.__new||At,o=n.__pin||At,a=n.__unpin||At,l=n.__collect||At,c=n.__rtti_base,u=c?function(e){return e[c>>>2]}:At;function h(e){const t=function(e){const t=new Uint32Array(r.buffer);if((e>>>=0)>=u(t))throw Error(`invalid id: ${e}`);return t[(c+4>>>2)+2*e]}(e);if(!(7&t))throw Error(`not an array: ${e}, flags=${t}`);return t}function p(e){const t=new Uint32Array(r.buffer);if((e>>>=0)>=u(t))throw Error(`invalid id: ${e}`);return t[(c+4>>>2)+2*e+1]}function f(e){return 31-Math.clz32(e>>>6&31)}function d(e,t,n){const i=r.buffer;if(n)switch(e){case 2:return new Float32Array(i);case 3:return new Float64Array(i)}else switch(e){case 0:return new(t?Int8Array:Uint8Array)(i);case 1:return new(t?Int16Array:Uint16Array)(i);case 2:return new(t?Int32Array:Uint32Array)(i);case 3:return new(t?BigInt64Array:BigUint64Array)(i)}throw Error(`unsupported align: ${e}`)}function v(e){const t=new Uint32Array(r.buffer),n=h(t[e+-8>>>2]),i=f(n);let s=4&n?e:t[e+4>>>2];const o=2&n?t[e+12>>>2]:t[s+-4>>>2]>>>i;return d(i,2048&n,4096&n).subarray(s>>>=i,s+o)}function m(e,t,n){return new e(g(e,t,n))}function g(e,t,n){const i=r.buffer,s=new Uint32Array(i),o=s[n+4>>>2];return new e(i,o,s[o+-4>>>2]>>>t)}function x(t,n,r){e[`__get${n}`]=m.bind(null,t,r),e[`__get${n}View`]=g.bind(null,t,r)}return e.__new=s,e.__pin=o,e.__unpin=a,e.__collect=l,e.__newString=function(e){if(null==e)return 0;const t=e.length,n=s(t<<1,1),i=new Uint16Array(r.buffer);for(var o=0,a=n>>>1;o<t;++o)i[a+o]=e.charCodeAt(o);return n},e.__newArrayBuffer=function(e){if(null==e)return 0;const t=new Uint8Array(e),n=s(t.length,0);return new Uint8Array(r.buffer).set(t,n),n},e.__getString=function(e){if(!e)return null;const t=r.buffer;if(1!==new Uint32Array(t)[e+-8>>>2])throw Error(`not a string: ${e}`);return Bt(t,e)},e.__newArray=function(e,t){const n=h(e),i=f(n),l=t.length,c=s(l<<i,4&n?e:0);let u;if(4&n)u=c;else{o(c);const t=s(2&n?16:12,e);a(c);const h=new Uint32Array(r.buffer);h[t+0>>>2]=c,h[t+4>>>2]=c,h[t+8>>>2]=l<<i,2&n&&(h[t+12>>>2]=l),u=t}const p=d(i,2048&n,4096&n);if(16384&n)for(let e=0;e<l;++e){const n=t[e];p[(c>>>i)+e]=n}else p.set(t,c>>>i);return u},e.__getArrayView=v,e.__getArray=function(e){const t=v(e),n=t.length,r=new Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r},e.__getArrayBuffer=function(e){const t=r.buffer,n=new Uint32Array(t)[e+-4>>>2];return t.slice(e,e+n)},[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array].forEach((e=>{x(e,e.name,31-Math.clz32(e.BYTES_PER_ELEMENT))})),wt&&[BigUint64Array,BigInt64Array].forEach((e=>{x(e,e.name.slice(3),3)})),e.__instanceof=function(e,t){const n=new Uint32Array(r.buffer);let i=n[e+-8>>>2];if(i<=u(n))do{if(i==t)return!0;i=p(i)}while(i);return!1},e.memory=e.memory||r,e.table=e.table||i,St(n,e)}function Ct(e){return"undefined"!=typeof Response&&e instanceof Response}function Mt(e){return e instanceof WebAssembly.Module}async function Dt(e,t={}){if(Ct(e=await e))return kt(e,t);const n=Mt(e)?e:await WebAssembly.compile(e),r=Ft(t),i=await WebAssembly.instantiate(n,t);return{module:n,instance:i,exports:Tt(r,i)}}async function kt(e,t={}){if(!WebAssembly.instantiateStreaming)return Dt(Ct(e=await e)?e.arrayBuffer():e,t);const n=Ft(t),r=await WebAssembly.instantiateStreaming(e,t),i=Tt(n,r.instance);return{...r,exports:i}}function St(e,t={}){const n=e.__argumentsLength?t=>{e.__argumentsLength.value=t}:e.__setArgumentsLength||e.__setargc||(()=>{});for(let r in e){if(!Object.prototype.hasOwnProperty.call(e,r))continue;const i=e[r];let s=r.split("."),o=t;for(;s.length>1;){let e=s.shift();Object.prototype.hasOwnProperty.call(o,e)||(o[e]={}),o=o[e]}let a=s[0],l=a.indexOf("#");if(l>=0){const t=a.substring(0,l),s=o[t];if(void 0===s||!s.prototype){const e=function(...t){return e.wrap(e.prototype.constructor(0,...t))};e.prototype={valueOf(){return this[Pt]}},e.wrap=function(t){return Object.create(e.prototype,{[Pt]:{value:t,writable:!1}})},s&&Object.getOwnPropertyNames(s).forEach((t=>Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t)))),o[t]=e}if(a=a.substring(l+1),o=o[t].prototype,/^(get|set):/.test(a)){if(!Object.prototype.hasOwnProperty.call(o,a=a.substring(4))){let t=e[r.replace("set:","get:")],n=e[r.replace("get:","set:")];Object.defineProperty(o,a,{get(){return t(this[Pt])},set(e){n(this[Pt],e)},enumerable:!0})}}else"constructor"===a?(o[a]=(...e)=>(n(e.length),i(...e))).original=i:(o[a]=function(...e){return n(e.length),i(this[Pt],...e)}).original=i}else/^(get|set):/.test(a)?Object.prototype.hasOwnProperty.call(o,a=a.substring(4))||Object.defineProperty(o,a,{get:e[r.replace("set:","get:")],set:e[r.replace("get:","set:")],enumerable:!0}):"function"==typeof i&&i!==n?(o[a]=(...e)=>(n(e.length),i(...e))).original=i:o[a]=i}return t}const Ot={instantiate:Dt,instantiateSync:function(e,t={}){const n=Mt(e)?e:new WebAssembly.Module(e),r=Ft(t),i=new WebAssembly.Instance(n,t);return{module:n,instance:i,exports:Tt(r,i)}},instantiateStreaming:kt,demangle:St},Ut=4294967295;function It(e){const t=new Image;return e.canvas.toBlob((e=>t.src=URL.createObjectURL(e))),t}var Vt;class Lt{constructor(e){this.uri=e}init(){}render(){return window.location.replace(this.uri),!1}destroy(){}}class Et{constructor(e){this.id=e}init(){jt.then((e=>e.init(this.id,ge)))}render(e){var t;return null===(t=qt)||void 0===t||t.render(e),!0}destroy(){var e;null===(e=qt)||void 0===e||e.destroy()}}let Rt=!1,qt=null;const jt=function(){const e={},t=function(e,t=fe){let n={};const r={};let i=1;const s={},o={};let a=1;const l={},c={};let u=1;const h={};let p=1;const f={};let d=1;const v={};let m=1;const g={};let x=1;const b={};let y=1;const w={};let P=1;const _={},B={};return e.mugl={getCanvasById(e){const t=n.__getString(e);if(s[t])return s[t];const r=document.getElementById(t);return r?(s[t]=i,o[i]=r,i++):0},createImage(e){const t=c[a]=new Image;return t.crossOrigin="anonymous",t.src=n.__getString(e),a++},getImageById(e){const t=n.__getString(e);if(l[t])return l[t];const r=document.getElementById(t);return r?(l[t]=a,c[a]=r,a++):0},deleteImage(e){delete c[e]},getGLDevice(e,n){const r={alpha:!!(1&n),antialias:!!(2&n),depth:!!(4&n),desynchronized:!!(8&n),failIfMajorPerformanceCaveat:!!(16&n),powerPreference:64&n?"high-performance":32&n?"low-power":"default",premultipliedAlpha:!!(128&n),preserveDrawingBuffer:!!(256&n),stencil:!!(512&n),webgl2:!!(1024&n)},i=o[e]&&t(o[e],r);return i?(h[u]=i,u++):0},getCanvasWidth(e){var t;return null===(t=h[e])||void 0===t?void 0:t.width},getCanvasHeight(e){var t;return null===(t=h[e])||void 0===t?void 0:t.height},resetDevice(e){var t;null===(t=h[e])||void 0===t||t.reset()},deviceFeature(e,t){var r;return!(null===(r=h[e])||void 0===r||!r.feature(n.__getString(t)))},createBuffer(e,t,n,r){const i=h[e];return i?(f[p]=i.buffer({type:t,size:n,usage:r}),p++):0},deleteBuffer(e){var t;null===(t=f[e])||void 0===t||t.destroy(),delete f[e]},bufferData(e,t,r){var i;null===(i=f[e])||void 0===i||i.data(n.__getArrayView(t),r)},createTexture(e,t,n,r,i,s,o,a,l,c,u,p,f,m,g,x,b){const y=h[e];return y?(v[d]=y.texture({type:t,format:n,width:r,height:i,depth:s,mipLevels:o,samples:a,renderTarget:l},{wrapU:c,wrapV:u,wrapW:p,magFilter:f,minFilter:m,minLOD:g,maxLOD:x,maxAniso:b}),d++):0},deleteTexture(e){var t;null===(t=v[e])||void 0===t||t.destroy(),delete v[e]},textureBuffer(e,t,r,i,s){var o;const a=n.__getArrayView(t);null===(o=v[e])||void 0===o||o.data({buffer:a},n.__getArrayView(r),n.__getArrayView(i),s)},textureImages(e,t,r,i,s){var o;const a=n.__getArrayView(t),l=new Array(a.length);for(let e=0;e<a.length;++e)l[e]=c[a[e]];null===(o=v[e])||void 0===o||o.data({images:l},n.__getArrayView(r),n.__getArrayView(i),s)},mipmap(e,t){var n;null===(n=v[e])||void 0===n||n.mipmap(t)},createShader(e,t,r){const i=h[e];return i?(g[m]=i.shader({type:t,source:n.__getString(r)}),m++):0},deleteShader(e){var t;null===(t=g[e])||void 0===t||t.destroy(),delete g[e]},createRenderPass(e,t,r,i,s,o,a,l,c,u){const p=h[e];if(!p)return 0;const f=[];if(t){const e=n.__getArrayView(r),s=n.__getArrayView(i),o=n.__getArrayView(t);for(let t=0;t<o.length;++t)f.push({tex:v[o[t]],mipLevel:e[t],slice:s[t]})}return b[x]=p.pass({color:f,depth:v[s]?{tex:v[s],mipLevel:o,slice:a}:null,clearColor:l?n.__getArray(l):null,clearDepth:c,clearStencil:u}),x++},deleteRenderPass(e){var t;null===(t=b[e])||void 0===t||t.destroy(),delete b[e]},resolveRenderPass(e){var t;null===(t=b[e])||void 0===t||t.resolve()},createPipeline(e,t,r,i,s,o,a,l,c,u,p,f,d,v,m,x,b,P,_,B,F,A,T,C,M,D,k,S,O,U,I,V,L,E,R,q,j,z,G,$,N){const W=h[e];if(!W)return 0;const H=n.__getArrayView(o),Z=Array(H.length);for(let e=0;e<Z.length;++e)Z[e]={attrs:[],stride:H[e]>>1,instanced:!!(1&H[e])};const X=n.__getArrayView(a),J=Array(X.length);for(let e=0;e<J.length;++e)J[e]=n.__getString(X[e]);const Y=n.__getArrayView(l),K=n.__getArrayView(c),Q=n.__getArrayView(u),ee=n.__getArrayView(p);for(let e=0;e<J.length;++e)Z[Y[e]].attrs.push({name:J[e],format:K[e],shaderLoc:Q[e]===Ut?void 0:Q[e],offset:ee[e]===Ut?void 0:ee[e]});const te=[];if(f){const e=n.__getArrayView(f),t=Array(e.length);for(let r=0;r<t.length;++r)t[r]=n.__getString(e[r]);const r=n.__getArrayView(d),i=n.__getArrayView(v);for(let e=0;e<t.length;++e)te.push({name:t[e],type:r[e],texType:i[e],valueFormat:i[e]})}return w[y]=W.pipeline({vert:g[t],frag:g[r],indexFormat:i,mode:s,buffers:Z,uniforms:te,raster:{frontFace:m,cullMode:x,depthBias:b,depthBiasSlopeScale:P,alphaToCoverage:_},depth:B?{write:F,compare:A}:null,stencil:T?{frontCompare:C,frontFailOp:M,frontZFailOp:D,frontPassOp:k,backCompare:S,backFailOp:O,backZFailOp:U,backPassOp:I,readMask:V,writeMask:L}:null,blend:E?{srcFactorRGB:R,dstFactorRGB:q,opRGB:j,srcFactorAlpha:z,dstFactorAlpha:G,opAlpha:$,colorMask:N}:null}),y++},deletePipeline(e){var t;null===(t=w[e])||void 0===t||t.destroy(),delete w[e]},render(e,t){const n=h[e],r=b[t];return n&&r?(_[P]=n.render(r),B[P]=[],P++):0},endRender(e){var t;null===(t=_[e])||void 0===t||t.end(),delete _[e],delete B[e]},bindPipeline(e,t){var n;w[t]&&(null===(n=_[e])||void 0===n||n.pipeline(w[t]))},bindVertexBuffer(e,t,n){var r;f[n]&&(null===(r=_[e])||void 0===r||r.vertex(t,f[n]))},bindIndexBuffer(e,t){var n;f[t]&&(null===(n=_[e])||void 0===n||n.index(f[t]))},bindUniform(e,t,i,s,o,a,l,c){var u;let h;s&&(h=n.__getArrayView(s),n.__pin(s),r[s]=s),null===(u=B[e])||void 0===u||u.push({name:n.__getString(t),value:i,values:h,tex:v[o],buffer:f[a],bufferOffset:l,bufferSize:c})},draw(e,t,i,s,o){const a=B[e];var l,c,u;null!=a&&a.length&&(null===(l=_[e])||void 0===l||l.uniforms(a),a.length=0),t?null===(c=_[e])||void 0===c||c.drawIndexed(i,s,o):null===(u=_[e])||void 0===u||u.draw(i,s,o);for(const e in r)n.__unpin(r[e]),delete r[e]},viewport(e,t,n,r,i,s,o){var a;null===(a=_[e])||void 0===a||a.viewport(t,n,r,i,s,o)},scissor(e,t,n,r,i){var s;null===(s=_[e])||void 0===s||s.scissor(t,n,r,i)},blendColor(e,t){var r;null===(r=_[e])||void 0===r||r.blendColor(n.__getArrayView(t))},stencilRef(e,t){var n;null===(n=_[e])||void 0===n||n.stencilRef(t)}},{bindModule(e){n=e},addCanvas:(e,t)=>(s[e]=i,o[i]=t,i++),addImage:(e,t)=>(l[e]=a,c[a]=t,a++),pinned:r,canvasIdMap:s,canvas:o,imageIdMap:l,images:c,devices:h,renderPassContexts:_,boundUniforms:B,buffers:f,textures:v,shaders:g,renderPasses:b,pipelines:w}}(e);return Ot.instantiate(fetch("examples.wasm"),e).then((({exports:e})=>(t.bindModule(e),console.log(t),e)))}().then((e=>qt=e));function zt(e,t,n){return r=>Rt?(console.log(`Rendering ${t} example in WASM...`),new Et(e)):(console.log(`Rendering ${t} example in JS...`),n(r,ge))}const Gt={};for(let e=0;e<yt.length;++e)Gt[yt[e].id]=new bt(yt[e].id,yt[e].title,zt(e,yt[e].id,yt[e].factory));Gt.gltf=new bt("gltf","glTF Model Viewer ",(()=>new Lt("./gltf.html"))),Gt.docs=new bt("docs","API Documentation ",(()=>new Lt("../docs")));const $t=document.getElementById("menu");for(const e in Gt){const t=document.createElement("li"),n=document.createElement("a");n.id=Gt[e].id,n.href=`#${Gt[e].id}`,n.innerText=Gt[e].title,t.appendChild(n),$t.appendChild(t)}const Nt=document.querySelector("canvas"),Wt=window.devicePixelRatio||1;if(Wt>1){const{width:e,height:t}=Nt;Nt.width=e*Wt,Nt.height=t*Wt,Nt.style.width=`${e}px`,Nt.style.height=`${t}px`}const Ht=fe(Nt,{stencil:!0,powerPreference:"low-power",webgl2:ge});let Zt,Xt=0;function Jt(e=0){Xt=requestAnimationFrame(Jt),Zt.render(e/1e3)||cancelAnimationFrame(Xt)}window.loadExample=function(e=location.hash){const t=Gt[e.replace("#","")];t&&(document.getElementById("title").innerText=t.title,document.getElementById("code").href=`https://github.com/andykswong/mugl/tree/main/examples/src/apps/${t.id}.ts`,cancelAnimationFrame(Xt),Zt&&(Zt.destroy(),Ht.reset()),Zt=t.factory(Ht,ge),Zt.init(),Jt())};const Yt=function(e=512){const t=document.createElement("div");return t.style.display="none",document.body.appendChild(t),new Promise(((n,r)=>{let i=1;const s=()=>{--i<=0&&n()},o=function(e){const t=new Image;return t.crossOrigin="anonymous",t.src="./airplane.png",t}();o.id="airplane",o.onload=s,o.onerror=r,t.appendChild(o);const a=function(e){const t=document.createElement("canvas");t.width=t.height=e;const n=t.getContext("2d"),r="#28ccdf",i="#39314b",s=n.createLinearGradient(0,0,0,e);s.addColorStop(0,r),s.addColorStop(.4,"#8aebf1"),s.addColorStop(.99,"#dff6f5"),s.addColorStop(1,i),n.fillStyle=r,n.fillRect(0,0,e,e);const o=It(n);n.fillStyle=i,n.fillRect(0,0,e,e);const a=It(n);return n.fillStyle=s,n.fillRect(0,0,e,e),[It(n),o,a]}(e);i+=a.length;for(let e=0;e<a.length;++e)a[e].id=`sky${e}`,a[e].onload=s,a[e].onerror=r,t.appendChild(a[e])}))}();location.hash=location.hash||"#basic",null===(Vt=document.getElementById("mode"))||void 0===Vt||Vt.addEventListener("click",(e=>{Rt=e.target.checked,window.loadExample()})),Yt.then((()=>{window.loadExample()}))})();