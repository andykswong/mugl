(()=>{async function e(e,t){if("img"===t)return await function(e){return new Promise(((t,n)=>{const r=new Image;r.crossOrigin="anonymous",r.onerror=()=>n(new Error(`Failed to load: ${e}`)),r.onload=()=>t(r),r.src=e}))}(e);const n=await fetch(e),r=await n.arrayBuffer();return new Uint8Array(r)}const t=new TextDecoder("utf-8");function n(e){return t.decode(e)}function r(e){return/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)}function i(e,t){return""===e?"":/^(https?:)?\/\//i.test(e)||r(e)?e:t+e}const a=1179937895;function o(e,t){const n=e[t.buffer];return n?new Uint8Array(n.buffer,n.byteOffset+(t.byteOffset||0),t.byteLength):new Uint8Array}const s=new Array(16);function l(e,t,n=0,r=0,i=e.length-n){for(let a=0;a<i;++a)t[r+a]=e[n+a];return t}function c(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}function f(e,t,n,r){const i=t.length/e,a=n.length/e;let o=0;s.length=i*a;for(let r=0;r<a;++r)for(let a=0;a<i;++a){o=0;for(let s=0;s<e;++s)o+=t[s*i+a]*n[r*e+s];s[r*i+a]=o}return l(s,r,0,0,s.length),r}function u(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n}function d(e=0,t=0,n=0,r=0){return[e,t,n,r]}function g(e,t,n=d()){return f(4,e,t,n)}function p(e=0,t=0,n=0){return[e,t,n]}function m(e,t,n=p()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]+t[r];return n}(e,t,n)}function b(e,t,n=p()){return function(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]-t[r];return n}(e,t,n)}function A(e,t,n=p()){return c(e,t,n)}function h(e){return Math.sqrt(u(e,e))}function x(e,t=p()){return c(e,1/(h(e)||1),t)}function T(e,t,n=p()){const r=e[2]*t[0]-t[2]*e[0],i=e[0]*t[1]-t[0]*e[1];return n[0]=e[1]*t[2]-t[1]*e[2],n[1]=r,n[2]=i,n}p(),d(),d();const F=4,v=0,y=1,O=32774,S=34962,w=34963,E=35040,_=35044,M=35048,U=1028,R=1029,N=2884,I=3042,C=2960,B=2929,L=32823,P=32926,k=2305,G=5120,D=5121,z=5122,V=5123,j=5124,W=5125,q=5126,H=6402,$=6407,K=6408,X=35632,J=35633,Z=519,Q=7680,Y=9728,ee=9984,te=9985,ne=9986,re=9987,ie=10240,ae=10241,oe=10242,se=10243,le=3553,ce=34067,fe=34069,ue=33984,de=33071,ge=36161,pe=33189,me=34041,be=36064,Ae=0,he=3314,xe=3315,Te=3316,Fe=6403,ve=32856,ye=32857,Oe=32877,Se=32878,we=32879,Ee=32882,_e=33640,Me=33082,Ue=33083,Re=33190,Ne=34892,Ie=34893,Ce=35907,Be=34894,Le=34836,Pe=34842,ke=35866,Ge=35898,De=35899,ze=36208,Ve=36214,je=36220,We=36226,qe=36232,He=36238,$e=36244,Ke=36249,Xe=36012,Je=36013,Ze=36269,Qe=34042,Ye=35056,et=36008,tt=36009,nt=5131,rt=33319,it=33320,at=33321,ot=33323,st=33325,lt=33326,ct=33327,ft=33328,ut=33329,dt=33330,gt=33331,pt=33332,mt=33333,bt=33334,At=33335,ht=33336,xt=33337,Tt=33338,Ft=33339,vt=33340,yt=36756,Ot=36757,St=36759,wt=35345,Et=4294967295,_t=34046,Mt=34047,Ut={Index:16,Vertex:32,Uniform:64,Dynamic:4096,Stream:8192},Rt={TextureBinding:4,RenderAttachment:16},Nt={Red:1,Green:2,Blue:4,Alpha:8,All:15},It={R8:at,R8SNORM:yt,R8UI:dt,R8I:ut,R16UI:pt,R16I:gt,RG8:ot,RG8SNORM:Ot,RG8UI:ht,RG8I:At,R32UI:bt,R32I:mt,RG16UI:Tt,RG16I:xt,RGBA8:ve,SRGBA8:Ce,RGBA8SNORM:St,RGBA8UI:je,RGBA8I:He,RGB10A2:ye,RG32UI:vt,RG32I:Ft,RGBA16UI:Ve,RGBA16I:qe,RGBA32UI:ze,RGBA32I:We,R16F:st,RG16F:ct,RG11B10F:Ge,RGBA16F:Pe,R32F:lt,RG32F:ft,RGBA32F:Le,Depth16:pe,Depth24:Re,Depth24Stencil8:Ye,Depth32F:Xe,Depth32FStencil8:Je},Ct={Nearest:Y,Linear:9729},Bt={Never:512,Less:513,Equal:514,LessEqual:515,Greater:516,NotEqual:517,GreaterEqual:518,Always:Z},Lt={Vertex:1,Fragment:2},Pt={Points:0,Lines:1,LineStrip:3,Triangles:F,TriangleStrip:5},kt={UInt16:V,UInt32:W},Gt={None:Ae,Front:U,Back:R},Dt={Zero:v,One:y,Src:768,OneMinusSrc:769,SrcAlpha:770,OneMinusSrcAlpha:771,Dst:774,OneMinusDst:775,DstAlpha:772,OneMinusDstAlpha:773,SrcAlphaSaturated:776,Constant:32769,OneMinusConstant:32770},zt={UI8x2:274,UI8x4:276,I8x2:4370,I8x4:4372,UNORM8x2:8466,UNORM8x4:8468,SNORM8x2:12562,SNORM8x4:12564,UI16x2:290,UI16x4:292,I16x2:4386,I16x4:4388,UNORM16x2:8482,UNORM16x4:8484,SNORM16x2:12578,SNORM16x4:12580,F16x2:546,F16x4:548,F32:577,F32x2:578,F32x3:579,F32x4:580},Vt={Buffer:0,Sampler:1,Texture:2};function jt(e){return e===we||e===ke}function Wt(e){return 15&e}function qt(e){switch(e>>4&511){case 36:return q;case 34:return nt;case 274:return z;case 273:return G;case 18:return V;case 17:return D}return Ae}function Ht(e){return!!(e>>13)}function $t(e){switch(e){case at:case yt:case st:case lt:return Fe;case dt:case ut:case pt:case gt:case bt:case mt:return $e;case ot:case Ot:case ct:case ft:return rt;case ht:case At:case Tt:case xt:case vt:case Ft:return it;case ve:case Ce:case St:case ye:case Pe:case Le:return K;case je:case He:case Ve:case ze:case qe:case We:return Ke;case Ge:return $;case pe:case Re:case Xe:return H;case Ye:case Je:return me}return Ae}function Kt(e){switch(e){case at:case dt:case ot:case ht:case ve:case Ce:case je:return D;case yt:case ut:case Ot:case At:case St:case He:return G;case pt:case Tt:case Ve:return V;case gt:case xt:case qe:return z;case bt:case vt:case ze:return W;case mt:case Ft:case We:return j;case ye:return _e;case st:case ct:case Pe:return nt;case lt:case ft:case Le:return q;case Ge:return De;case pe:return V;case Re:return W;case Ye:return Qe;case Xe:return q;case Je:return Ze}return Ae}const Xt={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float",16:"OES_draw_buffers_indexed"},Jt=4294967295;function Zt(e={}){const t=e.primitive||{},n=e.depthStencil||{},{stencilFront:r={},stencilBack:i={}}=n,{sampleCount:a=1,alphaToCoverage:o=!1}=e.multisample||{},s=e.targets||{},l=s.targets&&s.targets.map((e=>Qt(e.blendColor,e.blendAlpha,e.writeMask)))||[];return{sampleCount:a,alphaToCoverage:o,topology:t.topology||F,indexFormat:t.indexFormat||V,frontFace:t.frontFace||k,cullMode:t.cullMode||Ae,depth:!!e.depthStencil,depthWrite:n.depthWrite||!1,depthFormat:n.format||pe,depthCompare:n.depthCompare||Z,depthBias:n.depthBias||0,depthBiasSlopeScale:n.depthBiasSlopeScale||0,stencil:!(!n.stencilFront&&!n.stencilBack),stencilFrontCompare:r.compare||Z,stencilFrontFailOp:r.failOp||Q,stencilFrontDepthFailOp:r.depthFailOp||Q,stencilFrontPassOp:r.passOp||Q,stencilBackCompare:i.compare||Z,stencilBackFailOp:i.failOp||Q,stencilBackDepthFailOp:i.depthFailOp||Q,stencilBackPassOp:i.passOp||Q,stencilReadMask:n.stencilReadMask||Jt,stencilWriteMask:n.stencilWriteMask||Jt,blend:!!e.targets,drawBuffers:l,...Qt(s.blendColor,s.blendAlpha,s.writeMask)}}function Qt(e={},t={},n=Nt.All){return{blendWriteMask:n,blendColorOp:e.operation||O,blendColorSrcFactor:void 0!==e.srcFactor?e.srcFactor:y,blendColorDstFactor:e.dstFactor||v,blendAlphaOp:t.operation||O,blendAlphaSrcFactor:void 0!==t.srcFactor?t.srcFactor:y,blendAlphaDstFactor:t.dstFactor||v}}function Yt(e,t,n,r,i=0,a=!1){let o=!1,s=0,l=0,c=0,f=0;if(s=r.frontFace,(a||n.frontFace!==s)&&e.frontFace(s),s=r.cullMode,(a||n.cullMode!==s)&&((o=s!==Ae)&&e.cullFace(s),an(e,N,o)),o=r.alphaToCoverage,(a||n.alphaToCoverage!==o)&&an(e,P,o),o=!!r.depth,(a||n.depth!==o)&&an(e,B,o),(a||o)&&(nn(e,n.depthWrite,r.depthWrite,a),s=r.depthCompare,(a||n.depthCompare!==s)&&e.depthFunc(s)),s=r.depthBiasSlopeScale,l=r.depthBias,(a||n.depthBiasSlopeScale!==s||n.depthBias!==l)&&(an(e,L,!(!s&&!l)),e.polygonOffset(s,l)),o=!!r.stencil,(a||n.stencil!==o)&&an(e,C,o),(a||o)&&(s=r.stencilReadMask,o=a||n.stencilReadMask!==s,l=r.stencilFrontCompare,(o||n.stencilFrontCompare!==l)&&e.stencilFuncSeparate(U,l,i,s),l=r.stencilBackCompare,(o||n.stencilBackCompare!==l)&&e.stencilFuncSeparate(R,l,i,s),s=r.stencilFrontFailOp,l=r.stencilFrontDepthFailOp,c=r.stencilFrontPassOp,(a||n.stencilFrontFailOp!==s||n.stencilFrontDepthFailOp!==l||n.stencilFrontPassOp!==c)&&e.stencilOpSeparate(U,s,l,c),s=r.stencilBackFailOp,l=r.stencilBackDepthFailOp,c=r.stencilBackPassOp,(a||n.stencilBackFailOp!==s||n.stencilBackDepthFailOp!==l||n.stencilBackPassOp!==c)&&e.stencilOpSeparate(R,s,l,c),rn(e,n.stencilWriteMask,r.stencilWriteMask,a)),o=r.blend,(a||n.blend!==o)&&an(e,I,o),(a||o)&&(s=r.blendColorSrcFactor,l=r.blendColorDstFactor,c=r.blendAlphaSrcFactor,f=r.blendAlphaDstFactor,(a||n.blendColorSrcFactor!==s||n.blendColorDstFactor!==l||n.blendAlphaSrcFactor!==c||n.blendAlphaDstFactor!==f)&&e.blendFuncSeparate(s,l,c,f),s=r.blendColorOp,l=r.blendAlphaOp,(a||n.blendColorOp!==s||n.blendAlphaOp!==l)&&e.blendEquationSeparate(s,l),tn(e,n.blendWriteMask,r.blendWriteMask,a),t))for(let e=0;e<r.drawBuffers.length;++e)en(t,e,r,r.drawBuffers[e])}function en(e,t,n,r,i=!1){let a=0,o=0,s=0,l=0;a=r.blendColorSrcFactor,o=r.blendColorDstFactor,s=r.blendAlphaSrcFactor,l=r.blendAlphaDstFactor,(i||n.blendColorSrcFactor!==a||n.blendColorDstFactor!==o||n.blendAlphaSrcFactor!==s||n.blendAlphaDstFactor!==l)&&e.blendFuncSeparateiOES(t,a,o,s,l),a=r.blendColorOp,o=r.blendAlphaOp,(i||n.blendColorOp!==a||n.blendAlphaOp!==o)&&e.blendEquationSeparateiOES(t,a,o),function(e,t,n,r,i=!1){(i||n!==r)&&e.colorMaskiOES(t,!!(r&Nt.Red),!!(r&Nt.Green),!!(r&Nt.Blue),!!(r&Nt.Alpha))}(e,t,n.blendWriteMask,r.blendWriteMask,i)}function tn(e,t,n,r=!1){(r||t!==n)&&e.colorMask(!!(n&Nt.Red),!!(n&Nt.Green),!!(n&Nt.Blue),!!(n&Nt.Alpha))}function nn(e,t,n,r=!1){(r||t!==n)&&e.depthMask(n)}function rn(e,t,n,r=!1){(r||t!==n)&&e.stencilMask(n)}function an(e,t,n){n?e.enable(t):e.disable(t)}function on(e,t,n,r,i,a=be){e.bindFramebuffer(et,t),e.bindFramebuffer(tt,n),e.readBuffer(a),e.blitFramebuffer(0,0,r.width,r.height,0,0,r.width,r.height,i,Y)}function sn(e,t,n){e.bindBuffer(S,t.glb);for(let r=0;r<t.attributes.length;++r){const{ptr:i,step:a}=t.attributes[r],o=[...i];o[5]+=n,e.vertexAttribPointer(...o),e.vertexAttribDivisor(i[0],a)}}const ln=new FinalizationRegistry((({finalizer:e,gl:t})=>e(t)));function cn(e,t){const n=t.usage&Ut.Uniform?wt:t.usage&Ut.Index?w:S,r=t.usage&Ut.Stream?E:t.usage&Ut.Dynamic?M:_,i=e.gl.createBuffer();e.gl.bindBuffer(n,i),e.gl.bufferData(n,t.size,r);const a=e=>{e.deleteBuffer(i)},o={gl:e.gl,glb:i,type:n,size:t.size,destroy(){a(this.gl)}};return ln.register(o,{finalizer:a,gl:e.gl}),o}function fn(e,t){const n=t.sampleCount||1,r=t.dimension||le,i=t.format||ve,a=!function(e){switch(e){case pe:case Re:case Ye:case Xe:case Je:return!0}return!1}(i)||(t.usage||0)&Rt.TextureBinding,[o,s,l]=t.size||[1,1,1],c=r===ce?6:r===le?1:l;let f=null,u=null;(n>1||!a)&&(u=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(ge,u),n>1?e.gl.renderbufferStorageMultisample(ge,n,i,o,s):e.gl.renderbufferStorage(ge,i,o,s)),a&&(f=e.gl.createTexture(),e.gl.activeTexture(ue),e.gl.bindTexture(r,f),jt(r)?e.gl.texStorage3D(r,t.mipLevelCount||1,i,o,s,c):e.gl.texStorage2D(r,t.mipLevelCount||1,i,o,s));const d=e=>{e.deleteTexture(f),e.deleteRenderbuffer(u)},g={gl:e.gl,glt:f,glrb:u,type:r,format:i,width:o,height:s,depth:c,samples:n,destroy(){d(this.gl)}};return ln.register(g,{finalizer:d,gl:e.gl}),g}function un(e,t={}){const n=e.gl.createSampler();let r=t.minFilter||Y;t.mipmapFilter&&(r=t.mipmapFilter===Y?r===Y?ee:te:r===Y?ne:re),e.gl.samplerParameteri(n,ae,r),e.gl.samplerParameteri(n,ie,t.magFilter||Y),e.gl.samplerParameteri(n,oe,t.addressModeU||de),e.gl.samplerParameteri(n,se,t.addressModeV||de),e.gl.samplerParameteri(n,Ee,t.addressModeW||de),e.gl.samplerParameterf(n,Ue,void 0!==t.lodMaxClamp?t.lodMaxClamp:32),e.gl.samplerParameterf(n,Me,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(n,Ne,Be),e.gl.samplerParameterf(n,Ie,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(n,_t,Math.min(t.maxAnisotropy||1,e.gl.getParameter(Mt)));const i=e=>{e.deleteSampler(n)},a={gls:n,gl:e.gl,destroy(){i(this.gl)}};return ln.register(a,{finalizer:i,gl:e.gl}),a}function dn(e,t){const n=t.usage===Lt.Vertex?J:X,r=e.gl.createShader(n);e.gl.shaderSource(r,t.code),e.gl.compileShader(r);const i=e=>{e.deleteShader(r)},a={gl:e.gl,gls:r,destroy(){i(this.gl)}};return ln.register(a,{finalizer:i,gl:e.gl}),a}function gn(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function pn(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function mn(e,t,n,r=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,r,n)}function bn(e,{texture:t,mipLevel:n=0,origin:[r,i,a]=[0,0,0]},o,{offset:s=0,bytesPerRow:l,rowsPerImage:c=0},[f,u,d]=[t.width-r,t.height-i,t.depth-a]){const g=$t(t.format),p=Kt(t.format),m=t.type===ce,b=m?fe+a:t.type;e.gl.activeTexture(ue),e.gl.bindTexture(t.type,t.glt);const A=function(e){switch(e){case at:case dt:case yt:case ut:return 1;case pt:case gt:case ot:case ht:case Ot:case At:case st:return 2;case bt:case mt:case lt:case Tt:case xt:case ct:case ve:case Ce:case je:case St:case He:case ye:case Ge:return 4;case vt:case Ft:case ft:case Ve:case qe:case Pe:return 8;case ze:case We:case Le:return 16;case pe:return 2;case Re:case Ye:case Xe:return 4;case Je:return 8}return 0}(t.format),h=c||u,x=Math.floor(l/A),T=s-s%l;if(e.gl.pixelStorei(Se,h),e.gl.pixelStorei(he,x),e.gl.pixelStorei(Te,Math.floor(s%l/A)),e.gl.pixelStorei(xe,0),e.gl.pixelStorei(Oe,0),jt(t.type))e.gl.texSubImage3D(b,n,r,i,a,f,u,d,t.format,p,o,T);else if(m)for(let t=a;t<a+d;++t)e.gl.pixelStorei(xe,t*x*h),e.gl.texSubImage2D(b+t,n,r,i,f,u,g,p,o,T);else e.gl.texSubImage2D(b,n,r,i,f,u,g,p,o,T)}function An(e,t,n,r=0){const i=e.state.buffers[t];!i||i.glb===n.glb&&i.offset===r||(i.glb=n.glb,i.offset=r,i.instanceOffset=0,sn(e.gl,i,r))}function hn(e,t,n,r=[]){if(e.state.pipeline)for(let i=0,a=0;i<n.entries.length;++i){const o=n.entries[i],s=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][o.binding];if(s)if(o.buffer){let t=o.bufferOffset||0;s.bufferDynamicOffset&&(t+=r[a]||0,++a),e.gl.bindBufferRange(wt,s.slot,o.buffer.glb,t,o.bufferSize||o.buffer.size-t)}else o.texture?(e.gl.activeTexture(ue+s.slot),e.gl.bindTexture(o.texture.type,o.texture.glt),e.gl.uniform1i(s.loc,s.slot)):o.sampler&&e.gl.bindSampler(s.slot,o.sampler.gls)}}const xn=[1,0,0,0,1,0,0,0,1],Tn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Fn(e){for(let t=0;t<16;++t)e[t]=t%5?0:1;return e}function vn(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return f(4,e,t,n)}function yn(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[5]-e[4]*e[1],r=e[0]*e[9]-e[8]*e[1],i=e[0]*e[13]-e[12]*e[1],a=e[4]*e[9]-e[8]*e[5],o=e[4]*e[13]-e[12]*e[5],s=e[8]*e[13]-e[12]*e[9],l=e[2]*e[7]-e[6]*e[3],f=e[2]*e[11]-e[10]*e[3],u=e[2]*e[15]-e[14]*e[3],d=e[6]*e[11]-e[10]*e[7],g=e[6]*e[15]-e[14]*e[7],p=e[10]*e[15]-e[14]*e[11],m=n*p-r*g+i*d+a*u-o*f+s*l;return m?(Tn[0]=+e[5]*p-e[9]*g+e[13]*d,Tn[1]=-e[1]*p+e[9]*u-e[13]*f,Tn[2]=+e[1]*g-e[5]*u+e[13]*l,Tn[3]=-e[1]*d+e[5]*f-e[9]*l,Tn[4]=-e[4]*p+e[8]*g-e[12]*d,Tn[5]=+e[0]*p-e[8]*u+e[12]*f,Tn[6]=-e[0]*g+e[4]*u-e[12]*l,Tn[7]=+e[0]*d-e[4]*f+e[8]*l,Tn[8]=+e[7]*s-e[11]*o+e[15]*a,Tn[9]=-e[3]*s+e[11]*i-e[15]*r,Tn[10]=+e[3]*o-e[7]*i+e[15]*n,Tn[11]=-e[3]*a+e[7]*r-e[11]*n,Tn[12]=-e[6]*s+e[10]*o-e[14]*a,Tn[13]=+e[2]*s-e[10]*i+e[14]*r,Tn[14]=-e[2]*o+e[6]*i-e[14]*n,Tn[15]=+e[2]*a-e[6]*r+e[10]*n,function(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return c(e,t,n)}(Tn,1/m,t)):null}const On="#version 300 es\nprecision highp float;\nlayout(std140)uniform Model{mat4 A,B,C;vec4 D;};layout(std140)uniform Morph{vec4 E[2];};uniform sampler2D jointTexture;layout(location=0)in vec3 F;out vec3 vPosition;out vec2 vTexCoord0,vTexCoord1;\n#ifdef USE_NORMAL\nlayout(location=1)in vec3 G;\n#ifdef USE_TANGENT\nlayout(location=2)in vec4 H;out mat3 vTBN;\n#else\nout vec3 vNormal;\n#endif\n#endif \n#ifdef USE_TEXCOORD_0\nlayout(location=3)in vec2 I;\n#endif\n#ifdef USE_TEXCOORD_1\nlayout(location=4)in vec2 J;\n#endif\n#ifdef USE_COLOR_0\nout vec4 vColor0;\n#if defined(COLOR_0_VEC3)\nlayout(location=5)in vec3 K;\n#else\nlayout(location=5)in vec4 K;\n#endif\n#endif \n#if defined(USE_WEIGHTS_0) && defined(USE_JOINTS_0)\n#define USE_SKIN \nlayout(location=6)in vec4 L;layout(location=7)in vec4 M;mat4 N(int O){return mat4(texelFetch(jointTexture,ivec2(0,O),0),texelFetch(jointTexture,ivec2(1,O),0),texelFetch(jointTexture,ivec2(2,O),0),texelFetch(jointTexture,ivec2(3,O),0));}mat4 P(){mat4 Q=M.x*N(int(L.x))+M.y*N(int(L.y))+M.z*N(int(L.z))+M.w*N(int(L.w));return Q;}\n#endif \n#if defined(USE_POSITION_0)\n#define USE_MORPH \n#ifdef USE_POSITION_0\nlayout(location=8)in vec3 R;\n#endif\n#ifdef USE_POSITION_1\nlayout(location=9)in vec3 S;\n#endif\n#if !defined(USE_TANGENT_0)\n#ifdef USE_POSITION_2\nlayout(location=10)in vec3 T;\n#endif\n#ifdef USE_POSITION_3\nlayout(location=11)in vec3 U;\n#endif\n#if !defined(USE_NORMAL_0)\n#ifdef USE_POSITION_4\nlayout(location=12)in vec3 V;\n#endif\n#ifdef USE_POSITION_5\nlayout(location=13)in vec3 W;\n#endif\n#ifdef USE_POSITION_6\nlayout(location=14)in vec3 X;\n#endif\n#ifdef USE_POSITION_7\nlayout(location=15)in vec3 Y;\n#endif\n#endif \n#endif \n#ifdef USE_NORMAL_0\nlayout(location=12)in vec3 Z;\n#endif\n#ifdef USE_NORMAL_1\nlayout(location=13)in vec3 a;\n#endif\n#if !defined(USE_TANGENT_0)\n#ifdef USE_NORMAL_2\nlayout(location=14)in vec3 b;\n#endif\n#ifdef USE_NORMAL_3\nlayout(location=15)in vec3 c;\n#endif\n#endif \n#ifdef USE_TANGENT_0\nlayout(location=14)in vec3 d;\n#endif\n#ifdef USE_TANGENT_1\nlayout(location=15)in vec3 e;\n#endif\nvec3 f(){vec3 g=vec3(0.);\n#ifdef USE_POSITION_0\ng+=E[0].x*R;\n#endif\n#ifdef USE_POSITION_1\ng+=E[0].y*S;\n#endif\n#ifdef USE_POSITION_2\ng+=E[0].z*T;\n#endif\n#ifdef USE_POSITION_3\ng+=E[0].w*U;\n#endif\n#ifdef USE_POSITION_4\ng+=E[1].x*V;\n#endif\n#ifdef USE_POSITION_5\ng+=E[1].y*W;\n#endif\n#ifdef USE_POSITION_6\ng+=E[1].z*X;\n#endif\n#ifdef USE_POSITION_7\ng+=E[1].w*Y;\n#endif\nreturn g;}vec3 h(){vec3 g=vec3(0.);\n#ifdef USE_NORMAL_0\ng+=E[0].x*Z;\n#endif\n#ifdef USE_NORMAL_1\ng+=E[0].y*a;\n#endif\n#ifdef USE_NORMAL_2\ng+=E[0].z*b;\n#endif\n#ifdef USE_NORMAL_3\ng+=E[0].w*c;\n#endif\nreturn g;}vec3 i(){vec3 g=vec3(0.);\n#ifdef USE_TANGENT_0\ng+=E[0].x*d;\n#endif\n#ifdef USE_TANGENT_1\ng+=E[0].y*e;\n#endif\nreturn g;}\n#endif \nvec4 j(){vec4 k=vec4(F,1.);\n#ifdef USE_MORPH\nk+=vec4(f(),0.);\n#endif\n#ifdef USE_SKIN\nk=P()*k;\n#endif\nreturn k;}\n#ifdef USE_NORMAL\nvec3 l(){vec3 m=G;\n#ifdef USE_MORPH\nm+=h();\n#endif\n#ifdef USE_SKIN\nm=mat3(P())*m;\n#endif\nreturn normalize(m);}\n#ifdef USE_TANGENT\nvec3 n(){vec3 tan=H.xyz;\n#ifdef USE_MORPH\ntan+=i();\n#endif\n#ifdef USE_SKIN\ntan=mat3(P())*tan;\n#endif\nreturn normalize(tan);}\n#endif \n#endif \nvoid main(){vec4 k=A*j();vPosition=k.xyz/k.w;\n#ifdef USE_NORMAL\nmat3 o=mat3(B);\n#ifdef USE_TANGENT\nvec3 tan=n();vec3 p=normalize(o*l());vec3 q=normalize(o*tan);vec3 r=cross(p,q)*H.w;vTBN=mat3(q,r,p);\n#else\nvNormal=normalize(o*G);\n#endif \n#endif \n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\nvColor0=vec4(K,1.);\n#else\nvColor0=K;\n#endif\n#endif \nvTexCoord0=vec2(0.);vTexCoord1=vec2(0.);\n#ifdef USE_TEXCOORD_0\nvTexCoord0=I;\n#endif\n#ifdef USE_TEXCOORD_1\nvTexCoord1=J;\n#endif\ngl_Position=C*k;gl_PointSize=1.;}",Sn="#version 300 es\nprecision highp float;\nlayout(std140)uniform Model{mat4 A,B,C;vec4 D;};layout(std140)uniform Morph{vec4 E[2];};layout(std140)uniform Material{vec4 F;float G,H;float I,J;float K,L;float M,N;vec4 O;float P;};uniform sampler2D baseColorTexture;uniform sampler2D metallicRoughnessTexture;uniform sampler2D normalTexture;uniform sampler2D occlusionTexture;uniform sampler2D emissiveTexture;in vec3 vPosition;in vec2 vTexCoord0,vTexCoord1;\n#ifdef USE_COLOR_0\nin vec4 vColor0;\n#endif\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\nin mat3 vTBN;\n#else\nin vec3 vNormal;\n#endif\n#endif\nout vec4 fragColor;const float Q=2.2;const float R=3.141592653589793;vec3 S(vec3 T){return pow(T,vec3(1./Q));}vec2 U(float V){return mix(vTexCoord0,vTexCoord1,step(1.,V));}vec4 W(sampler2D X,float V){return texture(X,U(V));}vec4 W(sampler2D X,float V,vec4 Y){return mix(Y,texture(X,U(V)),step(0.,V));}vec3 Z(vec3 a,vec3 b,float c){return a+(b-a)*pow(clamp(1.-c,0.,1.),5.);}float d(float e,float f){float g=(f*f)*(e-1.)+1.;return e/(R*g*g);}float h(float e,float i,float j){float k=1./(i+sqrt(e+(1.-e)*(i*i)));float l=1./(j+sqrt(e+(1.-e)*(j*j)));return k*l;}float m(float e,float i,float j,float f){return h(e,i,j)*d(e,f);}vec3 n(vec3 T){return T/R;}vec4 o(){vec4 T=vec4(1.);\n#ifdef USE_COLOR_0\nT=vColor0;\n#endif\nreturn T;}vec4 p(){vec4 q=vec4(1.);q*=F;q*=W(baseColorTexture,I,vec4(1.));return q*o();}vec2 r(){vec4 s=W(metallicRoughnessTexture,J,vec4(1.));return vec2(clamp(G*s.b,0.,1.),clamp(H*s.g,.04,1.));}float t(){return W(occlusionTexture,N,vec4(1.)).r;}vec3 u(){return O.xyz*W(emissiveTexture,O.w,vec4(1.)).xyz;}struct v{vec3 ng;vec3 nn;vec3 t;vec3 b;};v w(vec3 x){vec3 y,t,b,ng;\n#ifdef USE_TANGENT\nt=normalize(vTBN[0]);b=normalize(vTBN[1]);ng=normalize(vTBN[2]);\n#else\n#ifdef USE_NORMAL\nng=normalize(vNormal);\n#else\nng=normalize(cross(dFdx(x),dFdy(x)));\n#endif\nvec2 z=U(L);vec3 AA=dFdx(vec3(z,0.));vec3 AB=dFdy(vec3(z,0.));vec3 AC=(AB.t*dFdx(x)-AA.t*dFdy(x))/(AA.s*AB.t-AB.s*AA.t);t=normalize(AC-ng*dot(ng,AC));b=cross(ng,t);\n#endif\nif(gl_FrontFacing==false){t*=-1.;b*=-1.;ng*=-1.;}y=ng;if(L>=0.){y=W(normalTexture,L).rgb*2.-vec3(1.);y*=vec3(K,K,1.);y=mat3(t,b,ng)*normalize(y);}v AD;AD.ng=ng;AD.t=t;AD.b=b;AD.nn=y;return AD;}\n#define LIGHT_DIRECTIONAL  0\n#define LIGHT_POINT  1\n#define LIGHT_SPOT  2\nint AE(mat4 AF){return int(AF[0].x);}vec2 AG(mat4 AF){return AF[0].zw;}vec4 AH(mat4 AF){return AF[1];}float AI(mat4 AF){return AF[2].w;}vec3 AJ(mat4 AF){return AF[2].xyz;}vec3 AK(mat4 AF){return AF[3].xyz;}float AL(float AM,float AN){if(AM<=0.){return 1./pow(AN,2.);}return max(min(1.-pow(AN/AM,4.),1.),0.)/pow(AN,2.);}float AO(vec3 AP,vec3 AQ,vec2 AR){float AS=dot(normalize(AQ),normalize(-AP));float AT=1./max(.001,AR[0]-AR[1]);float AU=-AR[1]*AT;float AV=clamp(AS*AT+AU,0.,1.);return AV*AV;}vec3 AW(mat4 AF,vec3 AX){return AE(AF)!=LIGHT_DIRECTIONAL?AK(AF)-AX:-AJ(AF);}vec3 AY(mat4 AF,vec3 AP){vec4 T=AH(AF);vec3 AZ=T.rgb*T.a;if(AE(AF)!=LIGHT_DIRECTIONAL){AZ*=AL(AI(AF),length(AP));}if(AE(AF)==LIGHT_SPOT){AZ*=AO(AP,AJ(AF),AG(AF));}return AZ;}void main(){vec4 q=p();\n#ifdef ALPHAMODE_OPAQUE\nq.a=1.;\n#endif\n#ifdef MATERIAL_UNLIT\ngl_FragColor=(vec4(S(q.rgb),q.a));return;\n#endif\nvec3 x=normalize(D.xyz-vPosition);v Aa=w(vPosition);vec3 y=Aa.nn;vec3 Ab=-normalize(reflect(x,y));float j=clamp(abs(dot(y,x)),0.001,1.);vec2 Ac=r();float Ad=Ac[0];float Ae=Ac[1];float Af=Ae*Ae;float e=Af*Af;vec3 Ag=vec3(0.04);vec3 Ah=q.rgb*(vec3(1.)-Ag)*(1.-Ad);vec3 Ai=mix(Ag,q.rgb,Ad);float a=max(max(Ai.r,Ai.g),Ai.b);float b=clamp(a*25.,0.,1.);vec3 Aj=Ai.rgb;vec3 Ak=vec3(1.,1.,1.)*b;vec3 Al=vec3(0.);vec3 Am=vec3(0.);\n#define NUM_LIGHTS  4\nmat4 An[4];An[0]=mat4(0.,0.,0.,0.,1.,1.,1.,1.,.5,-.707,-.5,0.,0.,0.,0.,0.);An[1]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,-.5,.707,.5,0.,0.,0.,0.,0.);An[2]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,.5,.707,-.5,0.,0.,0.,0.,0.);An[3]=mat4(0.,0.,0.,0.,1.,1.,1.,.75,-.5,-.707,.5,0.,0.,0.,0.,0.);\n#ifdef NUM_LIGHTS\nfor(int Ao=0;Ao<NUM_LIGHTS;++Ao){vec3 AP=AW(An[Ao],vPosition);vec3 AZ=AY(An[Ao],AP);vec3 Ap=normalize(AP);vec3 Aq=normalize(Ap+x);float i=clamp(dot(y,Ap),0.001,1.);float f=clamp(dot(y,Aq),0.,1.);float c=clamp(dot(x,Aq),0.,1.);vec3 Ar=Z(Aj,Ak,c);vec3 As=(1.-Ar)*n(Ah);vec3 At=max(vec3(0.),Ar*m(e,i,j,f));Al+=AZ*i*As;Am+=AZ*i*At;}\n#endif\nvec4 Au=vec4(.1);vec3 Av=Au.rgb*n(Ah);Al+=Av;vec3 Aw=Al+Am;float Ax=t();Aw=mix(Aw,Aw*Ax,M);vec3 Ay=u();Aw+=Ay;\n#ifdef ALPHAMODE_MASK\nif(q.a<P){discard;}q.a=1.;\n#endif\nfragColor=vec4(S(Aw),q.a);}",wn=1e-6,En=u,_n=p(),Mn=p(),Un=p();function Rn(e,t,n,r=1/0,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const a=1/Math.tan(t/2);if(Fn(i),i[0]=a/e,i[5]=a,i[11]=-1,i[15]=0,isFinite(r)){const e=1/(n-r);i[10]=(n+r)*e,i[14]=2*n*r*e}else i[10]=-1,i[14]=-2*n;return i}function Nn(e,t,n=p(0,1,0),r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const i=b(e,t,_n);x(i,i);const a=T(n,i,Mn);x(a,a);const o=T(i,a,Un);return x(o,o),l(a,r,0,0,3),l(o,r,0,4,3),l(i,r,0,8,3),l(e,r,0,12,3),r[3]=r[7]=r[11]=0,r[15]=1,r}const In=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Cn(e,t,n,r){const i=x(n),[a,o]=function(e,t,n,r){for(let n=0;n<3;++n)e[n]=1/0,t[n]=-1/0;const i=p(),a=p();let o=(r.nodes||[]).slice();for(;o.length>0;){const r=n.nodes?.[o.pop()];if(!r)continue;o=o.concat(r.children||[]);const s=n.meshes?.[r.mesh];if(s)for(const o of s.primitives){const s=n.accessors?.[o.attributes.POSITION];if(s){Gn(i,a,s,r.extras?.model||In);for(let n=0;n<3;++n)e[n]=Math.min(e[n],i[n]),t[n]=Math.max(t[n],a[n])}}}return[e,t]}(p(),p(),e,e.scenes[t]),s=Math.max(o[0]-a[0],o[1]-a[1]),l=Math.PI/4,c=l*r,f=s/2/Math.tan(l/2),u=s/2/Math.tan(c/2),d=Math.max(u,f);A(i,-1.2*d,i);const g=h(b(a,o)),T=d+6*g;let F=d-6*g;F=Math.max(F,T/1e4);const v=p();return m(a,o,v),A(v,.5,v),{model:Nn(i,v),proj:Rn(r,l,F,T)}}const Bn=p(),Ln=p(),Pn=p(),kn=p();function Gn(e,t,n,r){const i=[...n.min,1],a=[...n.max,1];g(r,i,i),g(r,a,a),l(i,Bn,0,0,3),l(a,Ln,0,0,3),m(Ln,Bn,Pn),A(Pn,.5,Pn),b(Ln,Pn,kn);const o=h(kn);for(let n=0;n<3;++n)e[n]=Pn[n]-o,t[n]=Pn[n]+o}const Dn=5120,zn=5121,Vn=5122,jn=5123,Wn=5125,qn=5126,Hn=9984,$n=9985,Kn=9986,Xn=9987;function Jn(e){return e.extras||(e.extras={}),e.extras}function Zn(e,t){let n=Jn(t).input||null;if(!n){const r=e.glTF.accessors?.[t.input];if(r){const{buffer:i,byteOffset:a=0}=er(e,r);Jn(t).input=n=new Float32Array(i.buffer,a+i.byteOffset,(i.byteLength-a)/4)}}return n}function Qn(e,t){let n=Jn(t).output||null;if(!n){const r=e.glTF.accessors?.[t.output];if(r){const{buffer:i,byteOffset:a=0}=er(e,r);let o=Float32Array;switch(r.componentType){case Dn:o=Int8Array;break;case zn:o=Uint8Array;break;case Vn:case jn:o=Uint16Array}Jn(t).output=n=new o(i.buffer,a+i.byteOffset,(i.byteLength-a)/o.BYTES_PER_ELEMENT)}}return n}function Yn(e){switch(e.type){case"VEC2":if(e.componentType===qn)return zt.F32x2;if(e.componentType===jn)return e.normalized?zt.UNORM16x2:zt.UI16x2;if(e.componentType===zn)return e.normalized?zt.UNORM8x2:zt.UI8x2;break;case"VEC3":if(e.componentType===qn)return zt.F32x3;break;case"VEC4":if(e.componentType===qn)return zt.F32x4;if(e.componentType===jn)return e.normalized?zt.UNORM16x4:zt.UI16x4;if(e.componentType===zn)return e.normalized?zt.UNORM8x4:zt.UI8x4}return null}function er(e,t){let n=Jn(t).buffer,r=Jn(t).byteOffset||0;if(n)return{buffer:n,byteOffset:r};const i=function(e){let t=0;switch(e.type){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":case"MAT2":t=4;break;case"MAT3":t=9;break;case"MAT4":t=16}let n=0;switch(e.componentType){case Dn:case zn:n=1;break;case Vn:case jn:n=2;break;case Wn:case qn:n=4}return t*n}(t);let a=t.count*i;const o=e.glTF.bufferViews?.[t.bufferView];if(o){const s=tr(e,o),l=o.byteStride||1;r=(t.byteOffset||0)%l,a=t.count*(o.byteStride||i);const c=(t.byteOffset||0)-r;n=new Uint8Array(s.buffer,s.byteOffset+c,a)}if(t.sparse){const{count:o,indices:{bufferView:s,byteOffset:l=0,componentType:c},values:{bufferView:f,byteOffset:u=0}}=t.sparse,d=e.glTF.bufferViews?.[s],g=e.glTF.bufferViews?.[f];if(d&&g){const t=new Uint8Array(a);n&&t.set(n,r);const s=tr(e,d),f=tr(e,g),p=new(c===zn?Uint8Array:c===jn?Uint16Array:Uint32Array)(s.buffer,s.byteOffset+l,o),m=new Uint8Array(f.buffer,f.byteOffset+u,o*i);for(let e=0;e<o;++e){const n=p[e]*i;for(let r=0;r<i;++r)t[n+r]=m[e*i+r]}r=0,n=t}}return n?(Jn(t).buffer=n,Jn(t).byteOffset=r):n=new Uint8Array,{buffer:n,byteOffset:r}}function tr(e,t){let n=Jn(t).buffer;if(!n){const r=e.buffers?.[t.buffer];n=r?new Uint8Array(r.buffer,r.byteOffset+(t.byteOffset||0),t.byteLength):new Uint8Array,Jn(t).buffer=n}return n}const nr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rr=[0,0,0,1],ir=p(1,1,1),ar=p();function or(e,t,n,r=null){const i=e.nodes?.[t];if(!i)return;r?.push(t);const a=Jn(i),o=a.matrix=a.matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];i.matrix?function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){l(e,t)}(i.matrix,o):(i.rotation||i.scale||i.translation||a.rotation||a.scale||a.translation)&&function(e,t,n,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[0],r=e[0]*e[1],i=e[0]*e[2],a=e[1]*e[1],o=e[1]*e[2],s=e[2]*e[2],l=e[3]*e[0],c=e[3]*e[1],f=e[3]*e[2];t[0]=1-2*(a+s),t[1]=2*(r+f),t[2]=2*(i-c),t[4]=2*(r-f),t[5]=1-2*(n+s),t[6]=2*(o+l),t[8]=2*(i+c),t[9]=2*(o-l),t[10]=1-2*(n+a),t[3]=t[7]=t[11]=t[12]=t[13]=t[14]=0,t[15]=1}(e,t)}(t,r);for(let e=0;e<3;++e)for(let t=0;t<3;++t)r[4*e+t]*=n[e];l(e,r,0,12,3)}(a.translation||i.translation||ar,a.rotation||i.rotation||rr,a.scale||i.scale||ir,o);const s=a.model=vn(n,o,a.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(i.children)for(const t of i.children)or(e,t,s,r)}function sr(e,t){const n=e.cameras?.[t.camera];if(n){const e=Jn(t).model=Jn(t).model||nr;Jn(n).view=yn(e,Jn(n).view||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Jn(n).translation=[e[12],e[13],e[14]]}}function lr(e,t){const n=e.glTF.skins?.[t.skin];if(n){const r=n.joints.length,i=Jn(t).jointMatrix=Jn(t).jointMatrix||new Float32Array(16*r),a=function(e,t){let n=Jn(t).inverseBindMatrices;if(!n){const r=e.glTF.accessors?.[t.inverseBindMatrices];if(r){const{buffer:i,byteOffset:a}=er(e,r);n=new Float32Array(i.buffer,i.byteOffset+a,16*t.joints.length)}else n=new Float32Array(16*t.joints.length);Jn(t).inverseBindMatrices=n}return n}(e,n);for(let o=0;o<r;++o){const r=e.glTF.nodes[n.joints[o]],s=new Float32Array(i.buffer,i.byteOffset+64*o,16),l=new Float32Array(a.buffer,a.byteOffset+64*o,16);yn(Jn(t).model||nr,s),vn(s,r&&Jn(r).model||nr,s),vn(s,l,s)}}}function cr(e,t,n,r,i=0){const a=e.length;let o,s;if(r<=t)o=s=0;else if(r>=n)o=s=a-1;else{for((i>=a||e[i]>r)&&(i=0),o=i,s=o+1;s<a&&!(e[o]<=r&&e[s]>r);++o,++s);s=Math.min(s,a-1)}return[o,s]}function fr(e,t,n,r,i,a,o,s){const c=t[r],f=t[i],u=(a-c)/(f-c),d=e.length,g=new Array(d);switch(o=r===i?"STEP":o){case"STEP":l(n,e,r*d,0,d);break;case"CUBICSPLINE":{const t=f-c,a=u*u,o=u*a;for(let s=0;s<d;++s)e[s]=(2*o-3*a+1)*n[(3*r+1)*d+s]+(o-2*a+u)*t*n[(3*r+2)*d+s]+(-2*o+3*a)*n[(3*i+1)*d+s]+(o-a)*t*n[3*i*d+s];break}default:if(s)l(n,e,r*d,0,d),l(n,g,i*d,0,d),function(e,t,n,r=[0,0,0,1]){let i=En(e,t),a=1;i<0&&(i*=-1,a=-1);let o=1-n,s=n;if(1-i>wn){const e=Math.acos(i),t=Math.sin(e);o=Math.sin((1-n)*e)/t,s=Math.sin(n*e)/t}s*=a,r[0]=e[0]*o+t[0]*s,r[1]=e[1]*o+t[1]*s,r[2]=e[2]*o+t[2]*s,r[3]=e[3]*o+t[3]*s}(e,g,u,e);else for(let t=0;t<d;++t)e[t]=(1-u)*n[r*d+t]+u*n[i*d+t]}}const ur=["POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","JOINTS_0","WEIGHTS_0"],dr=8,gr=["POSITION","NORMAL","TANGENT"],pr=[8,12,14],mr=/(POSITION|NORMAL|TANGENT)_(\d+)/,br={addressModeU:10497,addressModeV:10497,magFilter:Ct.Linear,minFilter:Ct.Linear},Ar=52,hr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],xr=p(),Tr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Fr(e,t,n,r,i){let a=!1,o=0,s=t.glTF.accessors?.[i.attributes.POSITION]?.count||0;if(!s)return;const c=function(e,t,n){let r=Jn(n).pipeline;if(r)return r;const i=n.mode||Pt.Triangles,a=t.glTF.materials?.[n.material];let o="OPAQUE",s=!1,l=!1;a&&(s=a.doubleSided||!1,o=a.alphaMode||o,l=!!a.extensions?.KHR_materials_unlit);const c=vr(t,n),f=t.glTF.accessors?.[n.indices]?.componentType===kt.UInt32?kt.UInt32:kt.UInt16,u=JSON.stringify([c,s,o,f,i,l]),d=Jn(t.glTF).pipelines=Jn(t.glTF).pipelines||{};if(r=d[u],r)return r;const g=[`ALPHAMODE_${o}`];for(const e of c)for(const t of e.attributes)g.push(`USE_${t.name}`),"COLOR_0"===t.name&&t.format===zt.F32x3&&g.push("COLOR_0_VEC3");l&&g.push("MATERIAL_UNLIT");const p=g.map((e=>`#define ${e}\n`)).join(""),m="#version 300 es\n",b=m+p+On.replace(m,""),A=m+p+Sn.replace(m,""),h=dn(e,{usage:Lt.Vertex,code:b}),x=dn(e,{usage:Lt.Fragment,code:A});return r=Jn(n).pipeline=d[u]=function(e,t){const n=function(e,t,n){const r=e.gl.createProgram();return e.gl.attachShader(r,t),e.gl.attachShader(r,n),e.gl.linkProgram(r),r}(e,t.vertex.gls,t.fragment.gls),r=[],i={};let a=0,o=0;if(t.bindGroups){for(let s=0;s<t.bindGroups.length;++s){const l=t.bindGroups[s].entries;r.push([]);for(let t=0;t<l.length;++t){const c=l[t];let f=null,u=Et;c.type===Vt.Buffer?(u=e.gl.getUniformBlockIndex(n,c.label),e.gl.uniformBlockBinding(n,u,a++)):c.type===Vt.Texture&&(f=e.gl.getUniformLocation(n,c.label),i[c.label]=o++),r[s][c.binding]={...c,loc:f,index:u,slot:c.type===Vt.Buffer?a-1:c.type===Vt.Texture?o-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const n=t.bindGroups[e].entries;for(let t=0;t<n.length;++t)n[t].type===Vt.Sampler&&i[n[t].label]&&(r[e][n[t].binding].slot=i[n[t].label])}}const s=e=>{e.deleteProgram(n)},l={gl:e.gl,glp:n,buffers:t.buffers,cache:r,state:Zt(t),destroy(){s(this.gl)}};return ln.register(l,{finalizer:s,gl:e.gl}),l}(e,{vertex:h,fragment:x,buffers:c,bindGroups:[Mr(0,t.glTF),_r(0,t.glTF)],primitive:{indexFormat:f,topology:i,cullMode:s?Gt.None:Gt.Back},depthStencil:{depthCompare:Bt.LessEqual,depthWrite:!("BLEND"===o)},targets:"BLEND"===o?{blendColor:{srcFactor:Dt.SrcAlpha,dstFactor:Dt.OneMinusSrcAlpha},blendAlpha:{srcFactor:Dt.One,dstFactor:Dt.OneMinusSrcAlpha}}:null}),h.destroy(),x.destroy(),r}(e,t,i);!function(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),Yt(e.gl,e.extDrawBuffersi,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const n=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)n[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let r=0;r<t.buffers.length;++r){const{attributes:i,stride:a,stepMode:o=0}=t.buffers[r],s=[];e.state.buffers[r]={glb:null,attributes:s,stride:a,step:o,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:l}of i)n[l]=(n[l]||0)+2,s.push({buffer:r,ptr:[l,Wt(e),qt(e),Ht(e),a,t],step:o})}for(let t=0;t<n.length;++t)2===n[t]?e.gl.enableVertexAttribArray(t):1===n[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}(e,c),hn(e,0,function(e,t,n){const r=t.glTF.materials?.[n];if(r&&Jn(r).bindGroup)return Jn(r).bindGroup;if(!r&&Jn(t.glTF).defaultMaterialBindGroup)return Jn(t.glTF).defaultMaterialBindGroup;const i=new Float32Array(20);i[0]=i[1]=i[2]=i[3]=1,i[4]=1,i[5]=1,i[6]=i[7]=i[9]=i[11]=i[15]=-1,i[8]=1,i[10]=0,i[12]=i[13]=i[14]=0,i[16]=.5;const a=cn(e,{usage:Ut.Uniform,size:i.byteLength});r&&(Jn(r).gpuBuffer=a);const o=[{binding:0,buffer:a},{binding:1,texture:Rr(e,t.glTF)},{binding:2,sampler:Nr(e,t.glTF)},{binding:3,texture:Rr(e,t.glTF)},{binding:4,sampler:Nr(e,t.glTF)},{binding:5,texture:Rr(e,t.glTF)},{binding:6,sampler:Nr(e,t.glTF)},{binding:7,texture:Rr(e,t.glTF)},{binding:8,sampler:Nr(e,t.glTF)},{binding:9,texture:Rr(e,t.glTF)},{binding:10,sampler:Nr(e,t.glTF)}];if(r){if(r.pbrMetallicRoughness){const n=r.pbrMetallicRoughness;n.baseColorFactor&&l(n.baseColorFactor,i,0,0,4),(n.metallicFactor||0===n.metallicFactor)&&(i[4]=n.metallicFactor),(n.roughnessFactor||0===n.roughnessFactor)&&(i[5]=n.roughnessFactor),n.baseColorTexture&&(o[1].texture=Or(e,t,n.baseColorTexture.index,It.SRGBA8),o[2].sampler=Sr(e,t.glTF,n.baseColorTexture.index),i[6]=n.baseColorTexture.texCoord||0),n.metallicRoughnessTexture&&(o[3].texture=Or(e,t,n.metallicRoughnessTexture.index),o[4].sampler=Sr(e,t.glTF,n.metallicRoughnessTexture.index),i[7]=n.metallicRoughnessTexture.texCoord||0)}r.normalTexture&&(o[5].texture=Or(e,t,r.normalTexture.index),o[6].sampler=Sr(e,t.glTF,r.normalTexture.index),i[8]=r.normalTexture.scale??1,i[9]=r.normalTexture.texCoord||0),r.occlusionTexture&&(o[7].texture=Or(e,t,r.occlusionTexture.index),o[8].sampler=Sr(e,t.glTF,r.occlusionTexture.index),i[10]=r.occlusionTexture.strength||0,i[11]=r.occlusionTexture.texCoord||0),r.emissiveFactor&&l(r.emissiveFactor,i,0,12,3),r.emissiveTexture&&(o[9].texture=Or(e,t,r.emissiveTexture.index,It.SRGBA8),o[10].sampler=Sr(e,t.glTF,r.emissiveTexture.index),i[15]=r.emissiveTexture.texCoord||0),(r.alphaCutoff||0===r.alphaCutoff)&&(i[16]=r.alphaCutoff)}mn(e,a,i);const s=pn(0,{layout:Mr(0,t.glTF),entries:o});return r?Jn(r).bindGroup=s:Jn(t.glTF).defaultMaterialBindGroup=s,s}(e,t,i.material)),hn(e,1,function(e,t,n,r){if(Jn(n).modelBindGroup)return Jn(n).modelBindGroup;const i=[{binding:0,buffer:wr(e,n)},{binding:1,buffer:Er(e,t,n,r)},{binding:2,texture:Ur(e,t,n)},{binding:3,sampler:Ir(e,t)}];return Jn(n).modelBindGroup=pn(0,{layout:_r(0,t),entries:i})}(e,t.glTF,n,r));const f=vr(t,i);for(let n=0;n<f.length;++n){const r=f[n].attributes[0].name,a=mr.exec(r),o=yr(e,t,a?i.targets[a[2]][a[1]]:i.attributes[r],Ut.Vertex);o&&An(e,n,o)}const u=t.glTF.accessors?.[i.indices];if(u){const n=yr(e,t,i.indices,Ut.Index);n&&(function(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(w,e.state.index=t.glb)}(e,n),s=u.count,o=Jn(u).byteOffset||0,a=!0)}a?function(e,t,n=1,r=0,i=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==i&&(t.instanceOffset=i,sn(e.gl,t,i*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,r*(e.state.state.indexFormat===V?2:4),n)}(e,s,1,o):function(e,t,n=1,r=0,i=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==i&&(t.instanceOffset=i,sn(e.gl,t,i*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,r,t,n)}(e,s)}function vr(e,t){const n={},r=[];if(Jn(t).bufferLayouts)return Jn(t).bufferLayouts;function i(t){if(!t.sparse){const i=er(e,t).buffer,a=`${t.bufferView},${i.byteOffset},${i.byteLength}`;if(a in n)return r[n[a]];n[a]=r.length}const i={attributes:[],stride:e.glTF.bufferViews?.[t.bufferView]?.byteStride||0};return r.push(i),i}for(let n=0;n<ur.length;++n){const r=e.glTF.accessors?.[t.attributes[ur[n]]];if(r){const e=Yn(r);if(!e)continue;i(r).attributes.push({name:ur[n],format:e,shaderLocation:n,offset:Jn(r).byteOffset||0})}}if(t.targets){const n=new Array(3);let r=dr;for(let a=0;a<Math.min(t.targets.length,r);++a){let o=0;for(let r=0;r<gr.length;++r)(n[r]=e.glTF.accessors?.[t.targets[a][gr[r]]])&&++o;r=dr/o|0;for(let e=0;e<gr.length;++e){const t=n[e];t&&i(t).attributes.push({name:`${gr[e]}_${a}`,format:zt.F32x3,shaderLocation:pr[e]+a,offset:Jn(t).byteOffset||0})}}}return Jn(t).bufferLayouts=r,r}function yr(e,t,n,r){const i=t.glTF.accessors?.[n];if(!i)return null;const a=r&Ut.Index&&i.componentType===zn;if(i.sparse||a){let n=Jn(i).gpuBuffer;if(!n){const o=er(t,i);let s=o.buffer;if(a){const e=new Uint16Array(s.byteLength);for(let t=0;t<s.byteLength;++t)e[t]=s[o.byteOffset+t];s=Jn(i).buffer=new Uint8Array(e.buffer,0,e.byteLength),Jn(i).byteOffset=0}n=Jn(i).gpuBuffer=cn(e,{usage:r,size:s.byteLength}),mn(e,n,s)}return n}const o=t.glTF.bufferViews?.[i.bufferView];if(!o)return null;const s=Jn(o).gpuBuffers=Jn(o).gpuBuffers||{},l=er(t,i).buffer,c=`${l.byteOffset},${l.byteLength}`;return s[c]||(s[c]=cn(e,{usage:r,size:l.byteLength}),mn(e,s[c],l)),s[c]}function Or(e,t,n,r=It.RGBA8){const i=t.glTF.textures?.[n],a=t.images?.[i?.source??-1];if(!i||!a)return Rr(e,t.glTF);let o=Jn(i).texture;return o||(o=Jn(i).texture=fn(e,{format:r,size:[a.width||1,a.height||1,1],usage:Rt.TextureBinding}),function(e,{src:t,origin:[n,r]=[0,0]},{texture:i,mipLevel:a=0,origin:[o,s,l]=[0,0,0]},[c,f]=[t.width-n,t.height-r]){const u=Kt(i.format),d=i.type===ce?fe+l:i.type;e.gl.activeTexture(ue),e.gl.bindTexture(i.type,i.glt),e.gl.pixelStorei(Te,n),e.gl.pixelStorei(xe,r),e.gl.pixelStorei(Oe,0),e.gl.pixelStorei(Se,0),jt(i.type)?e.gl.texSubImage3D(d,a,o,s,l,c,f,1,i.format,u,t):e.gl.texSubImage2D(d,a,o,s,c,f,$t(i.format),u,t)}(e,{src:a},{texture:o})),o}function Sr(e,t,n){const r=t.textures?.[n],i=t.samplers?.[r?.sampler??-1];if(!i)return Nr(e,t);let a=Jn(i).sampler;if(!a){const t={...br};switch(t.addressModeU=i.wrapS||t.addressModeU,t.addressModeV=i.wrapT||t.addressModeV,t.magFilter=i.magFilter||t.magFilter,i.minFilter){case Hn:t.minFilter=Ct.Nearest,t.mipmapFilter=Ct.Nearest;break;case Kn:t.minFilter=Ct.Nearest,t.mipmapFilter=Ct.Linear;break;case $n:t.minFilter=Ct.Linear,t.mipmapFilter=Ct.Nearest;break;case Xn:t.minFilter=Ct.Linear,t.mipmapFilter=Ct.Linear;break;default:t.minFilter=i.minFilter}a=Jn(i).sampler=un(e,t)}return a}function wr(e,t,n=null){let r=Jn(t).modelBuffer;if(r||(r=Jn(t).modelBuffer=cn(e,{usage:Ut.Uniform|Ut.Stream,size:4*Ar})),n){const i=new Float32Array(n.buffer,0,16);l(Jn(t).model||hr,i,0,0,16);const a=new Float32Array(n.buffer,64,16),o=function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){const n=function(e){return e[0]*+(e[4]*e[8]-e[7]*e[5])+e[3]*-(e[1]*e[8]-e[7]*e[2])+e[6]*+(e[1]*e[5]-e[4]*e[2])}(e);return n?(xn[0]=+(e[4]*e[8]-e[7]*e[5]),xn[1]=-(e[1]*e[8]-e[7]*e[2]),xn[2]=+(e[1]*e[5]-e[4]*e[2]),xn[3]=-(e[3]*e[8]-e[6]*e[5]),xn[4]=+(e[0]*e[8]-e[6]*e[2]),xn[5]=-(e[0]*e[5]-e[3]*e[2]),xn[6]=+(e[3]*e[7]-e[6]*e[4]),xn[7]=-(e[0]*e[7]-e[6]*e[1]),xn[8]=+(e[0]*e[4]-e[3]*e[1]),function(e,t,n=[1,0,0,0,1,0,0,0,1]){return c(e,t,n)}(xn,1/n,t)):null}(e,t)?function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t,n){let r=0;for(let e=0;e<3;++e)for(let i=e;i<3;++i)r=t[3*i+e],n[3*i+e]=t[3*e+i],n[3*e+i]=r;return n}(0,e,t)}(t,t):null}(function(e,t=[1,0,0,0,1,0,0,0,1]){for(let n=0;n<3;++n)for(let r=0;r<3;++r)t[3*n+r]=e[4*n+r];return t}(e,t),t)}(i);o?function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){for(let n=0;n<3;++n){for(let r=0;r<3;++r)t[4*n+r]=e[3*n+r];t[4*n+3]=0}t[12]=t[13]=t[14]=0,t[15]=1}(o,a):l(i,a,0,0,16),mn(e,r,n)}return r}function Er(e,t,n,r,i=!1){const a=Jn(n).weights||n.weights||r.weights;if(!a)return function(e,t){let n=Jn(t).morphBuffer;return n||(n=Jn(t).morphBuffer=cn(e,{usage:Ut.Uniform,size:4*dr})),n}(e,t);let o=Jn(n).morphBuffer;if(o||(o=Jn(n).morphBuffer=cn(e,{usage:Ut.Uniform|Ut.Stream,size:4*dr})),i){const t=new Float32Array(dr);l(a,t,0,0,dr),mn(e,o,t)}return o}function _r(e,t){let n=Jn(t).modelLayout;return n||(n=Jn(t).modelLayout=gn(0,{entries:[{binding:0,label:"Model",type:Vt.Buffer},{binding:1,label:"Morph",type:Vt.Buffer},{binding:2,label:"jointTexture",type:Vt.Texture},{binding:3,label:"jointTexture",type:Vt.Sampler}]})),n}function Mr(e,t){let n=Jn(t).materialLayout;return n||(n=Jn(t).materialLayout=gn(0,{entries:[{binding:0,label:"Material",type:Vt.Buffer},{binding:1,label:"baseColorTexture",type:Vt.Texture},{binding:2,label:"baseColorTexture",type:Vt.Sampler},{binding:3,label:"metallicRoughnessTexture",type:Vt.Texture},{binding:4,label:"metallicRoughnessTexture",type:Vt.Sampler},{binding:5,label:"normalTexture",type:Vt.Texture},{binding:6,label:"normalTexture",type:Vt.Sampler},{binding:7,label:"occlusionTexture",type:Vt.Texture},{binding:8,label:"occlusionTexture",type:Vt.Sampler},{binding:9,label:"emissiveTexture",type:Vt.Texture},{binding:10,label:"emissiveTexture",type:Vt.Sampler}]})),n}function Ur(e,t,n,r=!1){const i=t.skins?.[n.skin];if(!i)return Rr(e,t);const a=i.joints.length;let o=Jn(n).jointTexture;return o||(o=Jn(n).jointTexture=fn(e,{size:[4,a,1],format:It.RGBA32F,usage:Rt.TextureBinding})),r&&bn(e,{texture:o},Jn(n).jointMatrix=Jn(n).jointMatrix||new Float32Array(16*a),{bytesPerRow:64,rowsPerImage:a},[4,a,1]),o}function Rr(e,t){let n=Jn(t).blankTexture;return n||(n=Jn(t).blankTexture=fn(e,{usage:Rt.TextureBinding}),bn(e,{texture:n},new Uint8Array([255,255,255,255]),{bytesPerRow:4}),n)}function Nr(e,t){let n=Jn(t).defaultSampler;return n||(n=Jn(t).defaultSampler=un(e,br)),n}function Ir(e,t){let n=Jn(t).jointSampler;return n||(n=Jn(t).jointSampler=un(e,{})),n}const Cr=p(-1,-2,-2),Br=new URLSearchParams(window.location.search),Lr=document.querySelector("canvas"),Pr=Lr.parentElement;let kr=null,Gr=0,Dr=0;const zr=function(e,t={},n=0){const r=e.getContext("webgl2",t);if(r){let t=0;for(const e in Xt)n&+e&&r.getExtension(Xt[+e])&&(t|=+e);const i=16&t?r.getExtension(Xt[16]):null,a=function(e){const t=Zt();e.blendColor(1,1,1,1),Yt(e,null,t,t,0,!0);const n=e.getParameter(34921);for(let t=0;t<n;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}(r),o=e=>{e.deleteFramebuffer(a.copyFrameBuffer)},s={canvas:e,gl:r,features:t,extDrawBuffersi:i,pass:null,state:a,destroy(){o(this.gl)}};return ln.register(s,{finalizer:o,gl:r}),s}return null}(Lr,{powerPreference:"low-power"}),Vr="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/63f026b2aa957d3e8207f6dd798608993e33fb0d/2.0";function jr(e=0){if(window.requestAnimationFrame(jr),!kr)return;Gr||(Gr=e);const t=e-Gr,n=kr.glTF,r=Br.get("camera"),i=Br.get("scene"),a=((null!==i&&parseInt(i))??n.scene)||0;n.animations?.length&&(function(e,t,n=0,r=!1){const i=function(e,t){let n=Jn(t).duration||0;for(const r of t.channels){const i=e.nodes?.[r.target.node],a=e.accessors?.[t.samplers[r.sampler]?.input];i&&a&&(n=Math.max(n,a.max?.[0]||0))}return Jn(t).duration=n}(e.glTF,t),a=r?n-Math.floor(n/i)*i:Math.min(n,i);for(const n of t.channels){const r=e.glTF.nodes?.[n.target.node],i=t.samplers[n.sampler];if(!r||!i)continue;const o=Zn(e,i),s=Qn(e,i);if(!o?.length||!s)continue;const l=o.length,c=o[0],f=o[l-1],u=Jn(n).lastKeyframe||0,[d,g]=cr(o,c,f,a,u);Jn(n).lastKeyframe=d;const p=n.target.path;let m=3,b=!1;switch(p){case"rotation":m=4,b=!0;break;case"weights":m=r.weights?.length||e.glTF.meshes?.[r.mesh]?.weights?.length||0}fr(Jn(r)[p]=Jn(r)[p]||new Array(m),o,s,d,g,a,i.interpolation||"LINEAR",b)}return n<i}(kr,n.animations[Dr],t/1e3)||(Gr=e,Dr=(Dr+1)%n.animations.length)),function(e,t,n,r={}){const i=(r.scene??n.glTF.scene)||0,a=n.glTF.nodes,o=n.glTF.scenes?.[i]?.nodes;if(!a||!o)return;const s=function(e,t={}){let n=[];const r=e.glTF.scenes?.[(t.scene??e.glTF.scene)||0]?.nodes;if(r)for(let t=0;t<r.length;++t)or(e.glTF,r[t],nr,n);n=n.sort().filter(((e,t,n)=>!t||e!==n[t-1]));for(const t of n){const n=e.glTF.nodes[t];"camera"in n&&sr(e.glTF,n),"skin"in n&&lr(e,n)}return n}(n,{scene:i});let c=hr,f=hr,u=xr;if(r.camera){const t=n.glTF.cameras?.[r.camera.index||0];t&&(c=t.extras?.view||hr,d=Tr,g=t,m=e.width/e.height,g?.orthographic?function(e,t,n,r,i,a,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const s=1/(t-e),l=1/(r-n),c=1/(i-a);Fn(o),o[0]=2*s,o[5]=2*l,o[10]=2*c,o[12]=-(t+e)*s,o[13]=-(r+n)*l,o[14]=(i+a)*c}(-g.orthographic.xmag,g.orthographic.xmag,-g.orthographic.xmag/(m||1),g.orthographic.xmag/(m||1),g.orthographic.znear,g.orthographic.zfar,d):g?.perspective?Rn(m||g.perspective.aspectRatio||1,g.perspective.yfov,g.perspective.znear,g.perspective.zfar||1/0,d):Fn(d),f=d,u=t.extras?.translation||xr),r.camera.model&&(u=p(r.camera.model[12],r.camera.model[13],r.camera.model[14]),yn(r.camera.model,c)),f=r.camera.proj||f}var d,g,m;const b=vn(f,c,Tr),A=new Float32Array(Ar);l(b,A,0,32,16),l(u,A,0,48,3),function(e,t={}){e.gl.bindFramebuffer(36160,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,an(e.gl,3089,!1));let n=0;isNaN(t.clearDepth)||(n|=256,e.gl.clearDepth(t.clearDepth),nn(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(n|=1024,e.gl.clearStencil(t.clearStencil),rn(e.gl,e.state.state.stencilWriteMask,255),e.state.state.stencilWriteMask=255),t.clearColor&&(n|=16384,e.gl.clearColor(...t.clearColor),tn(e.gl,e.state.state.blendWriteMask,Nt.All),e.state.state.blendWriteMask=Nt.All),n&&e.gl.clear(n),e.pass=null}(t,{clearDepth:1});const h=[];for(let e=0;e<s.length;++e){const r=a[s[e]],i=n.glTF.meshes?.[r.mesh];if(i){wr(t,r,A),Er(t,n.glTF,r,i,!0),Ur(t,n.glTF,r,!0);for(let e=0;e<i.primitives.length;++e){const a=i.primitives[e];"BLEND"===n.glTF.materials?.[a.material]?.alphaMode?h.push({node:r,mesh:i,primitive:a}):Fr(t,n,r,i,a)}}}for(const e of h)Fr(t,n,e.node,e.mesh,e.primitive);!function(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&on(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],16384,be+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&on(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}(t)}(Lr,zr,kr,{scene:a,camera:n.cameras?{index:parseInt(r)||0}:Cn(n,a,Cr,Lr.width/Lr.height)})}function Wr(){const e=window.devicePixelRatio||1,t=Pr.clientWidth,n=Pr.clientHeight;Lr.width=t*e,Lr.height=n*e,Lr.style.width=`${t}px`,Lr.style.height=`${n}px`}window.addEventListener("resize",Wr,!1),Wr(),async function(){let t=Br.get("url");if(!t){const e=await(await fetch(`${Vr}/model-index.json`)).json(),n=Br.get("model")||"BrainStem",r=Br.get("variant")||"glTF",i=e.find((e=>e.name===n));t=`${Vr}/${n}/${r}/${i.variants[r]}`}kr=await async function(t,s=!0,l=e){const c=function(e){if(r(e))return"";const t=e.split(/[?#]/)[0].split("/");return t.pop(),t.length?t.join("/")+"/":""}(t);let f;const u=await l(t,"bin");var d;return d=u,f=new DataView(d.buffer||d,d.byteOffset||0,4).getUint32(0,!0)===a?function(e){let t,r;const i=e.buffer||e,o=e.byteOffset||0,s=new DataView(i,o,12);if(s.getUint32(0,!0)!==a)throw new Error("Invalid GLB format");const l=s.getUint32(4,!0);if(2!==l)throw new Error(`Unsupported GLB version: ${l}`);const c=new DataView(i,o+12);let f=0;for(;f<c.byteLength;){const e=c.getUint32(f,!0),a=c.getUint32(f+4,!0);if(f+=8,1313821514===a){const r=new Uint8Array(i,o+12+f,e);t=JSON.parse(n(r))}else 5130562===a&&(r=new Uint8Array(i,o+12+f,e));f+=e}if(!t)throw new Error("Invalid GLB format: missing JSON content");if(!t.asset||"2.0"!==t.asset.minVersion&&"2.0"!==t.asset.version)throw new Error("Unsupported glTF version: 2.0 required");return{glTF:t,binaryChunk:r}}(u):{glTF:JSON.parse(n(u))},f.baseUrl=c,s&&(f=await async function(t,n=e){return t=await async function(e,t){const n=e.buffers||[];if(e.glTF.buffers)for(let r=0;r<e.glTF.buffers.length;++r){if(n[r])continue;const a=e.glTF.buffers[r];if(a.uri)n[r]=await t(i(a.uri,e.baseUrl||""),"bin");else{if(0!==r||!e.binaryChunk)throw new Error(`Invalid glTF: missing uri for buffer ${r}`);n[r]=e.binaryChunk}}return{...e,buffers:n}}(t,n),await async function(e,t){const{glTF:n,buffers:r=[],images:a=[]}=e;if(n.images)for(let s=0;s<n.images.length;++s){if(a[s])continue;const l=n.images[s];let c=!1,f=l.uri;if(l.bufferView||0===l.bufferView){const e=n.bufferViews?.[l.bufferView];if(!e)throw new Error(`Invalid glTF: invalid bufferView for image ${s}`);const t=new Blob([o(r,e)],{type:l.mimeType});f=URL.createObjectURL(t),c=!0}if(!f)throw new Error(`Invalid glTF: missing uri or bufferView for image ${s}`);try{a[s]=await t(i(f,e.baseUrl||""),"img")}finally{c&&URL.revokeObjectURL(f)}}return{...e,images:a}}(t,n)}(f,l)),f}(t,!0),jr()}()})();