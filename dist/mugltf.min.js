var e,t;e=self,t=function(){return(()=>{var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e,t,n=0,r=0,i=e.length-n){for(let o=0;o<i;++o)t[r+o]=e[n+o];return t}function r(e,t,n){for(let r=0;r<e.length;++r)n[r]=e[r]*t;return n}e.r(t),e.d(t,{glTFResourceFetch:()=>X,renderGlTF:()=>B,resolveGlTF:()=>q,updateGlTF:()=>w,updateGlTFAnimation:()=>U});const i=[1,0,0,0,1,0,0,0,1],o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function a(e){for(let t=0;t<16;++t)e[t]=t%5?0:1;return e}function f(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return n(e,t)}function s(e,t,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return n(function(e,t,n,r){const i=t.length/4,o=n.length/4;let a=0;for(let e=0;e<o;++e)for(let o=0;o<i;++o){a=0;for(let r=0;r<4;++r)a+=t[r*i+o]*n[4*e+r];r[e*i+o]=a}return r}(0,e,t,o),r)}function l(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[5]-e[4]*e[1],i=e[0]*e[9]-e[8]*e[1],a=e[0]*e[13]-e[12]*e[1],f=e[4]*e[9]-e[8]*e[5],s=e[4]*e[13]-e[12]*e[5],l=e[8]*e[13]-e[12]*e[9],c=e[2]*e[7]-e[6]*e[3],u=e[2]*e[11]-e[10]*e[3],d=e[2]*e[15]-e[14]*e[3],v=e[6]*e[11]-e[10]*e[7],b=e[6]*e[15]-e[14]*e[7],m=e[10]*e[15]-e[14]*e[11],T=n*m-i*b+a*v+f*d-s*u+l*c;return T?(o[0]=+e[5]*m-e[9]*b+e[13]*v,o[1]=-e[1]*m+e[9]*d-e[13]*u,o[2]=+e[1]*b-e[5]*d+e[13]*c,o[3]=-e[1]*v+e[5]*u-e[9]*c,o[4]=-e[4]*m+e[8]*b-e[12]*v,o[5]=+e[0]*m-e[8]*d+e[12]*u,o[6]=-e[0]*b+e[4]*d-e[12]*c,o[7]=+e[0]*v-e[4]*u+e[8]*c,o[8]=+e[7]*l-e[11]*s+e[15]*f,o[9]=-e[3]*l+e[11]*a-e[15]*i,o[10]=+e[3]*s-e[7]*a+e[15]*n,o[11]=-e[3]*f+e[7]*i-e[11]*n,o[12]=-e[6]*l+e[10]*s-e[14]*f,o[13]=+e[2]*l-e[10]*a+e[14]*i,o[14]=-e[2]*s+e[6]*a-e[14]*n,o[15]=+e[2]*f-e[6]*i+e[10]*n,function(e,t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return r(e,t,n)}(o,1/T,t)):null}function c(e=0,t=0,n=0,r=0){return[e,t,n,r]}function u(e=0,t=0,n=0){return[e,t,n]}c(),u(),c(),c();const d=5121,v=5123,b=5126,m=3553,T=b,_=35676;function O(e,t,n,r=[0,0,0,1]){let i=function(e,t){let n=0;for(let r=0;r<e.length;++r)n+=e[r]*t[r];return n}(e,t),o=1;i<0&&(i*=-1,o=-1);let a=1-n,f=n;if(1-i>1e-6){const e=Math.acos(i),t=Math.sin(e);a=Math.sin((1-n)*e)/t,f=Math.sin(n*e)/t}return f*=o,r[0]=e[0]*a+t[0]*f,r[1]=e[1]*a+t[1]*f,r[2]=e[2]*a+t[2]*f,r[3]=e[3]*a+t[3]*f,r}function p(e){return e.extras||(e.extras={}),e.extras}function g(e,t){let n=p(t).input||null;if(!n){var r;const i=null===(r=e.accessors)||void 0===r?void 0:r[t.input];if(i){const{buffer:r,byteOffset:o=0}=x(e,i);p(t).input=n=new Float32Array(r.buffer,o+r.byteOffset,(r.byteLength-o)/4)}}return n}function N(e,t){let n=p(t).output||null;if(!n){var r;const i=null===(r=e.accessors)||void 0===r?void 0:r[t.output];if(i){const{buffer:r,byteOffset:o=0}=x(e,i);let a=Float32Array;switch(i.componentType){case 5120:a=Int8Array;break;case d:a=Uint8Array;break;case 5122:case v:a=Uint16Array}p(t).output=n=new a(r.buffer,o+r.byteOffset,(r.byteLength-o)/a.BYTES_PER_ELEMENT)}}return n}function h(e){switch(e.type){case"VEC2":if(e.componentType===b)return 512;if(e.componentType===v)return e.normalized?66052:516;if(e.componentType===d)return e.normalized?66050:514;break;case"VEC3":if(e.componentType===b)return 768;break;case"VEC4":if(e.componentType===b)return 1024;if(e.componentType===d)return e.normalized?66562:1026;if(e.componentType===v)return e.normalized?66564:1028}return null}function x(e,t){var n;let r=p(t).buffer,i=p(t).byteOffset||0;if(r)return{buffer:r,byteOffset:i};const o=function(e){let t=0;switch(e.type){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":case"MAT2":t=4;break;case"MAT3":t=9;break;case"MAT4":t=16}let n=0;switch(e.componentType){case 5120:case d:n=1;break;case 5122:case v:n=2;break;case 5125:case b:n=4}return t*n}(t);let a=t.count*o;const f=null===(n=e.bufferViews)||void 0===n?void 0:n[t.bufferView];if(f){const n=E(e,f),s=f.byteStride||1;i=(t.byteOffset||0)%s,a=t.count*(f.byteStride||o);const l=(t.byteOffset||0)-i;r=new Uint8Array(n.buffer,n.byteOffset+l,a)}if(t.sparse){var s,l;const{count:n,indices:{bufferView:f,byteOffset:c=0,componentType:u},values:{bufferView:b,byteOffset:m=0}}=t.sparse,T=null===(s=e.bufferViews)||void 0===s?void 0:s[f],_=null===(l=e.bufferViews)||void 0===l?void 0:l[b];if(T&&_){const t=new Uint8Array(a);r&&t.set(r,i);const f=E(e,T),s=E(e,_),l=new(u===d?Uint8Array:u===v?Uint16Array:Uint32Array)(f.buffer,f.byteOffset+c,n),b=new Uint8Array(s.buffer,s.byteOffset+m,n*o);for(let e=0;e<n;++e){const n=l[e]*o;for(let r=0;r<o;++r)t[n+r]=b[e*o+r]}i=0,r=t}}return r?(p(t).buffer=r,p(t).byteOffset=i):r=new Uint8Array,{buffer:r,byteOffset:i}}function E(e,t){let n=p(t).buffer;if(!n){var r;const i=null===(r=e.buffers)||void 0===r?void 0:r[t.buffer];if(i){const e=i.extras.buffer;n=new Uint8Array(e.buffer,e.byteOffset+(t.byteOffset||0),t.byteLength)}else n=new Uint8Array;p(t).buffer=n}return n}u(),u(),u();const y=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],S=[0,0,0,1],A=u(1,1,1),I=u();function w(e,t={}){var n,r,i;let o=[];const a=null===(n=e.scenes)||void 0===n||null===(r=n[(null!==(i=t.scene)&&void 0!==i?i:e.scene)||0])||void 0===r?void 0:r.nodes;if(a)for(let t=0;t<a.length;++t)R(e,a[t],y,o);o=o.sort().filter(((e,t,n)=>!t||e!==n[t-1]));for(const t of o){const n=e.nodes[t];"camera"in n&&L(e,n),"skin"in n&&M(e,n)}return o}function U(e,t,r=0,i=!1){var o,a,f,s;const l=function(e,t){let n=p(t).duration||0;for(const f of t.channels){var r,i,o;const s=null===(r=e.nodes)||void 0===r?void 0:r[f.target.node],l=null===(i=e.accessors)||void 0===i?void 0:i[null===(o=t.samplers[f.sampler])||void 0===o?void 0:o.input];var a;s&&l&&(n=Math.max(n,(null===(a=l.max)||void 0===a?void 0:a[0])||0))}return p(t).duration=n}(e,t),c=i?r-Math.floor(r/l)*l:Math.min(r,l);for(const r of t.channels){var u;const i=null===(u=e.nodes)||void 0===u?void 0:u[r.target.node],l=t.samplers[r.sampler];if(!i||!l)continue;const d=g(e,l),v=N(e,l);if(null==d||!d.length||!v)continue;const b=d.length,m=d[0],T=d[b-1];let _,h;if(c<=m)_=h=0;else if(c>=T)_=h=b-1;else{let e=p(r).lastKeyframe||0;for(d[e]>c&&(e=0),_=e,h=_+1;h<b&&!(d[_]<=c&&d[h]>c);++_,++h);}p(r).lastKeyframe=_;const x=r.target.path;let E=3;switch(x){case"rotation":E=4;break;case"weights":E=(null===(o=i.weights)||void 0===o?void 0:o.length)||(null===(a=e.meshes)||void 0===a||null===(f=a[i.mesh])||void 0===f||null===(s=f.weights)||void 0===s?void 0:s.length)||0}if(!E)continue;let y=l.interpolation;_===h&&(y="STEP");const S=d[_],A=d[h],I=(c-S)/(A-S),w=p(i)[x]=p(i)[x]||new Array(E),U=new Array(E);switch(y){case"STEP":n(v,w,_*E,0,E);break;case"CUBICSPLINE":{const e=A-S,t=I*I,n=I*t;for(let r=0;r<E;++r)w[r]=(2*n-3*t+1)*v[(3*_+1)*E+r]+(n-2*t+I)*e*v[(3*_+2)*E+r]+(-2*n+3*t)*v[(3*h+1)*E+r]+(n-t)*e*v[3*h*E+r];break}default:if("rotation"===x)n(v,w,_*E,0,E),n(v,U,h*E,0,E),O(w,U,I,w);else for(let e=0;e<E;++e)w[e]=(1-I)*v[_*E+e]+I*v[h*E+e]}}return r<l}function R(e,t,r,i=null){var o;const a=null===(o=e.nodes)||void 0===o?void 0:o[t];if(!a)return;null==i||i.push(t);const l=p(a),c=l.matrix=l.matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.matrix?f(a.matrix,c):(a.rotation||a.scale||a.translation||l.rotation||l.scale||l.translation)&&function(e,t,r,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){!function(e,t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const n=e[0]*e[0],r=e[0]*e[1],i=e[0]*e[2],o=e[1]*e[1],a=e[1]*e[2],f=e[2]*e[2],s=e[3]*e[0],l=e[3]*e[1],c=e[3]*e[2];t[0]=1-2*(o+f),t[1]=2*(r+c),t[2]=2*(i-l),t[4]=2*(r-c),t[5]=1-2*(n+f),t[6]=2*(a+s),t[8]=2*(i+l),t[9]=2*(a-s),t[10]=1-2*(n+o),t[3]=t[7]=t[11]=t[12]=t[13]=t[14]=0,t[15]=1}(e,t)}(t,i);for(let e=0;e<3;++e)for(let t=0;t<3;++t)i[4*e+t]*=r[e];n(e,i,0,12,3)}(l.translation||a.translation||I,l.rotation||a.rotation||S,l.scale||a.scale||A,c);const u=l.model=s(r,c,l.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(a.children)for(const t of a.children)R(e,t,u,i)}function L(e,t){var n;const r=null===(n=e.cameras)||void 0===n?void 0:n[t.camera];if(r){const e=p(t).model=p(t).model||y;p(r).view=l(e,p(r).view||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),p(r).translation=[e[12],e[13],e[14]]}}function M(e,t){var n;const r=null===(n=e.skins)||void 0===n?void 0:n[t.skin];if(r){const n=r.joints.length,i=p(t).jointMatrix=p(t).jointMatrix||new Float32Array(16*n),o=function(e,t){let n=p(t).inverseBindMatrices;if(!n){var r;const i=null===(r=e.accessors)||void 0===r?void 0:r[t.inverseBindMatrices];if(i){const{buffer:r,byteOffset:o}=x(e,i);n=new Float32Array(r.buffer,r.byteOffset+o,16*t.joints.length)}else n=new Float32Array(16*t.joints.length);p(t).inverseBindMatrices=n}return n}(e,r);for(let a=0;a<n;++a){const n=e.nodes[r.joints[a]],f=new Float32Array(i.buffer,i.byteOffset+64*a,16),c=new Float32Array(o.buffer,o.byteOffset+64*a,16);l(p(t).model||y,f),s(f,n&&p(n).model||y,f),s(f,c,f)}}}const C=["POSITION","NORMAL","TANGENT"],F=/(POSITION|NORMAL|TANGENT)_(\d+)/,P=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],G=u(),z=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function B(e,t,n={}){var r,i,o;const f=(null!==(r=n.scene)&&void 0!==r?r:t.scene)||0,c=t.nodes,d=null===(i=t.scenes)||void 0===i||null===(o=i[f])||void 0===o?void 0:o.nodes;if(!c||!d)return;const v=w(t,{scene:f});let b=P,m=P,T=G;if(n.camera){var _;const r=null===(_=t.cameras)||void 0===_?void 0:_[n.camera.index||0];var O,p;r&&(b=(null===(O=r.extras)||void 0===O?void 0:O.view)||P,g=z,N=r,h=e.width/e.height,null!=N&&N.orthographic?function(e,t,n,r,i,o,f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const s=1/(t-e),l=1/(r-n),c=1/(i-o);a(f),f[0]=2*s,f[5]=2*l,f[10]=2*c,f[12]=-(t+e)*s,f[13]=-(r+n)*l,f[14]=(i+o)*c}(-N.orthographic.xmag,N.orthographic.xmag,-N.orthographic.xmag/(h||1),N.orthographic.xmag/(h||1),N.orthographic.znear,N.orthographic.zfar,g):null!=N&&N.perspective?function(e,t,n,r=1/0,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const o=1/Math.tan(t/2);if(a(i),i[0]=o/e,i[5]=o,i[11]=-1,i[15]=0,isFinite(r)){const e=1/(n-r);i[10]=(n+r)*e,i[14]=2*n*r*e}else i[10]=-1,i[14]=-2*n}(h||N.perspective.aspectRatio||1,N.perspective.yfov,N.perspective.znear,N.perspective.zfar||1/0,g):a(g),m=g,T=(null===(p=r.extras)||void 0===p?void 0:p.translation)||G),n.camera.model&&(T=u(n.camera.model[12],n.camera.model[13],n.camera.model[14]),l(n.camera.model,b)),m=n.camera.proj||m}var g,N,h;const x={cameraPosition:T,viewProj:s(m,b,z)},E=e.pass(),y=e.render(E),S=[];for(let n=0;n<v.length;++n){var A;const r=c[v[n]],i=null===(A=t.meshes)||void 0===A?void 0:A[r.mesh];if(i)for(let n=0;n<i.primitives.length;++n){var I,U;const o=i.primitives[n];"BLEND"===(null===(I=t.materials)||void 0===I||null===(U=I[o.material])||void 0===U?void 0:U.alphaMode)?S.push({node:r,mesh:i,primitive:o}):j(e,y,t,r,i,o,x)}}for(const n of S)j(e,y,t,n.node,n.mesh,n.primitive,x);y.end(),E.destroy()}function j(e,t,n,o,a,s,l){var c,u,d,v;l.model=f(p(o).model||P,l.model||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t=[1,0,0,0,1,0,0,0,1]){const n=function(e){return e[0]*+(e[4]*e[8]-e[7]*e[5])+e[3]*-(e[1]*e[8]-e[7]*e[2])+e[6]*+(e[1]*e[5]-e[4]*e[2])}(e);return n?(i[0]=+(e[4]*e[8]-e[7]*e[5]),i[1]=-(e[1]*e[8]-e[7]*e[2]),i[2]=+(e[1]*e[5]-e[4]*e[2]),i[3]=-(e[3]*e[8]-e[6]*e[5]),i[4]=+(e[0]*e[8]-e[6]*e[2]),i[5]=-(e[0]*e[5]-e[3]*e[2]),i[6]=+(e[3]*e[7]-e[6]*e[4]),i[7]=-(e[0]*e[7]-e[6]*e[1]),i[8]=+(e[0]*e[4]-e[3]*e[1]),function(e,t,n=[1,0,0,0,1,0,0,0,1]){return r(e,t,n)}(i,1/n,t)):null}(e,t)?function(e,t=[1,0,0,0,1,0,0,0,1]){return function(e,t,n){let r=0;for(let e=0;e<3;++e)for(let i=e;i<3;++i)r=t[3*i+e],n[3*i+e]=t[3*e+i],n[3*e+i]=r;return n}(0,e,t)}(t,t):null}(function(e,t=[1,0,0,0,1,0,0,0,1]){for(let n=0;n<3;++n)for(let r=0;r<3;++r)t[3*n+r]=e[4*n+r];return t}(e,t),t)}(l.model,l.normalMatrix=l.normalMatrix||[1,0,0,0,1,0,0,0,1])||function(e){for(let t=0;t<9;++t)e[t]=t%4?0:1}(l.normalMatrix);let b=!1,O=0,g=(null===(c=n.accessors)||void 0===c||null===(u=c[s.attributes.POSITION])||void 0===u?void 0:u.count)||0;if(!g)return;const N={...l,...W(e,n,s.material)};s.targets&&(N.targetWeights=p(o).weights||o.weights||a.weights||[0,0,0,0,0,0,0,0]);let E=0;const y=null===(d=n.skins)||void 0===d?void 0:d[o.skin];if(s.attributes.JOINTS_0&&s.attributes.WEIGHTS_0&&y){E=y.joints.length;const e=p(o).jointMatrix=p(o).jointMatrix||new Float32Array(16*E);N.jointMatrix=e}const S=[];for(const e in N)"number"==typeof N[e]?S.push({name:e,value:N[e]}):N[e].length?S.push({name:e,values:N[e]}):S.push({name:e,tex:N[e]});const A=function(e,t,n,r=0){var i,o,a;let f=p(n).pipeline;if(f)return f;const s=n.mode||4,l=null===(i=t.materials)||void 0===i?void 0:i[n.material];let c="OPAQUE",u=!1,d=!1;var v;l&&(u=l.doubleSided||!1,c=l.alphaMode||c,d=!(null===(v=l.extensions)||void 0===v||!v.KHR_materials_unlit));const b=function(e,t){const n={},r=[];let i=0;function o(t){var i,o;if(!t.sparse){const i=x(e,t).buffer,o=`${t.bufferView},${i.byteOffset},${i.byteLength}`;if(o in n)return r[n[o]];n[o]=r.length}const a={attrs:[],stride:null===(i=e.bufferViews)||void 0===i||null===(o=i[t.bufferView])||void 0===o?void 0:o.byteStride};return r.push(a),a}for(const n of["POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","JOINTS_0","WEIGHTS_0"]){var a;const r=null===(a=e.accessors)||void 0===a?void 0:a[t.attributes[n]];if(r){const e=h(r);if(!e)continue;o(r).attrs.push({name:n,format:e,shaderLoc:i,offset:p(r).byteOffset||0}),i++}}if(t.targets){const n=new Array(3);for(let r=0;r<t.targets.length;++r){let a=0;for(let i=0;i<C.length;++i){var f;(n[i]=null===(f=e.accessors)||void 0===f?void 0:f[t.targets[r][C[i]]])&&++a}if(i+a>16)break;for(let e=0;e<C.length;++e){const t=n[e];t&&(o(t).attrs.push({name:`${C[e]}_${r}`,format:768,shaderLoc:i,offset:p(t).byteOffset||0}),i++)}}}return r}(t,n),O=5125===(null===(o=t.accessors)||void 0===o||null===(a=o[n.indices])||void 0===a?void 0:a.componentType)?5125:5123,g=n.attributes.JOINTS_0&&n.attributes.WEIGHTS_0?12*Math.ceil(r/12):0,N=JSON.stringify([b,u,c,g,O,s,d]),E=p(t).pipelines=p(t).pipelines||{};if(f=E[N],f)return f;const y=[`ALPHAMODE_${c}`];for(const e of b)for(const t of e.attrs)y.push(`USE_${t.name}`),"COLOR_0"===t.name&&3==(t.format>>8&255)&&y.push("COLOR_0_VEC3");g>0&&y.push(`NUM_JOINTS ${g}`),d&&y.push("MATERIAL_UNLIT");const S=y.map((e=>`#define ${e}\n`)).join(""),A=[];g>0&&A.push({name:"jointMatrix",type:1,valueFormat:_}),n.targets&&A.push({name:"targetWeights",type:1,valueFormat:T});const I=e.shader({type:35633,source:S+"precision highp float;uniform mat4 model,viewProj;uniform mat3 normalMatrix;\n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\nattribute vec3 COLOR_0;\n#else\nattribute vec4 COLOR_0;\n#endif\nvarying vec4 vColor0;\n#endif\n#ifdef USE_TEXCOORD_0\nattribute vec2 TEXCOORD_0;\n#endif\n#ifdef USE_TEXCOORD_1\nattribute vec2 TEXCOORD_1;\n#endif\nvarying vec2 vTexCoord0,vTexCoord1;attribute vec3 POSITION;varying vec3 vPosition;\n#if defined(NUM_JOINTS) && defined(USE_WEIGHTS_0) && defined(USE_JOINTS_0)\n#define USE_SKIN\nattribute vec4 JOINTS_0,WEIGHTS_0;uniform mat4 jointMatrix[NUM_JOINTS];mat4 a(){mat4 b=WEIGHTS_0.x*jointMatrix[int(JOINTS_0.x)]+WEIGHTS_0.y*jointMatrix[int(JOINTS_0.y)]+WEIGHTS_0.z*jointMatrix[int(JOINTS_0.z)]+WEIGHTS_0.w*jointMatrix[int(JOINTS_0.w)];return b;}\n#endif\n#if defined(NUM_MORPHS) && defined(USE_POSITION_0) || defined(USE_NORMAL_0) || defined(USE_TANGENT_0)\n#define USE_MORPH\nuniform float targetWeights[NUM_MORPHS];\n#ifdef USE_POSITION_0\nattribute vec3 POSITION_0;\n#endif\n#ifdef USE_POSITION_1\nattribute vec3 POSITION_1;\n#endif\n#ifdef USE_POSITION_2\nattribute vec3 POSITION_2;\n#endif\n#ifdef USE_POSITION_3\nattribute vec3 POSITION_3;\n#endif\n#ifdef USE_POSITION_4\nattribute vec3 POSITION_4;\n#endif\n#ifdef USE_POSITION_5\nattribute vec3 POSITION_5;\n#endif\n#ifdef USE_POSITION_6\nattribute vec3 POSITION_6;\n#endif\n#ifdef USE_POSITION_7\nattribute vec3 POSITION_7;\n#endif\n#ifdef USE_NORMAL_0\nattribute vec3 NORMAL_0;\n#endif\n#ifdef USE_NORMAL_1\nattribute vec3 NORMAL_1;\n#endif\n#ifdef USE_NORMAL_2\nattribute vec3 NORMAL_2;\n#endif\n#ifdef USE_NORMAL_3\nattribute vec3 NORMAL_3;\n#endif\n#ifdef USE_NORMAL_4\nattribute vec3 NORMAL_4;\n#endif\n#ifdef USE_NORMAL_5\nattribute vec3 NORMAL_5;\n#endif\n#ifdef USE_NORMAL_6\nattribute vec3 NORMAL_6;\n#endif\n#ifdef USE_NORMAL_7\nattribute vec3 NORMAL_7;\n#endif\n#ifdef USE_TANGENT_0\nattribute vec3 TANGENT_0;\n#endif\n#ifdef USE_TANGENT_1\nattribute vec3 TANGENT_1;\n#endif\n#ifdef USE_TANGENT_2\nattribute vec3 TANGENT_2;\n#endif\n#ifdef USE_TANGENT_3\nattribute vec3 TANGENT_3;\n#endif\n#ifdef USE_TANGENT_4\nattribute vec3 TANGENT_4;\n#endif\n#ifdef USE_TANGENT_5\nattribute vec3 TANGENT_5;\n#endif\n#ifdef USE_TANGENT_6\nattribute vec3 TANGENT_6;\n#endif\n#ifdef USE_TANGENT_7\nattribute vec3 TANGENT_7;\n#endif\nvec3 c(){vec3 d=vec3(0.);\n#ifdef USE_POSITION_0\nd+=targetWeights[0]*POSITION_0;\n#endif\n#ifdef USE_POSITION_1\nd+=targetWeights[1]*POSITION_1;\n#endif\n#ifdef USE_POSITION_2\nd+=targetWeights[2]*POSITION_2;\n#endif\n#ifdef USE_POSITION_3\nd+=targetWeights[3]*POSITION_3;\n#endif\n#ifdef USE_POSITION_4\nd+=targetWeights[4]*POSITION_4;\n#endif\n#ifdef USE_POSITION_5\nd+=targetWeights[5]*POSITION_5;\n#endif\n#ifdef USE_POSITION_6\nd+=targetWeights[6]*POSITION_6;\n#endif\n#ifdef USE_POSITION_7\nd+=targetWeights[7]*POSITION_7;\n#endif\nreturn d;}vec3 e(){vec3 d=vec3(0.);\n#ifdef USE_NORMAL_0\nd+=targetWeights[0]*NORMAL_0;\n#endif\n#ifdef USE_NORMAL_1\nd+=targetWeights[1]*NORMAL_1;\n#endif\n#ifdef USE_NORMAL_2\nd+=targetWeights[2]*NORMAL_2;\n#endif\n#ifdef USE_NORMAL_3\nd+=targetWeights[3]*NORMAL_3;\n#endif\n#ifdef USE_NORMAL_4\nd+=targetWeights[4]*NORMAL_4;\n#endif\n#ifdef USE_NORMAL_5\nd+=targetWeights[5]*NORMAL_5;\n#endif\n#ifdef USE_NORMAL_6\nd+=targetWeights[6]*NORMAL_6;\n#endif\n#ifdef USE_NORMAL_7\nd+=targetWeights[7]*NORMAL_7;\n#endif\nreturn d;}vec3 f(){vec3 d=vec3(0.);\n#ifdef USE_TANGENT_0\nd+=targetWeights[0]*TANGENT_0;\n#endif\n#ifdef USE_TANGENT_1\nd+=targetWeights[1]*TANGENT_1;\n#endif\n#ifdef USE_TANGENT_2\nd+=targetWeights[2]*TANGENT_2;\n#endif\n#ifdef USE_TANGENT_3\nd+=targetWeights[3]*TANGENT_3;\n#endif\n#ifdef USE_TANGENT_4\nd+=targetWeights[4]*TANGENT_4;\n#endif\n#ifdef USE_TANGENT_5\nd+=targetWeights[5]*TANGENT_5;\n#endif\n#ifdef USE_TANGENT_6\nd+=targetWeights[6]*TANGENT_6;\n#endif\n#ifdef USE_TANGENT_7\nd+=targetWeights[7]*TANGENT_7;\n#endif\nreturn d;}\n#endif\nvec4 g(){vec4 h=vec4(POSITION,1.);\n#ifdef USE_MORPH\nh+=vec4(c(),0.);\n#endif\n#ifdef USE_SKIN\nh=a()*h;\n#endif\nreturn h;}\n#ifdef USE_NORMAL\nattribute vec3 NORMAL;\n#ifdef USE_TANGENT\nattribute vec4 TANGENT;varying mat3 vTBN;vec3 i(){vec3 j=TANGENT.xyz;\n#ifdef USE_MORPH\ntan+=f();\n#endif\n#ifdef USE_SKIN\ntan=mat3(a())*tan;\n#endif\nreturn normalize(tan);}\n#else\nvarying vec3 vNormal;\n#endif\nvec3 k(){vec3 l=NORMAL;\n#ifdef USE_MORPH\nl+=e();\n#endif\n#ifdef USE_SKIN\nl=mat3(a())*l;\n#endif\nreturn normalize(l);}\n#endif\nvoid main(void){vec4 h=model*g();vPosition=h.xyz/h.w;\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\nvec3 j=i();vec3 m=normalize(normalMatrix*k());vec3 n=normalize(normalMatrix*tan);vec3 o=cross(m,n)*TANGENT.w;vTBN=mat3(n,o,m);\n#else\nvNormal=normalize(normalMatrix*NORMAL);\n#endif\n#endif\n#ifdef USE_COLOR_0\n#if defined(COLOR_0_VEC3)\nvColor0=vec4(COLOR_0,1.);\n#else\nvColor0=COLOR_0;\n#endif\n#endif\nvTexCoord0=vec2(0.);vTexCoord1=vec2(0.);\n#ifdef USE_TEXCOORD_0\nvTexCoord0=TEXCOORD_0;\n#endif\n#ifdef USE_TEXCOORD_1\nvTexCoord1=TEXCOORD_1;\n#endif\ngl_Position=viewProj*h;gl_PointSize=1.;}"}),w=e.shader({type:35632,source:S+"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;uniform float alphaCutoff;uniform vec3 cameraPosition;varying vec3 vPosition;const float a=2.2;const float b=3.141592653589793;vec3 c(vec3 d){return pow(d,vec3(1./a));}vec3 e(vec3 f){return pow(f.xyz,vec3(a));}vec4 e(vec4 f){return vec4(e(f.xyz),f.w);}vec3 g(vec3 h,vec3 i,float j){return h+(i-h)*pow(clamp(1.-j,0.,1.),5.);}float k(float l,float m){float n=(m*m)*(l-1.)+1.;return l/(b*n*n);}float o(float l,float p,float q){float r=1./(p+sqrt(l+(1.-l)*(p*p)));float s=1./(q+sqrt(l+(1.-l)*(q*q)));return r*s;}float t(float l,float p,float q,float m){return o(l,p,q)*k(l,m);}vec3 u(vec3 d){return d/b;}varying vec2 vTexCoord0,vTexCoord1;struct v{sampler2D tex;float texCoord;float scale;};vec2 w(v tex){return mix(vTexCoord0,vTexCoord1,step(1.,tex.texCoord));}vec4 x(v tex){return texture2D(tex.tex,w(tex));}vec4 x(v tex,vec4 y){return mix(y,texture2D(tex.tex,w(tex)),step(0.,tex.texCoord));}uniform v normalTexture;\n#ifdef USE_NORMAL\n#ifdef USE_TANGENT\nvarying mat3 vTBN;\n#else\nvarying vec3 vNormal;\n#endif\n#endif\nstruct z{vec3 A;vec3 B;vec3 t;vec3 b;};z C(vec3 D){vec3 B,t,b,A;\n#ifdef USE_TANGENT\nt=normalize(vTBN[0]);b=normalize(vTBN[1]);A=normalize(vTBN[2]);\n#else\n#ifdef USE_NORMAL\nA=normalize(vNormal);\n#else\nA=normalize(cross(dFdx(D),dFdy(D)));\n#endif\nvec2 E=w(normalTexture);vec3 F=dFdx(vec3(E,0.));vec3 G=dFdy(vec3(E,0.));vec3 H=(G.t*dFdx(D)-F.t*dFdy(D))/(F.s*G.t-G.s*F.t);t=normalize(H-A*dot(A,H));b=cross(A,t);\n#endif\nif(gl_FrontFacing==false){t*=-1.;b*=-1.;A*=-1.;}B=A;if(normalTexture.texCoord>=0.){B=x(normalTexture).rgb*2.-vec3(1.);B*=vec3(normalTexture.scale,normalTexture.scale,1.);B=mat3(t,b,A)*normalize(B);}z I;I.A=A;I.t=t;I.b=b;I.B=B;return I;}\n#ifdef USE_COLOR_0\nvarying vec4 vColor0;\n#endif\nuniform vec4 baseColorFactor;uniform v baseColorTexture;uniform float metallicFactor,roughnessFactor;uniform v metallicRoughnessTexture;uniform v occlusionTexture;uniform vec3 emissiveFactor;uniform v emissiveTexture;vec4 J(){vec4 d=vec4(1.);\n#ifdef USE_COLOR_0\nd=vColor0;\n#endif\nreturn d;}vec4 K(){vec4 L=vec4(1.);L*=baseColorFactor;L*=e(x(baseColorTexture,vec4(1.)));return L*J();}vec2 M(){vec4 N=x(metallicRoughnessTexture,vec4(1.));return vec2(clamp(metallicFactor*N.b,0.,1.),clamp(roughnessFactor*N.g,.04,1.));}float O(){return x(occlusionTexture,vec4(1.)).r;}vec3 P(){return emissiveFactor*e(x(emissiveTexture,vec4(0.)).rgb);}\n#define LIGHT_DIRECTIONAL 0\n#define LIGHT_POINT 1\n#define LIGHT_SPOT 2\nint Q(mat4 R){return int(R[0].x);}vec2 S(mat4 R){return R[0].yz;}vec4 T(mat4 R){return R[1];}float U(mat4 R){return R[2].w;}vec3 V(mat4 R){return R[2].xyz;}vec3 W(mat4 R){return R[3].xyz;}float X(float Y,float Z){if(Y<=0.){return 1./pow(Z,2.);}return max(min(1.0-pow(Z/Y,4.),1.),0.)/pow(Z,2.);}float ba(vec3 bb,vec3 bc,vec2 bd){float be=dot(normalize(bc),normalize(-bb));float scale=1./max(.001,bd[0]-bd[1]);float bf=-bd[1]*scale;float bg=clamp(be*scale+bf,0.,1.);return bg*bg;}vec3 bh(mat4 R,vec3 bi){return Q(R)!=LIGHT_DIRECTIONAL?W(R)-bi:-V(R);}vec3 bj(mat4 R,vec3 bb){vec4 d=T(R);vec3 bk=d.rgb*d.a;if(Q(R)!=LIGHT_DIRECTIONAL){bk*=X(U(R),length(bb));}if(Q(R)==LIGHT_SPOT){bk*=ba(bb,V(R),S(R));}return bk;}void main(){vec4 L=K();\n#ifdef ALPHAMODE_OPAQUE\nL.a=1.;\n#endif\n#ifdef MATERIAL_UNLIT\ngl_FragColor=(vec4(c(L.rgb),L.a));return;\n#endif\nvec3 D=normalize(cameraPosition-vPosition);z bl=C(vPosition);vec3 B=bl.B;vec3 bm=-normalize(reflect(D,B));float q=clamp(abs(dot(B,D)),0.001,1.);vec2 bn=M();float bo=bn[0];float bp=bn[1];float bq=bp*bp;float l=bq*bq;vec3 br=vec3(0.04);vec3 bs=L.rgb*(vec3(1.)-br)*(1.-bo);vec3 bt=mix(br,L.rgb,bo);float h=max(max(bt.r,bt.g),bt.b);float i=clamp(h*25.,0.,1.);vec3 bu=bt.rgb;vec3 bv=vec3(1.,1.,1.)*i;vec3 bw=vec3(0.);vec3 bx=vec3(0.);\n#define NUM_LIGHTS 4\nmat4 by[4];by[0]=mat4(0.,0.,0.,0.,1.,1.,1.,1.,.5,-.707,-.5,0.,0.,0.,0.,0.);by[1]=mat4(0.,0.,0.,0.,1.,1.,1.,.5,-.5,.707,.5,0.,0.,0.,0.,0.);by[2]=mat4(0.,0.,0.,0.,1.,1.,1.,.25,.5,.707,-.5,0.,0.,0.,0.,0.);by[3]=mat4(0.,0.,0.,0.,1.,1.,1.,.25,-.5,-.707,.5,0.,0.,0.,0.,0.);\n#ifdef NUM_LIGHTS\nfor(int bz=0;bz<NUM_LIGHTS;++bz){vec3 bb=bh(by[bz],vPosition);vec3 bk=bj(by[bz],bb);vec3 bA=normalize(bb);vec3 bB=normalize(bA+D);float p=clamp(dot(B,bA),0.001,1.);float m=clamp(dot(B,bB),0.,1.);float j=clamp(dot(D,bB),0.,1.);vec3 bC=g(bu,bv,j);vec3 bD=(1.-bC)*u(bs);vec3 bE=max(vec3(0.),bC*t(l,p,q,m));bw+=bk*p*bD;bx+=bk*p*bE;}\n#endif\nvec4 bF=vec4(.1);vec3 bG=bF.rgb*u(bs);bw+=bG;vec3 bH=bw+bx;float bI=O();bH=mix(bH,bH*bI,occlusionTexture.scale);vec3 bJ=P();bH+=bJ;\n#ifdef ALPHAMODE_MASK\nif(L.a<alphaCutoff){discard;}L.a=1.;\n#else\nalphaCutoff;\n#endif\ngl_FragColor=vec4(c(bH),L.a);}"});return f=p(n).pipeline=E[N]=e.pipeline({vert:I,frag:w,buffers:b,indexFormat:O,mode:s,depth:{compare:515,write:!("BLEND"===c)},blend:"BLEND"===c?{srcFactorRGB:770,dstFactorRGB:771,srcFactorAlpha:1,dstFactorAlpha:771}:void 0,raster:{cullMode:u?0:1029},uniforms:[{name:"model",type:1,valueFormat:_},{name:"viewProj",type:1,valueFormat:_},{name:"normalMatrix",type:1,valueFormat:35675},{name:"cameraPosition",type:1,valueFormat:35665},{name:"alphaCutoff",type:1,valueFormat:T},{name:"baseColorFactor",type:1,valueFormat:35666},{name:"baseColorTexture.tex",type:2,texType:m},{name:"baseColorTexture.texCoord",type:1,valueFormat:T},{name:"metallicFactor",type:1,valueFormat:T},{name:"roughnessFactor",type:1,valueFormat:T},{name:"metallicRoughnessTexture.tex",type:2,texType:m},{name:"metallicRoughnessTexture.texCoord",type:1,valueFormat:T},{name:"normalTexture.tex",type:2,texType:m},{name:"normalTexture.texCoord",type:1,valueFormat:T},{name:"normalTexture.scale",type:1,valueFormat:T},{name:"emissiveFactor",type:1,valueFormat:35665},{name:"emissiveTexture.tex",type:2,texType:m},{name:"emissiveTexture.texCoord",type:1,valueFormat:T},{name:"occlusionTexture.tex",type:2,texType:m},{name:"occlusionTexture.texCoord",type:1,valueFormat:T},{name:"occlusionTexture.scale",type:1,valueFormat:T},...A]}),I.destroy(),w.destroy(),f}(e,n,s,E);t.pipeline(A).uniforms(S);for(let r=0;r<A.props.buffers.length;++r){const i=A.props.buffers[r].attrs[0].name,o=F.exec(i),a=D(e,n,o?s.targets[o[2]][o[1]]:s.attributes[i],34962);a&&t.vertex(r,a)}const I=null===(v=n.accessors)||void 0===v?void 0:v[s.indices];if(I){const r=D(e,n,s.indices,34963);r&&(t.index(r),g=I.count,O=p(I).byteOffset||0,b=!0)}b?t.drawIndexed(g,1,O):t.draw(g)}function W(e,t,n){var r;const i={alphaCutoff:.5,baseColorFactor:[1,1,1,1],"baseColorTexture.tex":H(e,t),"baseColorTexture.texCoord":-1,metallicFactor:1,roughnessFactor:1,"metallicRoughnessTexture.tex":H(e,t),"metallicRoughnessTexture.texCoord":-1,"normalTexture.tex":H(e,t),"normalTexture.texCoord":-1,"normalTexture.scale":1,emissiveFactor:[0,0,0],"emissiveTexture.tex":H(e,t),"emissiveTexture.texCoord":-1,"occlusionTexture.tex":H(e,t),"occlusionTexture.texCoord":-1,"occlusionTexture.scale":0};function o(n,r,o=null){var a;n[r]&&(i[`${r}.tex`]=function(e,t,n){var r,i,o,a,f;const s=null===(r=t.textures)||void 0===r?void 0:r[n];if(!s)return H(e,t);let l=p(s).texture;if(l)return l;let c=null;const u={wrapU:10497,wrapV:10497,magFilter:9729,minFilter:9729},d=null===(i=t.images)||void 0===i?void 0:i[s.source];d&&(c=d.extras.image);const v=null===(o=t.samplers)||void 0===o?void 0:o[s.sampler];if(v)switch(u.wrapU=v.wrapS||u.wrapU,u.wrapV=v.wrapT||u.wrapV,u.magFilter=v.magFilter||u.magFilter,v.minFilter){case 9728:case 9984:case 9986:u.minFilter=9728}return l=p(s).texture=e.texture({width:(null===(a=c)||void 0===a?void 0:a.naturalWidth)||1,height:(null===(f=c)||void 0===f?void 0:f.naturalHeight)||1},u),l.data(c?{image:c}:{buffer:new Uint8Array([255,255,255,255])}),l}(e,t,n[r].index),i[`${r}.texCoord`]=n[r].texCoord||0,o&&(i[`${r}.scale`]=null!==(a=n[r][o])&&void 0!==a?a:i[`${r}.scale`]))}const a=null===(r=t.materials)||void 0===r?void 0:r[n];if(a){var f;if(a.pbrMetallicRoughness){const e=a.pbrMetallicRoughness;i.baseColorFactor=e.baseColorFactor||i.baseColorFactor,(e.metallicFactor||0===e.metallicFactor)&&(i.metallicFactor=e.metallicFactor),(e.roughnessFactor||0===e.roughnessFactor)&&(i.roughnessFactor=e.roughnessFactor),o(e,"baseColorTexture"),o(e,"metallicRoughnessTexture")}i.alphaCutoff=null!==(f=a.alphaCutoff)&&void 0!==f?f:i.alphaCutoff,i.emissiveFactor=a.emissiveFactor||i.emissiveFactor,o(a,"emissiveTexture"),o(a,"occlusionTexture","strength"),o(a,"normalTexture","scale")}return i}function D(e,t,n,r){var i,o;const a=null===(i=t.accessors)||void 0===i?void 0:i[n];if(!a)return null;const f=34963===r&&a.componentType===d;if(a.sparse||f){let n=p(a).gpuBuffer;if(!n){const i=x(t,a);let o=i.buffer;if(f){const e=new Uint16Array(o.byteLength);for(let t=0;t<o.byteLength;++t)e[t]=o[i.byteOffset+t];o=p(a).buffer=new Uint8Array(e.buffer,0,e.byteLength),p(a).byteOffset=0}n=p(a).gpuBuffer=e.buffer({type:r,size:o.byteLength}).data(o)}return n}const s=null===(o=t.bufferViews)||void 0===o?void 0:o[a.bufferView];if(!s)return null;const l=p(s).gpuBuffers=p(s).gpuBuffers||{},c=x(t,a).buffer,u=`${c.byteOffset},${c.byteLength}`;return l[u]?l[u]:l[u]=e.buffer({type:s.target||r,size:c.byteLength}).data(c)}function H(e,t){let n=p(t).blankTexture;return n||(n=p(t).blankTexture=e.texture({}).data({buffer:new Uint8Array([255,255,255,255])}),n)}function k(e){return(new TextDecoder).decode(e)}function V(e){return/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)}function J(e,t){return""===e?"":/^(https?:)?\/\//i.test(e)||V(e)?e:t+e}const $=1179937895;async function q(e,t=X){const n=e.uri?function(e){if(V(e))return"";const t=e.split(/[?#]/)[0].split("/");return t.pop(),t.length?t.join("/")+"/":""}(e.uri):"";let r=e.glTF,i=e.binaryChunk;if(!r&&e.uri){const n=await t(e.uri,"bin");if(o=n,new DataView(o.buffer||o,o.byteOffset||0,4).getUint32(0,!0)===$){const e=function(e){let t,n;const r=e.buffer||e,i=e.byteOffset||0,o=new DataView(r,i,12);if(o.getUint32(0,!0)!==$)throw new Error("Invalid GLB format");const a=o.getUint32(4,!0);if(2!==a)throw new Error("Unsupported GLB version: "+a);const f=new DataView(r,i+12);let s=0;for(;s<f.byteLength;){const e=f.getUint32(s,!0),o=f.getUint32(s+4,!0);if(s+=8,1313821514===o){const n=new Uint8Array(r,i+12+s,e);t=JSON.parse(k(n))}else 5130562===o&&(n=new Uint8Array(r,i+12+s,e));s+=e}if(!t)throw new Error("Invalid GLB format: missing JSON content");if(!t.asset||"2.0"!==t.asset.minVersion&&"2.0"!==t.asset.version)throw new Error("Unsupported glTF version: 2.0 required");return{glTF:t,binaryChunk:n}}(n);r=e.glTF,i=e.binaryChunk}else r=JSON.parse(k(n))}var o;if(!r)throw new Error("Failed to load glTF JSON");const a=await async function(e,t,n,r){if(e.buffers)for(let i=0;i<e.buffers.length;++i){const o=e.buffers[i];if(p(o).buffer)continue;let a;const f=o.uri;if(f)a=await n(J(f,r),"bin");else{if(0!==i||!t)throw new Error("Invalid glTF: missing uri for buffer "+i);a=t}p(o).buffer=a}return e}(r,i,t,n);return await async function(e,t,n){if(e.images)for(let i=0;i<e.images.length;++i){const o=e.images[i];if(p(o).image)continue;const a=o.bufferView;let f,s=!1,l=o.uri;if(a){var r;const t=null===(r=e.bufferViews)||void 0===r?void 0:r[a];if(!t)throw new Error("Invalid glTF: invalid bufferView for image "+i);const n=new Blob([E(e,t)],{type:o.mimeType});l=URL.createObjectURL(n),s=!0}if(!l)throw new Error("Invalid glTF: missing uri or bufferView for image "+i);try{f=await t(J(l,n),"img")}finally{s&&URL.revokeObjectURL(l)}p(o).image=f}return e}(a,t,n)}function X(e,t){return"img"===t?new Promise(((t,n)=>{const r=new Image;r.crossOrigin="anonymous",r.onerror=()=>n(new Error("Failed to load: "+e)),r.onload=()=>t(r),r.src=e})):fetch(e).then((e=>e.arrayBuffer())).then((e=>new Uint8Array(e)))}return t})()},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mugltf",[],t):"object"==typeof exports?exports.mugltf=t():e.mugltf=t();