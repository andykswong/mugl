var e,t;e=self,t=()=>(()=>{var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{begin_default_pass:()=>Tt,begin_render_pass:()=>Ut,copy_buffer:()=>Mt,copy_external_image_to_texture:()=>kt,copy_texture:()=>Dt,copy_texture_to_buffer:()=>Pt,create_bind_group:()=>St,create_bind_group_layout:()=>_t,create_buffer:()=>mt,create_image:()=>at,create_render_pass:()=>wt,create_render_pipeline:()=>vt,create_sampler:()=>xt,create_shader:()=>Ft,create_texture:()=>yt,delete_bind_group:()=>$e,delete_bind_group_layout:()=>$e,delete_buffer:()=>$e,delete_device:()=>dt,delete_image:()=>st,delete_render_pass:()=>$e,delete_render_pipeline:()=>$e,delete_sampler:()=>$e,delete_shader:()=>$e,delete_texture:()=>$e,draw:()=>It,draw_indexed:()=>Et,free_context:()=>tt,get_canvas_by_id:()=>ot,get_canvas_height:()=>ut,get_canvas_width:()=>ct,get_device_features:()=>bt,get_future_status:()=>rt,get_image_by_id:()=>nt,get_image_height:()=>it,get_image_width:()=>lt,is_device_lost:()=>ht,read_buffer:()=>Ct,reset_device:()=>pt,set_bind_group:()=>zt,set_blend_const:()=>Gt,set_context_memory:()=>et,set_index:()=>Wt,set_render_pipeline:()=>Lt,set_scissor_rect:()=>jt,set_stencil_ref:()=>Vt,set_vertex:()=>Rt,set_viewport:()=>Nt,submit_render_pass:()=>At,webgl_generate_mipmap:()=>gt,webgl_request_device:()=>ft,write_buffer:()=>Bt,write_texture:()=>Ot});const r=16384,a=1028,n=1029,s=3089,l=5123,i=5124,o=5125,c=5126,u=7680,f=9728,g=34067,p=34069,d=33984,h=33071,b=36160,m=36161,y=33189,x=36064,F=36096,_=33306,S=3315,v=6144,w=32856,C=32857,B=33190,M=35907,O=34836,k=34842,D=35898,P=36208,U=36214,T=36220,A=36226,L=36232,W=36238,R=36012,z=36013,I=35056,E=33321,N=33323,j=33325,G=33326,V=33327,q=33328,H=33329,X=33330,Y=33331,J=33332,K=33333,Q=33334,Z=33335,$=33336,ee=33337,te=33338,re=33339,ae=33340,ne=36756,se=36757,le=36759,ie={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float"};function oe(e){return 32879===e||35866===e}function ce(e){return 15&e}function ue(e){switch(e>>4&511){case 36:return c;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return l;case 17:return 5121}return 0}function fe(e){return!!(e>>13)}function ge(e){switch(e){case E:case ne:case j:case G:return 6403;case X:case H:case J:case Y:case Q:case K:return 36244;case N:case se:case V:case q:return 33319;case $:case Z:case te:case ee:case ae:case re:return 33320;case w:case M:case le:case C:case k:case O:return 6408;case T:case W:case U:case P:case L:case A:return 36249;case D:return 6407;case y:case B:case R:return 6402;case I:case z:return 34041}return 0}function pe(e){switch(e){case E:case X:case ne:case H:return 1;case J:case Y:case N:case $:case se:case Z:case j:return 2;case Q:case K:case G:case te:case ee:case V:case w:case M:case T:case le:case W:case C:case D:return 4;case ae:case re:case q:case U:case L:case k:return 8;case P:case A:case O:return 16;case y:return 2;case B:case I:case R:return 4;case z:return 8}return 0}function de(e){switch(e){case E:case X:case N:case $:case w:case M:case T:return 5121;case ne:case H:case se:case Z:case le:case W:return 5120;case J:case te:case U:return l;case Y:case ee:case L:return 5122;case Q:case ae:case P:return o;case K:case re:case A:return i;case C:return 33640;case j:case V:case k:return 5131;case G:case q:case O:return c;case D:return 35899;case y:return l;case B:return o;case I:return 34042;case R:return c;case z:return 36269}return 0}function he(e){switch(e){case H:case Y:case K:case Z:case ee:case re:case W:case L:case A:return i;case X:case J:case Q:case $:case te:case ae:case T:case U:case P:return o}return c}const be=255,me=4294967295;let ye=null;function xe(e){const t=ve();e.blendColor(1,1,1,1),we(e,t,t,0,!0);for(let t=0;t<16;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function Fe(e,t,{texture:r,slice:a=0,mipLevel:n=0}){if(oe(r.type))e.framebufferTextureLayer(b,t,r.glt,n,a);else{const s=r.type===g?p+a:r.type;e.framebufferTexture2D(b,t,s,r.glt,n)}}function _e(e,t,r){const a=e.createFramebuffer();return e.bindFramebuffer(b,a),Fe(e,t,r),a}function Se(e,t,r,a,n,s=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,r),e.readBuffer(s),e.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,n,f)}function ve(e={}){const t=e.primitive||{},r=e.depthStencil||{},{stencilFront:a={},stencilBack:n={}}=r,{sampleCount:s=1,alphaToCoverage:i=!1}=e.multisample||{},o=e.targets||{};let c=o.writeMask||15,f=o.blendColor||{},g=o.blendColor||{};return o.targets&&o.targets[0]&&(c=o.targets[0].writeMask||c,f=o.targets[0].blendColor||f,g=o.targets[0].blendAlpha||g),{sampleCount:s,alphaToCoverage:i,topology:t.topology||4,indexFormat:t.indexFormat||l,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:r.depthWrite||!1,depthFormat:r.format||y,depthCompare:r.depthCompare||519,depthBias:r.depthBias||0,depthBiasSlopeScale:r.depthBiasSlopeScale||0,stencil:!(!r.stencilFront&&!r.stencilBack),stencilFrontCompare:a.compare||519,stencilFrontFailOp:a.failOp||u,stencilFrontDepthFailOp:a.depthFailOp||u,stencilFrontPassOp:a.passOp||u,stencilBackCompare:n.compare||519,stencilBackFailOp:n.failOp||u,stencilBackDepthFailOp:n.depthFailOp||u,stencilBackPassOp:n.passOp||u,stencilReadMask:r.stencilReadMask||me,stencilWriteMask:r.stencilWriteMask||me,blend:!!e.targets,blendWriteMask:c,blendColorOp:f.operation||32774,blendColorSrcFactor:f.srcFactor||1,blendColorDstFactor:f.dstFactor||0,blendAlphaOp:g.operation||32774,blendAlphaSrcFactor:g.srcFactor||1,blendAlphaDstFactor:g.dstFactor||0}}function we(e,t,r,s=0,l=!1){let i=!1,o=0,c=0,u=0,f=0;o=r.frontFace,(l||t.frontFace!==o)&&e.frontFace(o),o=r.cullMode,(l||t.cullMode!==o)&&((i=0!==o)&&e.cullFace(o),Oe(e,2884,i)),i=r.alphaToCoverage,(l||t.alphaToCoverage!==i)&&Oe(e,32926,i),i=!!r.depth,(l||t.depth!==i)&&Oe(e,2929,i),(l||i)&&(Be(e,t.depthWrite,r.depthWrite,l),o=r.depthCompare,(l||t.depthCompare!==o)&&e.depthFunc(o)),o=r.depthBiasSlopeScale,c=r.depthBias,(l||t.depthBiasSlopeScale!==o||t.depthBias!==c)&&(Oe(e,32823,!(!o&&!c)),e.polygonOffset(o,c)),i=!!r.stencil,(l||t.stencil!==i)&&Oe(e,2960,i),(l||i)&&(o=r.stencilReadMask,i=l||t.stencilReadMask!==o,c=r.stencilFrontCompare,(i||t.stencilFrontCompare!==c)&&e.stencilFuncSeparate(a,c,s,o),c=r.stencilBackCompare,(i||t.stencilBackCompare!==c)&&e.stencilFuncSeparate(n,c,s,o),o=r.stencilFrontFailOp,c=r.stencilFrontDepthFailOp,u=r.stencilFrontPassOp,(l||t.stencilFrontFailOp!==o||t.stencilFrontDepthFailOp!==c||t.stencilFrontPassOp!==u)&&e.stencilOpSeparate(a,o,c,u),o=r.stencilBackFailOp,c=r.stencilBackDepthFailOp,u=r.stencilBackPassOp,(l||t.stencilBackFailOp!==o||t.stencilBackDepthFailOp!==c||t.stencilBackPassOp!==u)&&e.stencilOpSeparate(n,o,c,u),Me(e,t.stencilWriteMask,r.stencilWriteMask,l)),i=r.blend,(l||t.blend!==i)&&Oe(e,3042,i),(l||i)&&(o=r.blendColorSrcFactor,c=r.blendColorDstFactor,u=r.blendAlphaSrcFactor,f=r.blendAlphaDstFactor,(l||t.blendColorSrcFactor!==o||t.blendColorDstFactor!==c||t.blendAlphaSrcFactor!==u||t.blendAlphaDstFactor!==f)&&e.blendFuncSeparate(o,c,u,f),o=r.blendColorOp,c=r.blendAlphaOp,(l||t.blendColorOp!==o||t.blendAlphaOp!==c)&&e.blendEquationSeparate(o,c),Ce(e,t.blendWriteMask,r.blendWriteMask,l))}function Ce(e,t,r,a=!1){(a||t!==r)&&e.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))}function Be(e,t,r,a=!1){(a||t!==r)&&e.depthMask(r)}function Me(e,t,r,a=!1){(a||t!==r)&&e.stencilMask(r)}function Oe(e,t,r){r?e.enable(t):e.disable(t)}function ke(e,t,r){e.bindBuffer(34962,t.glb);for(let a=0;a<t.attributes.length;++a){const{ptr:n,step:s}=t.attributes[a],l=[...n];l[5]+=r,e.vertexAttribPointer(...l),e.vertexAttribDivisor(n[0],s)}}ye=new FinalizationRegistry((({finalizer:e,gl:t})=>{e(t)}));const De=2097151,Pe=2**32;function Ue(e,t){return(t&De)*Pe+(e>>>0)}function Te(e){return e>>>0}let Ae,Le;Ae=Symbol.iterator;class We{constructor(){this.generations=[],this.freeList=[]}get size(){return this.generations.length-this.freeList.length}clear(){this.generations.length=0,this.freeList.length=0}create(){let e,t;return this.freeList.length>0?(e=this.freeList.pop(),t=Math.abs(this.generations[e]),this.generations[e]=t):(e=this.generations.length,t=e?0:1,this.generations.push(t)),Ue(e,t)}delete(e){if(!this.has(e))return!1;const t=Te(e);let r=-(this.generations[t]+1&De);return t||r||++r,this.generations[t]=r,this.freeList.push(t),!0}forEach(e,t){let r=0;for(const a of this.values())e.call(t,a,r,this),r+=1}has(e){return Te(e)<this.generations.length&&function(e){return e/Pe&De}(e)===this.generations[Te(e)]}*values(){for(let e=0;e<this.generations.length;++e){const t=this.generations[e];this.generations[e]>=0&&(yield Ue(e,t))}}[Ae](){return this.values()}}Le=Symbol.iterator;class Re{constructor(){this.allocator=new We,this.data=[]}add(e){const t=this.allocator.create();return this.data[Te(t)]=e,t}clear(){this.allocator.clear(),this.data.length=0}delete(e){return!!this.allocator.delete(e)&&(delete this.data[Te(e)],!0)}*entries(){for(const e of this.allocator.values())yield[e,this.data[Te(e)]]}forEach(e,t){this.allocator.forEach((r=>{e.call(t,this.data[Te(r)],r,this)}),t)}get(e){return this.has(e)?this.data[Te(e)]:void 0}has(e){return this.allocator.has(e)}keys(){return this.allocator.values()}*values(){for(const e of this.allocator.values())yield this.data[Te(e)]}[Le](){return this.entries()}}const ze=new TextDecoder("utf-8");let Ie=new DataView(new ArrayBuffer(0));function Ee(e){return Ie.buffer!==e.buffer&&(Ie=new DataView(e.buffer)),Ie}function Ne(e,t,r){return ze.decode(new Uint8Array(e.buffer,t,r))}const je={},Ge=new Re,Ve=new Re,qe={},He=new Re,Xe={},Ye={},Je=new Re,Ke={};function Qe(e){return je[e].memory}function Ze(e){return Qe(Ke[e])}function $e(e){const t=Je.get(e);t&&(t.destroy(),Je.delete(e))}function et(e,t){(je[e]=je[e]||{memory:null}).memory=t}function tt(e){delete je[e]}function rt(e){const t=Ge.get(e);return t?(0!==t.status&&Ge.delete(e),t.status):1}function at(e,t,r){const a=new Image;return a.crossOrigin="anonymous",a.src=Ne(Qe(e),t,r),Ve.add(a)}function nt(e,t,r){const a=Ne(Qe(e),t,r);if(qe[a])return qe[a];const n=document.getElementById(a);return n?qe[a]=Ve.add(n):0}function st(e){Ve.delete(e)}function lt(e){var t;return(null===(t=Ve.get(e))||void 0===t?void 0:t.width)||0}function it(e){var t;return(null===(t=Ve.get(e))||void 0===t?void 0:t.height)||0}function ot(e,t,r){const a=Ne(Qe(e),t,r);if(Xe[a])return Xe[a];const n=document.getElementById(a);if(!n)return 0;const s=Xe[a]=He.add(n);return Ye[s]=e,s}function ct(e){var t;return(null===(t=He.get(e))||void 0===t?void 0:t.width)||0}function ut(e){var t;return(null===(t=He.get(e))||void 0===t?void 0:t.height)||0}function ft(e,t,r){const a=He.get(e);if(a){const s=function(e,t={},r=0){const a=e.getContext("webgl2",t);if(a){let t=0;for(const e in ie)r&+e&&a.getExtension(ie[+e])&&(t|=+e);const n=xe(a),s=e=>{e.deleteFramebuffer(n.copyFrameBuffer)},l={canvas:e,gl:a,state:n,features:t,pass:null,destroy(){s(this.gl)}};return ye.register(l,{finalizer:s,gl:a}),l}return null}(a,{alpha:!!(1&(n=t)),antialias:!!(2&n),depth:!!(4&n),desynchronized:!!(8&n),failIfMajorPerformanceCaveat:!!(16&n),powerPreference:32&n?"high-performance":"low-power",premultipliedAlpha:!!(64&n),preserveDrawingBuffer:!!(128&n),stencil:!!(256&n)},r);if(s){const t=Je.add(s);return Ke[t]=Ye[e],t}}var n;return 0}function gt(e,t,r){!function(e,t,r=4352){e.gl.activeTexture(d),e.gl.bindTexture(t.type,t.glt),e.gl.hint(33170,r),e.gl.generateMipmap(t.type)}(Je.get(e),Je.get(t),r)}function pt(e){!function(e){e.destroy(),Object.assign(e.state,xe(e.gl))}(Je.get(e))}function dt(e){$e(e),delete Ke[e]}function ht(e){return function(e){return e.gl.isContextLost()}(Je.get(e))}function bt(e){return function(e){return e.features}(Je.get(e))}function mt(e,t,r){const a=function(e,t){const r=64&t.usage?35345:16&t.usage?34963:34962,a=8192&t.usage?35040:4096&t.usage?35048:35044,n=e.gl.createBuffer();e.gl.bindBuffer(r,n),e.gl.bufferData(r,t.size,a);const s=e=>{e.deleteBuffer(n)},l={gl:e.gl,glb:n,type:r,size:t.size,destroy(){s(this.gl)}};return ye.register(l,{finalizer:s,gl:e.gl}),l}(Je.get(e),{size:t>>>0,usage:r>>>0});return Je.add(a)}function yt(e,t,r,a,n,s,l,i,o){const c=function(e,t){const r=t.sampleCount||1,a=t.dimension||3553,n=t.format||w,s=!function(e){switch(e){case y:case B:case I:case R:case z:return!0}return!1}(n)||4&(t.usage||0),[l,i,o]=t.size||[1,1,1],c=a===g?6:3553===a?1:o;let u=null,f=null;(r>1||!s)&&(f=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(m,f),r>1?e.gl.renderbufferStorageMultisample(m,r,n,l,i):e.gl.renderbufferStorage(m,n,l,i)),s&&(u=e.gl.createTexture(),e.gl.activeTexture(d),e.gl.bindTexture(a,u),oe(a)?e.gl.texStorage3D(a,t.mipLevelCount||1,n,l,i,c):e.gl.texStorage2D(a,t.mipLevelCount||1,n,l,i));const p=e=>{e.deleteTexture(u),e.deleteRenderbuffer(f)},h={gl:e.gl,glt:u,glrb:f,type:a,format:n,width:l,height:i,depth:c,samples:r,destroy(){p(this.gl)}};return ye.register(h,{finalizer:p,gl:e.gl}),h}(Je.get(e),{size:[t>>>0,r>>>0,a>>>0],mipLevelCount:n>>>0,sampleCount:s>>>0,dimension:l>>>0,format:i>>>0,usage:o>>>0});return Je.add(c)}function xt(e,t,r,a,n,s,l,i,o,c,u){const g=function(e,t={}){const r=e.gl.createSampler();let a=t.minFilter||f;t.mipmapFilter&&(a=t.mipmapFilter===f?a===f?9984:9985:a===f?9986:9987),e.gl.samplerParameteri(r,10241,a),e.gl.samplerParameteri(r,10240,t.magFilter||f),e.gl.samplerParameteri(r,10242,t.addressModeU||h),e.gl.samplerParameteri(r,10243,t.addressModeV||h),e.gl.samplerParameteri(r,32882,t.addressModeW||h),e.gl.samplerParameterf(r,33083,t.lodMaxClamp||32),e.gl.samplerParameterf(r,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(r,34892,34894),e.gl.samplerParameterf(r,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(r,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047)));const n=e=>{e.deleteSampler(r)},s={gls:r,gl:e.gl,destroy(){n(this.gl)}};return ye.register(s,{finalizer:n,gl:e.gl}),s}(Je.get(e),{addressModeU:t>>>0,addressModeV:r>>>0,addressModeW:a>>>0,magFilter:n>>>0,minFilter:s>>>0,mipmapFilter:l>>>0,lodMinClamp:i,lodMaxClamp:o,compare:c>>>0,maxAnisotropy:u>>>0});return Je.add(g)}function Ft(e,t,r,a){const n=function(e,t){const r=1===t.usage?35633:35632,a=e.gl.createShader(r);e.gl.shaderSource(a,t.code),e.gl.compileShader(a);const n=e=>{e.deleteShader(a)},s={gl:e.gl,gls:a,destroy(){n(this.gl)}};return ye.register(s,{finalizer:n,gl:e.gl}),s}(Je.get(e),{code:Ne(Ze(e),t,r),usage:a>>>0});return Je.add(n)}function _t(e,t,r){const a=Ze(e),n=[];for(let e=0;e<r;e++){const r=t+32*e,s=Ee(a).getUint32(r+0,!0),l=Ee(a).getUint32(r+4,!0),i=Ee(a).getUint8(r+16);let o=!1,c=0,u=0,f=3553,g=!1;switch(i){case 0:o=!!Ee(a).getUint8(r+20);break;case 1:c=Ee(a).getUint32(r+20,!0)>>>0;break;case 2:u=Ee(a).getUint32(r+20,!0)>>>0,f=Ee(a).getUint32(r+24,!0)>>>0,g=!!Ee(a).getUint8(r+28);break;default:throw new RangeError("invalid variant discriminant for BindingType")}n.push({label:Ne(a,s,l),binding:Ee(a).getUint32(r+8,!0)>>>0,visibility:Ee(a).getUint32(r+12,!0)>>>0,type:i,bufferDynamicOffset:o,samplerType:c,textureSampleType:u,textureDimension:f,textureMultisampled:g})}const s=(Je.get(e),{entries:{entries:n}.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}});return Je.add(s)}function St(e,t,r,a){const n=Ze(e),s=[];for(let e=0;e<a;e++){const t=r+24*e;let a=null,l=0,i=0,o=null,c=null;switch(Ee(n).getUint8(t+4)){case 0:a=Je.get(Ee(n).getFloat64(t+8,!0)),l=Ee(n).getUint32(t+16,!0),i=Ee(n).getUint32(t+20,!0);break;case 1:o=Je.get(Ee(n).getFloat64(t+8,!0));break;case 2:c=Je.get(Ee(n).getFloat64(t+8,!0));break;default:throw new RangeError("invalid variant discriminant for BindingResource")}s.push({binding:Ee(n).getUint32(t+0,!0),buffer:a,bufferOffset:l,bufferSize:i,sampler:o,texture:c})}const l=(Je.get(e),{entries:{layout:Je.get(t),entries:s}.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}});return Je.add(l)}function vt(e,t,r,a,n,s,l,i,o,c,u,f,g,p,d,h,b,m,y,x,F,_,S,v,w,C,B,M,O,k,D,P,U,T,A,L,W,R,z,I,E){const N=Ze(e),j=[];for(let e=0;e<n;e++){const t=a+12*e;j.push({format:Ee(N).getUint32(t+0,!0),offset:Ee(N).getUint32(t+4,!0),shaderLocation:Ee(N).getUint32(t+8,!0)})}const G=[];for(let e=0;e<l;e++){const t=s+16*e,r=Ee(N).getUint32(t+0,!0),a=Ee(N).getUint32(t+4,!0);G.push({attributes:j.slice(r,r+a),stride:Ee(N).getUint32(t+8,!0),stepMode:Ee(N).getUint32(t+12,!0)})}const V=[];for(let e=0;e<o;e++){const t=i+8*e;V.push(Je.get(Ee(N).getFloat64(t+0,!0)))}const q=[];for(let e=0;e<T;e++){const t=U+32*e;q.push({format:Ee(N).getUint32(t+0,!0)>>>0,writeMask:Ee(N).getUint32(t+4,!0)>>>0,blendColor:{operation:Ee(N).getUint32(t+8,!0)>>>0,srcFactor:Ee(N).getUint32(t+12,!0)>>>0,dstFactor:Ee(N).getUint32(t+16,!0)>>>0},blendAlpha:{operation:Ee(N).getUint32(t+20,!0)>>>0,srcFactor:Ee(N).getUint32(t+24,!0)>>>0,dstFactor:Ee(N).getUint32(t+28,!0)>>>0}})}const H=function(e,t){const r=function(e,t,r){const a=e.gl.createProgram();return e.gl.attachShader(a,t),e.gl.attachShader(a,r),e.gl.linkProgram(a),a}(e,t.vertex.gls,t.fragment.gls),a=[],n={};let s=0,l=0;if(t.bindGroups){for(let i=0;i<t.bindGroups.length;++i){const o=t.bindGroups[i].entries;a.push([]);for(let t=0;t<o.length;++t){const c=o[t];let u=null,f=4294967295;0===c.type?(f=e.gl.getUniformBlockIndex(r,c.label),e.gl.uniformBlockBinding(r,f,s++)):2===c.type&&(u=e.gl.getUniformLocation(r,c.label),n[c.label]=l++),a[i][c.binding]={...c,loc:u,index:f,slot:0===c.type?s-1:2===c.type?l-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const r=t.bindGroups[e].entries;for(let t=0;t<r.length;++t)1===r[t].type&&n[r[t].label]&&(a[e][r[t].binding].slot=n[r[t].label])}}const i=e=>{e.deleteProgram(r)},o={gl:e.gl,glp:r,buffers:t.buffers,cache:a,state:ve(t),destroy(){i(this.gl)}};return ye.register(o,{finalizer:i,gl:e.gl}),o}(Je.get(e),{vertex:Je.get(t),fragment:Je.get(r),buffers:G,bindGroups:V,primitive:{topology:c>>>0,indexFormat:u>>>0,frontFace:f>>>0,cullMode:g>>>0},multisample:{sampleCount:p>>>0,alphaToCoverage:!!d},depthStencil:h?{format:b>>>0,depthWrite:!!m,depthCompare:y>>>0,stencilFront:{compare:x>>>0,failOp:F>>>0,depthFailOp:_>>>0,passOp:S>>>0},stencilBack:{compare:v>>>0,failOp:w>>>0,depthFailOp:C>>>0,passOp:B>>>0},stencilReadMask:M>>>0,stencilWriteMask:O>>>0,depthBias:k,depthBiasSlopeScale:D,depthBiasClamp:P}:null,targets:{writeMask:A>>>0,blendColor:{operation:L>>>0,srcFactor:W>>>0,dstFactor:R>>>0},blendAlpha:{operation:z>>>0,srcFactor:I>>>0,dstFactor:E>>>0},targets:q}});return Je.add(H)}function wt(e,t,r,a,n,s,l,i,o,c,u,f,g){const p=Ze(e);let d;switch(i){case 0:d={clearDepth:t,clearStencil:r,clearColor:isNaN(a)?null:[a,n,s,l]};break;case 1:{const e=[];for(let t=0;t<g;t++){const r=f+32*t,a=[Ee(p).getFloat32(r+16,!0),Ee(p).getFloat32(r+20,!0),Ee(p).getFloat32(r+24,!0),Ee(p).getFloat32(r+28,!0)];e.push({view:{texture:Je.get(Ee(p).getFloat64(r+0,!0)),mipLevel:Ee(p).getUint32(r+8,!0),slice:Ee(p).getUint32(r+12,!0)},clear:isNaN(a[0])?null:a})}d={clearDepth:t,clearStencil:r,colors:e,depthStencil:{texture:Je.get(o),mipLevel:c>>>0,slice:u>>>0}};break}default:throw new RangeError("invalid variant discriminant for RenderPassDescriptor")}const h=function(e,t={}){let r=null;const a=[],n=t.depthStencil?t.depthStencil.texture:null,s=n&&function(e){switch(e){case 36168:case I:case z:return!0}return!1}(n.format)||!1;if(t.colors&&t.colors.length){r=e.gl.createFramebuffer(),e.gl.bindFramebuffer(b,r);for(let r=0;r<t.colors.length;++r)t.colors[r].view.texture.samples>1?e.gl.framebufferRenderbuffer(b,x+r,m,t.colors[r].view.texture.glrb):Fe(e.gl,x+r,t.colors[r].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>x+t))),n&&(n.glrb?e.gl.framebufferRenderbuffer(b,s?_:F,m,n.glrb):Fe(e.gl,s?_:F,t.depthStencil));for(let r=0;r<t.colors.length;++r)a.push(t.colors[r].view.texture.samples>1?_e(e.gl,x,t.colors[r].view):null);a.push(n&&n.samples>1&&n.glt?_e(e.gl,s?_:F,t.depthStencil):null)}const l=e=>{e.deleteFramebuffer(r);for(const t of a)e.deleteFramebuffer(t)},i={gl:e.gl,glfb:r,glrfb:a,depth:n,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){l(this.gl)}};return ye.register(i,{finalizer:l,gl:e.gl}),i}(Je.get(e),d);return Je.add(h)}function Ct(e,t,r,a,n){const s=function(e,t,r,a=0){const n={status:0};return function(e,t,r,a,n){const s=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),function(e,t,r,a){return new Promise(((r,a)=>{!function n(){const s=e.clientWaitSync(t,0,0);37149==s?a():37147==s?setTimeout(n,10):r()}()}))}(e,s).finally((()=>e.deleteSync(s))).then((()=>{const s=new Uint8Array(n);return e.bindBuffer(t,r),e.getBufferSubData(t,a,s,0,n),s}))}(e.gl,t.type,t.glb,a,r.byteLength).then((e=>{r.set(e),n.status=1}),(()=>n.status=2)),n}(Je.get(e),Je.get(t),new Uint8Array(Ze(e).buffer.slice(a,a+1*n),r>>>0));return Ge.add(s)}function Bt(e,t,r,a,n){!function(e,t,r,a=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,a,r)}(Je.get(e),Je.get(t),new Uint8Array(Ze(e).buffer.slice(r,r+1*a)),n>>>0)}function Mt(e,t,r,a,n,s){!function(e,t,r,a=t.size,n=0,s=0){e.gl.bindBuffer(36662,t.glb),e.gl.bindBuffer(36663,r.glb),e.gl.copyBufferSubData(36662,36663,n,s,a)}(Je.get(e),Je.get(t),Je.get(r),a>>>0,n>>>0,s>>>0)}function Ot(e,t,r,a,n,s,l,i,o,c,u,f,h,b){!function(e,{texture:t,mipLevel:r=0,origin:[a,n,s]=[0,0,0]},l,{offset:i=0,bytesPerRow:o,rowsPerImage:c=0},[u,f,h]=[t.width-a,t.height-n,t.depth-s]){const b=ge(t.format),m=de(t.format),y=t.type===g,x=y?p+s:t.type;e.gl.activeTexture(d),e.gl.bindTexture(t.type,t.glt);const F=pe(t.format),_=c||f,v=Math.floor(o/F),w=i-i%o;if(e.gl.pixelStorei(32878,_),e.gl.pixelStorei(3314,v),e.gl.pixelStorei(3316,Math.floor(i%o/F)),e.gl.pixelStorei(S,0),e.gl.pixelStorei(32877,0),oe(t.type))e.gl.texSubImage3D(x,r,a,n,s,u,f,h,t.format,m,l,w);else if(y)for(let t=s;t<s+h;++t)e.gl.pixelStorei(S,t*v*_),e.gl.texSubImage2D(x+t,r,a,n,u,f,b,m,l,w);else e.gl.texSubImage2D(x,r,a,n,u,f,b,m,l,w)}(Je.get(e),{texture:Je.get(t),mipLevel:r>>>0,origin:[a>>>0,n>>>0,s>>>0]},new Uint8Array(Ze(e).buffer.slice(l,l+1*i)),{offset:o>>>0,bytesPerRow:c>>>0,rowsPerImage:u>>>0},[f>>>0,h>>>0,b>>>0])}function kt(e,t,r,a,n,s,l,i,o,c,u){!function(e,{src:t,origin:[r,a]=[0,0]},{texture:n,mipLevel:s=0,origin:[l,i,o]=[0,0,0]},[c,u]=[t.width-r,t.height-a]){const f=de(n.format),h=n.type===g?p+o:n.type;e.gl.activeTexture(d),e.gl.bindTexture(n.type,n.glt),e.gl.pixelStorei(3316,r),e.gl.pixelStorei(S,a),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),oe(n.type)?e.gl.texSubImage3D(h,s,l,i,o,c,u,1,n.format,f,t):e.gl.texSubImage2D(h,s,l,i,c,u,ge(n.format),f,t)}(Je.get(e),{src:Ve.get(t),origin:[r>>>0,a>>>0]},{texture:Je.get(n),mipLevel:s>>>0,origin:[l>>>0,i>>>0,o>>>0]},[c>>>0,u>>>0])}function Dt(e,t,r,a,n,s,l,i,o,c,u,f,h,m){!function(e,{texture:t,mipLevel:r=0,origin:[a,n,s]=[0,0,0]},{texture:l,mipLevel:i=0,origin:[o,c,u]=[0,0,0]},[f,h,m]=[t.width-a,t.height-n,t.depth-s]){const y=l.type===g,F=y?p+u:l.type;if(e.gl.activeTexture(d),e.gl.bindTexture(l.type,l.glt),e.gl.readBuffer(x),e.gl.bindFramebuffer(b,e.state.copyFrameBuffer),oe(t.type)||t.type===g)for(let g=s;g<s+m;++g)Fe(e.gl,x,{texture:t,mipLevel:r,slice:g}),oe(l.type)?e.gl.copyTexSubImage3D(F+(y?g:0),i,o,c,u,a,n,f,h):e.gl.copyTexSubImage2D(F+(y?g:0),i,o,c,a,n,f,h);else{const s=0;Fe(e.gl,x,{texture:t,mipLevel:r,slice:s}),oe(l.type)?e.gl.copyTexSubImage3D(F+(y?s:0),i,o,c,u,a,n,f,h):e.gl.copyTexSubImage2D(F+(y?s:0),i,o,c,a,n,f,h)}e.gl.bindFramebuffer(b,e.pass?e.pass.glfb:null)}(Je.get(e),{texture:Je.get(t),mipLevel:r>>>0,origin:[a>>>0,n>>>0,s>>>0]},{texture:Je.get(l),mipLevel:i>>>0,origin:[o>>>0,c>>>0,u>>>0]},[f>>>0,h>>>0,m>>>0])}function Pt(e,t,r,a,n,s,l,i,o,c,u,f,p){!function(e,{texture:t,mipLevel:r=0,origin:[a,n,s]=[0,0,0]},l,{offset:i=0,bytesPerRow:o,rowsPerImage:c=0},[u,f,p]=[t.width-a,t.height-n,t.depth-s]){e.gl.bindBuffer(35051,l),e.gl.readBuffer(x),e.gl.bindFramebuffer(b,e.state.copyFrameBuffer);const d=de(t.format),h=ge(t.format),m=pe(t.format),y=c||f,F=Math.floor(o/m),_=i-i%o;if(e.gl.pixelStorei(3330,F),e.gl.pixelStorei(3332,Math.floor(i%o/m)),e.gl.pixelStorei(3331,0),oe(t.type)||t.type===g)for(let l=s;l<s+p;++l)Fe(e.gl,x,{texture:t,mipLevel:r,slice:l}),e.gl.readPixels(a,n,u,f,h,d,_+(l-s)*o*y);else{const s=0;Fe(e.gl,x,{texture:t,mipLevel:r,slice:s}),e.gl.readPixels(a,n,u,f,h,d,_)}e.gl.bindFramebuffer(b,e.pass?e.pass.glfb:null)}(Je.get(e),{texture:Je.get(t),mipLevel:r>>>0,origin:[a>>>0,n>>>0,s>>>0]},Je.get(l),{offset:i>>>0,bytesPerRow:o>>>0,rowsPerImage:c>>>0},[u>>>0,f>>>0,p>>>0])}function Ut(e,t){!function(e,t){let a=e.gl.drawingBufferWidth,n=e.gl.drawingBufferHeight;t.color.length&&(a=t.color[0].width,n=t.color[0].height),e.gl.bindFramebuffer(b,t.glfb),e.gl.viewport(0,0,a,n),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Oe(e.gl,s,!1));let l=0;if(isNaN(t.clearDepth)||(l|=256,e.gl.clearDepth(t.clearDepth),Be(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(l|=1024,e.gl.clearStencil(t.clearStencil),Me(e.gl,e.state.state.stencilWriteMask,be),e.state.state.stencilWriteMask=be),Ce(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15,t.color.length){for(let r=0;r<t.color.length;++r)if(t.clearColors[r]){const a=he(t.color[r].format);a===i?e.gl.clearBufferiv(v,r,t.clearColors[r]):a===o?e.gl.clearBufferuiv(v,r,t.clearColors[r]):e.gl.clearBufferfv(v,r,t.clearColors[r])}}else t.clearColor&&(l|=r,e.gl.clearColor(...t.clearColor));l&&e.gl.clear(l),e.pass=t}(Je.get(e),Je.get(t))}function Tt(e,t,a,n,l,i,o){!function(e,t={}){e.gl.bindFramebuffer(b,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Oe(e.gl,s,!1));let a=0;isNaN(t.clearDepth)||(a|=256,e.gl.clearDepth(t.clearDepth),Be(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(a|=1024,e.gl.clearStencil(t.clearStencil),Me(e.gl,e.state.state.stencilWriteMask,be),e.state.state.stencilWriteMask=be),t.clearColor&&(a|=r,e.gl.clearColor(...t.clearColor),Ce(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15),a&&e.gl.clear(a),e.pass=null}(Je.get(e),{clearColor:isNaN(n)?null:[n,l,i,o],clearDepth:t,clearStencil:a})}function At(e){!function(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&Se(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],r,x+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&Se(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}(Je.get(e))}function Lt(e,t){!function(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),we(e.gl,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const r=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)r[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let a=0;a<t.buffers.length;++a){const{attributes:n,stride:s,stepMode:l=0}=t.buffers[a],i=[];e.state.buffers[a]={glb:null,attributes:i,stride:s,step:l,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:o}of n)r[o]=(r[o]||0)+2,i.push({buffer:a,ptr:[o,ce(e),ue(e),fe(e),s,t],step:l})}for(let t=0;t<r.length;++t)2===r[t]?e.gl.enableVertexAttribArray(t):1===r[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}(Je.get(e),Je.get(t))}function Wt(e,t){!function(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}(Je.get(e),Je.get(t))}function Rt(e,t,r,a){!function(e,t,r,a=0){const n=e.state.buffers[t];!n||n.glb===r.glb&&n.offset===a||(n.glb=r.glb,n.offset=a,n.instanceOffset=0,ke(e.gl,n,a))}(Je.get(e),t>>>0,Je.get(r),a>>>0)}function zt(e,t,r,a,n){!function(e,t,r,a=[]){if(e.state.pipeline)for(let n=0,s=0;n<r.entries.length;++n){const l=r.entries[n],i=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][l.binding];if(i)if(l.buffer){let t=l.bufferOffset||0;i.bufferDynamicOffset&&(t+=a[s]||0,++s),e.gl.bindBufferRange(35345,i.slot,l.buffer.glb,t,l.bufferSize||l.buffer.size-t)}else l.texture?(e.gl.activeTexture(d+i.slot),e.gl.bindTexture(l.texture.type,l.texture.glt),e.gl.uniform1i(i.loc,i.slot)):l.sampler&&e.gl.bindSampler(i.slot,l.sampler.gls)}}(Je.get(e),t>>>0,Je.get(r),new Uint32Array(Ze(e).buffer.slice(a,a+4*n)))}function It(e,t,r,a,n){!function(e,t,r=1,a=0,n=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==n&&(t.instanceOffset=n,ke(e.gl,t,n*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,a,t,r)}(Je.get(e),t>>>0,r>>>0,a>>>0,n>>>0)}function Et(e,t,r,a,n){!function(e,t,r=1,a=0,n=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==n&&(t.instanceOffset=n,ke(e.gl,t,n*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,a*(e.state.state.indexFormat===l?2:4),r)}(Je.get(e),t>>>0,r>>>0,a>>>0,n>>>0)}function Nt(e,t,r,a,n,s,l){!function(e,t,r,a,n,s=0,l=1){e.gl.viewport(t,r,a,n),e.gl.depthRange(s,l)}(Je.get(e),t>>>0,r>>>0,a>>>0,n>>>0,s>>>0,l>>>0)}function jt(e,t,r,a,n){!function(e,t,r,a,n){e.state.scissor||(Oe(e.gl,s,!0),e.state.scissor=!0),e.gl.scissor(t,r,a,n)}(Je.get(e),t>>>0,r>>>0,a>>>0,n>>>0)}function Gt(e,t,r,a,n){!function(e,t){e.gl.blendColor(...t)}(Je.get(e),[t,r,a,n])}function Vt(e,t){!function(e,t){if(e.state.stencilRef!==t){const{stencilFrontCompare:r,stencilBackCompare:s,stencilReadMask:l}=e.state.state;e.gl.stencilFuncSeparate(a,r,t,l),e.gl.stencilFuncSeparate(n,s,t,l),e.state.stencilRef=t}}(Je.get(e),t>>>0)}return t})(),"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mugl",[],t):"object"==typeof exports?exports.mugl=t():e.mugl=t();