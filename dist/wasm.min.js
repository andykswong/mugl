var e,t;e=self,t=()=>(()=>{var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{begin_default_pass:()=>Ut,begin_render_pass:()=>Pt,copy_buffer:()=>Bt,copy_external_image_to_texture:()=>Mt,copy_texture:()=>kt,copy_texture_to_buffer:()=>Dt,create_bind_group:()=>St,create_bind_group_layout:()=>Ft,create_buffer:()=>bt,create_image:()=>rt,create_render_pass:()=>wt,create_render_pipeline:()=>_t,create_sampler:()=>yt,create_shader:()=>xt,create_texture:()=>mt,delete_bind_group:()=>Ze,delete_bind_group_layout:()=>Ze,delete_buffer:()=>Ze,delete_device:()=>pt,delete_image:()=>at,delete_render_pass:()=>Ze,delete_render_pipeline:()=>Ze,delete_sampler:()=>Ze,delete_shader:()=>Ze,delete_texture:()=>Ze,draw:()=>Et,draw_indexed:()=>It,free_context:()=>et,get_canvas_by_id:()=>it,get_canvas_height:()=>ct,get_canvas_width:()=>ot,get_device_features:()=>ht,get_future_status:()=>tt,get_image_by_id:()=>nt,get_image_height:()=>lt,get_image_width:()=>st,is_device_lost:()=>dt,read_buffer:()=>vt,reset_device:()=>gt,set_bind_group:()=>Rt,set_blend_const:()=>jt,set_context_memory:()=>$e,set_index:()=>Lt,set_render_pipeline:()=>Tt,set_scissor_rect:()=>zt,set_stencil_ref:()=>Gt,set_vertex:()=>Wt,set_viewport:()=>Nt,submit_render_pass:()=>At,webgl_generate_mipmap:()=>ft,webgl_request_device:()=>ut,write_buffer:()=>Ct,write_texture:()=>Ot});const r=2097151,n=2**32;function a(e,t){return(t&r)*n+(e>>>0)}function s(e){return e>>>0}class l{generations=[];freeList=[];get size(){return this.generations.length-this.freeList.length}clear(){this.generations.length=0,this.freeList.length=0}add(){let e,t;return this.freeList.length>0?(e=this.freeList.pop(),t=Math.abs(this.generations[e]),this.generations[e]=t):(e=this.generations.length,t=e?0:1,this.generations.push(t)),a(e,t)}delete(e){if(!this.has(e))return!1;const t=s(e);let n=this.generations[t]+1&r;return n||++n,this.generations[t]=-n,this.freeList.push(t),!0}forEach(e){for(const t of this.values())e(t,t)}has(e){return s(e)<this.generations.length&&function(e){return e/n&r}(e)===this.generations[s(e)]}keys(){return this.values()}*values(){for(let e=0;e<this.generations.length;++e){const t=this.generations[e];this.generations[e]>=0&&(yield a(e,t))}}*entries(){for(const e of this.values())yield[e,e]}[Symbol.iterator](){return this.values()}}class i{ids=new l;data=[];get size(){return this.ids.size}add(e){const t=this.ids.add();return this.data[s(t)]=e,t}clear(){this.ids.clear(),this.data.length=0}delete(e){return!!this.ids.delete(e)&&(delete this.data[s(e)],!0)}*entries(){for(const e of this.ids.values())yield[e,this.data[s(e)]]}forEach(e){this.ids.forEach((t=>{e(this.data[s(t)],t)}))}get(e){return this.ids.has(e)?this.data[s(e)]:void 0}has(e){return this.ids.has(e)}keys(){return this.ids.values()}set(e,t){return this.ids.has(e)&&(this.data[s(e)]=t),this}*values(){for(const e of this.ids.values())yield this.data[s(e)]}[Symbol.iterator](){return this.entries()}}const o=16384,c=1028,u=1029,f=3089,g=5123,p=5124,d=5125,h=5126,b=7680,m=9728,y=34067,x=34069,F=33984,S=33071,_=36160,w=36161,v=33189,C=36064,B=36096,O=33306,M=3315,k=6144,D=32856,P=32857,U=33190,A=35907,T=34836,L=34842,W=35898,R=36208,E=36214,I=36220,N=36226,z=36232,j=36238,G=36012,V=36013,q=35056,H=33321,X=33323,Y=33325,J=33326,K=33327,Q=33328,Z=33329,$=33330,ee=33331,te=33332,re=33333,ne=33334,ae=33335,se=33336,le=33337,ie=33338,oe=33339,ce=33340,ue=36756,fe=36757,ge=36759;function pe(e){return 32879===e||35866===e}function de(e){return 15&e}function he(e){switch(e>>4&511){case 36:return h;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return g;case 17:return 5121}return 0}function be(e){return!!(e>>13)}function me(e){switch(e){case H:case ue:case Y:case J:return 6403;case $:case Z:case te:case ee:case ne:case re:return 36244;case X:case fe:case K:case Q:return 33319;case se:case ae:case ie:case le:case ce:case oe:return 33320;case D:case A:case ge:case P:case L:case T:return 6408;case I:case j:case E:case R:case z:case N:return 36249;case W:return 6407;case v:case U:case G:return 6402;case q:case V:return 34041}return 0}function ye(e){switch(e){case H:case $:case ue:case Z:return 1;case te:case ee:case X:case se:case fe:case ae:case Y:return 2;case ne:case re:case J:case ie:case le:case K:case D:case A:case I:case ge:case j:case P:case W:return 4;case ce:case oe:case Q:case E:case z:case L:return 8;case R:case N:case T:return 16;case v:return 2;case U:case q:case G:return 4;case V:return 8}return 0}function xe(e){switch(e){case H:case $:case X:case se:case D:case A:case I:return 5121;case ue:case Z:case fe:case ae:case ge:case j:return 5120;case te:case ie:case E:return g;case ee:case le:case z:return 5122;case ne:case ce:case R:return d;case re:case oe:case N:return p;case P:return 33640;case Y:case K:case L:return 5131;case J:case Q:case T:return h;case W:return 35899;case v:return g;case U:return d;case q:return 34042;case G:return h;case V:return 36269}return 0}function Fe(e){switch(e){case Z:case ee:case re:case ae:case le:case oe:case j:case z:case N:return p;case $:case te:case ne:case se:case ie:case ce:case I:case E:case R:return d}return h}const Se={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float",16:"OES_draw_buffers_indexed"},_e=4294967295;function we(e){const t=ve();e.blendColor(1,1,1,1),Be(e,null,t,t,0,!0);const r=e.getParameter(34921);for(let t=0;t<r;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function ve(e={}){const t=e.primitive||{},r=e.depthStencil||{},{stencilFront:n={},stencilBack:a={}}=r,{sampleCount:s=1,alphaToCoverage:l=!1}=e.multisample||{},i=e.targets||{},o=i.targets&&i.targets.map((e=>Ce(e.blendColor,e.blendAlpha,e.writeMask)))||[];return{sampleCount:s,alphaToCoverage:l,topology:t.topology||4,indexFormat:t.indexFormat||g,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:r.depthWrite||!1,depthFormat:r.format||v,depthCompare:r.depthCompare||519,depthBias:r.depthBias||0,depthBiasSlopeScale:r.depthBiasSlopeScale||0,stencil:!(!r.stencilFront&&!r.stencilBack),stencilFrontCompare:n.compare||519,stencilFrontFailOp:n.failOp||b,stencilFrontDepthFailOp:n.depthFailOp||b,stencilFrontPassOp:n.passOp||b,stencilBackCompare:a.compare||519,stencilBackFailOp:a.failOp||b,stencilBackDepthFailOp:a.depthFailOp||b,stencilBackPassOp:a.passOp||b,stencilReadMask:r.stencilReadMask||_e,stencilWriteMask:r.stencilWriteMask||_e,blend:!!e.targets,drawBuffers:o,...Ce(i.blendColor,i.blendAlpha,i.writeMask)}}function Ce(e={},t={},r=15){return{blendWriteMask:r,blendColorOp:e.operation||32774,blendColorSrcFactor:void 0!==e.srcFactor?e.srcFactor:1,blendColorDstFactor:e.dstFactor||0,blendAlphaOp:t.operation||32774,blendAlphaSrcFactor:void 0!==t.srcFactor?t.srcFactor:1,blendAlphaDstFactor:t.dstFactor||0}}function Be(e,t,r,n,a=0,s=!1){let l=!1,i=0,o=0,f=0,g=0;if(i=n.frontFace,(s||r.frontFace!==i)&&e.frontFace(i),i=n.cullMode,(s||r.cullMode!==i)&&((l=0!==i)&&e.cullFace(i),Pe(e,2884,l)),l=n.alphaToCoverage,(s||r.alphaToCoverage!==l)&&Pe(e,32926,l),l=!!n.depth,(s||r.depth!==l)&&Pe(e,2929,l),(s||l)&&(ke(e,r.depthWrite,n.depthWrite,s),i=n.depthCompare,(s||r.depthCompare!==i)&&e.depthFunc(i)),i=n.depthBiasSlopeScale,o=n.depthBias,(s||r.depthBiasSlopeScale!==i||r.depthBias!==o)&&(Pe(e,32823,!(!i&&!o)),e.polygonOffset(i,o)),l=!!n.stencil,(s||r.stencil!==l)&&Pe(e,2960,l),(s||l)&&(i=n.stencilReadMask,l=s||r.stencilReadMask!==i,o=n.stencilFrontCompare,(l||r.stencilFrontCompare!==o)&&e.stencilFuncSeparate(c,o,a,i),o=n.stencilBackCompare,(l||r.stencilBackCompare!==o)&&e.stencilFuncSeparate(u,o,a,i),i=n.stencilFrontFailOp,o=n.stencilFrontDepthFailOp,f=n.stencilFrontPassOp,(s||r.stencilFrontFailOp!==i||r.stencilFrontDepthFailOp!==o||r.stencilFrontPassOp!==f)&&e.stencilOpSeparate(c,i,o,f),i=n.stencilBackFailOp,o=n.stencilBackDepthFailOp,f=n.stencilBackPassOp,(s||r.stencilBackFailOp!==i||r.stencilBackDepthFailOp!==o||r.stencilBackPassOp!==f)&&e.stencilOpSeparate(u,i,o,f),De(e,r.stencilWriteMask,n.stencilWriteMask,s)),l=n.blend,(s||r.blend!==l)&&Pe(e,3042,l),(s||l)&&(i=n.blendColorSrcFactor,o=n.blendColorDstFactor,f=n.blendAlphaSrcFactor,g=n.blendAlphaDstFactor,(s||r.blendColorSrcFactor!==i||r.blendColorDstFactor!==o||r.blendAlphaSrcFactor!==f||r.blendAlphaDstFactor!==g)&&e.blendFuncSeparate(i,o,f,g),i=n.blendColorOp,o=n.blendAlphaOp,(s||r.blendColorOp!==i||r.blendAlphaOp!==o)&&e.blendEquationSeparate(i,o),Me(e,r.blendWriteMask,n.blendWriteMask,s),t))for(let e=0;e<n.drawBuffers.length;++e)Oe(t,e,n,n.drawBuffers[e])}function Oe(e,t,r,n,a=!1){let s=0,l=0,i=0,o=0;s=n.blendColorSrcFactor,l=n.blendColorDstFactor,i=n.blendAlphaSrcFactor,o=n.blendAlphaDstFactor,(a||r.blendColorSrcFactor!==s||r.blendColorDstFactor!==l||r.blendAlphaSrcFactor!==i||r.blendAlphaDstFactor!==o)&&e.blendFuncSeparateiOES(t,s,l,i,o),s=n.blendColorOp,l=n.blendAlphaOp,(a||r.blendColorOp!==s||r.blendAlphaOp!==l)&&e.blendEquationSeparateiOES(t,s,l),function(e,t,r,n,a=!1){(a||r!==n)&&e.colorMaskiOES(t,!!(1&n),!!(2&n),!!(4&n),!!(8&n))}(e,t,r.blendWriteMask,n.blendWriteMask,a)}function Me(e,t,r,n=!1){(n||t!==r)&&e.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))}function ke(e,t,r,n=!1){(n||t!==r)&&e.depthMask(r)}function De(e,t,r,n=!1){(n||t!==r)&&e.stencilMask(r)}function Pe(e,t,r){r?e.enable(t):e.disable(t)}function Ue(e,t,{texture:r,slice:n=0,mipLevel:a=0}){if(pe(r.type))e.framebufferTextureLayer(_,t,r.glt,a,n);else{const s=r.type===y?x+n:r.type;e.framebufferTexture2D(_,t,s,r.glt,a)}}function Ae(e,t,r){const n=e.createFramebuffer();return e.bindFramebuffer(_,n),Ue(e,t,r),n}function Te(e,t,r,n,a,s=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,r),e.readBuffer(s),e.blitFramebuffer(0,0,n.width,n.height,0,0,n.width,n.height,a,m)}function Le(e,t,r){e.bindBuffer(34962,t.glb);for(let n=0;n<t.attributes.length;++n){const{ptr:a,step:s}=t.attributes[n],l=[...a];l[5]+=r,e.vertexAttribPointer(...l),e.vertexAttribDivisor(a[0],s)}}const We=255,Re=new TextDecoder("utf-8");let Ee=new DataView(new ArrayBuffer(0));function Ie(e){return Ee.buffer!==e.buffer&&(Ee=new DataView(e.buffer)),Ee}function Ne(e,t,r){return Re.decode(new Uint8Array(e.buffer,t,r))}const ze={},je=new i,Ge=new i,Ve={},qe=new i,He={},Xe={},Ye=new i,Je={};function Ke(e){return ze[e].memory}function Qe(e){return Ke(Je[e])}function Ze(e){const t=Ye.get(e);t&&(t.destroy(),Ye.delete(e))}function $e(e,t){(ze[e]=ze[e]||{memory:null}).memory=t}function et(e){delete ze[e]}function tt(e){const t=je.get(e);return t?(0!==t.status&&je.delete(e),t.status):1}function rt(e,t,r){const n=new Image;return n.crossOrigin="anonymous",n.src=Ne(Ke(e),t,r),Ge.add(n)}function nt(e,t,r){const n=Ne(Ke(e),t,r);if(Ve[n])return Ve[n];const a=document.getElementById(n);return a?Ve[n]=Ge.add(a):0}function at(e){Ge.delete(e)}function st(e){return Ge.get(e)?.width||0}function lt(e){return Ge.get(e)?.height||0}function it(e,t,r){const n=Ne(Ke(e),t,r);if(He[n])return He[n];const a=document.getElementById(n);if(!a)return 0;const s=He[n]=qe.add(a);return Xe[s]=e,s}function ot(e){return qe.get(e)?.width||0}function ct(e){return qe.get(e)?.height||0}function ut(e,t,r){const n=qe.get(e);if(n){const s=function(e,t={},r=0){const n=e.getContext("webgl2",t);if(n){let t=0;for(const e in Se)r&+e&&n.getExtension(Se[+e])&&(t|=+e);const a=16&t?n.getExtension(Se[16]):null,s=we(n),l=e=>{e.deleteFramebuffer(s.copyFrameBuffer)};return{canvas:e,gl:n,features:t,extDrawBuffersi:a,pass:null,state:s,destroy(){l(this.gl)}}}return null}(n,{alpha:!!(1&(a=t)),antialias:!!(2&a),depth:!!(4&a),desynchronized:!!(8&a),failIfMajorPerformanceCaveat:!!(16&a),powerPreference:32&a?"high-performance":"low-power",premultipliedAlpha:!!(64&a),preserveDrawingBuffer:!!(128&a),stencil:!!(256&a)},r);if(s){const t=Ye.add(s);return Je[t]=Xe[e],t}}var a;return 0}function ft(e,t,r){!function(e,t,r=4352){e.gl.activeTexture(F),e.gl.bindTexture(t.type,t.glt),e.gl.hint(33170,r),e.gl.generateMipmap(t.type)}(Ye.get(e),Ye.get(t),r)}function gt(e){!function(e){e.destroy(),Object.assign(e.state,we(e.gl))}(Ye.get(e))}function pt(e){Ze(e),delete Je[e]}function dt(e){return function(e){return e.gl.isContextLost()}(Ye.get(e))}function ht(e){return function(e){return e.features}(Ye.get(e))}function bt(e,t,r){const n=function(e,t){const r=64&t.usage?35345:16&t.usage?34963:34962,n=8192&t.usage?35040:4096&t.usage?35048:35044,a=e.gl.createBuffer();return e.gl.bindBuffer(r,a),e.gl.bufferData(r,t.size,n),{gl:e.gl,glb:a,type:r,size:t.size,destroy(){this.gl.deleteBuffer(a)}}}(Ye.get(e),{size:t>>>0,usage:r>>>0});return Ye.add(n)}function mt(e,t,r,n,a,s,l,i,o){const c=function(e,t){const r=t.sampleCount||1,n=t.dimension||3553,a=t.format||D,s=!function(e){switch(e){case v:case U:case q:case G:case V:return!0}return!1}(a)||4&(t.usage||0),[l,i,o]=t.size||[1,1,1],c=n===y?6:3553===n?1:o;let u=null,f=null;return(r>1||!s)&&(f=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(w,f),r>1?e.gl.renderbufferStorageMultisample(w,r,a,l,i):e.gl.renderbufferStorage(w,a,l,i)),s&&(u=e.gl.createTexture(),e.gl.activeTexture(F),e.gl.bindTexture(n,u),pe(n)?e.gl.texStorage3D(n,t.mipLevelCount||1,a,l,i,c):e.gl.texStorage2D(n,t.mipLevelCount||1,a,l,i)),{gl:e.gl,glt:u,glrb:f,type:n,format:a,width:l,height:i,depth:c,samples:r,destroy(){var e;(e=this.gl).deleteTexture(u),e.deleteRenderbuffer(f)}}}(Ye.get(e),{size:[t>>>0,r>>>0,n>>>0],mipLevelCount:a>>>0,sampleCount:s>>>0,dimension:l>>>0,format:i>>>0,usage:o>>>0});return Ye.add(c)}function yt(e,t,r,n,a,s,l,i,o,c,u){const f=function(e,t={}){const r=e.gl.createSampler();let n=t.minFilter||m;return t.mipmapFilter&&(n=t.mipmapFilter===m?n===m?9984:9985:n===m?9986:9987),e.gl.samplerParameteri(r,10241,n),e.gl.samplerParameteri(r,10240,t.magFilter||m),e.gl.samplerParameteri(r,10242,t.addressModeU||S),e.gl.samplerParameteri(r,10243,t.addressModeV||S),e.gl.samplerParameteri(r,32882,t.addressModeW||S),e.gl.samplerParameterf(r,33083,void 0!==t.lodMaxClamp?t.lodMaxClamp:32),e.gl.samplerParameterf(r,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(r,34892,34894),e.gl.samplerParameterf(r,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(r,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047))),{gls:r,gl:e.gl,destroy(){this.gl.deleteSampler(r)}}}(Ye.get(e),{addressModeU:t>>>0,addressModeV:r>>>0,addressModeW:n>>>0,magFilter:a>>>0,minFilter:s>>>0,mipmapFilter:l>>>0,lodMinClamp:i,lodMaxClamp:o,compare:c>>>0,maxAnisotropy:u>>>0});return Ye.add(f)}function xt(e,t,r,n){const a=function(e,t){const r=1===t.usage?35633:35632,n=e.gl.createShader(r);return e.gl.shaderSource(n,t.code),e.gl.compileShader(n),{gl:e.gl,gls:n,destroy(){this.gl.deleteShader(n)}}}(Ye.get(e),{code:Ne(Qe(e),t,r),usage:n>>>0});return Ye.add(a)}function Ft(e,t,r){const n=Qe(e),a=[];for(let e=0;e<r;e++){const r=t+32*e,s=Ie(n).getUint32(r+0,!0),l=Ie(n).getUint32(r+4,!0),i=Ie(n).getUint8(r+16);let o=!1,c=0,u=0,f=3553,g=!1;switch(i){case 0:o=!!Ie(n).getUint8(r+20);break;case 1:c=Ie(n).getUint32(r+20,!0)>>>0;break;case 2:u=Ie(n).getUint32(r+20,!0)>>>0,f=Ie(n).getUint32(r+24,!0)>>>0,g=!!Ie(n).getUint8(r+28);break;default:throw new RangeError("invalid variant discriminant for BindingType")}a.push({label:Ne(n,s,l),binding:Ie(n).getUint32(r+8,!0)>>>0,visibility:Ie(n).getUint32(r+12,!0)>>>0,type:i,bufferDynamicOffset:o,samplerType:c,textureSampleType:u,textureDimension:f,textureMultisampled:g})}const s=(Ye.get(e),{entries:{entries:a}.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}});return Ye.add(s)}function St(e,t,r,n){const a=Qe(e),s=[];for(let e=0;e<n;e++){const t=r+24*e;let n=null,l=0,i=0,o=null,c=null;switch(Ie(a).getUint8(t+4)){case 0:n=Ye.get(Ie(a).getFloat64(t+8,!0)),l=Ie(a).getUint32(t+16,!0),i=Ie(a).getUint32(t+20,!0);break;case 1:o=Ye.get(Ie(a).getFloat64(t+8,!0));break;case 2:c=Ye.get(Ie(a).getFloat64(t+8,!0));break;default:throw new RangeError("invalid variant discriminant for BindingResource")}s.push({binding:Ie(a).getUint32(t+0,!0),buffer:n,bufferOffset:l,bufferSize:i,sampler:o,texture:c})}const l=(Ye.get(e),{entries:{layout:Ye.get(t),entries:s}.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}});return Ye.add(l)}function _t(e,t,r,n,a,s,l,i,o,c,u,f,g,p,d,h,b,m,y,x,F,S,_,w,v,C,B,O,M,k,D,P,U,A,T,L,W,R,E,I,N){const z=Qe(e),j=[];for(let e=0;e<a;e++){const t=n+12*e;j.push({format:Ie(z).getUint32(t+0,!0),offset:Ie(z).getUint32(t+4,!0),shaderLocation:Ie(z).getUint32(t+8,!0)})}const G=[];for(let e=0;e<l;e++){const t=s+16*e,r=Ie(z).getUint32(t+0,!0),n=Ie(z).getUint32(t+4,!0);G.push({attributes:j.slice(r,r+n),stride:Ie(z).getUint32(t+8,!0),stepMode:Ie(z).getUint32(t+12,!0)})}const V=[];for(let e=0;e<o;e++){const t=i+8*e;V.push(Ye.get(Ie(z).getFloat64(t+0,!0)))}const q=[];for(let e=0;e<A;e++){const t=U+32*e;q.push({format:Ie(z).getUint32(t+0,!0)>>>0,writeMask:Ie(z).getUint32(t+4,!0)>>>0,blendColor:{operation:Ie(z).getUint32(t+8,!0)>>>0,srcFactor:Ie(z).getUint32(t+12,!0)>>>0,dstFactor:Ie(z).getUint32(t+16,!0)>>>0},blendAlpha:{operation:Ie(z).getUint32(t+20,!0)>>>0,srcFactor:Ie(z).getUint32(t+24,!0)>>>0,dstFactor:Ie(z).getUint32(t+28,!0)>>>0}})}const H=function(e,t){const r=function(e,t,r){const n=e.gl.createProgram();return e.gl.attachShader(n,t),e.gl.attachShader(n,r),e.gl.linkProgram(n),n}(e,t.vertex.gls,t.fragment.gls),n=[],a={};let s=0,l=0;if(t.bindGroups){for(let i=0;i<t.bindGroups.length;++i){const o=t.bindGroups[i].entries;n.push([]);for(let t=0;t<o.length;++t){const c=o[t];let u=null,f=4294967295;0===c.type?(f=e.gl.getUniformBlockIndex(r,c.label),e.gl.uniformBlockBinding(r,f,s++)):2===c.type&&(u=e.gl.getUniformLocation(r,c.label),a[c.label]=l++),n[i][c.binding]={...c,loc:u,index:f,slot:0===c.type?s-1:2===c.type?l-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const r=t.bindGroups[e].entries;for(let t=0;t<r.length;++t)1===r[t].type&&a[r[t].label]&&(n[e][r[t].binding].slot=a[r[t].label])}}return{gl:e.gl,glp:r,buffers:t.buffers,cache:n,state:ve(t),destroy(){this.gl.deleteProgram(r)}}}(Ye.get(e),{vertex:Ye.get(t),fragment:Ye.get(r),buffers:G,bindGroups:V,primitive:{topology:c>>>0,indexFormat:u>>>0,frontFace:f>>>0,cullMode:g>>>0},multisample:{sampleCount:p>>>0,alphaToCoverage:!!d},depthStencil:h?{format:b>>>0,depthWrite:!!m,depthCompare:y>>>0,stencilFront:{compare:x>>>0,failOp:F>>>0,depthFailOp:S>>>0,passOp:_>>>0},stencilBack:{compare:w>>>0,failOp:v>>>0,depthFailOp:C>>>0,passOp:B>>>0},stencilReadMask:O>>>0,stencilWriteMask:M>>>0,depthBias:k,depthBiasSlopeScale:D,depthBiasClamp:P}:null,targets:{writeMask:T>>>0,blendColor:{operation:L>>>0,srcFactor:W>>>0,dstFactor:R>>>0},blendAlpha:{operation:E>>>0,srcFactor:I>>>0,dstFactor:N>>>0},targets:q}});return Ye.add(H)}function wt(e,t,r,n,a,s,l,i,o,c,u,f,g){const p=Qe(e);let d;switch(i){case 0:d={clearDepth:t,clearStencil:r,clearColor:isNaN(n)?null:[n,a,s,l]};break;case 1:{const e=[];for(let t=0;t<g;t++){const r=f+32*t,n=[Ie(p).getFloat32(r+16,!0),Ie(p).getFloat32(r+20,!0),Ie(p).getFloat32(r+24,!0),Ie(p).getFloat32(r+28,!0)];e.push({view:{texture:Ye.get(Ie(p).getFloat64(r+0,!0)),mipLevel:Ie(p).getUint32(r+8,!0),slice:Ie(p).getUint32(r+12,!0)},clear:isNaN(n[0])?null:n})}d={clearDepth:t,clearStencil:r,colors:e,depthStencil:{texture:Ye.get(o),mipLevel:c>>>0,slice:u>>>0}};break}default:throw new RangeError("invalid variant discriminant for RenderPassDescriptor")}const h=function(e,t={}){let r=null;const n=[],a=t.depthStencil?t.depthStencil.texture:null,s=a&&function(e){switch(e){case 36168:case q:case V:return!0}return!1}(a.format)||!1;if(t.colors&&t.colors.length){r=e.gl.createFramebuffer(),e.gl.bindFramebuffer(_,r);for(let r=0;r<t.colors.length;++r)t.colors[r].view.texture.samples>1?e.gl.framebufferRenderbuffer(_,C+r,w,t.colors[r].view.texture.glrb):Ue(e.gl,C+r,t.colors[r].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>C+t))),a&&(a.glrb?e.gl.framebufferRenderbuffer(_,s?O:B,w,a.glrb):Ue(e.gl,s?O:B,t.depthStencil));for(let r=0;r<t.colors.length;++r)n.push(t.colors[r].view.texture.samples>1?Ae(e.gl,C,t.colors[r].view):null);n.push(a&&a.samples>1&&a.glt?Ae(e.gl,s?O:B,t.depthStencil):null)}return{gl:e.gl,glfb:r,glrfb:n,depth:a,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){(e=>{e.deleteFramebuffer(r);for(const t of n)e.deleteFramebuffer(t)})(this.gl)}}}(Ye.get(e),d);return Ye.add(h)}function vt(e,t,r,n,a){const s=function(e,t,r,n=0){const a={status:0};return function(e,t,r,n,a){const s=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),function(e,t,r,n){return new Promise(((r,n)=>{!function a(){const s=e.clientWaitSync(t,0,0);37149==s?n():37147==s?setTimeout(a,10):r()}()}))}(e,s).finally((()=>e.deleteSync(s))).then((()=>{const s=new Uint8Array(a);return e.bindBuffer(t,r),e.getBufferSubData(t,n,s,0,a),s}))}(e.gl,t.type,t.glb,n,r.byteLength).then((e=>{r.set(e),a.status=1}),(()=>a.status=2)),a}(Ye.get(e),Ye.get(t),new Uint8Array(Qe(e).buffer.slice(n,n+1*a),r>>>0));return je.add(s)}function Ct(e,t,r,n,a){!function(e,t,r,n=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,n,r)}(Ye.get(e),Ye.get(t),new Uint8Array(Qe(e).buffer.slice(r,r+1*n)),a>>>0)}function Bt(e,t,r,n,a,s){!function(e,t,r,n=t.size,a=0,s=0){e.gl.bindBuffer(36662,t.glb),e.gl.bindBuffer(36663,r.glb),e.gl.copyBufferSubData(36662,36663,a,s,n)}(Ye.get(e),Ye.get(t),Ye.get(r),n>>>0,a>>>0,s>>>0)}function Ot(e,t,r,n,a,s,l,i,o,c,u,f,g,p){!function(e,{texture:t,mipLevel:r=0,origin:[n,a,s]=[0,0,0]},l,{offset:i=0,bytesPerRow:o,rowsPerImage:c=0},[u,f,g]=[t.width-n,t.height-a,t.depth-s]){const p=me(t.format),d=xe(t.format),h=t.type===y,b=h?x+s:t.type;e.gl.activeTexture(F),e.gl.bindTexture(t.type,t.glt);const m=ye(t.format),S=c||f,_=Math.floor(o/m),w=i-i%o;if(e.gl.pixelStorei(32878,S),e.gl.pixelStorei(3314,_),e.gl.pixelStorei(3316,Math.floor(i%o/m)),e.gl.pixelStorei(M,0),e.gl.pixelStorei(32877,0),pe(t.type))e.gl.texSubImage3D(b,r,n,a,s,u,f,g,t.format,d,l,w);else if(h)for(let t=s;t<s+g;++t)e.gl.pixelStorei(M,t*_*S),e.gl.texSubImage2D(b+t,r,n,a,u,f,p,d,l,w);else e.gl.texSubImage2D(b,r,n,a,u,f,p,d,l,w)}(Ye.get(e),{texture:Ye.get(t),mipLevel:r>>>0,origin:[n>>>0,a>>>0,s>>>0]},new Uint8Array(Qe(e).buffer.slice(l,l+1*i)),{offset:o>>>0,bytesPerRow:c>>>0,rowsPerImage:u>>>0},[f>>>0,g>>>0,p>>>0])}function Mt(e,t,r,n,a,s,l,i,o,c,u){!function(e,{src:t,origin:[r,n]=[0,0]},{texture:a,mipLevel:s=0,origin:[l,i,o]=[0,0,0]},[c,u]=[t.width-r,t.height-n]){const f=xe(a.format),g=a.type===y?x+o:a.type;e.gl.activeTexture(F),e.gl.bindTexture(a.type,a.glt),e.gl.pixelStorei(3316,r),e.gl.pixelStorei(M,n),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),pe(a.type)?e.gl.texSubImage3D(g,s,l,i,o,c,u,1,a.format,f,t):e.gl.texSubImage2D(g,s,l,i,c,u,me(a.format),f,t)}(Ye.get(e),{src:Ge.get(t),origin:[r>>>0,n>>>0]},{texture:Ye.get(a),mipLevel:s>>>0,origin:[l>>>0,i>>>0,o>>>0]},[c>>>0,u>>>0])}function kt(e,t,r,n,a,s,l,i,o,c,u,f,g,p){!function(e,{texture:t,mipLevel:r=0,origin:[n,a,s]=[0,0,0]},{texture:l,mipLevel:i=0,origin:[o,c,u]=[0,0,0]},[f,g,p]=[t.width-n,t.height-a,t.depth-s]){const d=l.type===y,h=d?x+u:l.type;if(e.gl.activeTexture(F),e.gl.bindTexture(l.type,l.glt),e.gl.readBuffer(C),e.gl.bindFramebuffer(_,e.state.copyFrameBuffer),pe(t.type)||t.type===y)for(let b=s;b<s+p;++b)Ue(e.gl,C,{texture:t,mipLevel:r,slice:b}),pe(l.type)?e.gl.copyTexSubImage3D(h+(d?b:0),i,o,c,u,n,a,f,g):e.gl.copyTexSubImage2D(h+(d?b:0),i,o,c,n,a,f,g);else{const s=0;Ue(e.gl,C,{texture:t,mipLevel:r,slice:s}),pe(l.type)?e.gl.copyTexSubImage3D(h+(d?s:0),i,o,c,u,n,a,f,g):e.gl.copyTexSubImage2D(h+(d?s:0),i,o,c,n,a,f,g)}e.gl.bindFramebuffer(_,e.pass?e.pass.glfb:null)}(Ye.get(e),{texture:Ye.get(t),mipLevel:r>>>0,origin:[n>>>0,a>>>0,s>>>0]},{texture:Ye.get(l),mipLevel:i>>>0,origin:[o>>>0,c>>>0,u>>>0]},[f>>>0,g>>>0,p>>>0])}function Dt(e,t,r,n,a,s,l,i,o,c,u,f,g){!function(e,{texture:t,mipLevel:r=0,origin:[n,a,s]=[0,0,0]},l,{offset:i=0,bytesPerRow:o,rowsPerImage:c=0},[u,f,g]=[t.width-n,t.height-a,t.depth-s]){e.gl.bindBuffer(35051,l),e.gl.readBuffer(C),e.gl.bindFramebuffer(_,e.state.copyFrameBuffer);const p=xe(t.format),d=me(t.format),h=ye(t.format),b=c||f,m=Math.floor(o/h),x=i-i%o;if(e.gl.pixelStorei(3330,m),e.gl.pixelStorei(3332,Math.floor(i%o/h)),e.gl.pixelStorei(3331,0),pe(t.type)||t.type===y)for(let l=s;l<s+g;++l)Ue(e.gl,C,{texture:t,mipLevel:r,slice:l}),e.gl.readPixels(n,a,u,f,d,p,x+(l-s)*o*b);else{const s=0;Ue(e.gl,C,{texture:t,mipLevel:r,slice:s}),e.gl.readPixels(n,a,u,f,d,p,x)}e.gl.bindFramebuffer(_,e.pass?e.pass.glfb:null)}(Ye.get(e),{texture:Ye.get(t),mipLevel:r>>>0,origin:[n>>>0,a>>>0,s>>>0]},Ye.get(l),{offset:i>>>0,bytesPerRow:o>>>0,rowsPerImage:c>>>0},[u>>>0,f>>>0,g>>>0])}function Pt(e,t){!function(e,t){let r=e.gl.drawingBufferWidth,n=e.gl.drawingBufferHeight;t.color.length&&(r=t.color[0].width,n=t.color[0].height),e.gl.bindFramebuffer(_,t.glfb),e.gl.viewport(0,0,r,n),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Pe(e.gl,f,!1));let a=0;if(isNaN(t.clearDepth)||(a|=256,e.gl.clearDepth(t.clearDepth),ke(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(a|=1024,e.gl.clearStencil(t.clearStencil),De(e.gl,e.state.state.stencilWriteMask,We),e.state.state.stencilWriteMask=We),Me(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15,t.color.length){for(let r=0;r<t.color.length;++r)if(t.clearColors[r]){const n=Fe(t.color[r].format);n===p?e.gl.clearBufferiv(k,r,t.clearColors[r]):n===d?e.gl.clearBufferuiv(k,r,t.clearColors[r]):e.gl.clearBufferfv(k,r,t.clearColors[r])}}else t.clearColor&&(a|=o,e.gl.clearColor(...t.clearColor));a&&e.gl.clear(a),e.pass=t}(Ye.get(e),Ye.get(t))}function Ut(e,t,r,n,a,s,l){!function(e,t={}){e.gl.bindFramebuffer(_,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Pe(e.gl,f,!1));let r=0;isNaN(t.clearDepth)||(r|=256,e.gl.clearDepth(t.clearDepth),ke(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(r|=1024,e.gl.clearStencil(t.clearStencil),De(e.gl,e.state.state.stencilWriteMask,We),e.state.state.stencilWriteMask=We),t.clearColor&&(r|=o,e.gl.clearColor(...t.clearColor),Me(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15),r&&e.gl.clear(r),e.pass=null}(Ye.get(e),{clearColor:isNaN(n)?null:[n,a,s,l],clearDepth:t,clearStencil:r})}function At(e){!function(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&Te(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],o,C+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&Te(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}(Ye.get(e))}function Tt(e,t){!function(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),Be(e.gl,e.extDrawBuffersi,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const r=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)r[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let n=0;n<t.buffers.length;++n){const{attributes:a,stride:s,stepMode:l=0}=t.buffers[n],i=[];e.state.buffers[n]={glb:null,attributes:i,stride:s,step:l,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:o}of a)r[o]=(r[o]||0)+2,i.push({buffer:n,ptr:[o,de(e),he(e),be(e),s,t],step:l})}for(let t=0;t<r.length;++t)2===r[t]?e.gl.enableVertexAttribArray(t):1===r[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}(Ye.get(e),Ye.get(t))}function Lt(e,t){!function(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}(Ye.get(e),Ye.get(t))}function Wt(e,t,r,n){!function(e,t,r,n=0){const a=e.state.buffers[t];!a||a.glb===r.glb&&a.offset===n||(a.glb=r.glb,a.offset=n,a.instanceOffset=0,Le(e.gl,a,n))}(Ye.get(e),t>>>0,Ye.get(r),n>>>0)}function Rt(e,t,r,n,a){!function(e,t,r,n=[]){if(e.state.pipeline)for(let a=0,s=0;a<r.entries.length;++a){const l=r.entries[a],i=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][l.binding];if(i)if(l.buffer){let t=l.bufferOffset||0;i.bufferDynamicOffset&&(t+=n[s]||0,++s),e.gl.bindBufferRange(35345,i.slot,l.buffer.glb,t,l.bufferSize||l.buffer.size-t)}else l.texture?(e.gl.activeTexture(F+i.slot),e.gl.bindTexture(l.texture.type,l.texture.glt),e.gl.uniform1i(i.loc,i.slot)):l.sampler&&e.gl.bindSampler(i.slot,l.sampler.gls)}}(Ye.get(e),t>>>0,Ye.get(r),new Uint32Array(Qe(e).buffer.slice(n,n+4*a)))}function Et(e,t,r,n,a){!function(e,t,r=1,n=0,a=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==a&&(t.instanceOffset=a,Le(e.gl,t,a*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,n,t,r)}(Ye.get(e),t>>>0,r>>>0,n>>>0,a>>>0)}function It(e,t,r,n,a){!function(e,t,r=1,n=0,a=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==a&&(t.instanceOffset=a,Le(e.gl,t,a*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,n*(e.state.state.indexFormat===g?2:4),r)}(Ye.get(e),t>>>0,r>>>0,n>>>0,a>>>0)}function Nt(e,t,r,n,a,s,l){!function(e,t,r,n,a,s=0,l=1){e.gl.viewport(t,r,n,a),e.gl.depthRange(s,l)}(Ye.get(e),t>>>0,r>>>0,n>>>0,a>>>0,s>>>0,l>>>0)}function zt(e,t,r,n,a){!function(e,t,r,n,a){e.state.scissor||(Pe(e.gl,f,!0),e.state.scissor=!0),e.gl.scissor(t,r,n,a)}(Ye.get(e),t>>>0,r>>>0,n>>>0,a>>>0)}function jt(e,t,r,n,a){!function(e,t){e.gl.blendColor(...t)}(Ye.get(e),[t,r,n,a])}function Gt(e,t){!function(e,t){if(e.state.stencilRef!==t){const{stencilFrontCompare:r,stencilBackCompare:n,stencilReadMask:a}=e.state.state;e.gl.stencilFuncSeparate(c,r,t,a),e.gl.stencilFuncSeparate(u,n,t,a),e.state.stencilRef=t}}(Ye.get(e),t>>>0)}return t})(),"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mugl",[],t):"object"==typeof exports?exports.mugl=t():e.mugl=t();