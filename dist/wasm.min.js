var e,t;e=self,t=()=>(()=>{var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{begin_default_pass:()=>Pt,begin_render_pass:()=>Dt,copy_buffer:()=>Ct,copy_external_image_to_texture:()=>Mt,copy_texture:()=>Ot,copy_texture_to_buffer:()=>kt,create_bind_group:()=>Ft,create_bind_group_layout:()=>xt,create_buffer:()=>ht,create_image:()=>tt,create_render_pass:()=>St,create_render_pipeline:()=>_t,create_sampler:()=>mt,create_shader:()=>yt,create_texture:()=>bt,delete_bind_group:()=>Qe,delete_bind_group_layout:()=>Qe,delete_buffer:()=>Qe,delete_device:()=>ut,delete_image:()=>nt,delete_render_pass:()=>Qe,delete_render_pipeline:()=>Qe,delete_sampler:()=>Qe,delete_shader:()=>Qe,delete_texture:()=>Qe,draw:()=>Rt,draw_indexed:()=>zt,free_context:()=>$e,get_canvas_by_id:()=>lt,get_canvas_height:()=>ot,get_canvas_width:()=>it,get_device_features:()=>dt,get_future_status:()=>et,get_image_by_id:()=>rt,get_image_height:()=>at,get_image_width:()=>st,is_device_lost:()=>pt,read_buffer:()=>wt,reset_device:()=>gt,set_bind_group:()=>Wt,set_blend_const:()=>Nt,set_context_memory:()=>Ze,set_index:()=>At,set_render_pipeline:()=>Tt,set_scissor_rect:()=>Et,set_stencil_ref:()=>jt,set_vertex:()=>Lt,set_viewport:()=>It,submit_render_pass:()=>Ut,webgl_generate_mipmap:()=>ft,webgl_request_device:()=>ct,write_buffer:()=>vt,write_texture:()=>Bt});const r=2097151,n=2**32;function s(e,t){return(t&r)*n+(e>>>0)}function a(e){return e>>>0}class l{generations=[];freeList=[];get size(){return this.generations.length-this.freeList.length}clear(){this.generations.length=0,this.freeList.length=0}add(){let e,t;return this.freeList.length>0?(e=this.freeList.pop(),t=Math.abs(this.generations[e]),this.generations[e]=t):(e=this.generations.length,t=e?0:1,this.generations.push(t)),s(e,t)}delete(e){if(!this.has(e))return!1;const t=a(e);let n=this.generations[t]+1&r;return n||++n,this.generations[t]=-n,this.freeList.push(t),!0}forEach(e){for(const t of this.values())e(t,t)}has(e){return a(e)<this.generations.length&&function(e){return e/n&r}(e)===this.generations[a(e)]}keys(){return this.values()}*values(){for(let e=0;e<this.generations.length;++e){const t=this.generations[e];this.generations[e]>=0&&(yield s(e,t))}}*entries(){for(const e of this.values())yield[e,e]}[Symbol.iterator](){return this.values()}}class i{ids=new l;data=[];get size(){return this.ids.size}add(e){const t=this.ids.add();return this.data[a(t)]=e,t}clear(){this.ids.clear(),this.data.length=0}delete(e){return!!this.ids.delete(e)&&(delete this.data[a(e)],!0)}*entries(){for(const e of this.ids.values())yield[e,this.data[a(e)]]}forEach(e){this.ids.forEach((t=>{e(this.data[a(t)],t)}))}get(e){return this.ids.has(e)?this.data[a(e)]:void 0}has(e){return this.ids.has(e)}keys(){return this.ids.values()}set(e,t){return this.ids.has(e)&&(this.data[a(e)]=t),this}*values(){for(const e of this.ids.values())yield this.data[a(e)]}[Symbol.iterator](){return this.entries()}}const o=16384,c=1028,f=1029,g=3089,u=5123,p=5124,d=5125,h=5126,b=7680,m=9728,y=34067,x=34069,F=33984,_=33071,S=36160,w=36161,v=33189,C=36064,B=36096,M=33306,O=3315,k=6144,D=32856,P=32857,U=33190,T=35907,A=34836,L=34842,W=35898,R=36208,z=36214,I=36220,E=36226,N=36232,j=36238,G=36012,V=36013,q=35056,H=33321,X=33323,Y=33325,J=33326,K=33327,Q=33328,Z=33329,$=33330,ee=33331,te=33332,re=33333,ne=33334,se=33335,ae=33336,le=33337,ie=33338,oe=33339,ce=33340,fe=36756,ge=36757,ue=36759,pe={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float"};function de(e){return 32879===e||35866===e}function he(e){return 15&e}function be(e){switch(e>>4&511){case 36:return h;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return u;case 17:return 5121}return 0}function me(e){return!!(e>>13)}function ye(e){switch(e){case H:case fe:case Y:case J:return 6403;case $:case Z:case te:case ee:case ne:case re:return 36244;case X:case ge:case K:case Q:return 33319;case ae:case se:case ie:case le:case ce:case oe:return 33320;case D:case T:case ue:case P:case L:case A:return 6408;case I:case j:case z:case R:case N:case E:return 36249;case W:return 6407;case v:case U:case G:return 6402;case q:case V:return 34041}return 0}function xe(e){switch(e){case H:case $:case fe:case Z:return 1;case te:case ee:case X:case ae:case ge:case se:case Y:return 2;case ne:case re:case J:case ie:case le:case K:case D:case T:case I:case ue:case j:case P:case W:return 4;case ce:case oe:case Q:case z:case N:case L:return 8;case R:case E:case A:return 16;case v:return 2;case U:case q:case G:return 4;case V:return 8}return 0}function Fe(e){switch(e){case H:case $:case X:case ae:case D:case T:case I:return 5121;case fe:case Z:case ge:case se:case ue:case j:return 5120;case te:case ie:case z:return u;case ee:case le:case N:return 5122;case ne:case ce:case R:return d;case re:case oe:case E:return p;case P:return 33640;case Y:case K:case L:return 5131;case J:case Q:case A:return h;case W:return 35899;case v:return u;case U:return d;case q:return 34042;case G:return h;case V:return 36269}return 0}function _e(e){switch(e){case Z:case ee:case re:case se:case le:case oe:case j:case N:case E:return p;case $:case te:case ne:case ae:case ie:case ce:case I:case z:case R:return d}return h}const Se=255,we=4294967295;let ve=null;function Ce(e){const t=ke();e.blendColor(1,1,1,1),De(e,t,t,0,!0);for(let t=0;t<16;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function Be(e,t,{texture:r,slice:n=0,mipLevel:s=0}){if(de(r.type))e.framebufferTextureLayer(S,t,r.glt,s,n);else{const a=r.type===y?x+n:r.type;e.framebufferTexture2D(S,t,a,r.glt,s)}}function Me(e,t,r){const n=e.createFramebuffer();return e.bindFramebuffer(S,n),Be(e,t,r),n}function Oe(e,t,r,n,s,a=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,r),e.readBuffer(a),e.blitFramebuffer(0,0,n.width,n.height,0,0,n.width,n.height,s,m)}function ke(e={}){const t=e.primitive||{},r=e.depthStencil||{},{stencilFront:n={},stencilBack:s={}}=r,{sampleCount:a=1,alphaToCoverage:l=!1}=e.multisample||{},i=e.targets||{};let o=i.writeMask||15,c=i.blendColor||{},f=i.blendColor||{};return i.targets&&i.targets[0]&&(o=i.targets[0].writeMask||o,c=i.targets[0].blendColor||c,f=i.targets[0].blendAlpha||f),{sampleCount:a,alphaToCoverage:l,topology:t.topology||4,indexFormat:t.indexFormat||u,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:r.depthWrite||!1,depthFormat:r.format||v,depthCompare:r.depthCompare||519,depthBias:r.depthBias||0,depthBiasSlopeScale:r.depthBiasSlopeScale||0,stencil:!(!r.stencilFront&&!r.stencilBack),stencilFrontCompare:n.compare||519,stencilFrontFailOp:n.failOp||b,stencilFrontDepthFailOp:n.depthFailOp||b,stencilFrontPassOp:n.passOp||b,stencilBackCompare:s.compare||519,stencilBackFailOp:s.failOp||b,stencilBackDepthFailOp:s.depthFailOp||b,stencilBackPassOp:s.passOp||b,stencilReadMask:r.stencilReadMask||we,stencilWriteMask:r.stencilWriteMask||we,blend:!!e.targets,blendWriteMask:o,blendColorOp:c.operation||32774,blendColorSrcFactor:c.srcFactor||1,blendColorDstFactor:c.dstFactor||0,blendAlphaOp:f.operation||32774,blendAlphaSrcFactor:f.srcFactor||1,blendAlphaDstFactor:f.dstFactor||0}}function De(e,t,r,n=0,s=!1){let a=!1,l=0,i=0,o=0,g=0;l=r.frontFace,(s||t.frontFace!==l)&&e.frontFace(l),l=r.cullMode,(s||t.cullMode!==l)&&((a=0!==l)&&e.cullFace(l),Ae(e,2884,a)),a=r.alphaToCoverage,(s||t.alphaToCoverage!==a)&&Ae(e,32926,a),a=!!r.depth,(s||t.depth!==a)&&Ae(e,2929,a),(s||a)&&(Ue(e,t.depthWrite,r.depthWrite,s),l=r.depthCompare,(s||t.depthCompare!==l)&&e.depthFunc(l)),l=r.depthBiasSlopeScale,i=r.depthBias,(s||t.depthBiasSlopeScale!==l||t.depthBias!==i)&&(Ae(e,32823,!(!l&&!i)),e.polygonOffset(l,i)),a=!!r.stencil,(s||t.stencil!==a)&&Ae(e,2960,a),(s||a)&&(l=r.stencilReadMask,a=s||t.stencilReadMask!==l,i=r.stencilFrontCompare,(a||t.stencilFrontCompare!==i)&&e.stencilFuncSeparate(c,i,n,l),i=r.stencilBackCompare,(a||t.stencilBackCompare!==i)&&e.stencilFuncSeparate(f,i,n,l),l=r.stencilFrontFailOp,i=r.stencilFrontDepthFailOp,o=r.stencilFrontPassOp,(s||t.stencilFrontFailOp!==l||t.stencilFrontDepthFailOp!==i||t.stencilFrontPassOp!==o)&&e.stencilOpSeparate(c,l,i,o),l=r.stencilBackFailOp,i=r.stencilBackDepthFailOp,o=r.stencilBackPassOp,(s||t.stencilBackFailOp!==l||t.stencilBackDepthFailOp!==i||t.stencilBackPassOp!==o)&&e.stencilOpSeparate(f,l,i,o),Te(e,t.stencilWriteMask,r.stencilWriteMask,s)),a=r.blend,(s||t.blend!==a)&&Ae(e,3042,a),(s||a)&&(l=r.blendColorSrcFactor,i=r.blendColorDstFactor,o=r.blendAlphaSrcFactor,g=r.blendAlphaDstFactor,(s||t.blendColorSrcFactor!==l||t.blendColorDstFactor!==i||t.blendAlphaSrcFactor!==o||t.blendAlphaDstFactor!==g)&&e.blendFuncSeparate(l,i,o,g),l=r.blendColorOp,i=r.blendAlphaOp,(s||t.blendColorOp!==l||t.blendAlphaOp!==i)&&e.blendEquationSeparate(l,i),Pe(e,t.blendWriteMask,r.blendWriteMask,s))}function Pe(e,t,r,n=!1){(n||t!==r)&&e.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))}function Ue(e,t,r,n=!1){(n||t!==r)&&e.depthMask(r)}function Te(e,t,r,n=!1){(n||t!==r)&&e.stencilMask(r)}function Ae(e,t,r){r?e.enable(t):e.disable(t)}function Le(e,t,r){e.bindBuffer(34962,t.glb);for(let n=0;n<t.attributes.length;++n){const{ptr:s,step:a}=t.attributes[n],l=[...s];l[5]+=r,e.vertexAttribPointer(...l),e.vertexAttribDivisor(s[0],a)}}ve=new FinalizationRegistry((({finalizer:e,gl:t})=>{e(t)}));const We=new TextDecoder("utf-8");let Re=new DataView(new ArrayBuffer(0));function ze(e){return Re.buffer!==e.buffer&&(Re=new DataView(e.buffer)),Re}function Ie(e,t,r){return We.decode(new Uint8Array(e.buffer,t,r))}const Ee={},Ne=new i,je=new i,Ge={},Ve=new i,qe={},He={},Xe=new i,Ye={};function Je(e){return Ee[e].memory}function Ke(e){return Je(Ye[e])}function Qe(e){const t=Xe.get(e);t&&(t.destroy(),Xe.delete(e))}function Ze(e,t){(Ee[e]=Ee[e]||{memory:null}).memory=t}function $e(e){delete Ee[e]}function et(e){const t=Ne.get(e);return t?(0!==t.status&&Ne.delete(e),t.status):1}function tt(e,t,r){const n=new Image;return n.crossOrigin="anonymous",n.src=Ie(Je(e),t,r),je.add(n)}function rt(e,t,r){const n=Ie(Je(e),t,r);if(Ge[n])return Ge[n];const s=document.getElementById(n);return s?Ge[n]=je.add(s):0}function nt(e){je.delete(e)}function st(e){return je.get(e)?.width||0}function at(e){return je.get(e)?.height||0}function lt(e,t,r){const n=Ie(Je(e),t,r);if(qe[n])return qe[n];const s=document.getElementById(n);if(!s)return 0;const a=qe[n]=Ve.add(s);return He[a]=e,a}function it(e){return Ve.get(e)?.width||0}function ot(e){return Ve.get(e)?.height||0}function ct(e,t,r){const n=Ve.get(e);if(n){const a=function(e,t={},r=0){const n=e.getContext("webgl2",t);if(n){let t=0;for(const e in pe)r&+e&&n.getExtension(pe[+e])&&(t|=+e);const s=Ce(n),a=e=>{e.deleteFramebuffer(s.copyFrameBuffer)},l={canvas:e,gl:n,state:s,features:t,pass:null,destroy(){a(this.gl)}};return ve.register(l,{finalizer:a,gl:n}),l}return null}(n,{alpha:!!(1&(s=t)),antialias:!!(2&s),depth:!!(4&s),desynchronized:!!(8&s),failIfMajorPerformanceCaveat:!!(16&s),powerPreference:32&s?"high-performance":"low-power",premultipliedAlpha:!!(64&s),preserveDrawingBuffer:!!(128&s),stencil:!!(256&s)},r);if(a){const t=Xe.add(a);return Ye[t]=He[e],t}}var s;return 0}function ft(e,t,r){!function(e,t,r=4352){e.gl.activeTexture(F),e.gl.bindTexture(t.type,t.glt),e.gl.hint(33170,r),e.gl.generateMipmap(t.type)}(Xe.get(e),Xe.get(t),r)}function gt(e){!function(e){e.destroy(),Object.assign(e.state,Ce(e.gl))}(Xe.get(e))}function ut(e){Qe(e),delete Ye[e]}function pt(e){return function(e){return e.gl.isContextLost()}(Xe.get(e))}function dt(e){return function(e){return e.features}(Xe.get(e))}function ht(e,t,r){const n=function(e,t){const r=64&t.usage?35345:16&t.usage?34963:34962,n=8192&t.usage?35040:4096&t.usage?35048:35044,s=e.gl.createBuffer();e.gl.bindBuffer(r,s),e.gl.bufferData(r,t.size,n);const a=e=>{e.deleteBuffer(s)},l={gl:e.gl,glb:s,type:r,size:t.size,destroy(){a(this.gl)}};return ve.register(l,{finalizer:a,gl:e.gl}),l}(Xe.get(e),{size:t>>>0,usage:r>>>0});return Xe.add(n)}function bt(e,t,r,n,s,a,l,i,o){const c=function(e,t){const r=t.sampleCount||1,n=t.dimension||3553,s=t.format||D,a=!function(e){switch(e){case v:case U:case q:case G:case V:return!0}return!1}(s)||4&(t.usage||0),[l,i,o]=t.size||[1,1,1],c=n===y?6:3553===n?1:o;let f=null,g=null;(r>1||!a)&&(g=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(w,g),r>1?e.gl.renderbufferStorageMultisample(w,r,s,l,i):e.gl.renderbufferStorage(w,s,l,i)),a&&(f=e.gl.createTexture(),e.gl.activeTexture(F),e.gl.bindTexture(n,f),de(n)?e.gl.texStorage3D(n,t.mipLevelCount||1,s,l,i,c):e.gl.texStorage2D(n,t.mipLevelCount||1,s,l,i));const u=e=>{e.deleteTexture(f),e.deleteRenderbuffer(g)},p={gl:e.gl,glt:f,glrb:g,type:n,format:s,width:l,height:i,depth:c,samples:r,destroy(){u(this.gl)}};return ve.register(p,{finalizer:u,gl:e.gl}),p}(Xe.get(e),{size:[t>>>0,r>>>0,n>>>0],mipLevelCount:s>>>0,sampleCount:a>>>0,dimension:l>>>0,format:i>>>0,usage:o>>>0});return Xe.add(c)}function mt(e,t,r,n,s,a,l,i,o,c,f){const g=function(e,t={}){const r=e.gl.createSampler();let n=t.minFilter||m;t.mipmapFilter&&(n=t.mipmapFilter===m?n===m?9984:9985:n===m?9986:9987),e.gl.samplerParameteri(r,10241,n),e.gl.samplerParameteri(r,10240,t.magFilter||m),e.gl.samplerParameteri(r,10242,t.addressModeU||_),e.gl.samplerParameteri(r,10243,t.addressModeV||_),e.gl.samplerParameteri(r,32882,t.addressModeW||_),e.gl.samplerParameterf(r,33083,t.lodMaxClamp||32),e.gl.samplerParameterf(r,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(r,34892,34894),e.gl.samplerParameterf(r,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(r,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047)));const s=e=>{e.deleteSampler(r)},a={gls:r,gl:e.gl,destroy(){s(this.gl)}};return ve.register(a,{finalizer:s,gl:e.gl}),a}(Xe.get(e),{addressModeU:t>>>0,addressModeV:r>>>0,addressModeW:n>>>0,magFilter:s>>>0,minFilter:a>>>0,mipmapFilter:l>>>0,lodMinClamp:i,lodMaxClamp:o,compare:c>>>0,maxAnisotropy:f>>>0});return Xe.add(g)}function yt(e,t,r,n){const s=function(e,t){const r=1===t.usage?35633:35632,n=e.gl.createShader(r);e.gl.shaderSource(n,t.code),e.gl.compileShader(n);const s=e=>{e.deleteShader(n)},a={gl:e.gl,gls:n,destroy(){s(this.gl)}};return ve.register(a,{finalizer:s,gl:e.gl}),a}(Xe.get(e),{code:Ie(Ke(e),t,r),usage:n>>>0});return Xe.add(s)}function xt(e,t,r){const n=Ke(e),s=[];for(let e=0;e<r;e++){const r=t+32*e,a=ze(n).getUint32(r+0,!0),l=ze(n).getUint32(r+4,!0),i=ze(n).getUint8(r+16);let o=!1,c=0,f=0,g=3553,u=!1;switch(i){case 0:o=!!ze(n).getUint8(r+20);break;case 1:c=ze(n).getUint32(r+20,!0)>>>0;break;case 2:f=ze(n).getUint32(r+20,!0)>>>0,g=ze(n).getUint32(r+24,!0)>>>0,u=!!ze(n).getUint8(r+28);break;default:throw new RangeError("invalid variant discriminant for BindingType")}s.push({label:Ie(n,a,l),binding:ze(n).getUint32(r+8,!0)>>>0,visibility:ze(n).getUint32(r+12,!0)>>>0,type:i,bufferDynamicOffset:o,samplerType:c,textureSampleType:f,textureDimension:g,textureMultisampled:u})}const a=(Xe.get(e),{entries:{entries:s}.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}});return Xe.add(a)}function Ft(e,t,r,n){const s=Ke(e),a=[];for(let e=0;e<n;e++){const t=r+24*e;let n=null,l=0,i=0,o=null,c=null;switch(ze(s).getUint8(t+4)){case 0:n=Xe.get(ze(s).getFloat64(t+8,!0)),l=ze(s).getUint32(t+16,!0),i=ze(s).getUint32(t+20,!0);break;case 1:o=Xe.get(ze(s).getFloat64(t+8,!0));break;case 2:c=Xe.get(ze(s).getFloat64(t+8,!0));break;default:throw new RangeError("invalid variant discriminant for BindingResource")}a.push({binding:ze(s).getUint32(t+0,!0),buffer:n,bufferOffset:l,bufferSize:i,sampler:o,texture:c})}const l=(Xe.get(e),{entries:{layout:Xe.get(t),entries:a}.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}});return Xe.add(l)}function _t(e,t,r,n,s,a,l,i,o,c,f,g,u,p,d,h,b,m,y,x,F,_,S,w,v,C,B,M,O,k,D,P,U,T,A,L,W,R,z,I,E){const N=Ke(e),j=[];for(let e=0;e<s;e++){const t=n+12*e;j.push({format:ze(N).getUint32(t+0,!0),offset:ze(N).getUint32(t+4,!0),shaderLocation:ze(N).getUint32(t+8,!0)})}const G=[];for(let e=0;e<l;e++){const t=a+16*e,r=ze(N).getUint32(t+0,!0),n=ze(N).getUint32(t+4,!0);G.push({attributes:j.slice(r,r+n),stride:ze(N).getUint32(t+8,!0),stepMode:ze(N).getUint32(t+12,!0)})}const V=[];for(let e=0;e<o;e++){const t=i+8*e;V.push(Xe.get(ze(N).getFloat64(t+0,!0)))}const q=[];for(let e=0;e<T;e++){const t=U+32*e;q.push({format:ze(N).getUint32(t+0,!0)>>>0,writeMask:ze(N).getUint32(t+4,!0)>>>0,blendColor:{operation:ze(N).getUint32(t+8,!0)>>>0,srcFactor:ze(N).getUint32(t+12,!0)>>>0,dstFactor:ze(N).getUint32(t+16,!0)>>>0},blendAlpha:{operation:ze(N).getUint32(t+20,!0)>>>0,srcFactor:ze(N).getUint32(t+24,!0)>>>0,dstFactor:ze(N).getUint32(t+28,!0)>>>0}})}const H=function(e,t){const r=function(e,t,r){const n=e.gl.createProgram();return e.gl.attachShader(n,t),e.gl.attachShader(n,r),e.gl.linkProgram(n),n}(e,t.vertex.gls,t.fragment.gls),n=[],s={};let a=0,l=0;if(t.bindGroups){for(let i=0;i<t.bindGroups.length;++i){const o=t.bindGroups[i].entries;n.push([]);for(let t=0;t<o.length;++t){const c=o[t];let f=null,g=4294967295;0===c.type?(g=e.gl.getUniformBlockIndex(r,c.label),e.gl.uniformBlockBinding(r,g,a++)):2===c.type&&(f=e.gl.getUniformLocation(r,c.label),s[c.label]=l++),n[i][c.binding]={...c,loc:f,index:g,slot:0===c.type?a-1:2===c.type?l-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const r=t.bindGroups[e].entries;for(let t=0;t<r.length;++t)1===r[t].type&&s[r[t].label]&&(n[e][r[t].binding].slot=s[r[t].label])}}const i=e=>{e.deleteProgram(r)},o={gl:e.gl,glp:r,buffers:t.buffers,cache:n,state:ke(t),destroy(){i(this.gl)}};return ve.register(o,{finalizer:i,gl:e.gl}),o}(Xe.get(e),{vertex:Xe.get(t),fragment:Xe.get(r),buffers:G,bindGroups:V,primitive:{topology:c>>>0,indexFormat:f>>>0,frontFace:g>>>0,cullMode:u>>>0},multisample:{sampleCount:p>>>0,alphaToCoverage:!!d},depthStencil:h?{format:b>>>0,depthWrite:!!m,depthCompare:y>>>0,stencilFront:{compare:x>>>0,failOp:F>>>0,depthFailOp:_>>>0,passOp:S>>>0},stencilBack:{compare:w>>>0,failOp:v>>>0,depthFailOp:C>>>0,passOp:B>>>0},stencilReadMask:M>>>0,stencilWriteMask:O>>>0,depthBias:k,depthBiasSlopeScale:D,depthBiasClamp:P}:null,targets:{writeMask:A>>>0,blendColor:{operation:L>>>0,srcFactor:W>>>0,dstFactor:R>>>0},blendAlpha:{operation:z>>>0,srcFactor:I>>>0,dstFactor:E>>>0},targets:q}});return Xe.add(H)}function St(e,t,r,n,s,a,l,i,o,c,f,g,u){const p=Ke(e);let d;switch(i){case 0:d={clearDepth:t,clearStencil:r,clearColor:isNaN(n)?null:[n,s,a,l]};break;case 1:{const e=[];for(let t=0;t<u;t++){const r=g+32*t,n=[ze(p).getFloat32(r+16,!0),ze(p).getFloat32(r+20,!0),ze(p).getFloat32(r+24,!0),ze(p).getFloat32(r+28,!0)];e.push({view:{texture:Xe.get(ze(p).getFloat64(r+0,!0)),mipLevel:ze(p).getUint32(r+8,!0),slice:ze(p).getUint32(r+12,!0)},clear:isNaN(n[0])?null:n})}d={clearDepth:t,clearStencil:r,colors:e,depthStencil:{texture:Xe.get(o),mipLevel:c>>>0,slice:f>>>0}};break}default:throw new RangeError("invalid variant discriminant for RenderPassDescriptor")}const h=function(e,t={}){let r=null;const n=[],s=t.depthStencil?t.depthStencil.texture:null,a=s&&function(e){switch(e){case 36168:case q:case V:return!0}return!1}(s.format)||!1;if(t.colors&&t.colors.length){r=e.gl.createFramebuffer(),e.gl.bindFramebuffer(S,r);for(let r=0;r<t.colors.length;++r)t.colors[r].view.texture.samples>1?e.gl.framebufferRenderbuffer(S,C+r,w,t.colors[r].view.texture.glrb):Be(e.gl,C+r,t.colors[r].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>C+t))),s&&(s.glrb?e.gl.framebufferRenderbuffer(S,a?M:B,w,s.glrb):Be(e.gl,a?M:B,t.depthStencil));for(let r=0;r<t.colors.length;++r)n.push(t.colors[r].view.texture.samples>1?Me(e.gl,C,t.colors[r].view):null);n.push(s&&s.samples>1&&s.glt?Me(e.gl,a?M:B,t.depthStencil):null)}const l=e=>{e.deleteFramebuffer(r);for(const t of n)e.deleteFramebuffer(t)},i={gl:e.gl,glfb:r,glrfb:n,depth:s,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){l(this.gl)}};return ve.register(i,{finalizer:l,gl:e.gl}),i}(Xe.get(e),d);return Xe.add(h)}function wt(e,t,r,n,s){const a=function(e,t,r,n=0){const s={status:0};return function(e,t,r,n,s){const a=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),function(e,t,r,n){return new Promise(((r,n)=>{!function s(){const a=e.clientWaitSync(t,0,0);37149==a?n():37147==a?setTimeout(s,10):r()}()}))}(e,a).finally((()=>e.deleteSync(a))).then((()=>{const a=new Uint8Array(s);return e.bindBuffer(t,r),e.getBufferSubData(t,n,a,0,s),a}))}(e.gl,t.type,t.glb,n,r.byteLength).then((e=>{r.set(e),s.status=1}),(()=>s.status=2)),s}(Xe.get(e),Xe.get(t),new Uint8Array(Ke(e).buffer.slice(n,n+1*s),r>>>0));return Ne.add(a)}function vt(e,t,r,n,s){!function(e,t,r,n=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,n,r)}(Xe.get(e),Xe.get(t),new Uint8Array(Ke(e).buffer.slice(r,r+1*n)),s>>>0)}function Ct(e,t,r,n,s,a){!function(e,t,r,n=t.size,s=0,a=0){e.gl.bindBuffer(36662,t.glb),e.gl.bindBuffer(36663,r.glb),e.gl.copyBufferSubData(36662,36663,s,a,n)}(Xe.get(e),Xe.get(t),Xe.get(r),n>>>0,s>>>0,a>>>0)}function Bt(e,t,r,n,s,a,l,i,o,c,f,g,u,p){!function(e,{texture:t,mipLevel:r=0,origin:[n,s,a]=[0,0,0]},l,{offset:i=0,bytesPerRow:o,rowsPerImage:c=0},[f,g,u]=[t.width-n,t.height-s,t.depth-a]){const p=ye(t.format),d=Fe(t.format),h=t.type===y,b=h?x+a:t.type;e.gl.activeTexture(F),e.gl.bindTexture(t.type,t.glt);const m=xe(t.format),_=c||g,S=Math.floor(o/m),w=i-i%o;if(e.gl.pixelStorei(32878,_),e.gl.pixelStorei(3314,S),e.gl.pixelStorei(3316,Math.floor(i%o/m)),e.gl.pixelStorei(O,0),e.gl.pixelStorei(32877,0),de(t.type))e.gl.texSubImage3D(b,r,n,s,a,f,g,u,t.format,d,l,w);else if(h)for(let t=a;t<a+u;++t)e.gl.pixelStorei(O,t*S*_),e.gl.texSubImage2D(b+t,r,n,s,f,g,p,d,l,w);else e.gl.texSubImage2D(b,r,n,s,f,g,p,d,l,w)}(Xe.get(e),{texture:Xe.get(t),mipLevel:r>>>0,origin:[n>>>0,s>>>0,a>>>0]},new Uint8Array(Ke(e).buffer.slice(l,l+1*i)),{offset:o>>>0,bytesPerRow:c>>>0,rowsPerImage:f>>>0},[g>>>0,u>>>0,p>>>0])}function Mt(e,t,r,n,s,a,l,i,o,c,f){!function(e,{src:t,origin:[r,n]=[0,0]},{texture:s,mipLevel:a=0,origin:[l,i,o]=[0,0,0]},[c,f]=[t.width-r,t.height-n]){const g=Fe(s.format),u=s.type===y?x+o:s.type;e.gl.activeTexture(F),e.gl.bindTexture(s.type,s.glt),e.gl.pixelStorei(3316,r),e.gl.pixelStorei(O,n),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),de(s.type)?e.gl.texSubImage3D(u,a,l,i,o,c,f,1,s.format,g,t):e.gl.texSubImage2D(u,a,l,i,c,f,ye(s.format),g,t)}(Xe.get(e),{src:je.get(t),origin:[r>>>0,n>>>0]},{texture:Xe.get(s),mipLevel:a>>>0,origin:[l>>>0,i>>>0,o>>>0]},[c>>>0,f>>>0])}function Ot(e,t,r,n,s,a,l,i,o,c,f,g,u,p){!function(e,{texture:t,mipLevel:r=0,origin:[n,s,a]=[0,0,0]},{texture:l,mipLevel:i=0,origin:[o,c,f]=[0,0,0]},[g,u,p]=[t.width-n,t.height-s,t.depth-a]){const d=l.type===y,h=d?x+f:l.type;if(e.gl.activeTexture(F),e.gl.bindTexture(l.type,l.glt),e.gl.readBuffer(C),e.gl.bindFramebuffer(S,e.state.copyFrameBuffer),de(t.type)||t.type===y)for(let b=a;b<a+p;++b)Be(e.gl,C,{texture:t,mipLevel:r,slice:b}),de(l.type)?e.gl.copyTexSubImage3D(h+(d?b:0),i,o,c,f,n,s,g,u):e.gl.copyTexSubImage2D(h+(d?b:0),i,o,c,n,s,g,u);else{const a=0;Be(e.gl,C,{texture:t,mipLevel:r,slice:a}),de(l.type)?e.gl.copyTexSubImage3D(h+(d?a:0),i,o,c,f,n,s,g,u):e.gl.copyTexSubImage2D(h+(d?a:0),i,o,c,n,s,g,u)}e.gl.bindFramebuffer(S,e.pass?e.pass.glfb:null)}(Xe.get(e),{texture:Xe.get(t),mipLevel:r>>>0,origin:[n>>>0,s>>>0,a>>>0]},{texture:Xe.get(l),mipLevel:i>>>0,origin:[o>>>0,c>>>0,f>>>0]},[g>>>0,u>>>0,p>>>0])}function kt(e,t,r,n,s,a,l,i,o,c,f,g,u){!function(e,{texture:t,mipLevel:r=0,origin:[n,s,a]=[0,0,0]},l,{offset:i=0,bytesPerRow:o,rowsPerImage:c=0},[f,g,u]=[t.width-n,t.height-s,t.depth-a]){e.gl.bindBuffer(35051,l),e.gl.readBuffer(C),e.gl.bindFramebuffer(S,e.state.copyFrameBuffer);const p=Fe(t.format),d=ye(t.format),h=xe(t.format),b=c||g,m=Math.floor(o/h),x=i-i%o;if(e.gl.pixelStorei(3330,m),e.gl.pixelStorei(3332,Math.floor(i%o/h)),e.gl.pixelStorei(3331,0),de(t.type)||t.type===y)for(let l=a;l<a+u;++l)Be(e.gl,C,{texture:t,mipLevel:r,slice:l}),e.gl.readPixels(n,s,f,g,d,p,x+(l-a)*o*b);else{const a=0;Be(e.gl,C,{texture:t,mipLevel:r,slice:a}),e.gl.readPixels(n,s,f,g,d,p,x)}e.gl.bindFramebuffer(S,e.pass?e.pass.glfb:null)}(Xe.get(e),{texture:Xe.get(t),mipLevel:r>>>0,origin:[n>>>0,s>>>0,a>>>0]},Xe.get(l),{offset:i>>>0,bytesPerRow:o>>>0,rowsPerImage:c>>>0},[f>>>0,g>>>0,u>>>0])}function Dt(e,t){!function(e,t){let r=e.gl.drawingBufferWidth,n=e.gl.drawingBufferHeight;t.color.length&&(r=t.color[0].width,n=t.color[0].height),e.gl.bindFramebuffer(S,t.glfb),e.gl.viewport(0,0,r,n),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Ae(e.gl,g,!1));let s=0;if(isNaN(t.clearDepth)||(s|=256,e.gl.clearDepth(t.clearDepth),Ue(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(s|=1024,e.gl.clearStencil(t.clearStencil),Te(e.gl,e.state.state.stencilWriteMask,Se),e.state.state.stencilWriteMask=Se),Pe(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15,t.color.length){for(let r=0;r<t.color.length;++r)if(t.clearColors[r]){const n=_e(t.color[r].format);n===p?e.gl.clearBufferiv(k,r,t.clearColors[r]):n===d?e.gl.clearBufferuiv(k,r,t.clearColors[r]):e.gl.clearBufferfv(k,r,t.clearColors[r])}}else t.clearColor&&(s|=o,e.gl.clearColor(...t.clearColor));s&&e.gl.clear(s),e.pass=t}(Xe.get(e),Xe.get(t))}function Pt(e,t,r,n,s,a,l){!function(e,t={}){e.gl.bindFramebuffer(S,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Ae(e.gl,g,!1));let r=0;isNaN(t.clearDepth)||(r|=256,e.gl.clearDepth(t.clearDepth),Ue(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(r|=1024,e.gl.clearStencil(t.clearStencil),Te(e.gl,e.state.state.stencilWriteMask,Se),e.state.state.stencilWriteMask=Se),t.clearColor&&(r|=o,e.gl.clearColor(...t.clearColor),Pe(e.gl,e.state.state.blendWriteMask,15),e.state.state.blendWriteMask=15),r&&e.gl.clear(r),e.pass=null}(Xe.get(e),{clearColor:isNaN(n)?null:[n,s,a,l],clearDepth:t,clearStencil:r})}function Ut(e){!function(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&Oe(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],o,C+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&Oe(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}(Xe.get(e))}function Tt(e,t){!function(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),De(e.gl,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const r=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)r[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let n=0;n<t.buffers.length;++n){const{attributes:s,stride:a,stepMode:l=0}=t.buffers[n],i=[];e.state.buffers[n]={glb:null,attributes:i,stride:a,step:l,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:o}of s)r[o]=(r[o]||0)+2,i.push({buffer:n,ptr:[o,he(e),be(e),me(e),a,t],step:l})}for(let t=0;t<r.length;++t)2===r[t]?e.gl.enableVertexAttribArray(t):1===r[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}(Xe.get(e),Xe.get(t))}function At(e,t){!function(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}(Xe.get(e),Xe.get(t))}function Lt(e,t,r,n){!function(e,t,r,n=0){const s=e.state.buffers[t];!s||s.glb===r.glb&&s.offset===n||(s.glb=r.glb,s.offset=n,s.instanceOffset=0,Le(e.gl,s,n))}(Xe.get(e),t>>>0,Xe.get(r),n>>>0)}function Wt(e,t,r,n,s){!function(e,t,r,n=[]){if(e.state.pipeline)for(let s=0,a=0;s<r.entries.length;++s){const l=r.entries[s],i=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][l.binding];if(i)if(l.buffer){let t=l.bufferOffset||0;i.bufferDynamicOffset&&(t+=n[a]||0,++a),e.gl.bindBufferRange(35345,i.slot,l.buffer.glb,t,l.bufferSize||l.buffer.size-t)}else l.texture?(e.gl.activeTexture(F+i.slot),e.gl.bindTexture(l.texture.type,l.texture.glt),e.gl.uniform1i(i.loc,i.slot)):l.sampler&&e.gl.bindSampler(i.slot,l.sampler.gls)}}(Xe.get(e),t>>>0,Xe.get(r),new Uint32Array(Ke(e).buffer.slice(n,n+4*s)))}function Rt(e,t,r,n,s){!function(e,t,r=1,n=0,s=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==s&&(t.instanceOffset=s,Le(e.gl,t,s*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,n,t,r)}(Xe.get(e),t>>>0,r>>>0,n>>>0,s>>>0)}function zt(e,t,r,n,s){!function(e,t,r=1,n=0,s=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==s&&(t.instanceOffset=s,Le(e.gl,t,s*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,n*(e.state.state.indexFormat===u?2:4),r)}(Xe.get(e),t>>>0,r>>>0,n>>>0,s>>>0)}function It(e,t,r,n,s,a,l){!function(e,t,r,n,s,a=0,l=1){e.gl.viewport(t,r,n,s),e.gl.depthRange(a,l)}(Xe.get(e),t>>>0,r>>>0,n>>>0,s>>>0,a>>>0,l>>>0)}function Et(e,t,r,n,s){!function(e,t,r,n,s){e.state.scissor||(Ae(e.gl,g,!0),e.state.scissor=!0),e.gl.scissor(t,r,n,s)}(Xe.get(e),t>>>0,r>>>0,n>>>0,s>>>0)}function Nt(e,t,r,n,s){!function(e,t){e.gl.blendColor(...t)}(Xe.get(e),[t,r,n,s])}function jt(e,t){!function(e,t){if(e.state.stencilRef!==t){const{stencilFrontCompare:r,stencilBackCompare:n,stencilReadMask:s}=e.state.state;e.gl.stencilFuncSeparate(c,r,t,s),e.gl.stencilFuncSeparate(f,n,t,s),e.state.stencilRef=t}}(Xe.get(e),t>>>0)}return t})(),"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mugl",[],t):"object"==typeof exports?exports.mugl=t():e.mugl=t();