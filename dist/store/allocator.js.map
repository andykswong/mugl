{"version":3,"file":"allocator.js","names":["create","id","generationOf","indexOf","MAX_SAFE_GENERATION","Symbol","iterator","IdAllocator","generations","freeList","size","length","clear","index","generation","pop","Math","abs","push","delete","has","forEach","callbackFn","thisArg","values","call","i"],"sources":["../../js/store/allocator.ts"],"sourcesContent":["import { create as id, generationOf, indexOf, MAX_SAFE_GENERATION } from \"./id\";\n\n/** Allocator of generational index IDs. */\nexport class IdAllocator {\n  private generations: number[] = [];\n  private freeList: number[] = [];\n\n  public get size(): number {\n    return this.generations.length - this.freeList.length;\n  }\n\n  public clear(): void {\n    this.generations.length = 0;\n    this.freeList.length = 0;\n  }\n\n  public create(): number {\n    let index: number;\n    let generation: number;\n\n    if (this.freeList.length > 0) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      index = this.freeList.pop()!;\n      generation = Math.abs(this.generations[index]);\n      this.generations[index] = generation;\n    } else {\n      index = this.generations.length;\n      generation = index ? 0 : 1; // avoids 0 Id as it is usually reserved for null.\n      this.generations.push(generation);\n    }\n\n    return id(index, generation);\n  }\n\n  public delete(id: number): boolean {\n    if (!this.has(id)) {\n      return false;\n    }\n\n    const index = indexOf(id);\n    // Use negative sign to indicate free space\n    let generation = -((this.generations[index] + 1) & MAX_SAFE_GENERATION);\n    if (!index && !generation) {\n      ++generation; // avoids 0 Id as it is usually reserved for null.\n    }\n\n    this.generations[index] = generation;\n    this.freeList.push(index);\n\n    return true;\n  }\n\n  public forEach<C>(callbackFn: (id: number, index: number, self: IdAllocator) => void, thisArg?: C): void {\n    let index = 0;\n    for (const id of this.values()) {\n      callbackFn.call(thisArg, id, index, this);\n      index += 1;\n    }\n  }\n\n  public has(id: number): boolean {\n    return (indexOf(id) < this.generations.length\n      && generationOf(id) === this.generations[indexOf(id)]);\n  }\n\n  public * values(): Iterable<number> {\n    for (let i = 0; i < this.generations.length; ++i) {\n      const generation = this.generations[i];\n      if (this.generations[i] >= 0) {\n        yield id(i, generation);\n      }\n    }\n  }\n\n  public [Symbol.iterator](): Iterable<number> {\n    return this.values();\n  }\n}\n"],"mappings":"4BAASA,MAAM,GAAIC,G,CAAIC,Y,CAAcC,O,CAASC,mB,gCA0EpCC,MAAM,CAACC,Q,CAvEjB,MAAO,MAAMC,YAAY,oBACfC,WADe,CACS,EADT,MAEfC,QAFe,CAEM,EAFN,CAIR,GAAJC,KAAI,EAAW,CACxB,MAAO,MAAKF,WAAL,CAAiBG,MAAjB,CAA0B,KAAKF,QAAL,CAAcE,MAChD,CAEMC,KAAK,EAAS,CACnB,KAAKJ,WAAL,CAAiBG,MAAjB,CAA0B,CAA1B,CACA,KAAKF,QAAL,CAAcE,MAAd,CAAuB,CACxB,CAEMX,MAAM,EAAW,CACtB,GAAIa,MAAJ,CACA,GAAIC,WAAJ,CAEA,GAAI,KAAKL,QAAL,CAAcE,MAAd,CAAuB,CAA3B,CAA8B,CAE5BE,KAAK,CAAG,KAAKJ,QAAL,CAAcM,GAAd,EAAR,CACAD,UAAU,CAAGE,IAAI,CAACC,GAAL,CAAS,KAAKT,WAAL,CAAiBK,KAAjB,CAAT,CAAb,CACA,KAAKL,WAAL,CAAiBK,KAAjB,EAA0BC,UAC3B,CALD,IAKO,CACLD,KAAK,CAAG,KAAKL,WAAL,CAAiBG,MAAzB,CACAG,UAAU,CAAGD,KAAK,CAAG,CAAH,CAAO,CAAzB,CACA,KAAKL,WAAL,CAAiBU,IAAjB,CAAsBJ,UAAtB,CACD,CAED,MAAOb,GAAE,CAACY,KAAD,CAAQC,UAAR,CACV,CAEMK,MAAM,CAAClB,EAAD,CAAsB,CACjC,GAAI,CAAC,KAAKmB,GAAL,CAASnB,EAAT,CAAL,CAAmB,CACjB,MAAO,MACR,CAED,KAAMY,MAAK,CAAGV,OAAO,CAACF,EAAD,CAArB,CAEA,GAAIa,WAAU,CAAG,EAAG,KAAKN,WAAL,CAAiBK,KAAjB,EAA0B,CAA3B,CAAgCT,mBAAlC,CAAjB,CACA,GAAI,CAACS,KAAD,EAAU,CAACC,UAAf,CAA2B,CACzB,EAAEA,UACH,CAED,KAAKN,WAAL,CAAiBK,KAAjB,EAA0BC,UAA1B,CACA,KAAKL,QAAL,CAAcS,IAAd,CAAmBL,KAAnB,EAEA,MAAO,KACR,CAEMQ,OAAO,CAAIC,UAAJ,CAAwEC,OAAxE,CAA2F,CACvG,GAAIV,MAAK,CAAG,CAAZ,CACA,IAAK,KAAMZ,GAAX,GAAiB,MAAKuB,MAAL,EAAjB,CAAgC,CAC9BF,UAAU,CAACG,IAAX,CAAgBF,OAAhB,CAAyBtB,EAAzB,CAA6BY,KAA7B,CAAoC,IAApC,EACAA,KAAK,EAAI,CACV,CACF,CAEMO,GAAG,CAACnB,EAAD,CAAsB,CAC9B,MAAQE,QAAO,CAACF,EAAD,CAAP,CAAc,KAAKO,WAAL,CAAiBG,MAA/B,EACHT,YAAY,CAACD,EAAD,CAAZ,GAAqB,KAAKO,WAAL,CAAiBL,OAAO,CAACF,EAAD,CAAxB,CAC3B,CAEc,CAANuB,MAAM,EAAqB,CAClC,IAAK,GAAIE,EAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG,KAAKlB,WAAL,CAAiBG,MAArC,CAA6C,EAAEe,CAA/C,CAAkD,CAChD,KAAMZ,WAAU,CAAG,KAAKN,WAAL,CAAiBkB,CAAjB,CAAnB,CACA,GAAI,KAAKlB,WAAL,CAAiBkB,CAAjB,GAAuB,CAA3B,CAA8B,CAC5B,KAAMzB,GAAE,CAACyB,CAAD,CAAIZ,UAAJ,CACT,CACF,CACF,CAED,oBAA6C,CAC3C,MAAO,MAAKU,MAAL,EACR,CAzEsB"}