var e,t;e=self,t=function(){return(()=>{var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AddressMode:()=>Fe,BindingType:()=>we,BlendFactor:()=>ve,BlendOperation:()=>Ae,BufferUsage:()=>de,ColorWrite:()=>me,CompareFunction:()=>ye,CubeMapFace:()=>Ge,CullMode:()=>Ce,FilterMode:()=>Se,FrontFace:()=>Oe,FutureStatus:()=>s,IndexFormat:()=>Me,MUGL_DEBUG:()=>a,MUGL_FINALIZER:()=>l,MipmapHint:()=>We,PrimitiveTopology:()=>Re,SamplerBindingType:()=>ke,ShaderStage:()=>Be,StencilOperation:()=>De,TextureDimension:()=>he,TextureFormat:()=>xe,TextureSampleType:()=>Pe,TextureUsage:()=>be,VertexFormat:()=>Te,VertexStepMode:()=>Ie,WebGL:()=>r,WebGL2Feature:()=>Xe,vertexBufferLayouts:()=>ze});var r={};e.r(r),e.d(r,{beginDefaultPass:()=>St,beginRenderPass:()=>Ft,copyBuffer:()=>gt,copyExternalImageToTexture:()=>mt,copyTexture:()=>ht,copyTextureToBuffer:()=>xt,createBindGroup:()=>ot,createBindGroupLayout:()=>ct,createBuffer:()=>at,createRenderPass:()=>it,createRenderPipeline:()=>ft,createSampler:()=>st,createShader:()=>nt,createTexture:()=>lt,draw:()=>Ct,drawIndexed:()=>Dt,generateMipmap:()=>dt,getDeviceFeatures:()=>rt,isDeviceLost:()=>tt,readBuffer:()=>ut,requestWebGL2Device:()=>$e,resetDevice:()=>et,setBindGroup:()=>Ot,setBlendConst:()=>It,setIndex:()=>Rt,setRenderPipeline:()=>Bt,setScissorRect:()=>At,setStencilRef:()=>Tt,setVertex:()=>Mt,setViewport:()=>vt,submitRenderPass:()=>yt,writeBuffer:()=>pt,writeTexture:()=>bt});const a=!1,l=!0,s={Pending:0,Done:1,Error:2},n=16384,i=32774,c=1028,o=1029,f=3089,u=5123,p=5124,g=5125,d=5126,b=519,m=7680,h=9728,x=3553,F=34067,S=34069,y=33984,B=33071,R=36160,M=36161,O=33189,C=36064,D=36096,v=33306,A=3315,I=6144,T=32856,w=32857,k=33190,P=35907,G=34836,W=34842,L=35898,U=36208,N=36214,_=36220,E=36226,z=36232,V=36238,j=36012,q=36013,Z=35056,H=33321,X=33323,Y=33325,K=33326,J=33327,Q=33328,$=33329,ee=33330,te=33331,re=33332,ae=33333,le=33334,se=33335,ne=33336,ie=33337,ce=33338,oe=33339,fe=33340,ue=36756,pe=36757,ge=36759,de={Index:16,Vertex:32,Uniform:64,Dynamic:4096,Stream:8192},be={TextureBinding:4,RenderAttachment:16},me={Red:1,Green:2,Blue:4,Alpha:8,All:15},he={D2:x,D2Array:35866,CubeMap:F,D3:32879},xe={R8:H,R8SNORM:ue,R8UI:ee,R8I:$,R16UI:re,R16I:te,RG8:X,RG8SNORM:pe,RG8UI:ne,RG8I:se,R32UI:le,R32I:ae,RG16UI:ce,RG16I:ie,RGBA8:T,SRGBA8:P,RGBA8SNORM:ge,RGBA8UI:_,RGBA8I:V,RGB10A2:w,RG32UI:fe,RG32I:oe,RGBA16UI:N,RGBA16I:z,RGBA32UI:U,RGBA32I:E,R16F:Y,RG16F:J,RG11B10F:L,RGBA16F:W,R32F:K,RG32F:Q,RGBA32F:G,Depth16:O,Depth24:k,Depth24Stencil8:Z,Depth32F:j,Depth32FStencil8:q},Fe={ClampToEdge:B,Repeat:10497,MirrorRepeat:33648},Se={Nearest:h,Linear:9729},ye={Never:512,Less:513,Equal:514,LessEqual:515,Greater:516,NotEqual:517,GreaterEqual:518,Always:b},Be={Vertex:1,Fragment:2},Re={Points:0,Lines:1,LineStrip:3,Triangles:4,TriangleStrip:5},Me={UInt16:u,UInt32:g},Oe={CCW:2305,CW:2304},Ce={None:0,Front:c,Back:o},De={Keep:m,Zero:0,Replace:7681,Invert:5386,Increment:7682,Decrement:7683,IncrementWrap:34055,DecrementWrap:34056},ve={Zero:0,One:1,Src:768,OneMinusSrc:769,SrcAlpha:770,OneMinusSrcAlpha:771,Dst:774,OneMinusDst:775,DstAlpha:772,OneMinusDstAlpha:773,SrcAlphaSaturated:776,Constant:32769,OneMinusConstant:32770},Ae={Add:i,Subtract:32778,ReverseSubtract:32779,Min:32775,Max:32776},Ie={Vertex:0,Instance:1},Te={UI8x2:274,UI8x4:276,I8x2:4370,I8x4:4372,UNORM8x2:8466,UNORM8x4:8468,SNORM8x2:12562,SNORM8x4:12564,UI16x2:290,UI16x4:292,I16x2:4386,I16x4:4388,UNORM16x2:8482,UNORM16x4:8484,SNORM16x2:12578,SNORM16x4:12580,F16x2:546,F16x4:548,F32:577,F32x2:578,F32x3:579,F32x4:580},we={Buffer:0,Sampler:1,Texture:2},ke={Filtering:0,NonFiltering:1,Comparison:2},Pe={Float:0,Depth:1,Int:2,UInt:3},Ge={X:0,NegativeX:1,Y:2,NegativeY:3,Z:4,NegativeZ:5},We={Fast:4353,Nice:4354};function Le(e){return 32879===e||35866===e}function Ue(e){return(e>>4&15)*Ne(e)}function Ne(e){return 15&e}function _e(e){switch(e>>4&511){case 36:return d;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return u;case 17:return 5121}return 0}function Ee(e){return!!(e>>13)}function ze(e){let t=0;const r=[];for(let a=0;a<e.length;++a){const l=[];let s=0;for(let r=0;r<e[a].attributes.length;++r){const n=e[a].attributes[r];l.push({format:n,offset:s,shaderLocation:t}),s+=Ue(n),++t}r.push({attributes:l,stride:s,stepMode:e[a].instanced?Ie.Instance:Ie.Vertex})}return r}function Ve(e){switch(e){case O:case k:case Z:case j:case q:return!0}return!1}function je(e){switch(e){case H:case ue:case Y:case K:return 6403;case ee:case $:case re:case te:case le:case ae:return 36244;case X:case pe:case J:case Q:return 33319;case ne:case se:case ce:case ie:case fe:case oe:return 33320;case T:case P:case ge:case w:case W:case G:return 6408;case _:case V:case N:case U:case z:case E:return 36249;case L:return 6407;case O:case k:case j:return 6402;case Z:case q:return 34041}return 0}function qe(e){switch(e){case H:case ee:case ue:case $:return 1;case re:case te:case X:case ne:case pe:case se:case Y:return 2;case le:case ae:case K:case ce:case ie:case J:case T:case P:case _:case ge:case V:case w:case L:return 4;case fe:case oe:case Q:case N:case z:case W:return 8;case U:case E:case G:return 16;case O:return 2;case k:case Z:case j:return 4;case q:return 8}return 0}function Ze(e){switch(e){case H:case ee:case X:case ne:case T:case P:case _:return 5121;case ue:case $:case pe:case se:case ge:case V:return 5120;case re:case ce:case N:return u;case te:case ie:case z:return 5122;case le:case fe:case U:return g;case ae:case oe:case E:return p;case w:return 33640;case Y:case J:case W:return 5131;case K:case Q:case G:return d;case L:return 35899;case O:return u;case k:return g;case Z:return 34042;case j:return d;case q:return 36269}return 0}function He(e){switch(e){case $:case te:case ae:case se:case ie:case oe:case V:case z:case E:return p;case ee:case re:case le:case ne:case ce:case fe:case _:case N:case U:return g}return d}const Xe={TextureAnisotropic:1,TextureHalfFloatLinear:2,TextureFloatLinear:4,ColorBufferFloat:8},Ye={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float"},Ke=255,Je=4294967295;let Qe=null;function $e(e,t={},r=0){const a=e.getContext("webgl2",t);if(a){let t=0;for(const e in Ye)r&+e&&a.getExtension(Ye[+e])&&(t|=+e);const s=wt(a),n=e=>{e.deleteFramebuffer(s.copyFrameBuffer)},i={canvas:e,gl:a,state:s,features:t,pass:null,destroy(){n(this.gl)}};return l&&Qe.register(new WeakRef(i),{finalizer:n,gl:a}),i}return null}function et(e){e.destroy(),Object.assign(e.state,wt(e.gl))}function tt(e){return e.gl.isContextLost()}function rt(e){return e.features}function at(e,t){const r=t.usage&de.Uniform?35345:t.usage&de.Index?34963:34962,a=t.usage&de.Stream?35040:t.usage&de.Dynamic?35048:35044,s=e.gl.createBuffer();e.gl.bindBuffer(r,s),e.gl.bufferData(r,t.size,a);const n=e=>{e.deleteBuffer(s)},i={gl:e.gl,glb:s,type:r,size:t.size,destroy(){n(this.gl)}};return l&&Qe.register(new WeakRef(i),{finalizer:n,gl:e.gl}),i}function lt(e,t){const r=t.sampleCount||1,a=t.dimension||x,s=t.format||T,n=!Ve(s)||(t.usage||0)&be.TextureBinding,[i,c,o]=t.size||[1,1,1],f=a===F?6:a===x?1:o;let u=null,p=null;(r>1||!n)&&(p=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(M,p),r>1?e.gl.renderbufferStorageMultisample(M,r,s,i,c):e.gl.renderbufferStorage(M,s,i,c)),n&&(u=e.gl.createTexture(),e.gl.activeTexture(y),e.gl.bindTexture(a,u),Le(a)?e.gl.texStorage3D(a,t.mipLevelCount||1,s,i,c,f):e.gl.texStorage2D(a,t.mipLevelCount||1,s,i,c));const g=e=>{e.deleteTexture(u),e.deleteRenderbuffer(p)},d={gl:e.gl,glt:u,glrb:p,type:a,format:s,width:i,height:c,depth:f,samples:r,destroy(){g(this.gl)}};return l&&Qe.register(new WeakRef(d),{finalizer:g,gl:e.gl}),d}function st(e,t={}){const r=e.gl.createSampler();let a=t.minFilter||h;t.mipmapFilter&&(a=t.mipmapFilter===h?a===h?9984:9985:a===h?9986:9987),e.gl.samplerParameteri(r,10241,a),e.gl.samplerParameteri(r,10240,t.magFilter||h),e.gl.samplerParameteri(r,10242,t.addressModeU||B),e.gl.samplerParameteri(r,10243,t.addressModeV||B),e.gl.samplerParameteri(r,32882,t.addressModeW||B),e.gl.samplerParameterf(r,33083,t.lodMaxClamp||32),e.gl.samplerParameterf(r,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(r,34892,34894),e.gl.samplerParameterf(r,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(r,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047)));const s=e=>{e.deleteSampler(r)},n={gls:r,gl:e.gl,destroy(){s(this.gl)}};return l&&Qe.register(new WeakRef(n),{finalizer:s,gl:e.gl}),n}function nt(e,t){const r=t.usage===Be.Vertex?35633:35632,a=e.gl.createShader(r);e.gl.shaderSource(a,t.code),e.gl.compileShader(a);const s=e=>{e.deleteShader(a)},n={gl:e.gl,gls:a,destroy(){s(this.gl)}};return l&&Qe.register(new WeakRef(n),{finalizer:s,gl:e.gl}),n}function it(e,t={}){let r=null;const s=[],n=t.depthStencil?t.depthStencil.texture:null,i=n&&function(e){switch(e){case 36168:case Z:case q:return!0}return!1}(n.format)||!1;if(t.colors&&t.colors.length){r=e.gl.createFramebuffer(),e.gl.bindFramebuffer(R,r);for(let r=0;r<t.colors.length;++r)t.colors[r].view.texture.samples>1?e.gl.framebufferRenderbuffer(R,C+r,M,t.colors[r].view.texture.glrb):kt(e.gl,C+r,t.colors[r].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>C+t))),n&&(n.glrb?e.gl.framebufferRenderbuffer(R,i?v:D,M,n.glrb):(a&&Ve(n.format),kt(e.gl,i?v:D,t.depthStencil)));for(let r=0;r<t.colors.length;++r)s.push(t.colors[r].view.texture.samples>1?Pt(e.gl,C,t.colors[r].view):null);s.push(n&&n.samples>1&&n.glt?Pt(e.gl,i?v:D,t.depthStencil):null)}const c=e=>{e.deleteFramebuffer(r);for(const t of s)e.deleteFramebuffer(t)},o={gl:e.gl,glfb:r,glrfb:s,depth:n,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){c(this.gl)}};return l&&Qe.register(new WeakRef(o),{finalizer:c,gl:e.gl}),o}function ct(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function ot(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function ft(e,t){const r=function(e,t,r){const a=e.gl.createProgram();return e.gl.attachShader(a,t),e.gl.attachShader(a,r),e.gl.linkProgram(a),a}(e,t.vertex.gls,t.fragment.gls),a=[],s={};let n=0,i=0;if(t.bindGroups){for(let l=0;l<t.bindGroups.length;++l){const c=t.bindGroups[l].entries;a.push([]);for(let t=0;t<c.length;++t){const o=c[t];let f=null,u=4294967295;o.type===we.Buffer?(u=e.gl.getUniformBlockIndex(r,o.label),e.gl.uniformBlockBinding(r,u,n++)):o.type===we.Texture&&(f=e.gl.getUniformLocation(r,o.label),s[o.label]=i++),a[l][o.binding]={...o,loc:f,index:u,slot:o.type===we.Buffer?n-1:o.type===we.Texture?i-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const r=t.bindGroups[e].entries;for(let t=0;t<r.length;++t)r[t].type===we.Sampler&&s[r[t].label]&&(a[e][r[t].binding].slot=s[r[t].label])}}const c=e=>{e.deleteProgram(r)},o={gl:e.gl,glp:r,buffers:t.buffers,cache:a,state:Wt(t),destroy(){c(this.gl)}};return l&&Qe.register(new WeakRef(o),{finalizer:c,gl:e.gl}),o}function ut(e,t,r,a=0){const l={status:s.Pending};return function(e,t,r,a,l){const s=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),function(e,t,r,a){return new Promise(((r,a)=>{!function l(){const s=e.clientWaitSync(t,0,0);37149==s?a():37147==s?setTimeout(l,10):r()}()}))}(e,s).finally((()=>e.deleteSync(s))).then((()=>{const s=new Uint8Array(l);return e.bindBuffer(t,r),e.getBufferSubData(t,a,s,0,l),s}))}(e.gl,t.type,t.glb,a,r.byteLength).then((e=>{r.set(e),l.status=s.Done}),(()=>l.status=s.Error)),l}function pt(e,t,r,a=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,a,r)}function gt(e,t,r,a=t.size,l=0,s=0){e.gl.bindBuffer(36662,t.glb),e.gl.bindBuffer(36663,r.glb),e.gl.copyBufferSubData(36662,36663,l,s,a)}function dt(e,t,r=4352){e.gl.activeTexture(y),e.gl.bindTexture(t.type,t.glt),e.gl.hint(33170,r),e.gl.generateMipmap(t.type)}function bt(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},n,{offset:i=0,bytesPerRow:c,rowsPerImage:o=0},[f,u,p]=[t.width-a,t.height-l,t.depth-s]){const g=je(t.format),d=Ze(t.format),b=t.type===F,m=b?S+s:t.type;e.gl.activeTexture(y),e.gl.bindTexture(t.type,t.glt);const h=qe(t.format),x=o||u,B=Math.floor(c/h),R=i-i%c;if(e.gl.pixelStorei(32878,x),e.gl.pixelStorei(3314,B),e.gl.pixelStorei(3316,Math.floor(i%c/h)),e.gl.pixelStorei(A,0),e.gl.pixelStorei(32877,0),Le(t.type))e.gl.texSubImage3D(m,r,a,l,s,f,u,p,t.format,d,n,R);else if(b)for(let t=s;t<s+p;++t)e.gl.pixelStorei(A,t*B*x),e.gl.texSubImage2D(m+t,r,a,l,f,u,g,d,n,R);else e.gl.texSubImage2D(m,r,a,l,f,u,g,d,n,R)}function mt(e,{src:t,origin:[r,a]=[0,0]},{texture:l,mipLevel:s=0,origin:[n,i,c]=[0,0,0]},[o,f]=[t.width-r,t.height-a]){const u=Ze(l.format),p=l.type===F?S+c:l.type;e.gl.activeTexture(y),e.gl.bindTexture(l.type,l.glt),e.gl.pixelStorei(3316,r),e.gl.pixelStorei(A,a),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),Le(l.type)?e.gl.texSubImage3D(p,s,n,i,c,o,f,1,l.format,u,t):e.gl.texSubImage2D(p,s,n,i,o,f,je(l.format),u,t)}function ht(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},{texture:n,mipLevel:i=0,origin:[c,o,f]=[0,0,0]},[u,p,g]=[t.width-a,t.height-l,t.depth-s]){const d=n.type===F,b=d?S+f:n.type;if(e.gl.activeTexture(y),e.gl.bindTexture(n.type,n.glt),e.gl.readBuffer(C),e.gl.bindFramebuffer(R,e.state.copyFrameBuffer),Le(t.type)||t.type===F)for(let m=s;m<s+g;++m)kt(e.gl,C,{texture:t,mipLevel:r,slice:m}),Le(n.type)?e.gl.copyTexSubImage3D(b+(d?m:0),i,c,o,f,a,l,u,p):e.gl.copyTexSubImage2D(b+(d?m:0),i,c,o,a,l,u,p);else{const s=0;kt(e.gl,C,{texture:t,mipLevel:r,slice:s}),Le(n.type)?e.gl.copyTexSubImage3D(b+(d?s:0),i,c,o,f,a,l,u,p):e.gl.copyTexSubImage2D(b+(d?s:0),i,c,o,a,l,u,p)}e.gl.bindFramebuffer(R,e.pass?e.pass.glfb:null)}function xt(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},n,{offset:i=0,bytesPerRow:c,rowsPerImage:o=0},[f,u,p]=[t.width-a,t.height-l,t.depth-s]){e.gl.bindBuffer(35051,n),e.gl.readBuffer(C),e.gl.bindFramebuffer(R,e.state.copyFrameBuffer);const g=Ze(t.format),d=je(t.format),b=qe(t.format),m=o||u,h=Math.floor(c/b),x=i-i%c;if(e.gl.pixelStorei(3330,h),e.gl.pixelStorei(3332,Math.floor(i%c/b)),e.gl.pixelStorei(3331,0),Le(t.type)||t.type===F)for(let n=s;n<s+p;++n)kt(e.gl,C,{texture:t,mipLevel:r,slice:n}),e.gl.readPixels(a,l,f,u,d,g,x+(n-s)*c*m);else{const s=0;kt(e.gl,C,{texture:t,mipLevel:r,slice:s}),e.gl.readPixels(a,l,f,u,d,g,x)}e.gl.bindFramebuffer(R,e.pass?e.pass.glfb:null)}function Ft(e,t){let r=e.gl.drawingBufferWidth,a=e.gl.drawingBufferHeight;t.color.length&&(r=t.color[0].width,a=t.color[0].height),e.gl.bindFramebuffer(R,t.glfb),e.gl.viewport(0,0,r,a),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Et(e.gl,f,!1));let l=0;if(isNaN(t.clearDepth)||(l|=256,e.gl.clearDepth(t.clearDepth),Nt(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(l|=1024,e.gl.clearStencil(t.clearStencil),_t(e.gl,e.state.state.stencilWriteMask,Ke),e.state.state.stencilWriteMask=Ke),Ut(e.gl,e.state.state.blendWriteMask,me.All),e.state.state.blendWriteMask=me.All,t.color.length){for(let r=0;r<t.color.length;++r)if(t.clearColors[r]){const a=He(t.color[r].format);a===p?e.gl.clearBufferiv(I,r,t.clearColors[r]):a===g?e.gl.clearBufferuiv(I,r,t.clearColors[r]):e.gl.clearBufferfv(I,r,t.clearColors[r])}}else t.clearColor&&(l|=n,e.gl.clearColor(...t.clearColor));l&&e.gl.clear(l),e.pass=t}function St(e,t={}){e.gl.bindFramebuffer(R,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Et(e.gl,f,!1));let r=0;isNaN(t.clearDepth)||(r|=256,e.gl.clearDepth(t.clearDepth),Nt(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(r|=1024,e.gl.clearStencil(t.clearStencil),_t(e.gl,e.state.state.stencilWriteMask,Ke),e.state.state.stencilWriteMask=Ke),t.clearColor&&(r|=n,e.gl.clearColor(...t.clearColor),Ut(e.gl,e.state.state.blendWriteMask,me.All),e.state.state.blendWriteMask=me.All),r&&e.gl.clear(r),e.pass=null}function yt(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&Gt(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],n,C+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&Gt(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}function Bt(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),Lt(e.gl,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const r=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)r[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let a=0;a<t.buffers.length;++a){const{attributes:l,stride:s,stepMode:n=0}=t.buffers[a],i=[];e.state.buffers[a]={glb:null,attributes:i,stride:s,step:n,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:c}of l)r[c]=(r[c]||0)+2,i.push({buffer:a,ptr:[c,Ne(e),_e(e),Ee(e),s,t],step:n})}for(let t=0;t<r.length;++t)2===r[t]?e.gl.enableVertexAttribArray(t):1===r[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}function Rt(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}function Mt(e,t,r,a=0){const l=e.state.buffers[t];!l||l.glb===r.glb&&l.offset===a||(l.glb=r.glb,l.offset=a,l.instanceOffset=0,zt(e.gl,l,a))}function Ot(e,t,r,l=[]){if(e.state.pipeline)for(let s=0,n=0;s<r.entries.length;++s){const i=r.entries[s],c=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][i.binding];if(c)if(a&&(i.buffer?(e.gl.getActiveUniformBlockParameter(e.state.pipeline.glp,c.index,35392),e.gl.getParameter(35380)):i.texture||i.sampler),i.buffer){let t=i.bufferOffset||0;c.bufferDynamicOffset&&(t+=l[n]||0,++n),e.gl.bindBufferRange(35345,c.slot,i.buffer.glb,t,i.bufferSize||i.buffer.size-t)}else i.texture?(e.gl.activeTexture(y+c.slot),e.gl.bindTexture(i.texture.type,i.texture.glt),e.gl.uniform1i(c.loc,c.slot)):i.sampler&&e.gl.bindSampler(c.slot,i.sampler.gls)}}function Ct(e,t,r=1,a=0,l=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==l&&(t.instanceOffset=l,zt(e.gl,t,l*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,a,t,r)}function Dt(e,t,r=1,a=0,l=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==l&&(t.instanceOffset=l,zt(e.gl,t,l*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,a*(e.state.state.indexFormat===u?2:4),r)}function vt(e,t,r,a,l,s=0,n=1){e.gl.viewport(t,r,a,l),e.gl.depthRange(s,n)}function At(e,t,r,a,l){e.state.scissor||(Et(e.gl,f,!0),e.state.scissor=!0),e.gl.scissor(t,r,a,l)}function It(e,t){e.gl.blendColor(...t)}function Tt(e,t){if(e.state.stencilRef!==t){const{stencilFrontCompare:r,stencilBackCompare:a,stencilReadMask:l}=e.state.state;e.gl.stencilFuncSeparate(c,r,t,l),e.gl.stencilFuncSeparate(o,a,t,l),e.state.stencilRef=t}}function wt(e){const t=Wt();e.blendColor(1,1,1,1),Lt(e,t,t,0,!0);for(let t=0;t<16;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function kt(e,t,{texture:r,slice:a=0,mipLevel:l=0}){if(Le(r.type))e.framebufferTextureLayer(R,t,r.glt,l,a);else{const s=r.type===F?S+a:r.type;e.framebufferTexture2D(R,t,s,r.glt,l)}}function Pt(e,t,r){const a=e.createFramebuffer();return e.bindFramebuffer(R,a),kt(e,t,r),a}function Gt(e,t,r,a,l,s=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,r),e.readBuffer(s),e.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,l,h)}function Wt(e={}){const t=e.primitive||{},r=e.depthStencil||{},{stencilFront:a={},stencilBack:l={}}=r,{sampleCount:s=1,alphaToCoverage:n=!1}=e.multisample||{},c=e.targets||{};let o=c.writeMask||me.All,f=c.blendColor||{},p=c.blendColor||{};return c.targets&&c.targets[0]&&(o=c.targets[0].writeMask||o,f=c.targets[0].blendColor||f,p=c.targets[0].blendAlpha||p),{sampleCount:s,alphaToCoverage:n,topology:t.topology||4,indexFormat:t.indexFormat||u,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:r.depthWrite||!1,depthFormat:r.format||O,depthCompare:r.depthCompare||b,depthBias:r.depthBias||0,depthBiasSlopeScale:r.depthBiasSlopeScale||0,stencil:!(!r.stencilFront&&!r.stencilBack),stencilFrontCompare:a.compare||b,stencilFrontFailOp:a.failOp||m,stencilFrontDepthFailOp:a.depthFailOp||m,stencilFrontPassOp:a.passOp||m,stencilBackCompare:l.compare||b,stencilBackFailOp:l.failOp||m,stencilBackDepthFailOp:l.depthFailOp||m,stencilBackPassOp:l.passOp||m,stencilReadMask:r.stencilReadMask||Je,stencilWriteMask:r.stencilWriteMask||Je,blend:!!e.targets,blendWriteMask:o,blendColorOp:f.operation||i,blendColorSrcFactor:f.srcFactor||1,blendColorDstFactor:f.dstFactor||0,blendAlphaOp:p.operation||i,blendAlphaSrcFactor:p.srcFactor||1,blendAlphaDstFactor:p.dstFactor||0}}function Lt(e,t,r,a=0,l=!1){let s=!1,n=0,i=0,f=0,u=0;n=r.frontFace,(l||t.frontFace!==n)&&e.frontFace(n),n=r.cullMode,(l||t.cullMode!==n)&&((s=0!==n)&&e.cullFace(n),Et(e,2884,s)),s=r.alphaToCoverage,(l||t.alphaToCoverage!==s)&&Et(e,32926,s),s=!!r.depth,(l||t.depth!==s)&&Et(e,2929,s),(l||s)&&(Nt(e,t.depthWrite,r.depthWrite,l),n=r.depthCompare,(l||t.depthCompare!==n)&&e.depthFunc(n)),n=r.depthBiasSlopeScale,i=r.depthBias,(l||t.depthBiasSlopeScale!==n||t.depthBias!==i)&&(Et(e,32823,!(!n&&!i)),e.polygonOffset(n,i)),s=!!r.stencil,(l||t.stencil!==s)&&Et(e,2960,s),(l||s)&&(n=r.stencilReadMask,s=l||t.stencilReadMask!==n,i=r.stencilFrontCompare,(s||t.stencilFrontCompare!==i)&&e.stencilFuncSeparate(c,i,a,n),i=r.stencilBackCompare,(s||t.stencilBackCompare!==i)&&e.stencilFuncSeparate(o,i,a,n),n=r.stencilFrontFailOp,i=r.stencilFrontDepthFailOp,f=r.stencilFrontPassOp,(l||t.stencilFrontFailOp!==n||t.stencilFrontDepthFailOp!==i||t.stencilFrontPassOp!==f)&&e.stencilOpSeparate(c,n,i,f),n=r.stencilBackFailOp,i=r.stencilBackDepthFailOp,f=r.stencilBackPassOp,(l||t.stencilBackFailOp!==n||t.stencilBackDepthFailOp!==i||t.stencilBackPassOp!==f)&&e.stencilOpSeparate(o,n,i,f),_t(e,t.stencilWriteMask,r.stencilWriteMask,l)),s=r.blend,(l||t.blend!==s)&&Et(e,3042,s),(l||s)&&(n=r.blendColorSrcFactor,i=r.blendColorDstFactor,f=r.blendAlphaSrcFactor,u=r.blendAlphaDstFactor,(l||t.blendColorSrcFactor!==n||t.blendColorDstFactor!==i||t.blendAlphaSrcFactor!==f||t.blendAlphaDstFactor!==u)&&e.blendFuncSeparate(n,i,f,u),n=r.blendColorOp,i=r.blendAlphaOp,(l||t.blendColorOp!==n||t.blendAlphaOp!==i)&&e.blendEquationSeparate(n,i),Ut(e,t.blendWriteMask,r.blendWriteMask,l))}function Ut(e,t,r,a=!1){(a||t!==r)&&e.colorMask(!!(r&me.Red),!!(r&me.Green),!!(r&me.Blue),!!(r&me.Alpha))}function Nt(e,t,r,a=!1){(a||t!==r)&&e.depthMask(r)}function _t(e,t,r,a=!1){(a||t!==r)&&e.stencilMask(r)}function Et(e,t,r){r?e.enable(t):e.disable(t)}function zt(e,t,r){e.bindBuffer(34962,t.glb);for(let a=0;a<t.attributes.length;++a){const{ptr:l,step:s}=t.attributes[a],n=[...l];n[5]+=r,e.vertexAttribPointer(...n),e.vertexAttribDivisor(l[0],s)}}return l&&(Qe=new FinalizationRegistry((({finalizer:e,gl:t})=>{e(t)}))),t})()},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mugl",[],t):"object"==typeof exports?exports.mugl=t():e.mugl=t();