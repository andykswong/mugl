var e,t;e=self,t=function(){return(()=>{var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AddressMode:()=>xe,BindingType:()=>Ie,BlendFactor:()=>De,BlendOperation:()=>ve,BufferUsage:()=>ge,ColorWrite:()=>be,CompareFunction:()=>Fe,CubeMapFace:()=>ke,CullMode:()=>Oe,FilterMode:()=>Se,FrontFace:()=>Me,FutureStatus:()=>l,IndexFormat:()=>Re,MUGL_DEBUG:()=>a,MipmapHint:()=>Ge,PrimitiveTopology:()=>Be,SamplerBindingType:()=>we,ShaderStage:()=>ye,StencilOperation:()=>Ce,TextureDimension:()=>me,TextureFormat:()=>he,TextureSampleType:()=>Pe,TextureUsage:()=>de,VertexFormat:()=>Te,VertexStepMode:()=>Ae,WebGL:()=>r,WebGL2Feature:()=>Xe,vertexBufferLayouts:()=>Ee});var r={};e.r(r),e.d(r,{beginDefaultPass:()=>xt,beginRenderPass:()=>ht,copyBuffer:()=>ut,copyExternalImageToTexture:()=>dt,copyTexture:()=>bt,copyTextureToBuffer:()=>mt,createBindGroup:()=>it,createBindGroupLayout:()=>nt,createBuffer:()=>tt,createRenderPass:()=>st,createRenderPipeline:()=>ct,createSampler:()=>at,createShader:()=>lt,createTexture:()=>rt,draw:()=>Mt,drawIndexed:()=>Ot,generateMipmap:()=>pt,getDeviceFeatures:()=>et,isDeviceLost:()=>$e,readBuffer:()=>ot,requestWebGL2Device:()=>Je,resetDevice:()=>Qe,setBindGroup:()=>Rt,setBlendConst:()=>vt,setIndex:()=>yt,setRenderPipeline:()=>Ft,setScissorRect:()=>Dt,setStencilRef:()=>At,setVertex:()=>Bt,setViewport:()=>Ct,submitRenderPass:()=>St,writeBuffer:()=>ft,writeTexture:()=>gt});const a=!1,l={Pending:0,Done:1,Error:2},s=16384,n=32774,i=1028,c=1029,o=3089,f=5123,u=5124,p=5125,g=5126,d=519,b=7680,m=9728,h=3553,x=34067,S=34069,F=33984,y=33071,B=36160,R=36161,M=33189,O=36064,C=36096,D=33306,v=3315,A=6144,T=32856,I=32857,w=33190,P=35907,k=34836,G=34842,W=35898,L=36208,U=36214,N=36220,_=36226,E=36232,V=36238,j=36012,z=36013,q=35056,H=33321,X=33323,Z=33325,Y=33326,K=33327,J=33328,Q=33329,$=33330,ee=33331,te=33332,re=33333,ae=33334,le=33335,se=33336,ne=33337,ie=33338,ce=33339,oe=33340,fe=36756,ue=36757,pe=36759,ge={Index:16,Vertex:32,Uniform:64,Dynamic:4096,Stream:8192},de={TextureBinding:4,RenderAttachment:16},be={Red:1,Green:2,Blue:4,Alpha:8,All:15},me={D2:h,D2Array:35866,CubeMap:x,D3:32879},he={R8:H,R8SNORM:fe,R8UI:$,R8I:Q,R16UI:te,R16I:ee,RG8:X,RG8SNORM:ue,RG8UI:se,RG8I:le,R32UI:ae,R32I:re,RG16UI:ie,RG16I:ne,RGBA8:T,SRGBA8:P,RGBA8SNORM:pe,RGBA8UI:N,RGBA8I:V,RGB10A2:I,RG32UI:oe,RG32I:ce,RGBA16UI:U,RGBA16I:E,RGBA32UI:L,RGBA32I:_,R16F:Z,RG16F:K,RG11B10F:W,RGBA16F:G,R32F:Y,RG32F:J,RGBA32F:k,Depth16:M,Depth24:w,Depth24Stencil8:q,Depth32F:j,Depth32FStencil8:z},xe={ClampToEdge:y,Repeat:10497,MirrorRepeat:33648},Se={Nearest:m,Linear:9729},Fe={Never:512,Less:513,Equal:514,LessEqual:515,Greater:516,NotEqual:517,GreaterEqual:518,Always:d},ye={Vertex:1,Fragment:2},Be={Points:0,Lines:1,LineStrip:3,Triangles:4,TriangleStrip:5},Re={UInt16:f,UInt32:p},Me={CCW:2305,CW:2304},Oe={None:0,Front:i,Back:c},Ce={Keep:b,Zero:0,Replace:7681,Invert:5386,Increment:7682,Decrement:7683,IncrementWrap:34055,DecrementWrap:34056},De={Zero:0,One:1,Src:768,OneMinusSrc:769,SrcAlpha:770,OneMinusSrcAlpha:771,Dst:774,OneMinusDst:775,DstAlpha:772,OneMinusDstAlpha:773,SrcAlphaSaturated:776,Constant:32769,OneMinusConstant:32770},ve={Add:n,Subtract:32778,ReverseSubtract:32779,Min:32775,Max:32776},Ae={Vertex:0,Instance:1},Te={UI8x2:274,UI8x4:276,I8x2:4370,I8x4:4372,UNORM8x2:8466,UNORM8x4:8468,SNORM8x2:12562,SNORM8x4:12564,UI16x2:290,UI16x4:292,I16x2:4386,I16x4:4388,UNORM16x2:8482,UNORM16x4:8484,SNORM16x2:12578,SNORM16x4:12580,F16x2:546,F16x4:548,F32:577,F32x2:578,F32x3:579,F32x4:580},Ie={Buffer:0,Sampler:1,Texture:2},we={Filtering:0,NonFiltering:1,Comparison:2},Pe={Float:0,Depth:1,Int:2,UInt:3},ke={X:0,NegativeX:1,Y:2,NegativeY:3,Z:4,NegativeZ:5},Ge={Fast:4353,Nice:4354};function We(e){return 32879===e||35866===e}function Le(e){return(e>>4&15)*Ue(e)}function Ue(e){return 15&e}function Ne(e){switch(e>>4&511){case 36:return g;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return f;case 17:return 5121}return 0}function _e(e){return!!(e>>13)}function Ee(e){let t=0;const r=[];for(let a=0;a<e.length;++a){const l=[];let s=0;for(let r=0;r<e[a].attributes.length;++r){const n=e[a].attributes[r];l.push({format:n,offset:s,shaderLocation:t}),s+=Le(n),++t}r.push({attributes:l,stride:s,stepMode:e[a].instanced?Ae.Instance:Ae.Vertex})}return r}function Ve(e){switch(e){case M:case w:case q:case j:case z:return!0}return!1}function je(e){switch(e){case H:case fe:case Z:case Y:return 6403;case $:case Q:case te:case ee:case ae:case re:return 36244;case X:case ue:case K:case J:return 33319;case se:case le:case ie:case ne:case oe:case ce:return 33320;case T:case P:case pe:case I:case G:case k:return 6408;case N:case V:case U:case L:case E:case _:return 36249;case W:return 6407;case M:case w:case j:return 6402;case q:case z:return 34041}return 0}function ze(e){switch(e){case H:case $:case fe:case Q:return 1;case te:case ee:case X:case se:case ue:case le:case Z:return 2;case ae:case re:case Y:case ie:case ne:case K:case T:case P:case N:case pe:case V:case I:case W:return 4;case oe:case ce:case J:case U:case E:case G:return 8;case L:case _:case k:return 16;case M:return 2;case w:case q:case j:return 4;case z:return 8}return 0}function qe(e){switch(e){case H:case $:case X:case se:case T:case P:case N:return 5121;case fe:case Q:case ue:case le:case pe:case V:return 5120;case te:case ie:case U:return f;case ee:case ne:case E:return 5122;case ae:case oe:case L:return p;case re:case ce:case _:return u;case I:return 33640;case Z:case K:case G:return 5131;case Y:case J:case k:return g;case W:return 35899;case M:return f;case w:return p;case q:return 34042;case j:return g;case z:return 36269}return 0}function He(e){switch(e){case Q:case ee:case re:case le:case ne:case ce:case V:case E:case _:return u;case $:case te:case ae:case se:case ie:case oe:case N:case U:case L:return p}return g}const Xe={TextureAnisotropic:1,TextureHalfFloatLinear:2,TextureFloatLinear:4,ColorBufferFloat:8},Ze={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float"},Ye=255,Ke=4294967295;function Je(e,t={},r=0){const a=e.getContext("webgl2",t);if(a){let t=0;for(const e in Ze)r&+e&&a.getExtension(Ze[+e])&&(t|=+e);return{canvas:e,gl:a,features:t,pass:null,state:Tt(a),destroy(){this.gl.deleteFramebuffer(this.state.copyFrameBuffer)}}}return null}function Qe(e){e.destroy(),e.state=Tt(e.gl)}function $e(e){return e.gl.isContextLost()}function et(e){return e.features}function tt(e,t){const r=t.usage&ge.Uniform?35345:t.usage&ge.Index?34963:34962,a=t.usage&ge.Stream?35040:t.usage&ge.Dynamic?35048:35044,l=e.gl.createBuffer();return e.gl.bindBuffer(r,l),e.gl.bufferData(r,t.size,a),{gl:e.gl,glb:l,type:r,size:t.size,destroy(){this.gl.deleteBuffer(this.glb)}}}function rt(e,t){const r=t.sampleCount||1,a=t.dimension||h,l=t.format||T,s=!Ve(l)||(t.usage||0)&de.TextureBinding,[n,i,c]=t.size||[1,1,1],o=a===x?6:a===h?1:c;let f=null,u=null;return(r>1||!s)&&(u=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(R,u),r>1?e.gl.renderbufferStorageMultisample(R,r,l,n,i):e.gl.renderbufferStorage(R,l,n,i)),s&&(f=e.gl.createTexture(),e.gl.activeTexture(F),e.gl.bindTexture(a,f),We(a)?e.gl.texStorage3D(a,t.mipLevelCount||1,l,n,i,o):e.gl.texStorage2D(a,t.mipLevelCount||1,l,n,i)),{gl:e.gl,glt:f,glrb:u,type:a,format:l,width:n,height:i,depth:o,samples:r,destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb)}}}function at(e,t={}){const r=e.gl.createSampler();let a=t.minFilter||m;return t.mipmapFilter&&(a=t.mipmapFilter===m?a===m?9984:9985:a===m?9986:9987),e.gl.samplerParameteri(r,10241,a),e.gl.samplerParameteri(r,10240,t.magFilter||m),e.gl.samplerParameteri(r,10242,t.addressModeU||y),e.gl.samplerParameteri(r,10243,t.addressModeV||y),e.gl.samplerParameteri(r,32882,t.addressModeW||y),e.gl.samplerParameterf(r,33083,t.lodMaxClamp||32),e.gl.samplerParameterf(r,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(r,34892,34894),e.gl.samplerParameterf(r,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(r,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047))),{gls:r,gl:e.gl,destroy(){this.gl.deleteSampler(this.gls)}}}function lt(e,t){const r=t.usage===ye.Vertex?35633:35632,a=e.gl.createShader(r);return e.gl.shaderSource(a,t.code),e.gl.compileShader(a),{gl:e.gl,gls:a,destroy(){this.gl.deleteShader(this.gls)}}}function st(e,t={}){let r=null;const l=[],s=t.depthStencil?t.depthStencil.texture:null,n=s&&function(e){switch(e){case 36168:case q:case z:return!0}return!1}(s.format)||!1;if(t.colors&&t.colors.length){r=e.gl.createFramebuffer(),e.gl.bindFramebuffer(B,r);for(let r=0;r<t.colors.length;++r)t.colors[r].view.texture.samples>1?e.gl.framebufferRenderbuffer(B,O+r,R,t.colors[r].view.texture.glrb):It(e.gl,O+r,t.colors[r].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>O+t))),s&&(s.glrb?e.gl.framebufferRenderbuffer(B,n?D:C,R,s.glrb):(a&&Ve(s.format),It(e.gl,n?D:C,t.depthStencil)));for(let r=0;r<t.colors.length;++r)l.push(t.colors[r].view.texture.samples>1?wt(e.gl,O,t.colors[r].view):null);l.push(s&&s.samples>1&&s.glt?wt(e.gl,n?D:C,t.depthStencil):null)}return{gl:e.gl,glfb:r,glrfb:l,depth:s,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){this.gl.deleteFramebuffer(this.glfb);for(const e of this.glrfb)this.gl.deleteFramebuffer(e)}}}function nt(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function it(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function ct(e,t){const r=function(e,t,r){const a=e.gl.createProgram();return e.gl.attachShader(a,t),e.gl.attachShader(a,r),e.gl.linkProgram(a),a}(e,t.vertex.gls,t.fragment.gls),a=[],l={};let s=0,n=0;if(t.bindGroups){for(let i=0;i<t.bindGroups.length;++i){const c=t.bindGroups[i].entries;a.push([]);for(let t=0;t<c.length;++t){const o=c[t];let f=null,u=4294967295;o.type===Ie.Buffer?(u=e.gl.getUniformBlockIndex(r,o.label),e.gl.uniformBlockBinding(r,u,s++)):o.type===Ie.Texture&&(f=e.gl.getUniformLocation(r,o.label),l[o.label]=n++),a[i][o.binding]={...o,loc:f,index:u,slot:o.type===Ie.Buffer?s-1:o.type===Ie.Texture?n-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const r=t.bindGroups[e].entries;for(let t=0;t<r.length;++t)r[t].type===Ie.Sampler&&l[r[t].label]&&(a[e][r[t].binding].slot=l[r[t].label])}}return{gl:e.gl,glp:r,buffers:t.buffers,cache:a,state:kt(t),destroy(){this.gl.deleteProgram(this.glp)}}}function ot(e,t,r,a=0){const s={status:l.Pending};return function(e,t,r,a,l){const s=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),function(e,t,r,a){return new Promise(((r,a)=>{!function l(){const s=e.clientWaitSync(t,0,0);37149==s?a():37147==s?setTimeout(l,10):r()}()}))}(e,s).finally((()=>e.deleteSync(s))).then((()=>{const s=new Uint8Array(l);return e.bindBuffer(t,r),e.getBufferSubData(t,a,s,0,l),s}))}(e.gl,t.type,t.glb,a,r.byteLength).then((e=>{r.set(e),s.status=l.Done}),(()=>s.status=l.Error)),s}function ft(e,t,r,a=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,a,r)}function ut(e,t,r,a=t.size,l=0,s=0){e.gl.bindBuffer(36662,t.glb),e.gl.bindBuffer(36663,r.glb),e.gl.copyBufferSubData(36662,36663,l,s,a)}function pt(e,t,r=4352){e.gl.activeTexture(F),e.gl.bindTexture(t.type,t.glt),e.gl.hint(33170,r),e.gl.generateMipmap(t.type)}function gt(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},n,{offset:i=0,bytesPerRow:c,rowsPerImage:o=0},[f,u,p]=[t.width-a,t.height-l,t.depth-s]){const g=je(t.format),d=qe(t.format),b=t.type===x,m=b?S+s:t.type;e.gl.activeTexture(F),e.gl.bindTexture(t.type,t.glt);const h=ze(t.format),y=o||u,B=Math.floor(c/h),R=i-i%c;if(e.gl.pixelStorei(32878,y),e.gl.pixelStorei(3314,B),e.gl.pixelStorei(3316,Math.floor(i%c/h)),e.gl.pixelStorei(v,0),e.gl.pixelStorei(32877,0),We(t.type))e.gl.texSubImage3D(m,r,a,l,s,f,u,p,t.format,d,n,R);else if(b)for(let t=s;t<s+p;++t)e.gl.pixelStorei(v,t*B*y),e.gl.texSubImage2D(m+t,r,a,l,f,u,g,d,n,R);else e.gl.texSubImage2D(m,r,a,l,f,u,g,d,n,R)}function dt(e,{src:t,origin:[r,a]=[0,0]},{texture:l,mipLevel:s=0,origin:[n,i,c]=[0,0,0]},[o,f]=[t.width-r,t.height-a]){const u=qe(l.format),p=l.type===x?S+c:l.type;e.gl.activeTexture(F),e.gl.bindTexture(l.type,l.glt),e.gl.pixelStorei(3316,r),e.gl.pixelStorei(v,a),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),We(l.type)?e.gl.texSubImage3D(p,s,n,i,c,o,f,1,l.format,u,t):e.gl.texSubImage2D(p,s,n,i,o,f,je(l.format),u,t)}function bt(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},{texture:n,mipLevel:i=0,origin:[c,o,f]=[0,0,0]},[u,p,g]=[t.width-a,t.height-l,t.depth-s]){const d=n.type===x,b=d?S+f:n.type;if(e.gl.activeTexture(F),e.gl.bindTexture(n.type,n.glt),e.gl.readBuffer(O),e.gl.bindFramebuffer(B,e.state.copyFrameBuffer),We(t.type)||t.type===x)for(let m=s;m<s+g;++m)It(e.gl,O,{texture:t,mipLevel:r,slice:m}),We(n.type)?e.gl.copyTexSubImage3D(b+(d?m:0),i,c,o,f,a,l,u,p):e.gl.copyTexSubImage2D(b+(d?m:0),i,c,o,a,l,u,p);else{const s=0;It(e.gl,O,{texture:t,mipLevel:r,slice:s}),We(n.type)?e.gl.copyTexSubImage3D(b+(d?s:0),i,c,o,f,a,l,u,p):e.gl.copyTexSubImage2D(b+(d?s:0),i,c,o,a,l,u,p)}e.gl.bindFramebuffer(B,e.pass?e.pass.glfb:null)}function mt(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},n,{offset:i=0,bytesPerRow:c,rowsPerImage:o=0},[f,u,p]=[t.width-a,t.height-l,t.depth-s]){e.gl.bindBuffer(35051,n),e.gl.readBuffer(O),e.gl.bindFramebuffer(B,e.state.copyFrameBuffer);const g=qe(t.format),d=je(t.format),b=ze(t.format),m=o||u,h=Math.floor(c/b),S=i-i%c;if(e.gl.pixelStorei(3330,h),e.gl.pixelStorei(3332,Math.floor(i%c/b)),e.gl.pixelStorei(3331,0),We(t.type)||t.type===x)for(let n=s;n<s+p;++n)It(e.gl,O,{texture:t,mipLevel:r,slice:n}),e.gl.readPixels(a,l,f,u,d,g,S+(n-s)*c*m);else{const s=0;It(e.gl,O,{texture:t,mipLevel:r,slice:s}),e.gl.readPixels(a,l,f,u,d,g,S)}e.gl.bindFramebuffer(B,e.pass?e.pass.glfb:null)}function ht(e,t){let r=e.gl.drawingBufferWidth,a=e.gl.drawingBufferHeight;t.color.length&&(r=t.color[0].width,a=t.color[0].height),e.gl.bindFramebuffer(B,t.glfb),e.gl.viewport(0,0,r,a),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Nt(e.gl,o,!1));let l=0;if(isNaN(t.clearDepth)||(l|=256,e.gl.clearDepth(t.clearDepth),Lt(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(l|=1024,e.gl.clearStencil(t.clearStencil),Ut(e.gl,e.state.state.stencilWriteMask,Ye),e.state.state.stencilWriteMask=Ye),Wt(e.gl,e.state.state.blendWriteMask,be.All),e.state.state.blendWriteMask=be.All,t.color.length){for(let r=0;r<t.color.length;++r)if(t.clearColors[r]){const a=He(t.color[r].format);a===u?e.gl.clearBufferiv(A,r,t.clearColors[r]):a===p?e.gl.clearBufferuiv(A,r,t.clearColors[r]):e.gl.clearBufferfv(A,r,t.clearColors[r])}}else t.clearColor&&(l|=s,e.gl.clearColor(...t.clearColor));l&&e.gl.clear(l),e.pass=t}function xt(e,t={}){e.gl.bindFramebuffer(B,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Nt(e.gl,o,!1));let r=0;isNaN(t.clearDepth)||(r|=256,e.gl.clearDepth(t.clearDepth),Lt(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(r|=1024,e.gl.clearStencil(t.clearStencil),Ut(e.gl,e.state.state.stencilWriteMask,Ye),e.state.state.stencilWriteMask=Ye),t.clearColor&&(r|=s,e.gl.clearColor(...t.clearColor),Wt(e.gl,e.state.state.blendWriteMask,be.All),e.state.state.blendWriteMask=be.All),r&&e.gl.clear(r),e.pass=null}function St(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&Pt(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],s,O+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&Pt(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}function Ft(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),Gt(e.gl,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const r=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)r[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let a=0;a<t.buffers.length;++a){const{attributes:l,stride:s,stepMode:n=0}=t.buffers[a],i=[];e.state.buffers[a]={glb:null,attributes:i,stride:s,step:n,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:c}of l)r[c]=(r[c]||0)+2,i.push({buffer:a,ptr:[c,Ue(e),Ne(e),_e(e),s,t],step:n})}for(let t=0;t<r.length;++t)2===r[t]?e.gl.enableVertexAttribArray(t):1===r[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}function yt(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}function Bt(e,t,r,a=0){const l=e.state.buffers[t];!l||l.glb===r.glb&&l.offset===a||(l.glb=r.glb,l.offset=a,l.instanceOffset=0,_t(e.gl,l,a))}function Rt(e,t,r,l=[]){if(e.state.pipeline)for(let s=0,n=0;s<r.entries.length;++s){const i=r.entries[s],c=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][i.binding];if(c)if(a&&(i.buffer?(e.gl.getActiveUniformBlockParameter(e.state.pipeline.glp,c.index,35392),e.gl.getParameter(35380)):i.texture||i.sampler),i.buffer){let t=i.bufferOffset||0;c.bufferDynamicOffset&&(t+=l[n]||0,++n),e.gl.bindBufferRange(35345,c.slot,i.buffer.glb,t,i.bufferSize||i.buffer.size-t)}else i.texture?(e.gl.activeTexture(F+c.slot),e.gl.bindTexture(i.texture.type,i.texture.glt),e.gl.uniform1i(c.loc,c.slot)):i.sampler&&e.gl.bindSampler(c.slot,i.sampler.gls)}}function Mt(e,t,r=1,a=0,l=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==l&&(t.instanceOffset=l,_t(e.gl,t,l*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,a,t,r)}function Ot(e,t,r=1,a=0,l=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==l&&(t.instanceOffset=l,_t(e.gl,t,l*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,a*(e.state.state.indexFormat===f?2:4),r)}function Ct(e,t,r,a,l,s=0,n=1){e.gl.viewport(t,r,a,l),e.gl.depthRange(s,n)}function Dt(e,t,r,a,l){e.state.scissor||(Nt(e.gl,o,!0),e.state.scissor=!0),e.gl.scissor(t,r,a,l)}function vt(e,t){e.gl.blendColor(...t)}function At(e,t){if(e.state.stencilRef!==t){const{stencilFrontCompare:r,stencilBackCompare:a,stencilReadMask:l}=e.state.state;e.gl.stencilFuncSeparate(i,r,t,l),e.gl.stencilFuncSeparate(c,a,t,l),e.state.stencilRef=t}}function Tt(e){const t=kt();e.blendColor(1,1,1,1),Gt(e,t,t,0,!0);for(let t=0;t<16;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function It(e,t,{texture:r,slice:a=0,mipLevel:l=0}){if(We(r.type))e.framebufferTextureLayer(B,t,r.glt,l,a);else{const s=r.type===x?S+a:r.type;e.framebufferTexture2D(B,t,s,r.glt,l)}}function wt(e,t,r){const a=e.createFramebuffer();return e.bindFramebuffer(B,a),It(e,t,r),a}function Pt(e,t,r,a,l,s=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,r),e.readBuffer(s),e.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,l,m)}function kt(e={}){const t=e.primitive||{},r=e.depthStencil||{},{stencilFront:a={},stencilBack:l={}}=r,{sampleCount:s=1,alphaToCoverage:i=!1}=e.multisample||{},c=e.targets||{};let o=c.writeMask||be.All,u=c.blendColor||{},p=c.blendColor||{};return c.targets&&c.targets[0]&&(o=c.targets[0].writeMask||o,u=c.targets[0].blendColor||u,p=c.targets[0].blendAlpha||p),{sampleCount:s,alphaToCoverage:i,topology:t.topology||4,indexFormat:t.indexFormat||f,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:r.depthWrite||!1,depthFormat:r.format||M,depthCompare:r.depthCompare||d,depthBias:r.depthBias||0,depthBiasSlopeScale:r.depthBiasSlopeScale||0,stencil:!(!r.stencilFront&&!r.stencilBack),stencilFrontCompare:a.compare||d,stencilFrontFailOp:a.failOp||b,stencilFrontDepthFailOp:a.depthFailOp||b,stencilFrontPassOp:a.passOp||b,stencilBackCompare:l.compare||d,stencilBackFailOp:l.failOp||b,stencilBackDepthFailOp:l.depthFailOp||b,stencilBackPassOp:l.passOp||b,stencilReadMask:r.stencilReadMask||Ke,stencilWriteMask:r.stencilWriteMask||Ke,blend:!!e.targets,blendWriteMask:o,blendColorOp:u.operation||n,blendColorSrcFactor:u.srcFactor||1,blendColorDstFactor:u.dstFactor||0,blendAlphaOp:p.operation||n,blendAlphaSrcFactor:p.srcFactor||1,blendAlphaDstFactor:p.dstFactor||0}}function Gt(e,t,r,a=0,l=!1){let s=!1,n=0,o=0,f=0,u=0;n=r.frontFace,(l||t.frontFace!==n)&&e.frontFace(n),n=r.cullMode,(l||t.cullMode!==n)&&((s=0!==n)&&e.cullFace(n),Nt(e,2884,s)),s=r.alphaToCoverage,(l||t.alphaToCoverage!==s)&&Nt(e,32926,s),s=!!r.depth,(l||t.depth!==s)&&Nt(e,2929,s),(l||s)&&(Lt(e,t.depthWrite,r.depthWrite,l),n=r.depthCompare,(l||t.depthCompare!==n)&&e.depthFunc(n)),n=r.depthBiasSlopeScale,o=r.depthBias,(l||t.depthBiasSlopeScale!==n||t.depthBias!==o)&&(Nt(e,32823,!(!n&&!o)),e.polygonOffset(n,o)),s=!!r.stencil,(l||t.stencil!==s)&&Nt(e,2960,s),(l||s)&&(n=r.stencilReadMask,s=l||t.stencilReadMask!==n,o=r.stencilFrontCompare,(s||t.stencilFrontCompare!==o)&&e.stencilFuncSeparate(i,o,a,n),o=r.stencilBackCompare,(s||t.stencilBackCompare!==o)&&e.stencilFuncSeparate(c,o,a,n),n=r.stencilFrontFailOp,o=r.stencilFrontDepthFailOp,f=r.stencilFrontPassOp,(l||t.stencilFrontFailOp!==n||t.stencilFrontDepthFailOp!==o||t.stencilFrontPassOp!==f)&&e.stencilOpSeparate(i,n,o,f),n=r.stencilBackFailOp,o=r.stencilBackDepthFailOp,f=r.stencilBackPassOp,(l||t.stencilBackFailOp!==n||t.stencilBackDepthFailOp!==o||t.stencilBackPassOp!==f)&&e.stencilOpSeparate(c,n,o,f),Ut(e,t.stencilWriteMask,r.stencilWriteMask,l)),s=r.blend,(l||t.blend!==s)&&Nt(e,3042,s),(l||s)&&(n=r.blendColorSrcFactor,o=r.blendColorDstFactor,f=r.blendAlphaSrcFactor,u=r.blendAlphaDstFactor,(l||t.blendColorSrcFactor!==n||t.blendColorDstFactor!==o||t.blendAlphaSrcFactor!==f||t.blendAlphaDstFactor!==u)&&e.blendFuncSeparate(n,o,f,u),n=r.blendColorOp,o=r.blendAlphaOp,(l||t.blendColorOp!==n||t.blendAlphaOp!==o)&&e.blendEquationSeparate(n,o),Wt(e,t.blendWriteMask,r.blendWriteMask,l))}function Wt(e,t,r,a=!1){(a||t!==r)&&e.colorMask(!!(r&be.Red),!!(r&be.Green),!!(r&be.Blue),!!(r&be.Alpha))}function Lt(e,t,r,a=!1){(a||t!==r)&&e.depthMask(r)}function Ut(e,t,r,a=!1){(a||t!==r)&&e.stencilMask(r)}function Nt(e,t,r){r?e.enable(t):e.disable(t)}function _t(e,t,r){e.bindBuffer(34962,t.glb);for(let a=0;a<t.attributes.length;++a){const{ptr:l,step:s}=t.attributes[a],n=[...l];n[5]+=r,e.vertexAttribPointer(...n),e.vertexAttribDivisor(l[0],s)}}return t})()},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mugl",[],t):"object"==typeof exports?exports.mugl=t():e.mugl=t();