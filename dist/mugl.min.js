var e,t;e=self,t=function(){return(()=>{var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AddressMode:()=>he,BindingType:()=>Te,BlendFactor:()=>Ce,BlendOperation:()=>De,BufferUsage:()=>pe,ColorWrite:()=>de,CompareFunction:()=>Se,CubeMapFace:()=>ke,CullMode:()=>Me,FilterMode:()=>xe,FrontFace:()=>Re,IndexFormat:()=>Be,MUGL_DEBUG:()=>a,MipmapHint:()=>Pe,PrimitiveTopology:()=>ye,SamplerBindingType:()=>Ie,ShaderStage:()=>Fe,StencilOperation:()=>Oe,TextureDimension:()=>be,TextureFormat:()=>me,TextureSampleType:()=>we,TextureUsage:()=>ge,VertexFormat:()=>Ae,VertexStepMode:()=>ve,WebGL:()=>r,WebGL2Feature:()=>He,vertexBufferLayouts:()=>_e});var r={};e.r(r),e.d(r,{beginDefaultPass:()=>ht,beginRenderPass:()=>mt,copyBuffer:()=>ft,copyExternalImageToTexture:()=>gt,copyTexture:()=>dt,copyTextureToBuffer:()=>bt,createBindGroup:()=>nt,createBindGroupLayout:()=>st,createBuffer:()=>et,createRenderPass:()=>lt,createRenderPipeline:()=>it,createSampler:()=>rt,createShader:()=>at,createTexture:()=>tt,draw:()=>Rt,drawIndexed:()=>Mt,generateMipmap:()=>ut,getDeviceFeatures:()=>$e,isDeviceLost:()=>Qe,readBuffer:()=>ct,requestWebGL2Device:()=>Ke,resetDevice:()=>Je,setBindGroup:()=>Bt,setBlendConst:()=>Dt,setIndex:()=>Ft,setRenderPipeline:()=>St,setScissorRect:()=>Ct,setStencilRef:()=>vt,setVertex:()=>yt,setViewport:()=>Ot,submitRenderPass:()=>xt,writeBuffer:()=>ot,writeTexture:()=>pt});const a=!1,l=16384,s=32774,n=1028,i=1029,c=3089,o=5123,f=5124,u=5125,p=5126,g=519,d=7680,b=9728,m=3553,h=34067,x=34069,S=33984,F=33071,y=36160,B=36161,R=33189,M=36064,O=36096,C=33306,D=3315,v=6144,A=32856,T=32857,I=33190,w=35907,k=34836,P=34842,G=35898,W=36208,L=36214,U=36220,N=36226,_=36232,E=36238,V=36012,j=36013,z=35056,q=33321,H=33323,X=33325,Z=33326,Y=33327,K=33328,J=33329,Q=33330,$=33331,ee=33332,te=33333,re=33334,ae=33335,le=33336,se=33337,ne=33338,ie=33339,ce=33340,oe=36756,fe=36757,ue=36759,pe={Index:16,Vertex:32,Uniform:64,Dynamic:4096,Stream:8192},ge={TextureBinding:4,RenderAttachment:16},de={Red:1,Green:2,Blue:4,Alpha:8,All:15},be={D2:m,D2Array:35866,CubeMap:h,D3:32879},me={R8:q,R8SNORM:oe,R8UI:Q,R8I:J,R16UI:ee,R16I:$,RG8:H,RG8SNORM:fe,RG8UI:le,RG8I:ae,R32UI:re,R32I:te,RG16UI:ne,RG16I:se,RGBA8:A,SRGBA8:w,RGBA8SNORM:ue,RGBA8UI:U,RGBA8I:E,RGB10A2:T,RG32UI:ce,RG32I:ie,RGBA16UI:L,RGBA16I:_,RGBA32UI:W,RGBA32I:N,R16F:X,RG16F:Y,RG11B10F:G,RGBA16F:P,R32F:Z,RG32F:K,RGBA32F:k,Depth16:R,Depth24:I,Depth24Stencil8:z,Depth32F:V,Depth32FStencil8:j},he={ClampToEdge:F,Repeat:10497,MirrorRepeat:33648},xe={Nearest:b,Linear:9729},Se={Never:512,Less:513,Equal:514,LessEqual:515,Greater:516,NotEqual:517,GreaterEqual:518,Always:g},Fe={Vertex:1,Fragment:2},ye={Points:0,Lines:1,LineStrip:3,Triangles:4,TriangleStrip:5},Be={UInt16:o,UInt32:u},Re={CCW:2305,CW:2304},Me={None:0,Front:n,Back:i},Oe={Keep:d,Zero:0,Replace:7681,Invert:5386,Increment:7682,Decrement:7683,IncrementWrap:34055,DecrementWrap:34056},Ce={Zero:0,One:1,Src:768,OneMinusSrc:769,SrcAlpha:770,OneMinusSrcAlpha:771,Dst:774,OneMinusDst:775,DstAlpha:772,OneMinusDstAlpha:773,SrcAlphaSaturated:776,Constant:32769,OneMinusConstant:32770},De={Add:s,Subtract:32778,ReverseSubtract:32779,Min:32775,Max:32776},ve={Vertex:0,Instance:1},Ae={UI8x2:274,UI8x4:276,I8x2:4370,I8x4:4372,UNORM8x2:8466,UNORM8x4:8468,SNORM8x2:12562,SNORM8x4:12564,UI16x2:290,UI16x4:292,I16x2:4386,I16x4:4388,UNORM16x2:8482,UNORM16x4:8484,SNORM16x2:12578,SNORM16x4:12580,F16x2:546,F16x4:548,F32:577,F32x2:578,F32x3:579,F32x4:580},Te={Buffer:0,Sampler:1,Texture:2},Ie={Filtering:0,NonFiltering:1,Comparison:2},we={Float:0,Depth:1,Int:2,Uint:3},ke={X:0,NegativeX:1,Y:2,NegativeY:3,Z:4,NegativeZ:5},Pe={Fast:4353,Nice:4354};function Ge(e){return 32879===e||35866===e}function We(e){return(e>>4&15)*Le(e)}function Le(e){return 15&e}function Ue(e){switch(e>>4&511){case 36:return p;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return o;case 17:return 5121}return 0}function Ne(e){return!!(e>>13)}function _e(e){let t=0;const r=[];for(let a=0;a<e.length;++a){const l=[];let s=0;for(let r=0;r<e[a].attributes.length;++r){const n=e[a].attributes[r];l.push({format:n,offset:s,shaderLocation:t}),s+=We(n),++t}r.push({attributes:l,stride:s,stepMode:e[a].instanced?ve.Instance:ve.Vertex})}return r}function Ee(e){switch(e){case R:case I:case z:case V:case j:return!0}return!1}function Ve(e){switch(e){case q:case oe:case X:case Z:return 6403;case Q:case J:case ee:case $:case re:case te:return 36244;case H:case fe:case Y:case K:return 33319;case le:case ae:case ne:case se:case ce:case ie:return 33320;case A:case w:case ue:case T:case P:case k:return 6408;case U:case E:case L:case W:case _:case N:return 36249;case G:return 6407;case R:case I:case V:return 6402;case z:case j:return 34041}return 0}function je(e){switch(e){case q:case Q:case oe:case J:return 1;case ee:case $:case H:case le:case fe:case ae:case X:return 2;case re:case te:case Z:case ne:case se:case Y:case A:case w:case U:case ue:case E:case T:case G:return 4;case ce:case ie:case K:case L:case _:case P:return 8;case W:case N:case k:return 16;case R:return 2;case I:case z:case V:return 4;case j:return 8}return 0}function ze(e){switch(e){case q:case Q:case H:case le:case A:case w:case U:return 5121;case oe:case J:case fe:case ae:case ue:case E:return 5120;case ee:case ne:case L:return o;case $:case se:case _:return 5122;case re:case ce:case W:return u;case te:case ie:case N:return f;case T:return 33640;case X:case Y:case P:return 5131;case Z:case K:case k:return p;case G:return 35899;case R:return o;case I:return u;case z:return 34042;case V:return p;case j:return 36269}return 0}function qe(e){switch(e){case J:case $:case te:case ae:case se:case ie:case E:case _:case N:return f;case Q:case ee:case re:case le:case ne:case ce:case U:case L:case W:return u}return p}const He={TextureAnisotropic:1,TextureHalfFloatLinear:2,TextureFloatLinear:4,ColorBufferFloat:8},Xe={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float"},Ze=255,Ye=4294967295;function Ke(e,t={},r=0){const a=e.getContext("webgl2",t);if(a){let t=0;for(const e in Xe)r&+e&&a.getExtension(Xe[+e])&&(t|=+e);return{canvas:e,gl:a,features:t,pass:null,state:At(a),destroy(){this.gl.deleteFramebuffer(this.state.copyFrameBuffer)}}}return null}function Je(e){e.destroy(),e.state=At(e.gl)}function Qe(e){return e.gl.isContextLost()}function $e(e){return e.features}function et(e,t){const r=t.usage&pe.Uniform?35345:t.usage&pe.Index?34963:34962,a=t.usage&pe.Stream?35040:t.usage&pe.Dynamic?35048:35044,l=e.gl.createBuffer();return e.gl.bindBuffer(r,l),e.gl.bufferData(r,t.size,a),{gl:e.gl,glb:l,type:r,size:t.size,destroy(){this.gl.deleteBuffer(this.glb)}}}function tt(e,t){const r=t.sampleCount||1,a=t.dimension||m,l=t.format||A,s=!Ee(l)||(t.usage||0)&ge.TextureBinding,[n,i,c]=t.size||[1,1,1],o=a===h?6:a===m?1:c;let f=null,u=null;return(r>1||!s)&&(u=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(B,u),r>1?e.gl.renderbufferStorageMultisample(B,r,l,n,i):e.gl.renderbufferStorage(B,l,n,i)),s&&(f=e.gl.createTexture(),e.gl.activeTexture(S),e.gl.bindTexture(a,f),Ge(a)?e.gl.texStorage3D(a,t.mipLevelCount||1,l,n,i,o):e.gl.texStorage2D(a,t.mipLevelCount||1,l,n,i)),{gl:e.gl,glt:f,glrb:u,type:a,format:l,width:n,height:i,depth:o,samples:r,destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb)}}}function rt(e,t={}){const r=e.gl.createSampler();let a=t.minFilter||b;return t.mipmapFilter&&(a=t.mipmapFilter===b?a===b?9984:9985:a===b?9986:9987),e.gl.samplerParameteri(r,10241,a),e.gl.samplerParameteri(r,10240,t.magFilter||b),e.gl.samplerParameteri(r,10242,t.addressModeU||F),e.gl.samplerParameteri(r,10243,t.addressModeV||F),e.gl.samplerParameteri(r,32882,t.addressModeW||F),e.gl.samplerParameterf(r,33083,t.lodMaxClamp||32),e.gl.samplerParameterf(r,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(r,34892,34894),e.gl.samplerParameterf(r,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(r,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047))),{gls:r,gl:e.gl,destroy(){this.gl.deleteSampler(this.gls)}}}function at(e,t){const r=t.usage===Fe.Vertex?35633:35632,a=e.gl.createShader(r);return e.gl.shaderSource(a,t.code),e.gl.compileShader(a),{gl:e.gl,gls:a,destroy(){this.gl.deleteShader(this.gls)}}}function lt(e,t={}){let r=null;const l=[],s=t.depthStencil?t.depthStencil.texture:null,n=s&&function(e){switch(e){case 36168:case z:case j:return!0}return!1}(s.format)||!1;if(t.colors&&t.colors.length){r=e.gl.createFramebuffer(),e.gl.bindFramebuffer(y,r);for(let r=0;r<t.colors.length;++r)t.colors[r].view.texture.samples>1?e.gl.framebufferRenderbuffer(y,M+r,B,t.colors[r].view.texture.glrb):Tt(e.gl,M+r,t.colors[r].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>M+t))),s&&(s.glrb?e.gl.framebufferRenderbuffer(y,n?C:O,B,s.glrb):(a&&Ee(s.format),Tt(e.gl,n?C:O,t.depthStencil)));for(let r=0;r<t.colors.length;++r)l.push(t.colors[r].view.texture.samples>1?It(e.gl,M,t.colors[r].view):null);l.push(s&&s.samples>1&&s.glt?It(e.gl,n?C:O,t.depthStencil):null)}return{gl:e.gl,glfb:r,glrfb:l,depth:s,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){this.gl.deleteFramebuffer(this.glfb);for(const e of this.glrfb)this.gl.deleteFramebuffer(e)}}}function st(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function nt(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function it(e,t){const r=function(e,t,r){const a=e.gl.createProgram();return e.gl.attachShader(a,t),e.gl.attachShader(a,r),e.gl.linkProgram(a),e.gl.deleteShader(t),e.gl.deleteShader(r),a}(e,t.vertex.gls,t.fragment.gls),a=[],l={};let s=0,n=0;if(t.bindGroups){for(let i=0;i<t.bindGroups.length;++i){const c=t.bindGroups[i].entries;a.push([]);for(let t=0;t<c.length;++t){const o=c[t];let f=null,u=4294967295;o.type===Te.Buffer?(u=e.gl.getUniformBlockIndex(r,o.label),e.gl.uniformBlockBinding(r,u,s++)):o.type===Te.Texture&&(f=e.gl.getUniformLocation(r,o.label),l[o.label]=n++),a[i][o.binding]={...o,loc:f,index:u,slot:o.type===Te.Buffer?s-1:o.type===Te.Texture?n-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const r=t.bindGroups[e].entries;for(let t=0;t<r.length;++t)r[t].type===Te.Sampler&&l[r[t].label]&&(a[e][r[t].binding].slot=l[r[t].label])}}return{gl:e.gl,glp:r,buffers:t.buffers,cache:a,state:kt(t),destroy(){this.gl.deleteProgram(this.glp)}}}function ct(e,t,r,a=0){const l={done:!1};return function(e,t,r,a,l){const s=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),function(e,t,r,a){return new Promise(((r,a)=>{!function l(){const s=e.clientWaitSync(t,0,0);37149==s?a():37147==s?setTimeout(l,10):r()}()}))}(e,s).finally((()=>e.deleteSync(s))).then((()=>{const s=new Uint8Array(l);return e.bindBuffer(t,r),e.getBufferSubData(t,a,s,0,l),s}))}(e.gl,t.type,t.glb,a,r.byteLength).then((e=>r.set(e))).finally((()=>l.done=!0)),l}function ot(e,t,r,a=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,a,r)}function ft(e,t,r,a=t.size,l=0,s=0){e.gl.bindBuffer(36662,t.glb),e.gl.bindBuffer(36663,r.glb),e.gl.copyBufferSubData(36662,36663,l,s,a)}function ut(e,t,r=4352){e.gl.activeTexture(S),e.gl.bindTexture(t.type,t.glt),e.gl.hint(33170,r),e.gl.generateMipmap(t.type)}function pt(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},n,{offset:i=0,bytesPerRow:c,rowsPerImage:o=0},[f,u,p]=[t.width-a,t.height-l,t.depth-s]){const g=Ve(t.format),d=ze(t.format),b=t.type===h,m=b?x+s:t.type;e.gl.activeTexture(S),e.gl.bindTexture(t.type,t.glt);const F=je(t.format),y=o||u,B=Math.floor(c/F),R=i-i%c;if(e.gl.pixelStorei(32878,y),e.gl.pixelStorei(3314,B),e.gl.pixelStorei(3316,Math.floor(i%c/F)),e.gl.pixelStorei(D,0),e.gl.pixelStorei(32877,0),Ge(t.type))e.gl.texSubImage3D(m,r,a,l,s,f,u,p,t.format,d,n,R);else if(b)for(let t=s;t<s+p;++t)e.gl.pixelStorei(D,t*B*y),e.gl.texSubImage2D(m+t,r,a,l,f,u,g,d,n,R);else e.gl.texSubImage2D(m,r,a,l,f,u,g,d,n,R)}function gt(e,{src:t,origin:[r,a]=[0,0]},{texture:l,mipLevel:s=0,origin:[n,i,c]=[0,0,0]},[o,f]=[t.width-r,t.height-a]){const u=ze(l.format),p=l.type===h?x+c:l.type;e.gl.activeTexture(S),e.gl.bindTexture(l.type,l.glt),e.gl.pixelStorei(3316,r),e.gl.pixelStorei(D,a),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),Ge(l.type)?e.gl.texSubImage3D(p,s,n,i,c,o,f,1,l.format,u,t):e.gl.texSubImage2D(p,s,n,i,o,f,Ve(l.format),u,t)}function dt(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},{texture:n,mipLevel:i=0,origin:[c,o,f]=[0,0,0]},[u,p,g]=[t.width-a,t.height-l,t.depth-s]){const d=n.type===h,b=d?x+f:n.type;if(e.gl.activeTexture(S),e.gl.bindTexture(n.type,n.glt),e.gl.readBuffer(M),e.gl.bindFramebuffer(y,e.state.copyFrameBuffer),Ge(t.type)||t.type===h)for(let m=s;m<s+g;++m)Tt(e.gl,M,{texture:t,mipLevel:r,slice:m}),Ge(n.type)?e.gl.copyTexSubImage3D(b+(d?m:0),i,c,o,f,a,l,u,p):e.gl.copyTexSubImage2D(b+(d?m:0),i,c,o,a,l,u,p);else{const s=0;Tt(e.gl,M,{texture:t,mipLevel:r,slice:s}),Ge(n.type)?e.gl.copyTexSubImage3D(b+(d?s:0),i,c,o,f,a,l,u,p):e.gl.copyTexSubImage2D(b+(d?s:0),i,c,o,a,l,u,p)}e.gl.bindFramebuffer(y,e.pass?e.pass.glfb:null)}function bt(e,{texture:t,mipLevel:r=0,origin:[a,l,s]=[0,0,0]},n,{offset:i=0,bytesPerRow:c,rowsPerImage:o=0},[f,u,p]=[t.width-a,t.height-l,t.depth-s]){e.gl.bindBuffer(35051,n),e.gl.readBuffer(M),e.gl.bindFramebuffer(y,e.state.copyFrameBuffer);const g=ze(t.format),d=Ve(t.format),b=je(t.format),m=o||u,x=Math.floor(c/b),S=i-i%c;if(e.gl.pixelStorei(3330,x),e.gl.pixelStorei(3332,Math.floor(i%c/b)),e.gl.pixelStorei(3331,0),Ge(t.type)||t.type===h)for(let n=s;n<s+p;++n)Tt(e.gl,M,{texture:t,mipLevel:r,slice:n}),e.gl.readPixels(a,l,f,u,d,g,S+(n-s)*c*m);else{const s=0;Tt(e.gl,M,{texture:t,mipLevel:r,slice:s}),e.gl.readPixels(a,l,f,u,d,g,S)}e.gl.bindFramebuffer(y,e.pass?e.pass.glfb:null)}function mt(e,t){let r=e.gl.drawingBufferWidth,a=e.gl.drawingBufferHeight;t.color.length&&(r=t.color[0].width,a=t.color[0].height),e.gl.bindFramebuffer(y,t.glfb),e.gl.viewport(0,0,r,a),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Ut(e.gl,c,!1));let s=0;if(isNaN(t.clearDepth)||(s|=256,e.gl.clearDepth(t.clearDepth),Wt(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(s|=1024,e.gl.clearStencil(t.clearStencil),Lt(e.gl,e.state.state.stencilWriteMask,Ze),e.state.state.stencilWriteMask=Ze),Gt(e.gl,e.state.state.blendWriteMask,de.All),e.state.state.blendWriteMask=de.All,t.color.length){for(let r=0;r<t.color.length;++r)if(t.clearColors[r]){const a=qe(t.color[r].format);a===f?e.gl.clearBufferiv(v,r,t.clearColors[r]):a===u?e.gl.clearBufferuiv(v,r,t.clearColors[r]):e.gl.clearBufferfv(v,r,t.clearColors[r])}}else t.clearColor&&(s|=l,e.gl.clearColor(...t.clearColor));s&&e.gl.clear(s),e.pass=t}function ht(e,t={}){e.gl.bindFramebuffer(y,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Ut(e.gl,c,!1));let r=0;isNaN(t.clearDepth)||(r|=256,e.gl.clearDepth(t.clearDepth),Wt(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(r|=1024,e.gl.clearStencil(t.clearStencil),Lt(e.gl,e.state.state.stencilWriteMask,Ze),e.state.state.stencilWriteMask=Ze),t.clearColor&&(r|=l,e.gl.clearColor(...t.clearColor),Gt(e.gl,e.state.state.blendWriteMask,de.All),e.state.state.blendWriteMask=de.All),r&&e.gl.clear(r),e.pass=null}function xt(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&wt(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],l,M+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&wt(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}function St(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),Pt(e.gl,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const r=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)r[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let a=0;a<t.buffers.length;++a){const{attributes:l,stride:s,stepMode:n=0}=t.buffers[a],i=[];e.state.buffers[a]={glb:null,attributes:i,stride:s,step:n,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:c}of l)r[c]=(r[c]||0)+2,i.push({buffer:a,ptr:[c,Le(e),Ue(e),Ne(e),s,t],step:n})}for(let t=0;t<r.length;++t)2===r[t]?e.gl.enableVertexAttribArray(t):1===r[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}function Ft(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}function yt(e,t,r,a=0){const l=e.state.buffers[t];!l||l.glb===r.glb&&l.offset===a||(l.glb=r.glb,l.offset=a,l.instanceOffset=0,Nt(e.gl,l,a))}function Bt(e,t,r,l=[]){if(e.state.pipeline)for(let s=0,n=0;s<r.entries.length;++s){const i=r.entries[s],c=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][i.binding];if(c)if(a&&(i.buffer?(e.gl.getActiveUniformBlockParameter(e.state.pipeline.glp,c.index,35392),e.gl.getParameter(35380)):i.texture||i.sampler),i.buffer){let t=i.bufferOffset||0;c.bufferDynamicOffset&&(t+=l[n]||0,++n),e.gl.bindBufferRange(35345,c.slot,i.buffer.glb,t,i.bufferSize||i.buffer.size-t)}else i.texture?(e.gl.activeTexture(S+c.slot),e.gl.bindTexture(i.texture.type,i.texture.glt),e.gl.uniform1i(c.loc,c.slot)):i.sampler&&e.gl.bindSampler(c.slot,i.sampler.gls)}}function Rt(e,t,r=1,a=0,l=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==l&&(t.instanceOffset=l,Nt(e.gl,t,l*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,a,t,r)}function Mt(e,t,r=1,a=0,l=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==l&&(t.instanceOffset=l,Nt(e.gl,t,l*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,a*(e.state.state.indexFormat===o?2:4),r)}function Ot(e,t,r,a,l,s=0,n=1){e.gl.viewport(t,r,a,l),e.gl.depthRange(s,n)}function Ct(e,t,r,a,l){e.state.scissor||(Ut(e.gl,c,!0),e.state.scissor=!0),e.gl.scissor(t,r,a,l)}function Dt(e,t){e.gl.blendColor(...t)}function vt(e,t){if(e.state.stencilRef!==t){const{stencilFrontCompare:r,stencilBackCompare:a,stencilReadMask:l}=e.state.state;e.gl.stencilFuncSeparate(n,r,t,l),e.gl.stencilFuncSeparate(i,a,t,l),e.state.stencilRef=t}}function At(e){const t=kt();e.blendColor(1,1,1,1),Pt(e,t,t,0,!0);for(let t=0;t<16;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function Tt(e,t,{texture:r,slice:a=0,mipLevel:l=0}){if(Ge(r.type))e.framebufferTextureLayer(y,t,r.glt,l,a);else{const s=r.type===h?x+a:r.type;e.framebufferTexture2D(y,t,s,r.glt,l)}}function It(e,t,r){const a=e.createFramebuffer();return e.bindFramebuffer(y,a),Tt(e,t,r),a}function wt(e,t,r,a,l,s=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,r),e.readBuffer(s),e.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,l,b)}function kt(e={}){const t=e.primitive||{},r=e.depthStencil||{},{stencilFront:a={},stencilBack:l={}}=r,{sampleCount:n=1,alphaToCoverage:i=!1}=e.multisample||{},c=e.targets||{};let f=c.writeMask||de.All,u=c.blendColor||{},p=c.blendColor||{};return c.targets&&c.targets[0]&&(f=c.targets[0].writeMask||f,u=c.targets[0].blendColor||u,p=c.targets[0].blendAlpha||p),{sampleCount:n,alphaToCoverage:i,topology:t.topology||4,indexFormat:t.indexFormat||o,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:r.depthWrite||!1,depthFormat:r.format||R,depthCompare:r.depthCompare||g,depthBias:r.depthBias||0,depthBiasSlopeScale:r.depthBiasSlopeScale||0,stencil:!(!r.stencilFront&&!r.stencilBack),stencilFrontCompare:a.compare||g,stencilFrontFailOp:a.failOp||d,stencilFrontDepthFailOp:a.depthFailOp||d,stencilFrontPassOp:a.passOp||d,stencilBackCompare:l.compare||g,stencilBackFailOp:l.failOp||d,stencilBackDepthFailOp:l.depthFailOp||d,stencilBackPassOp:l.passOp||d,stencilReadMask:r.stencilReadMask||Ye,stencilWriteMask:r.stencilWriteMask||Ye,blend:!!e.targets,blendWriteMask:f,blendColorOp:u.operation||s,blendColorSrcFactor:u.srcFactor||1,blendColorDstFactor:u.dstFactor||0,blendAlphaOp:p.operation||s,blendAlphaSrcFactor:p.srcFactor||1,blendAlphaDstFactor:p.dstFactor||0}}function Pt(e,t,r,a=0,l=!1){let s=!1,c=0,o=0,f=0,u=0;c=r.frontFace,(l||t.frontFace!==c)&&e.frontFace(c),c=r.cullMode,(l||t.cullMode!==c)&&((s=0!==c)&&e.cullFace(c),Ut(e,2884,s)),s=r.alphaToCoverage,(l||t.alphaToCoverage!==s)&&Ut(e,32926,s),s=!!r.depth,(l||t.depth!==s)&&Ut(e,2929,s),(l||s)&&(Wt(e,t.depthWrite,r.depthWrite,l),c=r.depthCompare,(l||t.depthCompare!==c)&&e.depthFunc(c)),c=r.depthBiasSlopeScale,o=r.depthBias,(l||t.depthBiasSlopeScale!==c||t.depthBias!==o)&&(Ut(e,32823,!(!c&&!o)),e.polygonOffset(c,o)),s=!!r.stencil,(l||t.stencil!==s)&&Ut(e,2960,s),(l||s)&&(c=r.stencilReadMask,s=l||t.stencilReadMask!==c,o=r.stencilFrontCompare,(s||t.stencilFrontCompare!==o)&&e.stencilFuncSeparate(n,o,a,c),o=r.stencilBackCompare,(s||t.stencilBackCompare!==o)&&e.stencilFuncSeparate(i,o,a,c),c=r.stencilFrontFailOp,o=r.stencilFrontDepthFailOp,f=r.stencilFrontPassOp,(l||t.stencilFrontFailOp!==c||t.stencilFrontDepthFailOp!==o||t.stencilFrontPassOp!==f)&&e.stencilOpSeparate(n,c,o,f),c=r.stencilBackFailOp,o=r.stencilBackDepthFailOp,f=r.stencilBackPassOp,(l||t.stencilBackFailOp!==c||t.stencilBackDepthFailOp!==o||t.stencilBackPassOp!==f)&&e.stencilOpSeparate(i,c,o,f),Lt(e,t.stencilWriteMask,r.stencilWriteMask,l)),s=r.blend,(l||t.blend!==s)&&Ut(e,3042,s),(l||s)&&(c=r.blendColorSrcFactor,o=r.blendColorDstFactor,f=r.blendAlphaSrcFactor,u=r.blendAlphaDstFactor,(l||t.blendColorSrcFactor!==c||t.blendColorDstFactor!==o||t.blendAlphaSrcFactor!==f||t.blendAlphaDstFactor!==u)&&e.blendFuncSeparate(c,o,f,u),c=r.blendColorOp,o=r.blendAlphaOp,(l||t.blendColorOp!==c||t.blendAlphaOp!==o)&&e.blendEquationSeparate(c,o),Gt(e,t.blendWriteMask,r.blendWriteMask,l))}function Gt(e,t,r,a=!1){(a||t!==r)&&e.colorMask(!!(r&de.Red),!!(r&de.Green),!!(r&de.Blue),!!(r&de.Alpha))}function Wt(e,t,r,a=!1){(a||t!==r)&&e.depthMask(r)}function Lt(e,t,r,a=!1){(a||t!==r)&&e.stencilMask(r)}function Ut(e,t,r){r?e.enable(t):e.disable(t)}function Nt(e,t,r){e.bindBuffer(34962,t.glb);for(let a=0;a<t.attributes.length;++a){const{ptr:l,step:s}=t.attributes[a],n=[...l];n[5]+=r,e.vertexAttribPointer(...n),e.vertexAttribDivisor(l[0],s)}}return t})()},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mugl",[],t):"object"==typeof exports?exports.mugl=t():e.mugl=t();