var e,t;e=self,t=function(){return(()=>{var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AddressMode:()=>be,BindingType:()=>Te,BlendFactor:()=>Me,BlendOperation:()=>Ce,BufferUsage:()=>fe,ColorWrite:()=>de,CompareFunction:()=>xe,CubeMapFace:()=>Ie,CullMode:()=>we,FilterMode:()=>ye,FrontFace:()=>Be,IndexFormat:()=>ve,MUGL_DEBUG:()=>a,MipmapHint:()=>ke,PrimitiveTopology:()=>Se,SamplerBindingType:()=>Ue,ShaderStage:()=>Fe,StencilOperation:()=>Re,TextureDimension:()=>me,TextureFormat:()=>he,TextureSampleType:()=>Ae,TextureUsage:()=>pe,VertexFormat:()=>De,VertexStepMode:()=>Oe,WebAssemblyGL:()=>$t,WebGL:()=>r,WebGL2Feature:()=>He,vertexBufferLayouts:()=>Ee});var r={};e.r(r),e.d(r,{beginDefaultPass:()=>bt,beginRenderPass:()=>ht,copyBuffer:()=>ut,copyExternalImageToTexture:()=>pt,copyTexture:()=>dt,copyTextureToBuffer:()=>mt,createBindGroup:()=>lt,createBindGroupLayout:()=>nt,createBuffer:()=>et,createRenderPass:()=>st,createRenderPipeline:()=>it,createSampler:()=>rt,createShader:()=>at,createTexture:()=>tt,draw:()=>Bt,drawIndexed:()=>wt,generateMipmap:()=>gt,getDeviceFeatures:()=>$e,isDeviceLost:()=>Qe,readBuffer:()=>ot,requestWebGL2Device:()=>Ke,resetDevice:()=>Je,setBindGroup:()=>vt,setBlendConst:()=>Ct,setIndex:()=>Ft,setRenderPipeline:()=>xt,setScissorRect:()=>Mt,setStencilRef:()=>Ot,setVertex:()=>St,setViewport:()=>Rt,submitRenderPass:()=>yt,writeBuffer:()=>ct,writeTexture:()=>ft});const a=!1,s=16384,n=32774,l=1028,i=1029,o=3089,c=5123,u=5124,g=5125,f=5126,p=519,d=7680,m=9728,h=3553,b=34067,y=34069,x=33984,F=33071,S=36160,v=36161,B=33189,w=36064,R=36096,M=33306,C=3315,O=6144,D=32856,T=32857,U=33190,A=35907,I=34836,k=34842,P=35898,L=36208,G=36214,W=36220,N=36226,E=36232,_=36238,V=36012,z=36013,j=35056,q=33321,H=33323,X=33325,Z=33326,Y=33327,K=33328,J=33329,Q=33330,$=33331,ee=33332,te=33333,re=33334,ae=33335,se=33336,ne=33337,le=33338,ie=33339,oe=33340,ce=36756,ue=36757,ge=36759,fe={Index:16,Vertex:32,Uniform:64,Dynamic:4096,Stream:8192},pe={TextureBinding:4,RenderAttachment:16},de={Red:1,Green:2,Blue:4,Alpha:8,All:15},me={D2:h,D2Array:35866,CubeMap:b,D3:32879},he={R8:q,R8SNORM:ce,R8UI:Q,R8I:J,R16UI:ee,R16I:$,RG8:H,RG8SNORM:ue,RG8UI:se,RG8I:ae,R32UI:re,R32I:te,RG16UI:le,RG16I:ne,RGBA8:D,SRGBA8:A,RGBA8SNORM:ge,RGBA8UI:W,RGBA8I:_,RGB10A2:T,RG32UI:oe,RG32I:ie,RGBA16UI:G,RGBA16I:E,RGBA32UI:L,RGBA32I:N,R16F:X,RG16F:Y,RG11B10F:P,RGBA16F:k,R32F:Z,RG32F:K,RGBA32F:I,Depth16:B,Depth24:U,Depth24Stencil8:j,Depth32F:V,Depth32FStencil8:z},be={ClampToEdge:F,Repeat:10497,MirrorRepeat:33648},ye={Nearest:m,Linear:9729},xe={Never:512,Less:513,Equal:514,LessEqual:515,Greater:516,NotEqual:517,GreaterEqual:518,Always:p},Fe={Vertex:1,Fragment:2},Se={Points:0,Lines:1,LineStrip:3,Triangles:4,TriangleStrip:5},ve={UInt16:c,UInt32:g},Be={CCW:2305,CW:2304},we={None:0,Front:l,Back:i},Re={Keep:d,Zero:0,Replace:7681,Invert:5386,Increment:7682,Decrement:7683,IncrementWrap:34055,DecrementWrap:34056},Me={Zero:0,One:1,Src:768,OneMinusSrc:769,SrcAlpha:770,OneMinusSrcAlpha:771,Dst:774,OneMinusDst:775,DstAlpha:772,OneMinusDstAlpha:773,SrcAlphaSaturated:776,Constant:32769,OneMinusConstant:32770},Ce={Add:n,Subtract:32778,ReverseSubtract:32779,Min:32775,Max:32776},Oe={Vertex:0,Instance:1},De={UI8x2:274,UI8x4:276,I8x2:4370,I8x4:4372,UNORM8x2:8466,UNORM8x4:8468,SNORM8x2:12562,SNORM8x4:12564,UI16x2:290,UI16x4:292,I16x2:4386,I16x4:4388,UNORM16x2:8482,UNORM16x4:8484,SNORM16x2:12578,SNORM16x4:12580,F16x2:546,F16x4:548,F32:577,F32x2:578,F32x3:579,F32x4:580},Te={Buffer:0,Sampler:1,Texture:2},Ue={Filtering:0,NonFiltering:1,Comparison:2},Ae={Float:0,Depth:1,Int:2,Uint:3},Ie={X:0,NegativeX:1,Y:2,NegativeY:3,Z:4,NegativeZ:5},ke={Fast:4353,Nice:4354};function Pe(e){return 32879===e||35866===e}function Le(e){return(e>>4&15)*Ge(e)}function Ge(e){return 15&e}function We(e){switch(e>>4&511){case 36:return f;case 34:return 5131;case 274:return 5122;case 273:return 5120;case 18:return c;case 17:return 5121}return 0}function Ne(e){return!!(e>>13)}function Ee(e){let t=0;const r=[];for(let a=0;a<e.length;++a){const s=[];let n=0;for(let r=0;r<e[a].attributes.length;++r){const l=e[a].attributes[r];s.push({format:l,offset:n,shaderLocation:t}),n+=Le(l),++t}r.push({attributes:s,stride:n,stepMode:e[a].instanced?Oe.Instance:Oe.Vertex})}return r}function _e(e){switch(e){case B:case U:case j:case V:case z:return!0}return!1}function Ve(e){switch(e){case q:case ce:case X:case Z:return 6403;case Q:case J:case ee:case $:case re:case te:return 36244;case H:case ue:case Y:case K:return 33319;case se:case ae:case le:case ne:case oe:case ie:return 33320;case D:case A:case ge:case T:case k:case I:return 6408;case W:case _:case G:case L:case E:case N:return 36249;case P:return 6407;case B:case U:case V:return 6402;case j:case z:return 34041}return 0}function ze(e){switch(e){case q:case Q:case ce:case J:return 1;case ee:case $:case H:case se:case ue:case ae:case X:return 2;case re:case te:case Z:case le:case ne:case Y:case D:case A:case W:case ge:case _:case T:case P:return 4;case oe:case ie:case K:case G:case E:case k:return 8;case L:case N:case I:return 16;case B:return 2;case U:case j:case V:return 4;case z:return 8}return 0}function je(e){switch(e){case q:case Q:case H:case se:case D:case A:case W:return 5121;case ce:case J:case ue:case ae:case ge:case _:return 5120;case ee:case le:case G:return c;case $:case ne:case E:return 5122;case re:case oe:case L:return g;case te:case ie:case N:return u;case T:return 33640;case X:case Y:case k:return 5131;case Z:case K:case I:return f;case P:return 35899;case B:return c;case U:return g;case j:return 34042;case V:return f;case z:return 36269}return 0}function qe(e){switch(e){case J:case $:case te:case ae:case ne:case ie:case _:case E:case N:return u;case Q:case ee:case re:case se:case le:case oe:case W:case G:case L:return g}return f}const He={TextureAnisotropic:1,TextureHalfFloatLinear:2,TextureFloatLinear:4,ColorBufferFloat:8},Xe={1:"EXT_texture_filter_anisotropic",2:"OES_texture_half_float_linear",4:"OES_texture_float_linear",8:"EXT_color_buffer_float"},Ze=255,Ye=4294967295;function Ke(e,t={},r=0){const a=e.getContext("webgl2",t);if(a){let t=0;for(const e in Xe)r&+e&&a.getExtension(Xe[+e])&&(t|=+e);return{canvas:e,gl:a,features:t,pass:null,state:Dt(a),destroy(){this.gl.deleteFramebuffer(this.state.copyFrameBuffer)}}}return null}function Je(e){e.destroy(),e.state=Dt(e.gl)}function Qe(e){return e.gl.isContextLost()}function $e(e){return e.features}function et(e,t){const r=t.usage&fe.Uniform?35345:t.usage&fe.Index?34963:34962,a=t.usage&fe.Stream?35040:t.usage&fe.Dynamic?35048:35044,s=e.gl.createBuffer();return e.gl.bindBuffer(r,s),e.gl.bufferData(r,t.size,a),{gl:e.gl,glb:s,type:r,size:t.size,destroy(){this.gl.deleteBuffer(this.glb)}}}function tt(e,t){const r=t.sampleCount||1,a=t.dimension||h,s=t.format||D,n=!_e(s)||(t.usage||0)&pe.TextureBinding,[l,i,o]=t.size||[1,1,1],c=a===b?6:a===h?1:o;let u=null,g=null;return(r>1||!n)&&(g=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(v,g),r>1?e.gl.renderbufferStorageMultisample(v,r,s,l,i):e.gl.renderbufferStorage(v,s,l,i)),n&&(u=e.gl.createTexture(),e.gl.activeTexture(x),e.gl.bindTexture(a,u),Pe(a)?e.gl.texStorage3D(a,t.mipLevelCount||1,s,l,i,c):e.gl.texStorage2D(a,t.mipLevelCount||1,s,l,i)),{gl:e.gl,glt:u,glrb:g,type:a,format:s,width:l,height:i,depth:c,samples:r,destroy(){this.gl.deleteTexture(this.glt),this.gl.deleteRenderbuffer(this.glrb)}}}function rt(e,t={}){const r=e.gl.createSampler();let a=t.minFilter||m;return t.mipmapFilter&&(a=t.mipmapFilter===m?a===m?9984:9985:a===m?9986:9987),e.gl.samplerParameteri(r,10241,a),e.gl.samplerParameteri(r,10240,t.magFilter||m),e.gl.samplerParameteri(r,10242,t.addressModeU||F),e.gl.samplerParameteri(r,10243,t.addressModeV||F),e.gl.samplerParameteri(r,32882,t.addressModeW||F),e.gl.samplerParameterf(r,33083,t.lodMaxClamp||32),e.gl.samplerParameterf(r,33082,t.lodMinClamp||0),t.compare&&(e.gl.samplerParameterf(r,34892,34894),e.gl.samplerParameterf(r,34893,t.compare)),(t.maxAnisotropy||1)>1&&e.gl.samplerParameterf(r,34046,Math.min(t.maxAnisotropy||1,e.gl.getParameter(34047))),{gls:r,gl:e.gl,destroy(){this.gl.deleteSampler(this.gls)}}}function at(e,t){const r=t.usage===Fe.Vertex?35633:35632,a=e.gl.createShader(r);return e.gl.shaderSource(a,t.code),e.gl.compileShader(a),{gl:e.gl,gls:a,destroy(){this.gl.deleteShader(this.gls)}}}function st(e,t={}){let r=null;const s=[],n=t.depthStencil?t.depthStencil.texture:null,l=n&&function(e){switch(e){case 36168:case j:case z:return!0}return!1}(n.format)||!1;if(t.colors&&t.colors.length){r=e.gl.createFramebuffer(),e.gl.bindFramebuffer(S,r);for(let r=0;r<t.colors.length;++r)t.colors[r].view.texture.samples>1?e.gl.framebufferRenderbuffer(S,w+r,v,t.colors[r].view.texture.glrb):Tt(e.gl,w+r,t.colors[r].view);t.colors.length>1&&e.gl.drawBuffers(t.colors.map(((e,t)=>w+t))),n&&(n.glrb?e.gl.framebufferRenderbuffer(S,l?M:R,v,n.glrb):(a&&_e(n.format),Tt(e.gl,l?M:R,t.depthStencil)));for(let r=0;r<t.colors.length;++r)s.push(t.colors[r].view.texture.samples>1?Ut(e.gl,w,t.colors[r].view):null);s.push(n&&n.samples>1&&n.glt?Ut(e.gl,l?M:R,t.depthStencil):null)}return{gl:e.gl,glfb:r,glrfb:s,depth:n,color:t.colors?t.colors.map((e=>e.view.texture)):[],clearColors:t.colors?t.colors.map((e=>e.clear)):[],clearColor:t.clearColor,clearDepth:t.clearDepth,clearStencil:t.clearStencil,destroy(){this.gl.deleteFramebuffer(this.glfb);for(const e of this.glrfb)this.gl.deleteFramebuffer(e)}}}function nt(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function lt(e,t){return{entries:t.entries.map(((e,t)=>({binding:t,...e}))),destroy(){}}}function it(e,t){const r=function(e,t,r){const a=e.gl.createProgram();return e.gl.attachShader(a,t),e.gl.attachShader(a,r),e.gl.linkProgram(a),e.gl.deleteShader(t),e.gl.deleteShader(r),a}(e,t.vertex.gls,t.fragment.gls),a=[],s={};let n=0,l=0;if(t.bindGroups){for(let i=0;i<t.bindGroups.length;++i){const o=t.bindGroups[i].entries;a.push([]);for(let t=0;t<o.length;++t){const c=o[t];let u=null,g=4294967295;c.type===Te.Buffer?(g=e.gl.getUniformBlockIndex(r,c.label),e.gl.uniformBlockBinding(r,g,n++)):c.type===Te.Texture&&(u=e.gl.getUniformLocation(r,c.label),s[c.label]=l++),a[i][c.binding]={...c,loc:u,index:g,slot:c.type===Te.Buffer?n-1:c.type===Te.Texture?l-1:0}}}for(let e=0;e<t.bindGroups.length;++e){const r=t.bindGroups[e].entries;for(let t=0;t<r.length;++t)r[t].type===Te.Sampler&&s[r[t].label]&&(a[e][r[t].binding].slot=s[r[t].label])}}return{gl:e.gl,glp:r,buffers:t.buffers,cache:a,state:It(t),destroy(){this.gl.deleteProgram(this.glp)}}}function ot(e,t,r,a=0){const s={done:!1};return function(e,t,r,a,s){const n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),function(e,t,r,a){return new Promise(((r,a)=>{!function s(){const n=e.clientWaitSync(t,0,0);37149==n?a():37147==n?setTimeout(s,10):r()}()}))}(e,n).finally((()=>e.deleteSync(n))).then((()=>{const n=new Uint8Array(s);return e.bindBuffer(t,r),e.getBufferSubData(t,a,n,0,s),n}))}(e.gl,t.type,t.glb,a,r.byteLength).then((e=>r.set(e))).finally((()=>s.done=!0)),s}function ct(e,t,r,a=0){e.gl.bindBuffer(t.type,t.glb),e.gl.bufferSubData(t.type,a,r)}function ut(e,t,r,a=t.size,s=0,n=0){e.gl.bindBuffer(36662,t.glb),e.gl.bindBuffer(36663,r.glb),e.gl.copyBufferSubData(36662,36663,s,n,a)}function gt(e,t,r=4352){e.gl.activeTexture(x),e.gl.bindTexture(t.type,t.glt),e.gl.hint(33170,r),e.gl.generateMipmap(t.type)}function ft(e,{texture:t,mipLevel:r=0,origin:[a,s,n]=[0,0,0]},l,{offset:i=0,bytesPerRow:o,rowsPerImage:c=0},[u,g,f]=[t.width-a,t.height-s,t.depth-n]){const p=Ve(t.format),d=je(t.format),m=t.type===b,h=m?y+n:t.type;e.gl.activeTexture(x),e.gl.bindTexture(t.type,t.glt);const F=ze(t.format),S=c||g,v=Math.floor(o/F),B=i-i%o;if(e.gl.pixelStorei(32878,S),e.gl.pixelStorei(3314,v),e.gl.pixelStorei(3316,Math.floor(i%o/F)),e.gl.pixelStorei(C,0),e.gl.pixelStorei(32877,0),Pe(t.type))e.gl.texSubImage3D(h,r,a,s,n,u,g,f,t.format,d,l,B);else if(m)for(let t=n;t<n+f;++t)e.gl.pixelStorei(C,t*v*S),e.gl.texSubImage2D(h+t,r,a,s,u,g,p,d,l,B);else e.gl.texSubImage2D(h,r,a,s,u,g,p,d,l,B)}function pt(e,{src:t,origin:[r,a]=[0,0]},{texture:s,mipLevel:n=0,origin:[l,i,o]=[0,0,0]},[c,u]=[t.width-r,t.height-a]){const g=je(s.format),f=s.type===b?y+o:s.type;e.gl.activeTexture(x),e.gl.bindTexture(s.type,s.glt),e.gl.pixelStorei(3316,r),e.gl.pixelStorei(C,a),e.gl.pixelStorei(32877,0),e.gl.pixelStorei(32878,0),Pe(s.type)?e.gl.texSubImage3D(f,n,l,i,o,c,u,1,s.format,g,t):e.gl.texSubImage2D(f,n,l,i,c,u,Ve(s.format),g,t)}function dt(e,{texture:t,mipLevel:r=0,origin:[a,s,n]=[0,0,0]},{texture:l,mipLevel:i=0,origin:[o,c,u]=[0,0,0]},[g,f,p]=[t.width-a,t.height-s,t.depth-n]){const d=l.type===b,m=d?y+u:l.type;if(e.gl.activeTexture(x),e.gl.bindTexture(l.type,l.glt),e.gl.readBuffer(w),e.gl.bindFramebuffer(S,e.state.copyFrameBuffer),Pe(t.type)||t.type===b)for(let h=n;h<n+p;++h)Tt(e.gl,w,{texture:t,mipLevel:r,slice:h}),Pe(l.type)?e.gl.copyTexSubImage3D(m+(d?h:0),i,o,c,u,a,s,g,f):e.gl.copyTexSubImage2D(m+(d?h:0),i,o,c,a,s,g,f);else{const n=0;Tt(e.gl,w,{texture:t,mipLevel:r,slice:n}),Pe(l.type)?e.gl.copyTexSubImage3D(m+(d?n:0),i,o,c,u,a,s,g,f):e.gl.copyTexSubImage2D(m+(d?n:0),i,o,c,a,s,g,f)}e.gl.bindFramebuffer(S,e.pass?e.pass.glfb:null)}function mt(e,{texture:t,mipLevel:r=0,origin:[a,s,n]=[0,0,0]},l,{offset:i=0,bytesPerRow:o,rowsPerImage:c=0},[u,g,f]=[t.width-a,t.height-s,t.depth-n]){e.gl.bindBuffer(35051,l),e.gl.readBuffer(w),e.gl.bindFramebuffer(S,e.state.copyFrameBuffer);const p=je(t.format),d=Ve(t.format),m=ze(t.format),h=c||g,y=Math.floor(o/m),x=i-i%o;if(e.gl.pixelStorei(3330,y),e.gl.pixelStorei(3332,Math.floor(i%o/m)),e.gl.pixelStorei(3331,0),Pe(t.type)||t.type===b)for(let l=n;l<n+f;++l)Tt(e.gl,w,{texture:t,mipLevel:r,slice:l}),e.gl.readPixels(a,s,u,g,d,p,x+(l-n)*o*h);else{const n=0;Tt(e.gl,w,{texture:t,mipLevel:r,slice:n}),e.gl.readPixels(a,s,u,g,d,p,x)}e.gl.bindFramebuffer(S,e.pass?e.pass.glfb:null)}function ht(e,t){let r=e.gl.drawingBufferWidth,a=e.gl.drawingBufferHeight;t.color.length&&(r=t.color[0].width,a=t.color[0].height),e.gl.bindFramebuffer(S,t.glfb),e.gl.viewport(0,0,r,a),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Wt(e.gl,o,!1));let n=0;if(isNaN(t.clearDepth)||(n|=256,e.gl.clearDepth(t.clearDepth),Lt(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(n|=1024,e.gl.clearStencil(t.clearStencil),Gt(e.gl,e.state.state.stencilWriteMask,Ze),e.state.state.stencilWriteMask=Ze),Pt(e.gl,e.state.state.blendWriteMask,de.All),e.state.state.blendWriteMask=de.All,t.color.length){for(let r=0;r<t.color.length;++r)if(t.clearColors[r]){const a=qe(t.color[r].format);a===u?e.gl.clearBufferiv(O,r,t.clearColors[r]):a===g?e.gl.clearBufferuiv(O,r,t.clearColors[r]):e.gl.clearBufferfv(O,r,t.clearColors[r])}}else t.clearColor&&(n|=s,e.gl.clearColor(...t.clearColor));n&&e.gl.clear(n),e.pass=t}function bt(e,t={}){e.gl.bindFramebuffer(S,null),e.gl.viewport(0,0,e.gl.drawingBufferWidth,e.gl.drawingBufferHeight),e.gl.depthRange(0,1),e.state.scissor&&(e.state.scissor=!1,Wt(e.gl,o,!1));let r=0;isNaN(t.clearDepth)||(r|=256,e.gl.clearDepth(t.clearDepth),Lt(e.gl,e.state.state.depthWrite,!0),e.state.state.depthWrite=!0),isNaN(t.clearStencil)||(r|=1024,e.gl.clearStencil(t.clearStencil),Gt(e.gl,e.state.state.stencilWriteMask,Ze),e.state.state.stencilWriteMask=Ze),t.clearColor&&(r|=s,e.gl.clearColor(...t.clearColor),Pt(e.gl,e.state.state.blendWriteMask,de.All),e.state.state.blendWriteMask=de.All),r&&e.gl.clear(r),e.pass=null}function yt(e){if(e.pass){for(let t=0;t<e.pass.color.length;++t)e.pass.glrfb[t]&&At(e.gl,e.pass.glfb,e.pass.glrfb[t],e.pass.color[t],s,w+t);const t=e.pass.glrfb[e.pass.glrfb.length-1];e.pass.depth&&t&&At(e.gl,e.pass.glfb,t,e.pass.depth,1280)}e.pass=null}function xt(e,t){if(e.state.pipeline===t)return;e.state.pipeline&&e.state.pipeline.glp===t.glp||e.gl.useProgram(t.glp),kt(e.gl,e.state.state,t.state,e.state.stencilRef),Object.assign(e.state.state,t.state);const r=[];for(const{attributes:t}of e.state.buffers)for(const{ptr:e}of t)r[e[0]]=1;e.state.buffers=Array(t.buffers.length);for(let a=0;a<t.buffers.length;++a){const{attributes:s,stride:n,stepMode:l=0}=t.buffers[a],i=[];e.state.buffers[a]={glb:null,attributes:i,stride:n,step:l,offset:0,instanceOffset:0};for(const{format:e,offset:t,shaderLocation:o}of s)r[o]=(r[o]||0)+2,i.push({buffer:a,ptr:[o,Ge(e),We(e),Ne(e),n,t],step:l})}for(let t=0;t<r.length;++t)2===r[t]?e.gl.enableVertexAttribArray(t):1===r[t]&&e.gl.disableVertexAttribArray(t);e.state.pipeline=t}function Ft(e,t){t.glb!==e.state.index&&e.gl.bindBuffer(34963,e.state.index=t.glb)}function St(e,t,r,a=0){const s=e.state.buffers[t];!s||s.glb===r.glb&&s.offset===a||(s.glb=r.glb,s.offset=a,s.instanceOffset=0,Nt(e.gl,s,a))}function vt(e,t,r,s=[]){if(e.state.pipeline)for(let n=0,l=0;n<r.entries.length;++n){const i=r.entries[n],o=e.state.pipeline.cache[t]&&e.state.pipeline.cache[t][i.binding];if(o)if(a&&(i.buffer?(e.gl.getActiveUniformBlockParameter(e.state.pipeline.glp,o.index,35392),e.gl.getParameter(35380)):i.texture||i.sampler),i.buffer){let t=i.bufferOffset||0;o.bufferDynamicOffset&&(t+=s[l]||0,++l),e.gl.bindBufferRange(35345,o.slot,i.buffer.glb,t,i.bufferSize||i.buffer.size-t)}else i.texture?(e.gl.activeTexture(x+o.slot),e.gl.bindTexture(i.texture.type,i.texture.glt),e.gl.uniform1i(o.loc,o.slot)):i.sampler&&e.gl.bindSampler(o.slot,i.sampler.gls)}}function Bt(e,t,r=1,a=0,s=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==s&&(t.instanceOffset=s,Nt(e.gl,t,s*t.stride));e.gl.drawArraysInstanced(e.state.state.topology,a,t,r)}function wt(e,t,r=1,a=0,s=0){for(const t of e.state.buffers)t.step&&t.instanceOffset!==s&&(t.instanceOffset=s,Nt(e.gl,t,s*t.stride));e.gl.drawElementsInstanced(e.state.state.topology,t,e.state.state.indexFormat,a*(e.state.state.indexFormat===c?2:4),r)}function Rt(e,t,r,a,s,n=0,l=1){e.gl.viewport(t,r,a,s),e.gl.depthRange(n,l)}function Mt(e,t,r,a,s){e.state.scissor||(Wt(e.gl,o,!0),e.state.scissor=!0),e.gl.scissor(t,r,a,s)}function Ct(e,t){e.gl.blendColor(...t)}function Ot(e,t){if(e.state.stencilRef!==t){const{stencilFrontCompare:r,stencilBackCompare:a,stencilReadMask:s}=e.state.state;e.gl.stencilFuncSeparate(l,r,t,s),e.gl.stencilFuncSeparate(i,a,t,s),e.state.stencilRef=t}}function Dt(e){const t=It();e.blendColor(1,1,1,1),kt(e,t,t,0,!0);for(let t=0;t<16;++t)e.disableVertexAttribArray(t);return e.pixelStorei(3333,1),e.pixelStorei(3317,1),{copyFrameBuffer:e.createFramebuffer(),buffers:[],state:t,pipeline:null,index:null,stencilRef:0,scissor:!1}}function Tt(e,t,{texture:r,slice:a=0,mipLevel:s=0}){if(Pe(r.type))e.framebufferTextureLayer(S,t,r.glt,s,a);else{const n=r.type===b?y+a:r.type;e.framebufferTexture2D(S,t,n,r.glt,s)}}function Ut(e,t,r){const a=e.createFramebuffer();return e.bindFramebuffer(S,a),Tt(e,t,r),a}function At(e,t,r,a,s,n=36064){e.bindFramebuffer(36008,t),e.bindFramebuffer(36009,r),e.readBuffer(n),e.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,s,m)}function It(e={}){const t=e.primitive||{},r=e.depthStencil||{},{stencilFront:a={},stencilBack:s={}}=r,{sampleCount:l=1,alphaToCoverage:i=!1}=e.multisample||{},o=e.targets||{};let u=o.writeMask||de.All,g=o.blendColor||{},f=o.blendColor||{};return o.targets&&o.targets[0]&&(u=o.targets[0].writeMask||u,g=o.targets[0].blendColor||g,f=o.targets[0].blendAlpha||f),{sampleCount:l,alphaToCoverage:i,topology:t.topology||4,indexFormat:t.indexFormat||c,frontFace:t.frontFace||2305,cullMode:t.cullMode||0,depth:!!e.depthStencil,depthWrite:r.depthWrite||!1,depthFormat:r.format||B,depthCompare:r.depthCompare||p,depthBias:r.depthBias||0,depthBiasSlopeScale:r.depthBiasSlopeScale||0,stencil:!(!r.stencilFront&&!r.stencilBack),stencilFrontCompare:a.compare||p,stencilFrontFailOp:a.failOp||d,stencilFrontDepthFailOp:a.depthFailOp||d,stencilFrontPassOp:a.passOp||d,stencilBackCompare:s.compare||p,stencilBackFailOp:s.failOp||d,stencilBackDepthFailOp:s.depthFailOp||d,stencilBackPassOp:s.passOp||d,stencilReadMask:r.stencilReadMask||Ye,stencilWriteMask:r.stencilWriteMask||Ye,blend:!!e.targets,blendWriteMask:u,blendColorOp:g.operation||n,blendColorSrcFactor:g.srcFactor||1,blendColorDstFactor:g.dstFactor||0,blendAlphaOp:f.operation||n,blendAlphaSrcFactor:f.srcFactor||1,blendAlphaDstFactor:f.dstFactor||0}}function kt(e,t,r,a=0,s=!1){let n=!1,o=0,c=0,u=0,g=0;o=r.frontFace,(s||t.frontFace!==o)&&e.frontFace(o),o=r.cullMode,(s||t.cullMode!==o)&&((n=0!==o)&&e.cullFace(o),Wt(e,2884,n)),n=r.alphaToCoverage,(s||t.alphaToCoverage!==n)&&Wt(e,32926,n),n=!!r.depth,(s||t.depth!==n)&&Wt(e,2929,n),(s||n)&&(Lt(e,t.depthWrite,r.depthWrite,s),o=r.depthCompare,(s||t.depthCompare!==o)&&e.depthFunc(o)),o=r.depthBiasSlopeScale,c=r.depthBias,(s||t.depthBiasSlopeScale!==o||t.depthBias!==c)&&(Wt(e,32823,!(!o&&!c)),e.polygonOffset(o,c)),n=!!r.stencil,(s||t.stencil!==n)&&Wt(e,2960,n),(s||n)&&(o=r.stencilReadMask,n=s||t.stencilReadMask!==o,c=r.stencilFrontCompare,(n||t.stencilFrontCompare!==c)&&e.stencilFuncSeparate(l,c,a,o),c=r.stencilBackCompare,(n||t.stencilBackCompare!==c)&&e.stencilFuncSeparate(i,c,a,o),o=r.stencilFrontFailOp,c=r.stencilFrontDepthFailOp,u=r.stencilFrontPassOp,(s||t.stencilFrontFailOp!==o||t.stencilFrontDepthFailOp!==c||t.stencilFrontPassOp!==u)&&e.stencilOpSeparate(l,o,c,u),o=r.stencilBackFailOp,c=r.stencilBackDepthFailOp,u=r.stencilBackPassOp,(s||t.stencilBackFailOp!==o||t.stencilBackDepthFailOp!==c||t.stencilBackPassOp!==u)&&e.stencilOpSeparate(i,o,c,u),Gt(e,t.stencilWriteMask,r.stencilWriteMask,s)),n=r.blend,(s||t.blend!==n)&&Wt(e,3042,n),(s||n)&&(o=r.blendColorSrcFactor,c=r.blendColorDstFactor,u=r.blendAlphaSrcFactor,g=r.blendAlphaDstFactor,(s||t.blendColorSrcFactor!==o||t.blendColorDstFactor!==c||t.blendAlphaSrcFactor!==u||t.blendAlphaDstFactor!==g)&&e.blendFuncSeparate(o,c,u,g),o=r.blendColorOp,c=r.blendAlphaOp,(s||t.blendColorOp!==o||t.blendAlphaOp!==c)&&e.blendEquationSeparate(o,c),Pt(e,t.blendWriteMask,r.blendWriteMask,s))}function Pt(e,t,r,a=!1){(a||t!==r)&&e.colorMask(!!(r&de.Red),!!(r&de.Green),!!(r&de.Blue),!!(r&de.Alpha))}function Lt(e,t,r,a=!1){(a||t!==r)&&e.depthMask(r)}function Gt(e,t,r,a=!1){(a||t!==r)&&e.stencilMask(r)}function Wt(e,t,r){r?e.enable(t):e.disable(t)}function Nt(e,t,r){e.bindBuffer(34962,t.glb);for(let a=0;a<t.attributes.length;++a){const{ptr:s,step:n}=t.attributes[a],l=[...s];l[5]+=r,e.vertexAttribPointer(...l),e.vertexAttribDivisor(s[0],n)}}let Et,_t;const Vt=2097151,zt=2**32;function jt(e,t){return(t&Vt)*zt+(e>>>0)}function qt(e){return e>>>0}Et=Symbol.iterator;class Ht{constructor(){this.generations=[],this.freeList=[]}[Et](){return this.values()}get size(){return this.generations.length-this.freeList.length}clear(){this.generations.length=0,this.freeList.length=0}create(){let e,t;return this.freeList.length>0?(e=this.freeList.pop(),t=Math.abs(this.generations[e]),this.generations[e]=t):(e=this.generations.length,t=e?0:1,this.generations.push(t)),jt(e,t)}delete(e){if(!this.has(e))return!1;const t=qt(e);let r=-(this.generations[t]+1&Vt);return t||r||++r,this.generations[t]=r,this.freeList.push(t),!0}forEach(e,t){let r=0;for(const a of this.values())e.call(t,a,r,this),r+=1}has(e){return qt(e)<this.generations.length&&function(e){return e/zt&Vt}(e)===this.generations[qt(e)]}*values(){for(let e=0;e<this.generations.length;++e){const t=this.generations[e];this.generations[e]>=0&&(yield jt(e,t))}}}_t=Symbol.iterator;class Xt{constructor(){this.allocator=new Ht,this.data=[]}[_t](){return this.entries()}add(e){const t=this.allocator.create();return this.data[qt(t)]=e,t}clear(){this.allocator.clear(),this.data.length=0}delete(e){return!!this.allocator.delete(e)&&(delete this.data[qt(e)],!0)}*entries(){for(const e of this.allocator.values())yield[e,this.data[qt(e)]]}forEach(e,t){this.allocator.forEach((r=>{e.call(t,this.data[qt(r)],r,this)}),t)}get(e){return this.has(e)?this.data[qt(e)]:void 0}has(e){return this.allocator.has(e)}keys(){return this.allocator.values()}*values(){for(const e of this.allocator.values())yield this.data[qt(e)]}}const Zt=new TextDecoder("utf-8");let Yt=new DataView(new ArrayBuffer(0));function Kt(e){return Yt.buffer!==e.buffer&&(Yt=new DataView(e.buffer)),Yt}function Jt(e,t,r){return Zt.decode(new Uint8Array(e.buffer,t,r))}const Qt=r;function $t(){const e=new Xt,t=new Xt,r={},a=new Xt,s={},n=new Xt;function l(e){const t=n.get(e);t&&(t.destroy(),n.delete(e))}const i={memory:null,"is-future-done"(t){const r=e.get(t);if(r){if(!r.done)return!1;e.delete(t)}return!0},"create-image"(e,r){const a=new Image;return a.crossOrigin="anonymous",a.src=Jt(i.memory,e,r),t.add(a)},"get-image-by-id"(e,a){const s=Jt(i.memory,e,a);if(r[s])return r[s];const n=document.getElementById(s);return n?r[s]=t.add(n):0},"delete-image"(e){t.delete(e)},"get-image-width"(e){var r;return(null===(r=t.get(e))||void 0===r?void 0:r.width)||0},"get-image-height"(e){var r;return(null===(r=t.get(e))||void 0===r?void 0:r.height)||0},"get-canvas-by-id"(e,t){const r=Jt(i.memory,e,t);if(s[r])return s[r];const n=document.getElementById(r);return n?s[r]=a.add(n):0},"get-canvas-width"(e){var t;return(null===(t=a.get(e))||void 0===t?void 0:t.width)||0},"get-canvas-height"(e){var t;return(null===(t=a.get(e))||void 0===t?void 0:t.height)||0},"webgl-request-device"(e,t,r){const s=a.get(e);if(s){const e=Ke(s,{alpha:!!(1&(l=t)),antialias:!!(2&l),depth:!!(4&l),desynchronized:!!(8&l),failIfMajorPerformanceCaveat:!!(16&l),powerPreference:32&l?"high-performance":"low-power",premultipliedAlpha:!!(64&l),preserveDrawingBuffer:!!(128&l),stencil:!!(256&l)},r);if(e)return n.add(e)}var l;return 0},"webgl-generate-mipmap"(e,t,r){gt(n.get(e),n.get(t),r)},"reset-device"(e){Qt.resetDevice(n.get(e))},"delete-device":l,"is-device-lost":e=>Qt.isDeviceLost(n.get(e)),"get-device-features":e=>Qt.getDeviceFeatures(n.get(e)),"create-buffer"(e,t,r){const a=Qt.createBuffer(n.get(e),{size:t>>>0,usage:r>>>0});return n.add(a)},"delete-buffer":l,"create-texture"(e,t,r,a,s,l,i,o,c){const u=Qt.createTexture(n.get(e),{size:[t>>>0,r>>>0,a>>>0],mipLevelCount:s>>>0,sampleCount:l>>>0,dimension:i>>>0,format:o>>>0,usage:c>>>0});return n.add(u)},"delete-texture":l,"create-sampler"(e,t,r,a,s,l,i,o,c,u,g){const f=Qt.createSampler(n.get(e),{addressModeU:t>>>0,addressModeV:r>>>0,addressModeW:a>>>0,magFilter:s>>>0,minFilter:l>>>0,mipmapFilter:i>>>0,lodMinClamp:o,lodMaxClamp:c,compare:u>>>0,maxAnisotropy:g>>>0});return n.add(f)},"delete-sampler":l,"create-shader"(e,t,r,a){const s=Qt.createShader(n.get(e),{code:Jt(i.memory,t,r),usage:a>>>0});return n.add(s)},"delete-shader":l,"create-bind-group-layout"(e,t,r){const a=[];for(let e=0;e<r;e++){const r=t+32*e,s=Kt(i.memory).getUint32(r+0,!0),n=Kt(i.memory).getUint32(r+4,!0),l=Kt(i.memory).getUint8(r+16);let o=!1,c=Ue.Filtering,u=Ae.Float,g=me.D2,f=!1;switch(l){case Te.Buffer:o=!!Kt(i.memory).getUint8(r+20);break;case Te.Sampler:c=Kt(i.memory).getUint32(r+20,!0)>>>0;break;case Te.Texture:u=Kt(i.memory).getUint32(r+20,!0)>>>0,g=Kt(i.memory).getUint32(r+24,!0)>>>0,f=!!Kt(i.memory).getUint8(r+28);break;default:throw new RangeError("invalid variant discriminant for BindingType")}a.push({label:Jt(i.memory,s,n),binding:Kt(i.memory).getUint32(r+8,!0)>>>0,visibility:Kt(i.memory).getUint32(r+12,!0)>>>0,type:l,bufferDynamicOffset:o,samplerType:c,textureSampleType:u,textureDimension:g,textureMultisampled:f})}const s=Qt.createBindGroupLayout(n.get(e),{entries:a});return n.add(s)},"delete-bind-group-layout":l,"create-bind-group"(e,t,r,a){const s=[];for(let e=0;e<a;e++){const t=r+24*e;let a=null,l=0,o=0,c=null,u=null;switch(Kt(i.memory).getUint8(t+4)){case Te.Buffer:a=n.get(Kt(i.memory).getFloat64(t+8,!0)),l=Kt(i.memory).getUint32(t+16,!0),o=Kt(i.memory).getUint32(t+20,!0);break;case Te.Sampler:c=n.get(Kt(i.memory).getFloat64(t+8,!0));break;case Te.Texture:u=n.get(Kt(i.memory).getFloat64(t+8,!0));break;default:throw new RangeError("invalid variant discriminant for BindingResource")}s.push({binding:Kt(i.memory).getUint32(t+0,!0),buffer:a,bufferOffset:l,bufferSize:o,sampler:c,texture:u})}const l=Qt.createBindGroup(n.get(e),{layout:n.get(t),entries:s});return n.add(l)},"delete-bind-group":l,"create-render-pipeline"(e,t,r,a,s,l,o,c,u,g,f,p,d,m,h,b,y,x,F,S,v,B,w,R,M,C,O,D,T,U,A,I,k,P,L,G,W,N,E,_,V){const z=[];for(let e=0;e<s;e++){const t=a+12*e;z.push({format:Kt(i.memory).getUint32(t+0,!0),offset:Kt(i.memory).getUint32(t+4,!0),shaderLocation:Kt(i.memory).getUint32(t+8,!0)})}const j=[];for(let e=0;e<o;e++){const t=l+16*e,r=Kt(i.memory).getUint32(t+0,!0),a=Kt(i.memory).getUint32(t+4,!0);j.push({attributes:z.slice(r,r+a),stride:Kt(i.memory).getUint32(t+8,!0),stepMode:Kt(i.memory).getUint32(t+12,!0)})}const q=[];for(let e=0;e<u;e++){const t=c+8*e;q.push(n.get(Kt(i.memory).getFloat64(t+0,!0)))}const H=[];for(let e=0;e<P;e++){const t=k+32*e;H.push({format:Kt(i.memory).getUint32(t+0,!0)>>>0,writeMask:Kt(i.memory).getUint32(t+4,!0)>>>0,blendColor:{operation:Kt(i.memory).getUint32(t+8,!0)>>>0,srcFactor:Kt(i.memory).getUint32(t+12,!0)>>>0,dstFactor:Kt(i.memory).getUint32(t+16,!0)>>>0},blendAlpha:{operation:Kt(i.memory).getUint32(t+20,!0)>>>0,srcFactor:Kt(i.memory).getUint32(t+24,!0)>>>0,dstFactor:Kt(i.memory).getUint32(t+28,!0)>>>0}})}const X=Qt.createRenderPipeline(n.get(e),{vertex:n.get(t),fragment:n.get(r),buffers:j,bindGroups:q,primitive:{topology:g>>>0,indexFormat:f>>>0,frontFace:p>>>0,cullMode:d>>>0},multisample:{sampleCount:m>>>0,alphaToCoverage:!!h},depthStencil:b?{format:y>>>0,depthWrite:!!x,depthCompare:F>>>0,stencilFront:{compare:S>>>0,failOp:v>>>0,depthFailOp:B>>>0,passOp:w>>>0},stencilBack:{compare:R>>>0,failOp:M>>>0,depthFailOp:C>>>0,passOp:O>>>0},stencilReadMask:D>>>0,stencilWriteMask:T>>>0,depthBias:U,depthBiasSlopeScale:A,depthBiasClamp:I}:null,targets:{writeMask:L>>>0,blendColor:{operation:G>>>0,srcFactor:W>>>0,dstFactor:N>>>0},blendAlpha:{operation:E>>>0,srcFactor:_>>>0,dstFactor:V>>>0},targets:H}});return n.add(X)},"delete-render-pipeline":l,"create-render-pass"(e,t,r,a,s,l,o,c,u,g,f,p,d){let m;switch(c){case 0:m={clearDepth:t,clearStencil:r,clearColor:isNaN(a)?null:[a,s,l,o]};break;case 1:{const e=[];for(let t=0;t<d;t++){const r=p+32*t,a=[Kt(i.memory).getFloat32(r+16,!0),Kt(i.memory).getFloat32(r+20,!0),Kt(i.memory).getFloat32(r+24,!0),Kt(i.memory).getFloat32(r+28,!0)];e.push({view:{texture:n.get(Kt(i.memory).getFloat64(r+0,!0)),mipLevel:Kt(i.memory).getUint32(r+8,!0),slice:Kt(i.memory).getUint32(r+12,!0)},clear:isNaN(a[0])?null:a})}m={clearDepth:t,clearStencil:r,colors:e,depthStencil:{texture:n.get(u),mipLevel:g>>>0,slice:f>>>0}};break}default:throw new RangeError("invalid variant discriminant for RenderPassDescriptor")}const h=Qt.createRenderPass(n.get(e),m);return n.add(h)},"delete-render-pass":l,"read-buffer"(t,r,a,s,l){const o=Qt.readBuffer(n.get(t),n.get(r),new Uint8Array(i.memory.buffer.slice(s,s+1*l),a>>>0));return e.add(o)},"write-buffer"(e,t,r,a,s){Qt.writeBuffer(n.get(e),n.get(t),new Uint8Array(i.memory.buffer.slice(r,r+1*a)),s>>>0)},"copy-buffer"(e,t,r,a,s,l){Qt.copyBuffer(n.get(e),n.get(t),n.get(r),a>>>0,s>>>0,l>>>0)},"write-texture"(e,t,r,a,s,l,o,c,u,g,f,p,d,m){Qt.writeTexture(n.get(e),{texture:n.get(t),mipLevel:r>>>0,origin:[a>>>0,s>>>0,l>>>0]},new Uint8Array(i.memory.buffer.slice(o,o+1*c)),{offset:u>>>0,bytesPerRow:g>>>0,rowsPerImage:f>>>0},[p>>>0,d>>>0,m>>>0])},"copy-external-image-to-texture"(e,r,a,s,l,i,o,c,u,g,f){Qt.copyExternalImageToTexture(n.get(e),{src:t.get(r),origin:[a>>>0,s>>>0]},{texture:n.get(l),mipLevel:i>>>0,origin:[o>>>0,c>>>0,u>>>0]},[g>>>0,f>>>0])},"copy-texture"(e,t,r,a,s,l,i,o,c,u,g,f,p,d){Qt.copyTexture(n.get(e),{texture:n.get(t),mipLevel:r>>>0,origin:[a>>>0,s>>>0,l>>>0]},{texture:n.get(i),mipLevel:o>>>0,origin:[c>>>0,u>>>0,g>>>0]},[f>>>0,p>>>0,d>>>0])},"copy-texture-to-buffer"(e,t,r,a,s,l,i,o,c,u,g,f,p){Qt.copyTextureToBuffer(n.get(e),{texture:n.get(t),mipLevel:r>>>0,origin:[a>>>0,s>>>0,l>>>0]},n.get(i),{offset:o>>>0,bytesPerRow:c>>>0,rowsPerImage:u>>>0},[g>>>0,f>>>0,p>>>0])},"begin-render-pass"(e,t){Qt.beginRenderPass(n.get(e),n.get(t))},"begin-default-pass"(e,t,r,a,s,l,i){Qt.beginDefaultPass(n.get(e),{clearColor:isNaN(a)?null:[a,s,l,i],clearDepth:t,clearStencil:r})},"submit-render-pass"(e){Qt.submitRenderPass(n.get(e))},"set-render-pipeline"(e,t){Qt.setRenderPipeline(n.get(e),n.get(t))},"set-index"(e,t){Qt.setIndex(n.get(e),n.get(t))},"set-vertex"(e,t,r,a){Qt.setVertex(n.get(e),t>>>0,n.get(r),a>>>0)},"set-bind-group"(e,t,r,a,s){Qt.setBindGroup(n.get(e),t>>>0,n.get(r),new Uint32Array(i.memory.buffer.slice(a,a+4*s)))},draw(e,t,r,a,s){Qt.draw(n.get(e),t>>>0,r>>>0,a>>>0,s>>>0)},"draw-indexed"(e,t,r,a,s){Qt.drawIndexed(n.get(e),t>>>0,r>>>0,a>>>0,s>>>0)},"set-viewport"(e,t,r,a,s,l,i){Qt.setViewport(n.get(e),t>>>0,r>>>0,a>>>0,s>>>0,l>>>0,i>>>0)},"set-scissor-rect"(e,t,r,a,s){Qt.setScissorRect(n.get(e),t>>>0,r>>>0,a>>>0,s>>>0)},"set-blend-const"(e,t,r,a,s){Qt.setBlendConst(n.get(e),[t,r,a,s])},"set-stencil-ref"(e,t){Qt.setStencilRef(n.get(e),t>>>0)}};return i}return t})()},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mugl",[],t):"object"==typeof exports?exports.mugl=t():e.mugl=t();